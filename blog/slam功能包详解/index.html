<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>slam功能包详解 | 晓</title><meta name="keywords" content="晓氏集团"><meta name="author" content="one by one"><meta name="copyright" content="one by one"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="简介base_control(底盘)robot_vision雷达文件夹robot_navigationrobot_simulation base_control(底盘)                               launch文件将机器人本身硬件名字和发布订阅的话题更名并设置串口通信参数波特率和端口启动base_control功能包下的base_control节点来控制机器人底盘默">
<meta property="og:type" content="article">
<meta property="og:title" content="slam功能包详解">
<meta property="og:url" content="http://154181.xyz/blog/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="晓">
<meta property="og:description" content="简介base_control(底盘)robot_vision雷达文件夹robot_navigationrobot_simulation base_control(底盘)                               launch文件将机器人本身硬件名字和发布订阅的话题更名并设置串口通信参数波特率和端口启动base_control功能包下的base_control节点来控制机器人底盘默">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://154181.xyz/media/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3.webp">
<meta property="article:published_time" content="2023-02-02T03:21:55.000Z">
<meta property="article:modified_time" content="2023-08-09T01:51:26.359Z">
<meta property="article:author" content="one by one">
<meta property="article:tag" content="晓氏集团">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://154181.xyz/media/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3.webp"><link rel="shortcut icon" href="/media/2.jpg"><link rel="canonical" href="http://154181.xyz/blog/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'slam功能包详解',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: false,
  postUpdate: '2023-08-09 09:51:26'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://www.fomal.cc/static/css/runtime.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/todolist"><span> 计划表</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 我的</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><i class="fa-fw fas fa-book"></i><span> 作业</span></a></li><li><a class="site-page child" href="/myimage/"><i class="fa-fw fas fa-camera"></i><span> 图片</span></a></li><li><a class="site-page child" href="/note"><i class="fa-fw fas fa-file-circle-check"></i><span> 笔记</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://985.so/bmx9r"><i class="fa-fw fas fa-headphones"></i><span> 夜听电脑版</span></a></li><li><a class="site-page child" href="/music-friends"><i class="fa-fw fas fa-headphones"></i><span> 音乐库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 传送门</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="http://985.so/mwb21"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/media/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3.webp')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">晓</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/todolist"><span> 计划表</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 我的</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><i class="fa-fw fas fa-book"></i><span> 作业</span></a></li><li><a class="site-page child" href="/myimage/"><i class="fa-fw fas fa-camera"></i><span> 图片</span></a></li><li><a class="site-page child" href="/note"><i class="fa-fw fas fa-file-circle-check"></i><span> 笔记</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://985.so/bmx9r"><i class="fa-fw fas fa-headphones"></i><span> 夜听电脑版</span></a></li><li><a class="site-page child" href="/music-friends"><i class="fa-fw fas fa-headphones"></i><span> 音乐库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 传送门</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="http://985.so/mwb21"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">slam功能包详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-02T03:21:55.000Z" title="发表于 2023-02-02 11:21:55">2023-02-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-08-09T01:51:26.359Z" title="更新于 2023-08-09 09:51:26">2023-08-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1/">毕业设计</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">14.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>74分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="slam功能包详解"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">简介</button></li><li class="tab"><button type="button" data-href="#test4-2">base_control(底盘)</button></li><li class="tab"><button type="button" data-href="#test4-3">robot_vision</button></li><li class="tab"><button type="button" data-href="#test4-4">雷达文件夹</button></li><li class="tab"><button type="button" data-href="#test4-5">robot_navigation</button></li><li class="tab"><button type="button" data-href="#test4-6">robot_simulation</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><details class="folding-tag" green><summary> base_control(底盘) </summary>
              <div class='content'>
              <ol><li><p class='p blue'>launch文件</p><br>将机器人本身硬件名字和发布订阅的话题更名并设置串口通信参数波特率和端口<br>启动base_control功能包下的base_control节点来控制机器人底盘<br>默认更名：<br>baudrate:——————115200<br>port:————————/dev/move_base<br>base_id:——————-base_footprint<br>odom_id:——————-odom<br>imu_id:———————imu<br>odom_topic:—————odom<br>imu_topic:—————-imu<br>battery_topic:———-battery<br>cmd_vel_topic:———-cmd_vel(ros自带的终端控制电机话题-不停的发布)<br>当需要控制机器人移动时可以向这个话题里写数据<a target="_blank" rel="noopener" href="http://wiki.ros.org/Robots/TIAGo/Tutorials/motions/cmd_vel">http://wiki.ros.org/Robots/TIAGo/Tutorials/motions/cmd_vel</a><br>ackermann_cmd_topic:-ackermann_cmd<br>imu和雷达不发布话题,不订阅ackermann话题<br>launch文件输入robot_name参数后以上除了波特率和端口，其余改为robot_name/()<br>eg: robot_name/base_footprint</li><li><p class='p blue'>base_control.py文件</p><br>打开串口,<br>编写定时器回调函数timerOdomC—timerBatteryCB—timerSonarCB—timerIMUCB当定时器时间到了就执行这四个函数(经过定时器回调函数timerCommunicationCB解析)分别从串口获取odom,电池,超声波,imu信息数据并发布话题，同时发布base_link-odom,Sonar-base_link,imu-base_link坐标关系<br>当终端的键盘控制节点启动就会自动发布cmd_vel,编写订阅函数当里面有东西时执行回调函数cmdCB,复制vel_cmd里存的信息，根据串口通讯进行转换再通过串口写入底盘</li></ol>
              </div>
            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><details class="folding-tag" green><summary> package.xml文件 </summary>
              <div class='content'>
              <ol><li><p class='p blue'>package.xml用来做功能包的描述，它内容包含有功能包名，版本号，功能包功能描述，作者联系邮箱，开源协议等等。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指明xml语法的版本</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line">&lt;package&gt;</span><br><span class="line"><span class="comment">//指明xml对应的功能包名</span></span><br><span class="line">  &lt;name&gt;base_control&lt;/name&gt;</span><br><span class="line">  <span class="comment">//维护的版本-自定义，每次维护一次可以改一下</span></span><br><span class="line">  &lt;version&gt;<span class="number">1.3</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">  <span class="comment">//对功能包的描述</span></span><br><span class="line">  &lt;description&gt;The base_control package&lt;/description&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- One maintainer tag required, multiple allowed, one person per tag --&gt; </span><br><span class="line">  &lt;!-- Example:  --&gt;</span><br><span class="line">  &lt;!-- &lt;maintainer email=<span class="string">&quot;jane.doe@example.com&quot;</span>&gt;Jane Doe&lt;/maintainer&gt; --&gt;</span><br><span class="line">  <span class="comment">//包的作者和联系方式</span></span><br><span class="line">  &lt;maintainer email=<span class="string">&quot;liu.fuzhi@bingda-robot.com&quot;</span>&gt;FuZhi, Liu&lt;/maintainer&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- One license tag required, multiple allowed, one license per tag --&gt;</span><br><span class="line">  &lt;!-- Commonly used license strings: --&gt;</span><br><span class="line">  &lt;!--   BSD, MIT, Boost Software License, GPLv2, GPLv3, LGPLv2<span class="number">.1</span>, LGPLv3 --&gt;</span><br><span class="line">  <span class="comment">//开源证书</span></span><br><span class="line">  &lt;license&gt;Apache <span class="number">2.0</span>&lt;/license&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- Url tags are optional, but multiple are allowed, one per tag --&gt;</span><br><span class="line">  &lt;!-- Optional attribute type can be: website, bugtracker, <span class="keyword">or</span> repository --&gt;</span><br><span class="line">  &lt;!-- Example: --&gt;</span><br><span class="line">  &lt;!-- &lt;url type=<span class="string">&quot;website&quot;</span>&gt;http:<span class="comment">//wiki.ros.org/base_control&lt;/url&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- Author tags are optional, multiple are allowed, one per tag --&gt;</span><br><span class="line">  &lt;!-- Authors <span class="keyword">do</span> <span class="keyword">not</span> have to be maintainers, but could be --&gt;</span><br><span class="line">  &lt;!-- Example: --&gt;</span><br><span class="line">  &lt;!-- &lt;author email=<span class="string">&quot;jane.doe@example.com&quot;</span>&gt;Jane Doe&lt;/author&gt; --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- The *_depend tags are used to specify dependencies --&gt;</span><br><span class="line">  &lt;!-- Dependencies can be catkin packages <span class="keyword">or</span> system dependencies --&gt;</span><br><span class="line">  &lt;!-- Examples: --&gt;</span><br><span class="line">  &lt;!-- Use build_depend <span class="keyword">for</span> packages you need at compile time: --&gt;</span><br><span class="line">  &lt;!--   &lt;build_depend&gt;message_generation&lt;/build_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- Use buildtool_depend <span class="keyword">for</span> build tool packages: --&gt;</span><br><span class="line">  &lt;!--   &lt;buildtool_depend&gt;catkin&lt;/buildtool_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- Use run_depend <span class="keyword">for</span> packages you need at runtime: --&gt;</span><br><span class="line">  &lt;!--   &lt;run_depend&gt;message_runtime&lt;/run_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- Use test_depend <span class="keyword">for</span> packages you need only <span class="keyword">for</span> testing: --&gt;</span><br><span class="line">  &lt;!--   &lt;test_depend&gt;gtest&lt;/test_depend&gt; --&gt;</span><br><span class="line">  <span class="comment">//run_depend是用来帮助rosdep这个工具解决依赖项的问题</span></span><br><span class="line">  &lt;run_depend&gt;rospy&lt;/run_depend&gt; </span><br><span class="line">  &lt;run_depend&gt;tf&lt;/run_depend&gt; </span><br><span class="line">  &lt;run_depend&gt;geometry_msgs&lt;/run_depend&gt; </span><br><span class="line">  &lt;run_depend&gt;nav_msgs&lt;/run_depend&gt; </span><br><span class="line">  &lt;run_depend&gt;sensor_msgs&lt;/run_depend&gt; </span><br><span class="line">  &lt;run_depend&gt;ackermann_msgs&lt;/run_depend&gt; </span><br><span class="line">  &lt;run_depend&gt;teleop_twist_keyboard&lt;/run_depend&gt; </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  &lt;buildtool_depend&gt;catkin&lt;/buildtool_depend&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- The <span class="keyword">export</span> tag contains other, unspecified, tags --&gt;</span><br><span class="line">  &lt;<span class="keyword">export</span>&gt;</span><br><span class="line">    &lt;!-- Other tools can request additional information be placed here --&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/<span class="keyword">export</span>&gt;</span><br><span class="line">&lt;/package&gt;</span><br></pre></td></tr></table></figure></li></ol>
              </div>
            </details>
<details class="folding-tag" blue><summary> base_control.launch </summary>
              <div class='content'>
              <ol><li><p class='p blue'>arg标签</p><br>arg标签是用来在launch文件中声明参数的，在launch中声明过的参数都可以在启动launch文件时传入已声明过的参数。我们在终端输入roslaunch base_control base_control.launch然后按TAB键补全就能看到可传入的参数列表。default的内容则是对参数赋值。如无参数传入则使用launch文件中定义的值。也可以在启动launch文件时传入参数的值。例如传入pub_imu的值为true：<br>roslaunch base_control base_control.launch pub_imu:=ture</li><li><p class='p blue'>group标签</p><br>group标签会将group里的内容划分成一个组，在launch中使用if unless作为判断语句。判断符合第一个条件则执行第一个group中的内容，否则则执行第二个group的内容。</li><li><p class='p blue'>node标签</p><br>node标签包括了要执行的节点的名称name、该节点所在的包名pkg，节点的可执行文件type以及输出方式output，“screen”表示输出在当前终端屏幕。</li><li><p class='p blue'>param标签</p><br>节点中有param标签，它的作用也是声明参数。param和arg的区别在于，param声明的变量是节点所接收的，而arg的参数是launch文件所接收的。这里利用param标签设置了传入节点的参数，这些参数的值是通过value直接传入的固定值。例如：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;param name=<span class="string">&quot;baudrate&quot;</span>   value=<span class="string">&quot;115200&quot;</span>/&gt;  </span><br><span class="line">&lt;param name=&quot;port&quot;  value=&#x27;/dev/move_base&#x27;/&gt;</span><br></pre></td></tr></table></figure>也可以是通过value传入的一个参数<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;param name=<span class="string">&quot;base_id&quot;</span>    value=<span class="string">&quot;$(arg base_frame)&quot;</span>/&gt;</span><br><span class="line"><span class="comment">//这里base_id这个参数的值就是launch文件中arg标签声明的参数base_frame</span></span><br></pre></td></tr></table></figure></li><li><p class='p blue'>ns</p><br>ns是ros下的命名空间机制。使用命名空间后，比如<group ns="$(arg robot_name)">会在话题名前加上robot_name这个变量所对应的参数值。以odom话题为例如果传入的robot_name是robot1，查看话题列表显示的就会是/robot1/odom。这样是为例便于支持多机器人，防止话题名重名。</li><li><p class='p blue'>代码注释：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指明xml版本</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line"></span><br><span class="line">&lt;launch&gt;</span><br><span class="line"><span class="comment">//传入机器人名字，机器人坐标系名称：imu和Odom类似都用来测位姿变化本次只用了odom</span></span><br><span class="line">    &lt;!-- support multi robot --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;robot_name&quot;</span> <span class="keyword">default</span>=<span class="string">&quot;&quot;</span>/&gt;   &lt;!-- support multi robot --&gt;</span><br><span class="line">    &lt;!-- robot frame --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;base_frame&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;base_footprint&quot;</span> /&gt;    </span><br><span class="line">    &lt;arg name=<span class="string">&quot;odom_frame&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;odom&quot;</span> /&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;imu_frame&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;imu&quot;</span> /&gt; </span><br><span class="line"> <span class="comment">//给机器人硬件odom ,imu,电池，发布的话题名字改为odom,imu,battery  </span></span><br><span class="line">    &lt;!-- pub topic --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;odom_topic&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;odom&quot;</span> /&gt;&lt;!-- <span class="keyword">do</span> NOT use <span class="string">&#x27;/&#x27;</span> in topic name--&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;imu_topic&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;imu&quot;</span> /&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;battery_topic&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;battery&quot;</span> /&gt;</span><br><span class="line">    &lt;!-- sub topic --&gt;</span><br><span class="line"><span class="comment">//给终端发布的控制速度话题,ackermann机器人控制话题命名为cmd_vel,ackermann_cmd</span></span><br><span class="line">    &lt;arg name=<span class="string">&quot;cmd_vel_topic&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;cmd_vel&quot;</span> /&gt; &lt;!-- <span class="keyword">do</span> NOT use <span class="string">&#x27;/&#x27;</span> in topic name--&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;ackermann_cmd_topic&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;ackermann_cmd&quot;</span> /&gt;</span><br><span class="line">    &lt;!-- config param --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;pub_imu&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;False&quot;</span> /&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;sub_ackermann&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;False&quot;</span> /&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;pub_sonar&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;False&quot;</span> /&gt;</span><br><span class="line">    &lt;!-- base control node --&gt;</span><br><span class="line"><span class="comment">//因为默认机器人名字为空，所以执行第一个group里的内容</span></span><br><span class="line">    &lt;!--ros <span class="keyword">namespace</span> name can NOT be empty,so need evaluate use multi robot <span class="keyword">or</span> <span class="keyword">not</span>--&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;$(eval robot_name == &#x27;&#x27;)&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//启动base_control功能包下的base_control节点来控制机器人底盘</span></span><br><span class="line">        &lt;node name=<span class="string">&quot;base_control&quot;</span>   pkg=<span class="string">&quot;base_control&quot;</span>  type=<span class="string">&quot;base_control.py&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//给base_control节点传入参数</span></span><br><span class="line">    <span class="comment">//波特率，端口--通信用的</span></span><br><span class="line"></span><br><span class="line">            &lt;param name=<span class="string">&quot;baudrate&quot;</span>   value=<span class="string">&quot;115200&quot;</span>/&gt;  </span><br><span class="line">            &lt;param name=&quot;port&quot;  value=&#x27;/dev/move_base&#x27;/&gt;</span><br><span class="line">    <span class="comment">//底盘、odom、imu这些硬件命名为某某坐标系--引用了上面的base_footprint，odom，imu</span></span><br><span class="line">            &lt;param name=<span class="string">&quot;base_id&quot;</span>    value=<span class="string">&quot;$(arg base_frame)&quot;</span>/&gt; &lt;!-- base_link name --&gt;</span><br><span class="line">            &lt;param name=<span class="string">&quot;odom_id&quot;</span>    value=<span class="string">&quot;$(arg odom_frame)&quot;</span>/&gt;      &lt;!-- odom link name --&gt;</span><br><span class="line">            &lt;param name=<span class="string">&quot;imu_id&quot;</span>    value=<span class="string">&quot;$(arg imu_frame)&quot;</span>/&gt;      &lt;!-- imu link name --&gt;</span><br><span class="line">    <span class="comment">//odom、imu、电池这些硬件发布的话题命名为--引用了上面的odom，imu,battery</span></span><br><span class="line">            &lt;param name=<span class="string">&quot;odom_topic&quot;</span> value=<span class="string">&quot;$(arg odom_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">            &lt;param name=<span class="string">&quot;imu_topic&quot;</span> value=<span class="string">&quot;$(arg imu_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">            &lt;param name=<span class="string">&quot;battery_topic&quot;</span> value=<span class="string">&quot;$(arg battery_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">    <span class="comment">//终端发布的控制速度话题命名为--引用了上面的cmd_vel,ackermann_cmd</span></span><br><span class="line">            &lt;param name=<span class="string">&quot;cmd_vel_topic&quot;</span> value=<span class="string">&quot;$(arg cmd_vel_topic)&quot;</span>/&gt; </span><br><span class="line">            &lt;param name=<span class="string">&quot;ackermann_cmd_topic&quot;</span> value=<span class="string">&quot;$(arg ackermann_cmd_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">    <span class="comment">//imu和雷达硬件参数（发送话题）改false</span></span><br><span class="line">            &lt;param name=<span class="string">&quot;pub_imu&quot;</span> value=<span class="string">&quot;$(arg pub_imu)&quot;</span>/&gt; &lt;!-- pub imu topic <span class="keyword">or</span> <span class="keyword">not</span> --&gt;</span><br><span class="line">            &lt;param name=<span class="string">&quot;pub_sonar&quot;</span> value=<span class="string">&quot;$(arg pub_sonar)&quot;</span>/&gt; &lt;!-- pub sonar topic <span class="keyword">or</span> <span class="keyword">not</span> --&gt;</span><br><span class="line">    <span class="comment">//不订阅ackermann话题       </span></span><br><span class="line">            &lt;param name=<span class="string">&quot;sub_ackermann&quot;</span> value=<span class="string">&quot;$(arg sub_ackermann)&quot;</span>/&gt; &lt;!-- sub ackermann topic <span class="keyword">or</span> <span class="keyword">not</span> --&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;--&gt;</span><br><span class="line">    <span class="comment">//如果给该launch文件robot_name参数赋值不为空则执行下列</span></span><br><span class="line">    &lt;group unless=<span class="string">&quot;$(eval robot_name == &#x27;&#x27;)&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//命名空间后会在话题名前加上robot_name这个变量所对应的参数值。以odom话题为例如果传入的robot_name是robot1，查看话题列表显示的就会是/robot1/odom</span></span><br><span class="line">        &lt;group ns=<span class="string">&quot;$(arg robot_name)&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//启动base_control功能包下的base_control节点来控制机器人底盘</span></span><br><span class="line">            &lt;node name=<span class="string">&quot;base_control&quot;</span>   pkg=<span class="string">&quot;base_control&quot;</span>  type=<span class="string">&quot;base_control.py&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//给base_control节点传入参数</span></span><br><span class="line">    <span class="comment">//波特率，端口--通信用的 </span></span><br><span class="line">                &lt;param name=<span class="string">&quot;baudrate&quot;</span>   value=<span class="string">&quot;115200&quot;</span>/&gt;  </span><br><span class="line">                &lt;param name=&quot;port&quot;  value=&#x27;/dev/move_base&#x27;/&gt;</span><br><span class="line">    <span class="comment">//底盘、odom、imu这些硬件命名为机器人名字/某某坐标系--引用了上面的robot_name/base_footprint，robot_name/odom，robot_name/imu</span></span><br><span class="line">                &lt;param name=<span class="string">&quot;base_id&quot;</span>    value=<span class="string">&quot;$(arg robot_name)/$(arg base_frame)&quot;</span>/&gt; &lt;!-- base_link name --&gt;</span><br><span class="line">                &lt;param name=<span class="string">&quot;odom_id&quot;</span>    value=<span class="string">&quot;$(arg robot_name)/$(arg odom_frame)&quot;</span>/&gt;      &lt;!-- odom link name --&gt;</span><br><span class="line">                &lt;param name=<span class="string">&quot;imu_id&quot;</span>    value=<span class="string">&quot;$(arg robot_name)/$(arg imu_frame)&quot;</span>/&gt;      &lt;!-- imu link name --&gt;</span><br><span class="line">    <span class="comment">//odom、imu、电池这些硬件发布的话题命名为--引用了上面的robot_name/odom，robot_name/imu,robot_name/battery</span></span><br><span class="line">                &lt;param name=<span class="string">&quot;odom_topic&quot;</span> value=<span class="string">&quot;$(arg odom_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">                &lt;param name=<span class="string">&quot;imu_topic&quot;</span> value=<span class="string">&quot;$(arg imu_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">                &lt;param name=<span class="string">&quot;battery_topic&quot;</span> value=<span class="string">&quot;$(arg battery_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">    <span class="comment">//终端发布的控制速度话题命名为--引用了上面的robot_name/cmd_vel,robot_name/ackermann_cmd</span></span><br><span class="line">                &lt;param name=<span class="string">&quot;cmd_vel_topic&quot;</span> value=<span class="string">&quot;$(arg cmd_vel_topic)&quot;</span>/&gt; </span><br><span class="line">                &lt;param name=<span class="string">&quot;ackermann_cmd_topic&quot;</span> value=<span class="string">&quot;$(arg robot_name)$(arg ackermann_cmd_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">    <span class="comment">//imu和雷达硬件参数（发送话题）改false</span></span><br><span class="line">                &lt;param name=<span class="string">&quot;pub_imu&quot;</span> value=<span class="string">&quot;$(arg pub_imu)&quot;</span>/&gt; &lt;!-- pub imu topic <span class="keyword">or</span> <span class="keyword">not</span> --&gt;</span><br><span class="line">                &lt;param name=<span class="string">&quot;pub_sonar&quot;</span> value=<span class="string">&quot;$(arg pub_sonar)&quot;</span>/&gt; &lt;!-- pub sonar topic <span class="keyword">or</span> <span class="keyword">not</span> --&gt;</span><br><span class="line">    <span class="comment">//不订阅ackermann话题  </span></span><br><span class="line">                &lt;param name=<span class="string">&quot;sub_ackermann&quot;</span> value=<span class="string">&quot;$(arg sub_ackermann)&quot;</span>/&gt; &lt;!-- sub ackermann topic <span class="keyword">or</span> <span class="keyword">not</span> --&gt;</span><br><span class="line">            &lt;/node&gt;</span><br><span class="line">        &lt;/group&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>
              </div>
            </details>
<details class="folding-tag" green><summary> base_control.py文件 </summary>
              <div class='content'>
              <ol><li><p class='p blue'>指明脚本解释器，编码模式，开源证书，载入依赖包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding=gbk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copyright 2019 Wechange Tech.</span></span><br><span class="line"><span class="comment"># Developer: FuZhi, Liu (liu.fuzhi@wechangetech.com)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import rospy</span><br><span class="line">import tf</span><br><span class="line">import time</span><br><span class="line">import sys</span><br><span class="line">import math</span><br><span class="line">import serial</span><br><span class="line">import string</span><br><span class="line">from geometry_msgs.msg import Twist</span><br><span class="line">from nav_msgs.msg import Odometry</span><br><span class="line">from sensor_msgs.msg import BatteryState</span><br><span class="line">from sensor_msgs.msg import Imu</span><br><span class="line">from sensor_msgs.msg import Range</span><br><span class="line"></span><br><span class="line">import ctypes</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>读取环境变量BASE_TYPE，SONAR_NUM的值。根据车型和超声波数量的不同执行不同指令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">base_type = os.getenv(<span class="string">&#x27;BASE_TYPE&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> os.getenv(<span class="string">&#x27;SONAR_NUM&#x27;</span>) is None:</span><br><span class="line">    sonar_num = 0</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    sonar_num = int(os.getenv(<span class="string">&#x27;SONAR_NUM&#x27;</span>)) </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p class='p blue'>设计环形队列缓存串口数据防止数据丢失</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#class queue is design for uart receive data cache</span></span><br><span class="line">class queue:</span><br><span class="line">    def __init__(self, capacity = 1024*4):</span><br><span class="line">        self.capacity = capacity</span><br><span class="line">        self.size = 0</span><br><span class="line">        self.front = 0</span><br><span class="line">        self.rear = 0</span><br><span class="line">        self.array = [0]*capacity</span><br><span class="line"> </span><br><span class="line">    def is_empty(self):</span><br><span class="line">        <span class="built_in">return</span> 0 == self.size</span><br><span class="line"> </span><br><span class="line">    def is_full(self):</span><br><span class="line">        <span class="built_in">return</span> self.size == self.capacity</span><br><span class="line"> </span><br><span class="line">    def enqueue(self, element):</span><br><span class="line">        <span class="keyword">if</span> self.is_full():</span><br><span class="line">            raise Exception(<span class="string">&#x27;queue is full&#x27;</span>)</span><br><span class="line">        self.array[self.rear] = element</span><br><span class="line">        self.size += 1</span><br><span class="line">        self.rear = (self.rear + 1) % self.capacity</span><br><span class="line"> </span><br><span class="line">    def dequeue(self):</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            raise Exception(<span class="string">&#x27;queue is empty&#x27;</span>)</span><br><span class="line">        self.size -= 1</span><br><span class="line">        self.front = (self.front + 1) % self.capacity</span><br><span class="line"> </span><br><span class="line">    def get_front(self):</span><br><span class="line">        <span class="built_in">return</span> self.array[self.front]</span><br><span class="line">    </span><br><span class="line">    def get_front_second(self):</span><br><span class="line">        <span class="built_in">return</span> self.array[((self.front + 1) % self.capacity)]</span><br><span class="line"></span><br><span class="line">    def get_queue_length(self):</span><br><span class="line">        <span class="built_in">return</span> (self.rear - self.front + self.capacity) % self.capacity</span><br><span class="line"></span><br><span class="line">    def show_queue(self):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.capacity):</span><br><span class="line">            <span class="built_in">print</span> self.array[i],</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>设计BaseControl类实现底盘硬件的基本控制</p></li></ol><ul><li>1.获取基本参数值(baseId,odomId,device_port等都是launch定义好的，没有的赋值最后面的默认值)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#class BaseControl is design for hardware base relative control</span></span><br><span class="line">class BaseControl:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        <span class="comment">#Get params</span></span><br><span class="line">        self.baseId = rospy.get_param(<span class="string">&#x27;~base_id&#x27;</span>,<span class="string">&#x27;base_footprint&#x27;</span>)</span><br><span class="line">        self.odomId = rospy.get_param(<span class="string">&#x27;~odom_id&#x27;</span>,<span class="string">&#x27;odom&#x27;</span>)</span><br><span class="line">        self.device_port = rospy.get_param(<span class="string">&#x27;~port&#x27;</span>,<span class="string">&#x27;/dev/ttyUSB0&#x27;</span>)</span><br><span class="line">        self.baudrate = int(rospy.get_param(<span class="string">&#x27;~baudrate&#x27;</span>,<span class="string">&#x27;115200&#x27;</span>))</span><br><span class="line">        self.odom_freq = int(rospy.get_param(<span class="string">&#x27;~odom_freq&#x27;</span>,<span class="string">&#x27;50&#x27;</span>))</span><br><span class="line">        self.odom_topic = rospy.get_param(<span class="string">&#x27;~odom_topic&#x27;</span>,<span class="string">&#x27;/odom&#x27;</span>)</span><br><span class="line">        self.battery_topic = rospy.get_param(<span class="string">&#x27;~battery_topic&#x27;</span>,<span class="string">&#x27;battery&#x27;</span>)</span><br><span class="line">        self.battery_freq = <span class="built_in">float</span>(rospy.get_param(<span class="string">&#x27;~battery_freq&#x27;</span>,<span class="string">&#x27;1&#x27;</span>))</span><br><span class="line">        self.cmd_vel_topic= rospy.get_param(<span class="string">&#x27;~cmd_vel_topic&#x27;</span>,<span class="string">&#x27;/cmd_vel&#x27;</span>)</span><br><span class="line">        self.ackermann_cmd_topic = rospy.get_param(<span class="string">&#x27;~ackermann_cmd_topic&#x27;</span>,<span class="string">&#x27;/ackermann_cmd_topic&#x27;</span>)</span><br><span class="line">            self.pub_imu = bool(rospy.get_param(<span class="string">&#x27;~pub_imu&#x27;</span>,False))</span><br><span class="line">        <span class="keyword">if</span>(self.pub_imu == True):</span><br><span class="line">            self.imuId = rospy.get_param(<span class="string">&#x27;~imu_id&#x27;</span>,<span class="string">&#x27;imu&#x27;</span>)</span><br><span class="line">            self.imu_topic = rospy.get_param(<span class="string">&#x27;~imu_topic&#x27;</span>,<span class="string">&#x27;imu&#x27;</span>)</span><br><span class="line">            self.imu_freq = <span class="built_in">float</span>(rospy.get_param(<span class="string">&#x27;~imu_freq&#x27;</span>,<span class="string">&#x27;50&#x27;</span>))</span><br><span class="line">            <span class="keyword">if</span> self.imu_freq &gt; 100:</span><br><span class="line">                self.imu_freq = 100</span><br><span class="line"></span><br><span class="line">        self.pub_sonar = bool(rospy.get_param(<span class="string">&#x27;~pub_sonar&#x27;</span>,False))</span><br><span class="line">        self.sub_ackermann = bool(rospy.get_param(<span class="string">&#x27;~sub_ackermann&#x27;</span>,False))</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>2.定义一些接下来用的变量 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define param</span></span><br><span class="line">self.current_time = rospy.Time.now()//当前时间</span><br><span class="line">self.previous_time = self.current_time//之前时间</span><br><span class="line">self.pose_x = 0.0 //odom数据通过计算显示的x坐标</span><br><span class="line">self.pose_y = 0.0 //odom数据通过计算显示的y坐标</span><br><span class="line">self.pose_yaw = 0.0 //odom数据通过计算显示的绕z轴转的角度</span><br><span class="line">self.serialIDLE_flag = 0</span><br><span class="line">self.trans_x = 0.0 //复制vel_cmd里存的信息-x方向的线速度</span><br><span class="line">self.trans_y = 0.0 //复制vel_cmd里存的信息-y方向的线速度</span><br><span class="line">self.rotat_z = 0.0 //复制vel_cmd里存的信息-z方向的角速度</span><br><span class="line">self.speed = 0.0  // 复制ackermann_cmd里存的信息-转向速度</span><br><span class="line">self.steering_angle = 0.0//复制ackermann_cmd里存的信息-转向角度</span><br><span class="line">self.sendcounter = 0</span><br><span class="line">self.ImuErrFlag = False</span><br><span class="line">self.EncoderFlag = False</span><br><span class="line">self.BatteryFlag = False</span><br><span class="line">self.OdomTimeCounter = 0 //odom定时器计数器</span><br><span class="line">self.BatteryTimeCounter = 0 //电池定时器计时器</span><br><span class="line">self.Circleloop = queue(capacity = 1024*4) //环形队列</span><br><span class="line">self.Vx = 0//x轴方向速度</span><br><span class="line">self.Vy = 0//y轴方向速度</span><br><span class="line">self.Vyaw = 0//沿y轴转动的速度</span><br><span class="line">self.Yawz = 0//imu姿态-沿z轴转动的角度</span><br><span class="line">self.Vvoltage = 0//电池的电压</span><br><span class="line">self.Icurrent = 0//电池的电流</span><br><span class="line">self.Gyro = [0,0,0]//陀螺仪-姿态</span><br><span class="line">self.Accel = [0,0,0]//xyz方向线加速度</span><br><span class="line">self.Quat = [0,0,0,0]//四元数-姿态</span><br><span class="line">self.Sonar = [0,0,0,0]//超声波测距信息</span><br><span class="line">self.movebase_firmware_version = [0,0,0]//底盘软件版本号</span><br><span class="line">self.movebase_hardware_version = [0,0,0]//底盘硬件版本号</span><br><span class="line">//底盘类型</span><br><span class="line">self.movebase_type = [<span class="string">&quot;NanoCar&quot;</span>,<span class="string">&quot;NanoRobot&quot;</span>,<span class="string">&quot;4WD_OMNI&quot;</span>,<span class="string">&quot;4WD&quot;</span>,<span class="string">&quot;RC_ACKERMAN&quot;</span>]</span><br><span class="line">//电机型号</span><br><span class="line">self.motor_type = [<span class="string">&quot;25GA370&quot;</span>,<span class="string">&quot;37GB520&quot;</span>,<span class="string">&quot;TT48&quot;</span>,<span class="string">&quot;RS365&quot;</span>,<span class="string">&quot;RS540&quot;</span>]</span><br><span class="line">self.last_cmd_vel_time = rospy.Time.now()</span><br><span class="line">self.last_ackermann_cmd_time = rospy.Time.now()</span><br></pre></td></tr></table></figure></li><li>3.打开串口<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Serial Communication</span></span><br><span class="line">try:</span><br><span class="line">    self.serial = serial.Serial(self.device_port,self.baudrate,timeout=10)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Opening Serial&quot;</span>)</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">if</span> self.serial.in_waiting:</span><br><span class="line">            self.serial.readall()</span><br><span class="line">    except:</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;Opening Serial Try Faild&quot;</span>)</span><br><span class="line">        pass</span><br><span class="line">except:</span><br><span class="line">    rospy.logerr(<span class="string">&quot;Can not open Serial&quot;</span>+self.device_port)</span><br><span class="line">    self.serial.close</span><br><span class="line">    sys.exit(0)</span><br><span class="line">rospy.loginfo(<span class="string">&quot;Serial Open Succeed&quot;</span>)</span><br></pre></td></tr></table></figure></li><li>4.判断小车类型如果是不能原地打转的，订阅电机转向移动话题ackermann topic否则订阅cmd_vel topic<br>终端控制转向移动的话题信息有两种：ackermann_cmd和cmd_vel<br>当终端的键盘控制节点启动就会自动发布cmd_vel，键盘控制时随着键盘变化cmd_vel里的速度信息也变化(比如直行 linear.x=10,其余为0 )<br>也可以通过rostopic pub主动发布话题cmd_vel<br>ackermann_cmd_topic就是ackermann_cmd(launch里定义的)<br>订阅终端控制话题,当里面有东西时执行回调函数cmdCB<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#if move base type is ackermann car like robot and use ackermann msg ,sud ackermann topic,else sub cmd_vel topic</span></span><br><span class="line"><span class="keyword">if</span>((<span class="string">&#x27;NanoCar&#x27;</span> <span class="keyword">in</span> base_type) &amp; (self.sub_ackermann == True)):</span><br><span class="line">    from ackermann_msgs.msg import AckermannDriveStamped</span><br><span class="line">    self.sub = rospy.Subscriber(self.ackermann_cmd_topic,AckermannDriveStamped,self.ackermannCmdCB,queue_size=20)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    self.sub = rospy.Subscriber(self.cmd_vel_topic,Twist,self.cmdCB,queue_size=20)</span><br></pre></td></tr></table></figure></li><li>5.定义发布器(发布odom,电池，超声波话题)没发布呢<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">self.pub = rospy.Publisher(self.odom_topic,Odometry,queue_size=10)</span><br><span class="line">self.battery_pub = rospy.Publisher(self.battery_topic,BatteryState,queue_size=3)</span><br><span class="line"><span class="keyword">if</span> self.pub_sonar:</span><br><span class="line">    <span class="keyword">if</span> sonar_num &gt; 0:</span><br><span class="line">        self.range_pub1 = rospy.Publisher(<span class="string">&#x27;sonar_1&#x27;</span>,Range,queue_size=3)</span><br><span class="line">    <span class="keyword">if</span> sonar_num &gt; 1:    </span><br><span class="line">        self.range_pub2 = rospy.Publisher(<span class="string">&#x27;sonar_2&#x27;</span>,Range,queue_size=3)</span><br><span class="line">    <span class="keyword">if</span> sonar_num &gt; 2:</span><br><span class="line">        self.range_pub3 = rospy.Publisher(<span class="string">&#x27;sonar_3&#x27;</span>,Range,queue_size=3)</span><br><span class="line">    <span class="keyword">if</span> sonar_num &gt; 3:</span><br><span class="line">        self.range_pub4 = rospy.Publisher(<span class="string">&#x27;sonar_4&#x27;</span>,Range,queue_size=3)</span><br><span class="line">    <span class="keyword">if</span> sonar_num &gt; 0:</span><br><span class="line">        self.timer_sonar = rospy.Timer(rospy.Duration(100.0/1000),self.timerSonarCB)</span><br></pre></td></tr></table></figure></li><li>6.注册tf坐标发布器，定义定时器控制odom,电池发布周期以及串口通信多久一次<br>定时器到了分别执行回调函数timerOdomCB，timerBatteryCB，timerCommunicationCB<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self.tf_broadcaster = tf.TransformBroadcaster()</span><br><span class="line">self.timer_odom = rospy.Timer(rospy.Duration(1.0/self.odom_freq),self.timerOdomCB)</span><br><span class="line">self.timer_battery = rospy.Timer(rospy.Duration(1.0/self.battery_freq),self.timerBatteryCB)  </span><br><span class="line">self.timer_communication = rospy.Timer(rospy.Duration(1.0/500),self.timerCommunicationCB)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>7.定义发布器(发布imu)没发布呢,定义定时器控制imu发布周期,定时器时间到了执行回调函数timerIMUCB<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#inorder to compatibility old version firmware,imu topic is NOT pud in default</span></span><br><span class="line"><span class="keyword">if</span>(self.pub_imu):</span><br><span class="line">    self.imu_pub = rospy.Publisher(self.imu_topic,Imu,queue_size=10)</span><br><span class="line">    self.timer_imu = rospy.Timer(rospy.Duration(1.0/self.imu_freq),self.timerIMUCB) </span><br></pre></td></tr></table></figure></li><li>8.获取底盘版本（自写）,发了出去但没有收到地盘回复<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">self.getVersion()</span><br><span class="line"><span class="comment">#move base imu initialization need about 2s,during initialization,move base system is blocked</span></span><br><span class="line"><span class="comment">#so need this gap</span></span><br><span class="line"><span class="keyword">while</span> self.movebase_hardware_version[0] == 0:</span><br><span class="line">    pass</span><br><span class="line"><span class="comment"># if self.movebase_hardware_version[0] &lt; 2:</span></span><br><span class="line"><span class="comment">#     print self.movebase_hardware_version</span></span><br><span class="line"><span class="comment">#     time.sleep(2.0)</span></span><br></pre></td></tr></table></figure></li><li>9.获取底盘SN（自写）,发了出去但没有收到地盘回复<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">self.getSN()</span><br><span class="line">time.sleep(0.01)</span><br><span class="line">self.getInfo()</span><br></pre></td></tr></table></figure></li><li>10.CRC校验<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#CRC-8 Calculate</span></span><br><span class="line">    def crc_1byte(self,data):</span><br><span class="line">        crc_1byte = 0</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(0,8):</span><br><span class="line">            <span class="keyword">if</span>((crc_1byte^data)&amp;0x01):</span><br><span class="line">                crc_1byte^=0x18</span><br><span class="line">                crc_1byte&gt;&gt;=1</span><br><span class="line">                crc_1byte|=0x80</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                crc_1byte&gt;&gt;=1</span><br><span class="line">            data&gt;&gt;=1</span><br><span class="line">        <span class="built_in">return</span> crc_1byte</span><br><span class="line">    def crc_byte(self,data,length):</span><br><span class="line">        ret = 0</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">            ret = self.crc_1byte(ret^data[i])</span><br><span class="line">        <span class="built_in">return</span> ret               </span><br></pre></td></tr></table></figure></li><li>11.定义收到vel_cmd话题后的回调函数并记录回调时的时间,复制vel_cmd里存的信息，根据串口通讯进行转换再通过串口写入底盘<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Subscribe vel_cmd call this to send vel cmd to move base</span></span><br><span class="line">    def cmdCB(self,data):</span><br><span class="line">        self.trans_x = data.linear.x</span><br><span class="line">        self.trans_y = data.linear.y</span><br><span class="line">        self.rotat_z = data.angular.z</span><br><span class="line">        self.last_cmd_vel_time = rospy.Time.now()</span><br><span class="line">        output = chr(0x5a) + chr(12) + chr(0x01) + chr(0x01) + \</span><br><span class="line">            chr((int(self.trans_x*1000.0)&gt;&gt;8)&amp;0xff) + chr(int(self.trans_x*1000.0)&amp;0xff) + \</span><br><span class="line">            chr((int(self.trans_y*1000.0)&gt;&gt;8)&amp;0xff) + chr(int(self.trans_y*1000.0)&amp;0xff) + \</span><br><span class="line">            chr((int(self.rotat_z*1000.0)&gt;&gt;8)&amp;0xff) + chr(int(self.rotat_z*1000.0)&amp;0xff) + \</span><br><span class="line">            chr(0x00)</span><br><span class="line">        outputdata = [0x5a,0x0c,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]</span><br><span class="line">        outputdata[4] = (int(self.trans_x*1000.0)&gt;&gt;8)&amp;0xff</span><br><span class="line">        outputdata[5] = int(self.trans_x*1000.0)&amp;0xff</span><br><span class="line">        outputdata[6] = (int(self.trans_y*1000.0)&gt;&gt;8)&amp;0xff</span><br><span class="line">        outputdata[7] = int(self.trans_y*1000.0)&amp;0xff</span><br><span class="line">        outputdata[8] = (int(self.rotat_z*1000.0)&gt;&gt;8)&amp;0xff</span><br><span class="line">        outputdata[9] = int(self.rotat_z*1000.0)&amp;0xff</span><br><span class="line">        crc_8 = self.crc_byte(outputdata,len(outputdata)-1)</span><br><span class="line">        output += chr(crc_8)</span><br><span class="line">        <span class="keyword">while</span> self.serialIDLE_flag:</span><br><span class="line">            time.sleep(0.01)</span><br><span class="line">        self.serialIDLE_flag = 4</span><br><span class="line">        try:</span><br><span class="line">            <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">                pass</span><br><span class="line">            self.serial.write(output)</span><br><span class="line">        except:</span><br><span class="line">            rospy.logerr(<span class="string">&quot;Vel Command Send Faild&quot;</span>)</span><br><span class="line">        self.serialIDLE_flag = 0</span><br></pre></td></tr></table></figure></li><li>12.定义收到ackermann_cmd话题后的回调函数并记录回调时的时间,复制ackermann_cmd里存的信息，根据串口通讯进行转换再通过串口写入底盘<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Subscribe ackermann Cmd call this to send vel cmd to move base</span></span><br><span class="line">def ackermannCmdCB(self,data):</span><br><span class="line">    self.speed = data.drive.speed</span><br><span class="line">    self.steering_angle = data.drive.steering_angle</span><br><span class="line">    self.last_ackermann_cmd_time = rospy.Time.now()</span><br><span class="line">    output = chr(0x5a) + chr(12) + chr(0x01) + chr(0x15) + \</span><br><span class="line">        chr((int(self.speed*1000.0)&gt;&gt;8)&amp;0xff) + chr(int(self.speed*1000.0)&amp;0xff) + \</span><br><span class="line">        chr(0x00) + chr(0x00) + \</span><br><span class="line">        chr((int(self.steering_angle*1000.0)&gt;&gt;8)&amp;0xff) + chr(int(self.steering_angle*1000.0)&amp;0xff) + \</span><br><span class="line">        chr(0x00)</span><br><span class="line">    outputdata = [0x5a,0x0c,0x01,0x15,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]</span><br><span class="line">    outputdata[4] = (int(self.speed*1000.0)&gt;&gt;8)&amp;0xff</span><br><span class="line">    outputdata[5] = int(self.speed*1000.0)&amp;0xff</span><br><span class="line">    outputdata[8] = (int(self.steering_angle*1000.0)&gt;&gt;8)&amp;0xff</span><br><span class="line">    outputdata[9] = int(self.steering_angle*1000.0)&amp;0xff</span><br><span class="line">    crc_8 = self.crc_byte(outputdata,len(outputdata)-1)</span><br><span class="line">    output += chr(crc_8)</span><br><span class="line">    <span class="keyword">while</span> self.serialIDLE_flag:</span><br><span class="line">        time.sleep(0.01)</span><br><span class="line">    self.serialIDLE_flag = 4</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">            pass</span><br><span class="line">        self.serial.write(output)</span><br><span class="line">    except:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Vel Command Send Faild&quot;</span>)</span><br><span class="line">    self.serialIDLE_flag = 0</span><br></pre></td></tr></table></figure></li><li>13.编写定时器回调函数timerCommunicationCB-检查串口中有无缓存数据,有的话存放到编写好的消息环形队列,如果消息环形队列有数据把数据取出来放到我们定义的变量<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Communication Timer callback to handle receive data</span></span><br><span class="line"><span class="comment">#depend on communication protocol</span></span><br><span class="line">def timerCommunicationCB(self,event):</span><br><span class="line">    length = self.serial.in_waiting</span><br><span class="line">    <span class="keyword">if</span> length:</span><br><span class="line">        reading = self.serial.read_all()</span><br><span class="line">        <span class="keyword">if</span> len(reading)!=0:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(0,len(reading)):</span><br><span class="line">                data = (int(reading[i].encode(<span class="string">&#x27;hex&#x27;</span>),16)) </span><br><span class="line">                try:</span><br><span class="line">                    self.Circleloop.enqueue(data)</span><br><span class="line">                except:</span><br><span class="line">                    pass</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        pass</span><br><span class="line">    <span class="keyword">if</span> self.Circleloop.is_empty()==False:</span><br><span class="line">        data = self.Circleloop.get_front()</span><br><span class="line">        <span class="keyword">if</span> data == 0x5a:</span><br><span class="line">            length = self.Circleloop.get_front_second()</span><br><span class="line">            <span class="keyword">if</span> length &gt; 1 :</span><br><span class="line">                <span class="keyword">if</span> self.Circleloop.get_front_second() &lt;= self.Circleloop.get_queue_length():</span><br><span class="line">                    databuf = []</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">                        databuf.append(self.Circleloop.get_front())</span><br><span class="line">                        self.Circleloop.dequeue()</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span> (databuf[length-1]) == self.crc_byte(databuf,length-1):</span><br><span class="line">                        pass</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        pass</span><br><span class="line">                    <span class="comment">#parse receive data</span></span><br><span class="line">                    <span class="keyword">if</span>(databuf[3] == 0x04):</span><br><span class="line">                        self.Vx =    databuf[4]*256</span><br><span class="line">                        self.Vx +=   databuf[5]</span><br><span class="line">                        self.Vy =    databuf[6]*256</span><br><span class="line">                        self.Vy +=   databuf[7]</span><br><span class="line">                        self.Vyaw =  databuf[8]*256</span><br><span class="line">                        self.Vyaw += databuf[9]</span><br><span class="line">                    <span class="keyword">elif</span>(databuf[3] == 0x06):</span><br><span class="line">                        self.Yawz =  databuf[8]*256</span><br><span class="line">                        self.Yawz += databuf[9]</span><br><span class="line">                    <span class="keyword">elif</span> (databuf[3] == 0x08):</span><br><span class="line">                        self.Vvoltage = databuf[4]*256</span><br><span class="line">                        self.Vvoltage += databuf[5]</span><br><span class="line">                        self.Icurrent = databuf[6]*256</span><br><span class="line">                        self.Icurrent += databuf[7]</span><br><span class="line">                    <span class="keyword">elif</span> (databuf[3] == 0x0a):</span><br><span class="line">                        self.Vx =    databuf[4]*256</span><br><span class="line">                        self.Vx +=   databuf[5]</span><br><span class="line">                        self.Yawz =  databuf[6]*256</span><br><span class="line">                        self.Yawz += databuf[7]</span><br><span class="line">                        self.Vyaw =  databuf[8]*256</span><br><span class="line">                        self.Vyaw += databuf[9]</span><br><span class="line">                    <span class="keyword">elif</span> (databuf[3] == 0x12):</span><br><span class="line">                        self.Vx =    databuf[4]*256</span><br><span class="line">                        self.Vx +=   databuf[5]</span><br><span class="line">                        self.Vy =  databuf[6]*256</span><br><span class="line">                        self.Vy += databuf[7]</span><br><span class="line">                        self.Yawz =  databuf[8]*256</span><br><span class="line">                        self.Yawz += databuf[9]    </span><br><span class="line">                        self.Vyaw =  databuf[10]*256</span><br><span class="line">                        self.Vyaw += databuf[11]                          </span><br><span class="line">                    <span class="keyword">elif</span> (databuf[3] == 0x14):</span><br><span class="line">                        self.Gyro[0] = int(((databuf[4]&amp;0xff)&lt;&lt;<span class="string">24)|((databuf[5]&amp;0xff)&lt;&lt;16)|((databuf[6]&amp;0xff)&lt;&lt;8)|(databuf[7]&amp;0xff))</span></span><br><span class="line"><span class="string">                        self.Gyro[1] = int(((databuf[8]&amp;0xff)&lt;&lt;24</span>)|((databuf[9]&amp;0xff)&lt;&lt;<span class="string">16)|((databuf[10]&amp;0xff)&lt;&lt;8)|(databuf[11]&amp;0xff))</span></span><br><span class="line"><span class="string">                        self.Gyro[2] = int(((databuf[12]&amp;0xff)&lt;&lt;24)|((databuf[13]&amp;0xff)&lt;&lt;16</span>)|((databuf[14]&amp;0xff)&lt;&lt;<span class="string">8)|(databuf[15]&amp;0xff))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                        self.Accel[0] = int(((databuf[16]&amp;0xff)&lt;&lt;24)|((databuf[17]&amp;0xff)&lt;&lt;16)|((databuf[18]&amp;0xff)&lt;&lt;8</span>)|(databuf[19]&amp;0xff))</span><br><span class="line">                        self.Accel[1] = int(((databuf[20]&amp;0xff)&lt;&lt;<span class="string">24)|((databuf[21]&amp;0xff)&lt;&lt;16)|((databuf[22]&amp;0xff)&lt;&lt;8)|(databuf[23]&amp;0xff))</span></span><br><span class="line"><span class="string">                        self.Accel[2] = int(((databuf[24</span>]&amp;0xff)&lt;&lt;<span class="string">24)|((databuf[25]&amp;0xff)&lt;&lt;16)|((databuf[26]&amp;0xff)&lt;&lt;8)|(databuf[27]&amp;0xff))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                        self.Quat[0] = int((databuf[28]&amp;0xff)&lt;&lt;8|databuf[29])</span></span><br><span class="line"><span class="string">                        self.Quat[1] = int((databuf[30]&amp;0xff)&lt;&lt;8|databuf[31])</span></span><br><span class="line"><span class="string">                        self.Quat[2] = int((databuf[32]&amp;0xff)&lt;&lt;8|databuf[33])</span></span><br><span class="line"><span class="string">                        self.Quat[3] = int((databuf[34]&amp;0xff)&lt;&lt;8|databuf[35])</span></span><br><span class="line"><span class="string">                    elif (databuf[3] == 0x1a):</span></span><br><span class="line"><span class="string">                        self.Sonar[0] = databuf[4]</span></span><br><span class="line"><span class="string">                        self.Sonar[1] = databuf[5]</span></span><br><span class="line"><span class="string">                        self.Sonar[2] = databuf[6]</span></span><br><span class="line"><span class="string">                        self.Sonar[3] = databuf[7]    </span></span><br><span class="line"><span class="string">                    elif(databuf[3] == 0xf2):</span></span><br><span class="line"><span class="string">                        self.movebase_hardware_version[0] = databuf[4]</span></span><br><span class="line"><span class="string">                        self.movebase_hardware_version[1] = databuf[5]</span></span><br><span class="line"><span class="string">                        self.movebase_hardware_version[2] = databuf[6]</span></span><br><span class="line"><span class="string">                        self.movebase_firmware_version[0] = databuf[7]</span></span><br><span class="line"><span class="string">                        self.movebase_firmware_version[1] = databuf[8]</span></span><br><span class="line"><span class="string">                        self.movebase_firmware_version[2] = databuf[9]</span></span><br><span class="line"><span class="string">                        version_string = &quot;Move Base Hardware Ver %d.%d.%d,Firmware Ver %d.%d.%d&quot;\</span></span><br><span class="line"><span class="string">                            %(self.movebase_hardware_version[0],self.movebase_hardware_version[1],self.movebase_hardware_version[2],\</span></span><br><span class="line"><span class="string">                            self.movebase_firmware_version[0],self.movebase_firmware_version[1],self.movebase_firmware_version[2])</span></span><br><span class="line"><span class="string">                        rospy.loginfo(version_string)</span></span><br><span class="line"><span class="string">                    elif(databuf[3] == 0xf4):</span></span><br><span class="line"><span class="string">                        sn_string = &quot;SN:&quot;</span></span><br><span class="line"><span class="string">                        for i in range(4,16):</span></span><br><span class="line"><span class="string">                            sn_string = &quot;%s%02x&quot;%(sn_string,databuf[i])</span></span><br><span class="line"><span class="string">                        rospy.loginfo(sn_string)                            </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    elif(databuf[3] == 0x22):</span></span><br><span class="line"><span class="string">                        fRatio = float(databuf[6]&lt;&lt;8|databuf[7])/10</span></span><br><span class="line"><span class="string">                        fDiameter = float(databuf[8]&lt;&lt;8|databuf[9])/10</span></span><br><span class="line"><span class="string">                        info_string = &quot;Type:%s Motor:%s Ratio:%.01f WheelDiameter:%.01f&quot;\</span></span><br><span class="line"><span class="string">                            %(self.movebase_type[databuf[4]-1],self.motor_type[databuf[5]-1],fRatio,fDiameter)</span></span><br><span class="line"><span class="string">                        rospy.loginfo(info_string)</span></span><br><span class="line"><span class="string">                    else:</span></span><br><span class="line"><span class="string">                        pass</span></span><br><span class="line"><span class="string">            else:</span></span><br><span class="line"><span class="string">                pass</span></span><br><span class="line"><span class="string">        else:</span></span><br><span class="line"><span class="string">            self.Circleloop.dequeue()</span></span><br><span class="line"><span class="string">    else:</span></span><br><span class="line"><span class="string">        # rospy.loginfo(&quot;Circle is Empty&quot;)</span></span><br><span class="line"><span class="string">        pass</span></span><br></pre></td></tr></table></figure></li><li>14.编写获取底盘版本函数,发了出去但没有收到底盘回复<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#get move base hardware &amp; firmware version    </span></span><br><span class="line">def getVersion(self):</span><br><span class="line">    <span class="comment">#Get version info</span></span><br><span class="line">    output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0xf1) + chr(0x00) + chr(0xd7) <span class="comment">#0xd7 is CRC-8 value</span></span><br><span class="line">    <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">        time.sleep(0.01)</span><br><span class="line">    self.serialIDLE_flag = 1</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">            pass</span><br><span class="line">        self.serial.write(output)</span><br><span class="line">    except:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Get Version Command Send Faild&quot;</span>)</span><br><span class="line">    self.serialIDLE_flag = 0 </span><br></pre></td></tr></table></figure></li><li>15.编写获取底盘SN函数,发了出去但没有收到底盘回复<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#get move base SN</span></span><br><span class="line">def getSN(self):</span><br><span class="line">    <span class="comment">#Get version info</span></span><br><span class="line">    output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0xf3) + chr(0x00) + chr(0x46) <span class="comment">#0x46 is CRC-8 value</span></span><br><span class="line">    <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">        time.sleep(0.01)</span><br><span class="line">    self.serialIDLE_flag = 1</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">            pass</span><br><span class="line">        self.serial.write(output)</span><br><span class="line">    except:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Get SN Command Send Faild&quot;</span>)</span><br><span class="line">    self.serialIDLE_flag = 0  </span><br></pre></td></tr></table></figure></li><li>16.编写获取底盘信息函数(车型，轮距)发了出去但没有收到底盘回复<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#get move base info</span></span><br><span class="line">def getInfo(self):</span><br><span class="line">    <span class="comment">#Get version info</span></span><br><span class="line">    output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0x21) + chr(0x00) + chr(0x8f) <span class="comment">#0x8f is CRC-8 value</span></span><br><span class="line">    <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">        time.sleep(0.01)</span><br><span class="line">    self.serialIDLE_flag = 1</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">            pass</span><br><span class="line">        self.serial.write(output)</span><br><span class="line">    except:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Get info Command Send Faild&quot;</span>)</span><br><span class="line">    self.serialIDLE_flag = 0            </span><br></pre></td></tr></table></figure></li><li>17.编写定时器回调函数timerOdomCB-将串口发送的odom信息经过处理得到位姿信息，填入odom话题并发布,同时发布tf坐标广播(底盘坐标系在odom坐标系中的位姿)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Odom Timer call this to get velocity and imu info and convert to odom topic</span></span><br><span class="line">def timerOdomCB(self,event):</span><br><span class="line">    <span class="comment">#Get move base velocity data</span></span><br><span class="line">    <span class="keyword">if</span> self.movebase_firmware_version[1] == 0: </span><br><span class="line">        <span class="comment">#old version firmware have no version info and not support new command below</span></span><br><span class="line">        output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0x09) + chr(0x00) + chr(0x38) <span class="comment">#0x38 is CRC-8 value</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment">#in firmware version new than v1.1.0,support this command      </span></span><br><span class="line">        output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0x11) + chr(0x00) + chr(0xa2) </span><br><span class="line">    <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">        time.sleep(0.01)</span><br><span class="line">    self.serialIDLE_flag = 1</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">            pass</span><br><span class="line">        self.serial.write(output)</span><br><span class="line">    except:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Odom Command Send Faild&quot;</span>)</span><br><span class="line">    self.serialIDLE_flag = 0   </span><br><span class="line">    <span class="comment">#calculate odom data</span></span><br><span class="line">    Vx = <span class="built_in">float</span>(ctypes.c_int16(self.Vx).value/1000.0)</span><br><span class="line">    Vy = <span class="built_in">float</span>(ctypes.c_int16(self.Vy).value/1000.0)</span><br><span class="line">    Vyaw = <span class="built_in">float</span>(ctypes.c_int16(self.Vyaw).value/1000.0)</span><br><span class="line"></span><br><span class="line">    self.pose_yaw = <span class="built_in">float</span>(ctypes.c_int16(self.Yawz).value/100.0)</span><br><span class="line">    self.pose_yaw = self.pose_yaw*math.pi/180.0</span><br><span class="line">  </span><br><span class="line">    self.current_time = rospy.Time.now()</span><br><span class="line">    dt = (self.current_time - self.previous_time).to_sec()</span><br><span class="line">    self.previous_time = self.current_time</span><br><span class="line">    self.pose_x = self.pose_x + Vx * (math.cos(self.pose_yaw))*dt - Vy * (math.sin(self.pose_yaw))*dt</span><br><span class="line">    self.pose_y = self.pose_y + Vx * (math.sin(self.pose_yaw))*dt + Vy * (math.cos(self.pose_yaw))*dt</span><br><span class="line"></span><br><span class="line">    pose_quat = tf.transformations.quaternion_from_euler(0,0,self.pose_yaw)        </span><br><span class="line">    msg = Odometry()</span><br><span class="line">    msg.header.stamp = self.current_time</span><br><span class="line">    msg.header.frame_id = self.odomId</span><br><span class="line">    msg.child_frame_id =self.baseId</span><br><span class="line">    msg.pose.pose.position.x = self.pose_x</span><br><span class="line">    msg.pose.pose.position.y = self.pose_y</span><br><span class="line">    msg.pose.pose.position.z = 0</span><br><span class="line">    msg.pose.pose.orientation.x = pose_quat[0]</span><br><span class="line">    msg.pose.pose.orientation.y = pose_quat[1]</span><br><span class="line">    msg.pose.pose.orientation.z = pose_quat[2]</span><br><span class="line">    msg.pose.pose.orientation.w = pose_quat[3]</span><br><span class="line">    msg.twist.twist.linear.x = Vx</span><br><span class="line">    msg.twist.twist.linear.y = Vy</span><br><span class="line">    msg.twist.twist.angular.z = Vyaw</span><br><span class="line">    self.pub.publish(msg)</span><br><span class="line">    self.tf_broadcaster.sendTransform((self.pose_x,self.pose_y,0.0),pose_quat,self.current_time,self.baseId,self.odomId)</span><br><span class="line"> </span><br></pre></td></tr></table></figure></li><li>18.编写定时器回调函数timerBatteryCB-将串口发送的电池信息经过处理填入电池话题并发布<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Battery Timer callback function to get battery info</span></span><br><span class="line">    def timerBatteryCB(self,event):</span><br><span class="line">        output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0x07) + chr(0x00) + chr(0xe4) <span class="comment">#0xe4 is CRC-8 value</span></span><br><span class="line">        <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">            time.sleep(0.01)</span><br><span class="line">        self.serialIDLE_flag = 3</span><br><span class="line">        try:</span><br><span class="line">            <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">                pass</span><br><span class="line">            self.serial.write(output)</span><br><span class="line">        except:</span><br><span class="line">            rospy.logerr(<span class="string">&quot;Battery Command Send Faild&quot;</span>)</span><br><span class="line">        self.serialIDLE_flag = 0</span><br><span class="line">        msg = BatteryState()</span><br><span class="line">        msg.header.stamp = self.current_time</span><br><span class="line">        msg.header.frame_id = self.baseId</span><br><span class="line">        msg.voltage = <span class="built_in">float</span>(self.Vvoltage/1000.0)</span><br><span class="line">        msg.current = <span class="built_in">float</span>(self.Icurrent/1000.0)</span><br><span class="line">        self.battery_pub.publish(msg)</span><br></pre></td></tr></table></figure></li><li>19.编写定时器回调函数timerSonarCB-将串口发送的超声波信息经过处理填入超声波话题并发布,同时发布tf坐标广播(超声波仪器和底盘)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sonar Timer callback function to get battery info</span></span><br><span class="line">    def timerSonarCB(self,event):</span><br><span class="line">        output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0x19) + chr(0x00) + chr(0xff) <span class="comment">#0xff is CRC-8 value</span></span><br><span class="line">        <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">            time.sleep(0.01)</span><br><span class="line">        self.serialIDLE_flag = 3</span><br><span class="line">        try:</span><br><span class="line">            <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">                pass</span><br><span class="line">            self.serial.write(output)</span><br><span class="line">        except:</span><br><span class="line">            rospy.logerr(<span class="string">&quot;Sonar Command Send Faild&quot;</span>)</span><br><span class="line">        self.serialIDLE_flag = 0</span><br><span class="line">        msg = Range()</span><br><span class="line">        msg.header.stamp = self.current_time</span><br><span class="line">        msg.field_of_view = 0.26 <span class="comment">#about 15 degree</span></span><br><span class="line">        msg.max_range = 2.5</span><br><span class="line">        msg.min_range = 0.01</span><br><span class="line">        <span class="comment"># Sonar 1</span></span><br><span class="line">        msg.header.frame_id = <span class="string">&#x27;Sonar_1&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> self.Sonar[0] == 0xff:</span><br><span class="line">            msg.range = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>) </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg.range = self.Sonar[0] / 100.0</span><br><span class="line">        self.range_pub1.publish(msg)</span><br><span class="line">         </span><br><span class="line">        <span class="comment"># TF value calculate from mechanical structure</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;NanoRobot&#x27;</span> <span class="keyword">in</span> base_type ):</span><br><span class="line">            self.tf_broadcaster.sendTransform((0.0, 0.0, 0.0 ),(0.0, 0.0, 0.0, 1.0),self.current_time,<span class="string">&#x27;Sonar_1&#x27;</span>,self.baseId)</span><br><span class="line">        <span class="keyword">elif</span>(<span class="string">&#x27;NanoCar&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">            self.tf_broadcaster.sendTransform((0.18, 0.0, 0.0 ),(0.0, 0.0, 0.0, 1.0),self.current_time,<span class="string">&#x27;Sonar_1&#x27;</span>,self.baseId)</span><br><span class="line">        <span class="keyword">elif</span>(<span class="string">&#x27;4WD&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">            self.tf_broadcaster.sendTransform((0.0, 0.0, 0.0 ),(0.0, 0.0, 0.0, 1.0),self.current_time,<span class="string">&#x27;Sonar_1&#x27;</span>,self.baseId)</span><br><span class="line">        <span class="keyword">elif</span>(<span class="string">&#x27;Race182&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">            self.tf_broadcaster.sendTransform((0.18, 0.0, 0.0 ),(0.0, 0.0, 0.0, 1.0),self.current_time,<span class="string">&#x27;Sonar_1&#x27;</span>,self.baseId)   </span><br><span class="line">        <span class="keyword">elif</span>(<span class="string">&#x27;NanoOmni&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">            self.tf_broadcaster.sendTransform((0.11, 0.0, 0.0 ),(0.0, 0.0, 0.0, 1.0),self.current_time,<span class="string">&#x27;Sonar_1&#x27;</span>,self.baseId)              </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pass</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Sonar 2</span></span><br><span class="line">        <span class="keyword">if</span> sonar_num &gt; 1:   </span><br><span class="line">            <span class="keyword">if</span> self.Sonar[1] == 0xff:</span><br><span class="line">                msg.range = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>) </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                msg.range = self.Sonar[1] / 100.0</span><br><span class="line">            msg.header.frame_id = <span class="string">&#x27;Sonar_2&#x27;</span></span><br><span class="line">            self.range_pub2.publish(msg)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&#x27;NanoRobot&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((0.0, 0.0 ,0.0 ),(0.0,0.0,-1.0,0),self.current_time,<span class="string">&#x27;Sonar_2&#x27;</span>,self.baseId) </span><br><span class="line">            <span class="keyword">elif</span>(<span class="string">&#x27;NanoCar&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((-0.035, 0.0 ,0.0 ),(0.0,0.0,-1.0,0),self.current_time,<span class="string">&#x27;Sonar_2&#x27;</span>,self.baseId) </span><br><span class="line">            <span class="keyword">elif</span>(<span class="string">&#x27;4WD&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((0.0, 0.0 ,0.0 ),(0.0,0.0,-1.0,0),self.current_time,<span class="string">&#x27;Sonar_2&#x27;</span>,self.baseId) </span><br><span class="line">            <span class="keyword">elif</span>(<span class="string">&#x27;Race182&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((-0.08, 0.0 ,0.0 ),(0.0,0.0,-1.0,0),self.current_time,<span class="string">&#x27;Sonar_2&#x27;</span>,self.baseId)     </span><br><span class="line">            <span class="keyword">elif</span>(<span class="string">&#x27;NanoOmni&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((-0.11, 0.0, 0.0 ),(0.0, 0.0, -1.0, 0.0),self.current_time,<span class="string">&#x27;Sonar_2&#x27;</span>,self.baseId)  </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pass</span><br><span class="line">        <span class="keyword">if</span> sonar_num &gt; 2:   </span><br><span class="line">        <span class="comment"># Sonar 3</span></span><br><span class="line">            msg.header.frame_id = <span class="string">&#x27;Sonar_3&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> self.Sonar[2] == 0xff:</span><br><span class="line">                msg.range = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>) </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                msg.range = self.Sonar[2] / 100.0</span><br><span class="line">            self.range_pub3.publish(msg)</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&#x27;Race182&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((0.0, 0.06 ,0.0 ),(0.0,0.0,0.707,0.707),self.current_time,<span class="string">&#x27;Sonar_3&#x27;</span>,self.baseId) </span><br><span class="line">            <span class="keyword">elif</span>(<span class="string">&#x27;NanoOmni&#x27;</span> <span class="keyword">in</span> base_type):   </span><br><span class="line">                self.tf_broadcaster.sendTransform((0.0, 0.07 ,0.0 ),(0.0,0.0,0.707,0.707),self.current_time,<span class="string">&#x27;Sonar_3&#x27;</span>,self.baseId)          </span><br><span class="line">        <span class="keyword">if</span> sonar_num &gt; 3:   </span><br><span class="line">        <span class="comment"># Sonar 4</span></span><br><span class="line">            <span class="keyword">if</span> self.Sonar[3] == 0xff:</span><br><span class="line">                msg.range = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>) </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                msg.range = self.Sonar[3] / 100.0</span><br><span class="line">            msg.header.frame_id = <span class="string">&#x27;Sonar_4&#x27;</span></span><br><span class="line">            self.range_pub4.publish(msg)</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&#x27;Race182&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((0.0, -0.06 ,0.0 ),(0.0,0.0,-0.707,0.707),self.current_time,<span class="string">&#x27;Sonar_4&#x27;</span>,self.baseId) </span><br><span class="line">            <span class="keyword">elif</span>(<span class="string">&#x27;NanoOmni&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((0.0, -0.07 ,0.0 ),(0.0,0.0,-0.707,0.707),self.current_time,<span class="string">&#x27;Sonar_4&#x27;</span>,self.baseId) </span><br></pre></td></tr></table></figure></li><li>20.编写定时器回调函数timerIMUCB-将串口发送的imu信息经过处理填入imu话题并发布,同时发布tf坐标广播(imu和底盘)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#IMU Timer callback function to get raw imu info</span></span><br><span class="line">def timerIMUCB(self,event):</span><br><span class="line">    output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0x13) + chr(0x00) + chr(0x33) <span class="comment">#0x33 is CRC-8 value</span></span><br><span class="line">    <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">        time.sleep(0.01)</span><br><span class="line">    self.serialIDLE_flag = 3</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">            pass</span><br><span class="line">        self.serial.write(output)</span><br><span class="line">    except:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Imu Command Send Faild&quot;</span>)</span><br><span class="line"></span><br><span class="line">    self.serialIDLE_flag = 0</span><br><span class="line">    msg = Imu()</span><br><span class="line">    msg.header.stamp = self.current_time</span><br><span class="line">    msg.header.frame_id = self.imuId</span><br><span class="line"></span><br><span class="line">    msg.angular_velocity.x = <span class="built_in">float</span>(ctypes.c_int32(self.Gyro[0]).value/100000.0)</span><br><span class="line">    msg.angular_velocity.y = <span class="built_in">float</span>(ctypes.c_int32(self.Gyro[1]).value/100000.0)</span><br><span class="line">    msg.angular_velocity.z = <span class="built_in">float</span>(ctypes.c_int32(self.Gyro[2]).value/100000.0)</span><br><span class="line"></span><br><span class="line">    msg.linear_acceleration.x = <span class="built_in">float</span>(ctypes.c_int32(self.Accel[0]).value/100000.0)</span><br><span class="line">    msg.linear_acceleration.y = <span class="built_in">float</span>(ctypes.c_int32(self.Accel[1]).value/100000.0)</span><br><span class="line">    msg.linear_acceleration.z = <span class="built_in">float</span>(ctypes.c_int32(self.Accel[2]).value/100000.0)</span><br><span class="line"></span><br><span class="line">    msg.orientation.w = <span class="built_in">float</span>(ctypes.c_int16(self.Quat[0]).value/10000.0)</span><br><span class="line">    msg.orientation.x = <span class="built_in">float</span>(ctypes.c_int16(self.Quat[1]).value/10000.0)</span><br><span class="line">    msg.orientation.y = <span class="built_in">float</span>(ctypes.c_int16(self.Quat[2]).value/10000.0)</span><br><span class="line">    msg.orientation.z = <span class="built_in">float</span>(ctypes.c_int16(self.Quat[3]).value/10000.0)</span><br><span class="line"></span><br><span class="line">    self.imu_pub.publish(msg)  </span><br><span class="line">    <span class="comment"># TF value calculate from mechanical structure</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&#x27;NanoRobot&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">        self.tf_broadcaster.sendTransform((-0.062,-0.007,0.08),(0.0,0.0,0.0,1.0),self.current_time,self.imuId,self.baseId)   </span><br><span class="line">    <span class="keyword">elif</span>(<span class="string">&#x27;NanoCar&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">        self.tf_broadcaster.sendTransform((0.0,0.0,0.09),(0.0,0.0,0.0,1.0),self.current_time,self.imuId,self.baseId) </span><br><span class="line">    <span class="keyword">elif</span>(<span class="string">&#x27;4WD&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">        self.tf_broadcaster.sendTransform((-0.065,0.0167,0.02),(0.0,0.0,0.0,1.0),self.current_time,self.imuId,self.baseId)     </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.tf_broadcaster.sendTransform((0.0,0.0,0.0),(0.0,0.0,0.0,1.0),self.current_time,self.imuId,self.baseId)  </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>21.main循环执行BaseControl()<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#main function</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    try:</span><br><span class="line">        rospy.init_node(<span class="string">&#x27;base_control&#x27;</span>,anonymous=True)</span><br><span class="line">        <span class="keyword">if</span> base_type != None:</span><br><span class="line">            rospy.loginfo(<span class="string">&#x27;%s base control ...&#x27;</span>%base_type)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rospy.loginfo(<span class="string">&#x27;base control ...&#x27;</span>)</span><br><span class="line">            rospy.logerr(<span class="string">&#x27;PLEASE SET BASE_TYPE ENV FIRST&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        bc = BaseControl()</span><br><span class="line">        rospy.spin()</span><br><span class="line">    except KeyboardInterrupt:</span><br><span class="line">        bc.serial.close</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Shutting down&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul>
              </div>
            </details>
<details class="folding-tag" blue><summary> sh文件 </summary>
              <div class='content'>
              <ol><li><p class='p blue'>setbase.sh</p></li></ol><ul><li>定义底盘的类型作为环境变量并写入配置文件</li></ul><ol><li><p class='p blue'>rpi4initsetup.sh</p></li></ol><ul><li>将move_base创建符号链接到端口并将端口权限更改为所有用户可读写(方便移植)</li></ul>
              </div>
            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-4"><p><p class='p blue'>这里的文件夹厂家自带，不需要自己编写。</p><br>lidar是多个常用的雷达功能包的合集。<br>其下包含hls_lfcd_lds_driver，iiiroboticslidar2_ros，rplidar_ros，sc_mini，ydlidar五款雷达的功能包。（里面有发布节点和客户端节点）<br>此外lidar文件夹下还包含一个用于udev规则的生成的脚本initenv.sh它的作用是将设备进行udev规则转换让所有设备拥有统一的名称。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-5"><details class="folding-tag" blue><summary> launch文件夹 </summary>
              <div class='content'>
              <details class="folding-tag" blue><summary> includes文件夹 </summary>              <div class='content'>              <p class='p blue'>存放的是ros自带的建图算法的launch文件</p><p class='p blue'>gmapping.launch、hector.launch、 karto.launch、 cartographer.launch</p>              </div>            </details><details class="folding-tag" blue><summary> lidar文件夹 </summary>              <div class='content'>              <p><p class='p blue'>lidar文件夹存放的是雷达的launch文件是重新编写的不是自带的</p></p><ol><li>启动雷达硬件</li><li>雷达的基坐标系名字使用lidar_frame参数（lidar）</li><li>雷达的端口改为/dev/rplidar<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;lidar_frame&quot;</span> default=<span class="string">&quot;lidar&quot;</span>/&gt;   </span><br><span class="line"></span><br><span class="line">    &lt;node name=<span class="string">&quot;rplidarNode&quot;</span>          pkg=<span class="string">&quot;rplidar_ros&quot;</span>  <span class="built_in">type</span>=<span class="string">&quot;rplidarNode&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;serial_port&quot;</span>         <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span> value=<span class="string">&quot;/dev/rplidar&quot;</span>/&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;serial_baudrate&quot;</span>     <span class="built_in">type</span>=<span class="string">&quot;int&quot;</span>    value=<span class="string">&quot;115200&quot;</span>/&gt;&lt;!--A1/A2 --&gt;</span><br><span class="line">        &lt;!--param name=<span class="string">&quot;serial_baudrate&quot;</span>     <span class="built_in">type</span>=<span class="string">&quot;int&quot;</span>    value=<span class="string">&quot;256000&quot;</span>--&gt;&lt;!--A3 --&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;frame_id&quot;</span>            <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span> value=<span class="string">&quot;<span class="subst">$(arg lidar_frame)</span>&quot;</span>/&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;inverted&quot;</span>            <span class="built_in">type</span>=<span class="string">&quot;bool&quot;</span>   value=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;angle_compensate&quot;</span>    <span class="built_in">type</span>=<span class="string">&quot;bool&quot;</span>   value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" blue><summary> rviz文件夹 </summary>              <div class='content'>              <p><p class='p blue'>rviz存放的是rviz相关的launch文件用来打开对应的rviz界面--打开功能包robot_navigation下的rviz文件(可以用rviz界面导出)</p><br>lidar_rviz.launch—打开雷达的rviz界面(lidar.rviz)<br>slam_rviz.launch—打开slam建图的rviz界面(slam.rviz)<br>navigation_rviz.launch—打开单点导航的rviz界面(navigation.rviz)<br>multi_navigation.launch—打开多点导航的rviz界面(multi_navigation.rviz)</p>              </div>            </details><details class="folding-tag" green><summary> robot_slam_laser.launch文件 </summary>              <div class='content'>              <p>激光SLAM建图</p><ol><li><p class='p blue'>简介</p><br>slam_methods———gmapping<br>open_rviz————-false<br>simulation————false<br>planner—————-“”<br>指定导航算法，指定是否打开rviz，指定是否使用simulation(仿真机器人)，指定局部路径规划算法(dwa和teb)-<br>如果simulation为true就启动机器人模型robot_simulation/launch/simulation_one_robot.launch<br>如果simulation为false就启动robot_navigation/launch/robot_lidar.launch(雷达和底盘控制)<br>这个launch文件启动了底盘控制节点base_control/launch/base_control.launch和雷达节点robot_navigation/launch/lidar.launch<br>雷达节点robot_navigation/launch/lidar.launch功能是根据雷达环境变量的不同启动不同的雷达robot_navigation/launch/lidar/$(arg lidar_type).launch，根据底盘类型的不同发布不同的tf静态坐标-雷达到底盘，名字为base_footprint_to_laser<br>robot_navigation/launch/lidar/$(arg lidar_type).launch实现了以下功能<br>1.启动雷达硬件<br>2.雷达的基坐标系名字使用lidar_frame参数（lidar）<br>3.雷达的端口改为/dev/rplidar<br>启动建图算法的launch文件robot_navigation/launch/includes/$(arg slam_methods).launch<br>启动导航堆栈move_base.launch(ros提供)—-如果启动则可以边导航边建图</li><li><p class='p blue'>代码详解</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">  &lt;!-- Arguments --&gt;</span><br><span class="line">  //指定导航算法</span><br><span class="line">  &lt;arg name=<span class="string">&quot;slam_methods&quot;</span> default=<span class="string">&quot;gmapping&quot;</span> doc=<span class="string">&quot;slam type [gmapping, hector, karto, cartographer]&quot;</span>/&gt;</span><br><span class="line">  //指定是否打开rviz</span><br><span class="line">  &lt;arg name=<span class="string">&quot;open_rviz&quot;</span> default=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">  //指定是否使用simulation(仿真机器人)</span><br><span class="line">  &lt;arg name=<span class="string">&quot;simulation&quot;</span> default= <span class="string">&quot;false&quot;</span>/&gt; </span><br><span class="line">  //指定局部路径规划算法(dwa和teb)--teb适合阿克曼的转向，不能原地旋转</span><br><span class="line">  &lt;arg name=<span class="string">&quot;planner&quot;</span>  default=<span class="string">&quot;&quot;</span> doc=<span class="string">&quot;opt: dwa, teb&quot;</span>/&gt; </span><br><span class="line"></span><br><span class="line">  &lt;param name=<span class="string">&quot;/use_sim_time&quot;</span> value=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span> /&gt;  </span><br><span class="line"></span><br><span class="line">  &lt;!-- simulation robot with lidar and map--&gt;</span><br><span class="line">  //如果simulation为<span class="literal">true</span>就启动机器人模型robot_simulation/launch/simulation_one_robot.launch</span><br><span class="line">  &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span>&gt;</span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_simulation)</span>/launch/simulation_one_robot.launch&quot;</span>/&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">  //如果simulation为<span class="literal">false</span>就启动robot_navigation/launch/robot_lidar.launch(雷达和底盘控制)</span><br><span class="line">  &lt;!-- robot with lidar --&gt;</span><br><span class="line">  &lt;group unless=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span>&gt;</span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/robot_lidar.launch&quot;</span>/&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">  //启动建图算法的launch文件robot_navigation/launch/includes/$(arg slam_methods).launch</span><br><span class="line">  &lt;!-- SLAM: Gmapping, Cartographer, Hector, Karto --&gt;</span><br><span class="line">  &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/includes/<span class="subst">$(arg slam_methods)</span>.launch&quot;</span>&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;simulation&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span>/&gt;</span><br><span class="line">  &lt;/include&gt;</span><br><span class="line">   //启动导航堆栈move_base.launch(ros提供)</span><br><span class="line">  &lt;!-- move_base --&gt;</span><br><span class="line">  &lt;group unless=<span class="string">&quot;<span class="subst">$(eval planner == &#x27;&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/move_base.launch&quot;</span> unless=<span class="string">&quot;<span class="subst">$(eval planner == &#x27;&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;arg name=<span class="string">&quot;planner&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg planner)</span>&quot;</span>/&gt;</span><br><span class="line">    &lt;/include&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- rviz --&gt;</span><br><span class="line">  //如果open_rviz为<span class="literal">true</span>打开设置好的rviz配置robot_navigation/rviz/slam.rviz</span><br><span class="line">  &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(arg open_rviz)</span>&quot;</span>&gt; </span><br><span class="line">    &lt;node pkg=<span class="string">&quot;rviz&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;rviz&quot;</span> name=<span class="string">&quot;rviz&quot;</span> required=<span class="string">&quot;true&quot;</span></span><br><span class="line">          args=<span class="string">&quot;-d <span class="subst">$(find robot_navigation)</span>/rviz/slam.rviz&quot;</span>/&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> robot_navigation.launch文件 </summary>              <div class='content'>              <p>指定单点导航</p><ol><li><p class='p blue'>简介</p><br>指定导航的地图路径，启动仿真器机器人的地图<br>simulation为false就启动robot_navigation/launch/robot_lidar.launch(雷达和底盘控制)<br>启动地图服务器并读入地图文件<br>启动定位节点，根据车型载入不同的定位yaml文件<br>设置机器人在地图的初始位置和航向角<br>启动导航堆栈robot_navigation/launch/move_base.launch(核心)<br>这个launch文件主要功能<br>1.启动导航堆栈move_base(参数为全局规划器和导航规划器),载入车型的所有配置信息<br>2.接收控制信息话题和odom话题</li><li><p class='p blue'>代码详解</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">  &lt;!-- Arguments --&gt;</span><br><span class="line">  //指定导航的地图路径</span><br><span class="line">  &lt;arg name=<span class="string">&quot;map_file&quot;</span> default=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/maps/map.yaml&quot;</span>/&gt;</span><br><span class="line">  &lt;arg name=<span class="string">&quot;simulation&quot;</span> default= <span class="string">&quot;false&quot;</span>/&gt; </span><br><span class="line">  &lt;arg name=<span class="string">&quot;planner&quot;</span>  default=<span class="string">&quot;teb&quot;</span> doc=<span class="string">&quot;opt: dwa, teb&quot;</span>/&gt; </span><br><span class="line">  &lt;arg name=<span class="string">&quot;open_rviz&quot;</span> default=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">  &lt;arg name=<span class="string">&quot;use_dijkstra&quot;</span> default= <span class="string">&quot;true&quot;</span>/&gt; </span><br><span class="line">  //启动仿真器机器人的地图</span><br><span class="line">  &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span>&gt;</span><br><span class="line">    &lt;!-- simulation robot with lidar and map--&gt;</span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_simulation)</span>/launch/simulation_one_robot_with_map.launch&quot;</span>/&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">   //simulation为<span class="literal">false</span>就启动robot_navigation/launch/robot_lidar.launch(雷达和底盘控制)</span><br><span class="line">  &lt;group unless=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span>&gt;</span><br><span class="line">    &lt;!-- robot with lidar --&gt;</span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/robot_lidar.launch&quot;</span>&gt;</span><br><span class="line">          &lt;!--&lt;arg name=<span class="string">&quot;robot_name&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg robot_name)</span>&quot;</span>/&gt;--&gt;</span><br><span class="line">    &lt;/include&gt;</span><br><span class="line">    //启动地图服务器并读入地图文件 </span><br><span class="line">    &lt;!-- Map server --&gt;</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;map_server&quot;</span> name=<span class="string">&quot;map_server&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;map_server&quot;</span> args=<span class="string">&quot;<span class="subst">$(arg map_file)</span>&quot;</span>&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;frame_id&quot;</span> value=<span class="string">&quot;map&quot;</span>/&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">    //启动定位节点，根据车型载入不同的定位yaml文件</span><br><span class="line">    &lt;!-- AMCL --&gt;</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;amcl&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;amcl&quot;</span> name=<span class="string">&quot;amcl&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/amcl_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">    //机器人在地图的初始位置和航向角  </span><br><span class="line">      &lt;param name=<span class="string">&quot;initial_pose_x&quot;</span>            value=<span class="string">&quot;0.0&quot;</span>/&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;initial_pose_y&quot;</span>            value=<span class="string">&quot;0.0&quot;</span>/&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;initial_pose_a&quot;</span>            value=<span class="string">&quot;0.0&quot;</span>/&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">    //启动导航堆栈robot_navigation/launch/move_base.launch</span><br><span class="line">  &lt;!-- move_base --&gt;</span><br><span class="line">  &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/move_base.launch&quot;</span> &gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;planner&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg planner)</span>&quot;</span>/&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;simulation&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span>/&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;use_dijkstra&quot;</span>     value=<span class="string">&quot;<span class="subst">$(arg use_dijkstra)</span>&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/include&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- rviz --&gt;</span><br><span class="line">  &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(arg open_rviz)</span>&quot;</span>&gt; </span><br><span class="line">    &lt;node pkg=<span class="string">&quot;rviz&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;rviz&quot;</span> name=<span class="string">&quot;rviz&quot;</span> required=<span class="string">&quot;true&quot;</span></span><br><span class="line">          args=<span class="string">&quot;-d <span class="subst">$(find robot_navigation)</span>/rviz/navigation.rviz&quot;</span>/&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> multi_points_navigation.launch文件 </summary>              <div class='content'>              <p>指定多点导航<br>只是启动了一个python文件multi_goal_point.py<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--&lt;node name=<span class="string">&quot;robot_pose_publisher&quot;</span> pkg=<span class="string">&quot;robot_pose_publisher&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;robot_pose_publisher&quot;</span> /&gt;--&gt;</span><br><span class="line">    &lt;node name=<span class="string">&quot;multi_mark&quot;</span> pkg=<span class="string">&quot;robot_navigation&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;multi_goal_point.py&quot;</span> output=<span class="string">&quot;screen&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" green><summary> way_point.launch文件 </summary>              <div class='content'>              <p>多点全自动巡航<br>只是启动了一个python文件way_point.py<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- For Simulation --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;sim_mode&quot;</span> default=<span class="string">&quot;false&quot;</span> /&gt;</span><br><span class="line">    &lt;param name=<span class="string">&quot;/use_sim_time&quot;</span> value=<span class="string">&quot;<span class="subst">$(arg sim_mode)</span>&quot;</span>/&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;loopTimes&quot;</span>       default=<span class="string">&quot;0&quot;</span> /&gt;</span><br><span class="line">    &lt;!-- move base --&gt;</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;robot_navigation&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;way_point.py&quot;</span> respawn=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;way_point&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">        &lt;!-- params <span class="keyword">for</span> move_base --&gt;</span><br><span class="line">        //自动巡航的三个点的坐标以及循环次数，0代表不停止</span><br><span class="line">        &lt;param name=<span class="string">&quot;goalListX&quot;</span> value=<span class="string">&quot;[4.2, 4.6, 4.4]&quot;</span> /&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;goalListY&quot;</span> value=<span class="string">&quot;[4.6, 7.4, 9.2]&quot;</span> /&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;goalListZ&quot;</span> value=<span class="string">&quot;[0.0, 0.0, 0.0]&quot;</span> /&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;loopTimes&quot;</span> value=<span class="string">&quot;<span class="subst">$(arg loopTimes)</span>&quot;</span>/&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;map_frame&quot;</span> value=<span class="string">&quot;map&quot;</span> /&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" green><summary> navigation_stack.launch文件 </summary>              <div class='content'>              </div>            </details><details class="folding-tag" green><summary> robot_lidar.launch文件 </summary>              <div class='content'>              <ol><li><p class='p blue'>启动底盘控制节点</p><br>base_control/launch/base_control.launch</li><li><p class='p blue'>启动雷达节点</p><br>robot_navigation/launch/lidar.launch<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- config param --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;pub_imu&quot;</span>       default=<span class="string">&quot;False&quot;</span> /&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;sub_ackermann&quot;</span>       default=<span class="string">&quot;False&quot;</span> /&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;lidar_frame&quot;</span> default=<span class="string">&quot;base_laser_link&quot;</span>/&gt;  </span><br><span class="line"></span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find base_control)</span>/launch/base_control.launch&quot;</span>&gt;</span><br><span class="line">        &lt;arg name=<span class="string">&quot;pub_imu&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg pub_imu)</span>&quot;</span>/&gt;  </span><br><span class="line">        &lt;arg name=<span class="string">&quot;sub_ackermann&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg sub_ackermann)</span>&quot;</span>/&gt;  </span><br><span class="line">    &lt;/include&gt;</span><br><span class="line"></span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/lidar.launch&quot;</span>&gt;</span><br><span class="line">        &lt;arg name=<span class="string">&quot;lidar_frame&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg lidar_frame)</span>&quot;</span>/&gt;  </span><br><span class="line">    &lt;/include&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> lidar.launch文件 </summary>              <div class='content'>              <ol><li><p class='p blue'>根据雷达环境变量的不同启动不同的雷达</p><br>robot_navigation/launch/lidar/$(arg lidar_type).launch</li><li><p class='p blue'>根据底盘类型的不同发布不同的tf静态坐标-雷达到底盘，名字为base_footprint_to_laser</p></li><li><p class='p blue'>用launch发布静态坐标的方法，名字为base_footprint_to_laser</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"> &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoRobot&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;-0.01225 0.0 0.18 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">```        </span><br><span class="line">```bash</span><br><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!--robot bast <span class="built_in">type</span> use different tf value--&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;base_type&quot;</span>       default=<span class="string">&quot;<span class="subst">$(env BASE_TYPE)</span>&quot;</span> /&gt;</span><br><span class="line">    &lt;!-- robot frame --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;base_frame&quot;</span>       default=<span class="string">&quot;/base_footprint&quot;</span> /&gt;    </span><br><span class="line">    &lt;arg name=<span class="string">&quot;lidar_type&quot;</span>       default=<span class="string">&quot;<span class="subst">$(env LIDAR_TYPE)</span>&quot;</span> /&gt;   </span><br><span class="line">    &lt;arg name=<span class="string">&quot;lidar_frame&quot;</span> default=<span class="string">&quot;base_laser_link&quot;</span>/&gt;  </span><br><span class="line"></span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/lidar/<span class="subst">$(arg lidar_type)</span>.launch&quot;</span>&gt;</span><br><span class="line">        &lt;arg name=<span class="string">&quot;lidar_frame&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg lidar_frame)</span>&quot;</span>/&gt;</span><br><span class="line">    &lt;/include&gt;</span><br><span class="line"></span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoRobot&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;-0.01225 0.0 0.18 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoRobot_Pro&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;-0.0515 0.0 0.18 -1.5708 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;4WD&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.01 0.0 0.25 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;4WD_OMNI&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.01 0.0 0.25 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoCar&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.1037 0.0 0.115 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoCar_Pro&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.1037 0.0 0.165 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoCar_SE&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.0955 0.0 0.115 1.5708 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;Race182&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.1 0.0 0.192 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoOmni&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.019 0.0 0.192 3.14159265 0.0 1.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> move_base.launch文件 </summary>              <div class='content'>              <p>启动导航堆栈move_base.launch(ros提供)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">  &lt;!-- Arguments --&gt;</span><br><span class="line">  &lt;arg name=<span class="string">&quot;cmd_vel_topic&quot;</span> default=<span class="string">&quot;cmd_vel&quot;</span> /&gt;</span><br><span class="line">  &lt;arg name=<span class="string">&quot;odom_topic&quot;</span> default=<span class="string">&quot;odom&quot;</span> /&gt;</span><br><span class="line">  &lt;arg name=<span class="string">&quot;planner&quot;</span>  default=<span class="string">&quot;dwa&quot;</span> doc=<span class="string">&quot;opt: dwa, teb&quot;</span>/&gt; </span><br><span class="line">  &lt;arg name=<span class="string">&quot;simulation&quot;</span> default= <span class="string">&quot;false&quot;</span>/&gt; </span><br><span class="line">  &lt;arg name=<span class="string">&quot;use_dijkstra&quot;</span> default= <span class="string">&quot;true&quot;</span>/&gt;  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  &lt;arg name=<span class="string">&quot;base_type&quot;</span> default= <span class="string">&quot;<span class="subst">$(env BASE_TYPE)</span>&quot;</span>/&gt; </span><br><span class="line">  //雷达建图和导航是360度所以可以用<span class="literal">false</span>，用相机导航和建图只能看见前面所以用<span class="literal">true</span></span><br><span class="line">  &lt;arg name=<span class="string">&quot;move_forward_only&quot;</span> default=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- move_base use DWA planner--&gt;</span><br><span class="line">  &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval planner == &#x27;dwa&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">  //启动导航堆栈move_base(参数为全局规划器和导航规划器),载入车型的所有配置信息</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;move_base&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;move_base&quot;</span> respawn=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;move_base&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">      &lt;!-- use global_planner replace default navfn as global planner ,global_planner support A* and dijkstra algorithm--&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;base_global_planner&quot;</span> value=<span class="string">&quot;global_planner/GlobalPlanner&quot;</span>/&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;base_local_planner&quot;</span> value=<span class="string">&quot;dwa_local_planner/DWAPlannerROS&quot;</span> /&gt;</span><br><span class="line">      &lt;!-- &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/global_planner_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;       --&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/costmap_common_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> ns=<span class="string">&quot;global_costmap&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/costmap_common_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> ns=<span class="string">&quot;local_costmap&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/local_costmap_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/global_costmap_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/move_base_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/dwa_local_planner_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      //接收控制信息话题和odom话题</span><br><span class="line">      &lt;remap from=<span class="string">&quot;cmd_vel&quot;</span> to=<span class="string">&quot;<span class="subst">$(arg cmd_vel_topic)</span>&quot;</span>/&gt;</span><br><span class="line">      &lt;remap from=<span class="string">&quot;odom&quot;</span> to=<span class="string">&quot;<span class="subst">$(arg odom_topic)</span>&quot;</span>/&gt;</span><br><span class="line">      当只允许前向运动时设置局部规划最小速度为0，不出现负速度(后向)</span><br><span class="line">      &lt;param name=<span class="string">&quot;DWAPlannerROS/min_vel_x&quot;</span> value=<span class="string">&quot;0.0&quot;</span> <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(arg move_forward_only)</span>&quot;</span> /&gt;</span><br><span class="line">      &lt;!--default is True,use dijkstra algorithm;<span class="built_in">set</span> to False,usd A* algorithm--&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;GlobalPlanner/use_dijkstra &quot;</span> value=<span class="string">&quot;<span class="subst">$(arg use_dijkstra)</span>&quot;</span> /&gt;    </span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">  &lt;!-- move_base use TEB planner--&gt;</span><br><span class="line">  &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval planner == &#x27;teb&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;move_base&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;move_base&quot;</span> respawn=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;move_base&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">      &lt;!-- use global_planner replace default navfn as global planner ,global_planner support A* and dijkstra algorithm--&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;base_global_planner&quot;</span> value=<span class="string">&quot;global_planner/GlobalPlanner&quot;</span>/&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;base_local_planner&quot;</span> value=<span class="string">&quot;teb_local_planner/TebLocalPlannerROS&quot;</span> /&gt;</span><br><span class="line">      &lt;!-- &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/global_planner_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt; --&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/costmap_common_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> ns=<span class="string">&quot;global_costmap&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/costmap_common_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> ns=<span class="string">&quot;local_costmap&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/local_costmap_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/global_costmap_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/move_base_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/teb_local_planner_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;remap from=<span class="string">&quot;cmd_vel&quot;</span> to=<span class="string">&quot;<span class="subst">$(arg cmd_vel_topic)</span>&quot;</span>/&gt;</span><br><span class="line">      &lt;remap from=<span class="string">&quot;odom&quot;</span> to=<span class="string">&quot;<span class="subst">$(arg odom_topic)</span>&quot;</span>/&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;TebLocalPlannerROS/max_vel_x_backwards&quot;</span> value=<span class="string">&quot;0.0&quot;</span> <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(arg move_forward_only)</span>&quot;</span> /&gt;</span><br><span class="line">      &lt;!--default is True,use dijkstra algorithm;<span class="built_in">set</span> to False,usd A* algorithm--&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;GlobalPlanner/use_dijkstra &quot;</span> value=<span class="string">&quot;<span class="subst">$(arg use_dijkstra)</span>&quot;</span> /&gt;</span><br><span class="line">      &lt;!--stage simulator takes the angle instead of the rotvel as input (twist message)--&gt;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;!-- move_base --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></p>              </div>            </details>
              </div>
            </details>
<details class="folding-tag" blue><summary> config文件夹 </summary>
              <div class='content'>
              <p>算法的配置，下载后自动出现</p>
              </div>
            </details>
<details class="folding-tag" blue><summary> maps文件夹 </summary>
              <div class='content'>
              <p>maps存放的是地图文件和地图配置信息相关的文件</p>
              </div>
            </details>
<details class="folding-tag" blue><summary> param文件夹 </summary>
              <div class='content'>
              <p>param存放的是yaml文件——一个车型一个文件夹(ros有)<br>NanoCar：</p><p><p class='p blue'>amcl_params.yaml--设置机器人定位配置</p></p><p><p class='p blue'>costmap_common_params.yaml--设置机器人的矩形轮廓尺寸</p><br>footprint: [ [-0.035,-0.1], [0.18,-0.1], [0.18,0.1], [-0.035,0.1] ]表示以机器人中心为坐标轴原点，这四个坐标点分别对应机器人的四个角。路径规划器获取到机器人轮廓大小从而规划相应的路径</p><p><p class='p blue'>local_costmap_params.yaml--在这个文件中需要指定发布频率和更新频率</p><br>为了降低机器人的计算负担设置了一个以机器人所在位置为中心的3*3滑动窗口，这个框设置得越小路径规划效果越差，越大机器人负担的运算就越大。最后设置了一个地图的层，第一个是静态层，也就是建图时的黑色边界以外的灰色可通行区域。第二个是障碍物层，地图中不存在但是实际扫面到的障碍物会被识别在障碍物层。</p><p><p class='p blue'>global_costmap_params.yaml--这个文件也是一样设置一些发布频率等信息</p></p><p><p class='p blue'>move_base_params.yaml--这个文件也是进行一些频率设置，包括对地盘的控制频率，路径规划频率以及机器人在一个点持续震荡时最大允许震荡时间等等。</p><br>最后clearing_rotation_allowed这个参数的作用是，当机器人被困住时会原地360度转一圈重新扫描找到一条出路。这里我们的机器人以NanoCar是为例它不具备原地转向的能力所以需要禁用。</p><p><p class='p blue'>dwa_local_planner_params.yaml--设置机器人导航的最大最小速度，y轴的横向运动速度，转向角度，加速度信息，到达目标所能容忍的误差等等。</p><br>当planner参数为teb时，同样启动move_base功能包下的move_base节点加下来载入的参数也基本一致，区别在于最后载入的是teb_local_planner_params.yaml文件</p><p><p class='p blue'>teb_local_planner_params.yaml--和dwa的基本类似，它将参数分开设置成转向速度，x轴速度，x轴后向的速度，y轴速度，y轴后向速度等等。</p><br>teb路径规划支持阿克曼结构的机器人，所以需要设置最小转向半径的参数，轮距参数等。在使用仿真器仿真阿克曼车型时需要将cmd_angle_instead_rotvel参数值改为true。这是由于stage仿真器中”Car”车型接受的cmd_vel话题中z轴角速度并非给定机器人角速度，而是指转向结构的转向角度。</p>
              </div>
            </details>
<details class="folding-tag" blue><summary> rviz文件夹 </summary>
              <div class='content'>

              </div>
            </details>
<details class="folding-tag" blue><summary> script文件夹 </summary>
              <div class='content'>
              <details class="folding-tag" green><summary> multi_goal_point.py文件 </summary>              <div class='content'>              <p><p class='p blue'>简介</p><br>通过rviz界面的按钮发布/goal话题而不是直接发布/move_base_simple/goal，因为这个话题会直接发布给move_base而直接产生导航目标直接开始了导航。因此通过了markerArray = MarkerArray()把/goal缓存起来作为数组，第一个点通过click_callback回调开始导航然后对每一个导航点的结果触发回调status_callback来启动下一个目标点的导航<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding=gbk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copyright 2020 Wechange Tech.</span></span><br><span class="line"><span class="comment"># Developer: FuZhi, Liu (liu.fuzhi@wechangetech.com)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line">from visualization_msgs.msg import Marker</span><br><span class="line">from visualization_msgs.msg import MarkerArray</span><br><span class="line">import rospy</span><br><span class="line">import math</span><br><span class="line">from geometry_msgs.msg import PointStamped,PoseStamped</span><br><span class="line">import actionlib</span><br><span class="line">from move_base_msgs.msg import *</span><br><span class="line">import tf</span><br><span class="line">//如果导航状态为3代表成功到达目标点读取下一个目标点的位置给pose变量</span><br><span class="line">//使用goal_pub发布到/move_base_simple/goal话题(真正触发move_base进行导航的话题)</span><br><span class="line">def status_callback(msg):</span><br><span class="line"></span><br><span class="line">    global goal_pub, index,markerArray</span><br><span class="line">    global add_more_point,try_again</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(msg.status.status == 3):</span><br><span class="line">        try_again = 1</span><br><span class="line">        <span class="keyword">if</span> add_more_point == 0:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Goal reached&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> index &lt; count:</span><br><span class="line"></span><br><span class="line">            pose = PoseStamped()</span><br><span class="line">            pose.header.frame_id = <span class="string">&quot;map&quot;</span></span><br><span class="line">            pose.header.stamp = rospy.Time.now()</span><br><span class="line">            pose.pose.position.x = markerArray.markers[index].pose.position.x</span><br><span class="line">            pose.pose.position.y = markerArray.markers[index].pose.position.y</span><br><span class="line">            pose.pose.orientation.w = 1</span><br><span class="line">            goal_pub.publish(pose)</span><br><span class="line"></span><br><span class="line">            index += 1</span><br><span class="line">    //当导航点都执行结束令add_more_point = 1 </span><br><span class="line">    //此时如果设置了新的目标点click_callback会被执行</span><br><span class="line">    //<span class="keyword">if</span> add_more_point and count &gt; 0得到满足强制发布了move.status.status = 3</span><br><span class="line">    //主函数又发布了/move_base/result话题重新执行status_callback来发布新的目标点     </span><br><span class="line">        <span class="keyword">elif</span> index == count:</span><br><span class="line">            add_more_point = 1</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># uint8 PENDING         = 0   # The goal has yet to be processed by the action server</span></span><br><span class="line">    <span class="comment"># uint8 ACTIVE          = 1   # The goal is currently being processed by the action server</span></span><br><span class="line">    <span class="comment"># uint8 PREEMPTED       = 2   # The goal received a cancel request after it started executing</span></span><br><span class="line">    <span class="comment">#                             #   and has since completed its execution (Terminal State)</span></span><br><span class="line">    <span class="comment"># uint8 SUCCEEDED       = 3   # The goal was achieved successfully by the action server (Terminal State)</span></span><br><span class="line">    <span class="comment"># uint8 ABORTED         = 4   # The goal was aborted during execution by the action server due</span></span><br><span class="line">    <span class="comment">#                             #    to some failure (Terminal State)</span></span><br><span class="line">    <span class="comment"># uint8 REJECTED        = 5   # The goal was rejected by the action server without being processed,</span></span><br><span class="line">    <span class="comment">#                             #    because the goal was unattainable or invalid (Terminal State)</span></span><br><span class="line">    <span class="comment"># uint8 PREEMPTING      = 6   # The goal received a cancel request after it started executing</span></span><br><span class="line">    <span class="comment">#                             #    and has not yet completed execution</span></span><br><span class="line">    <span class="comment"># uint8 RECALLING       = 7   # The goal received a cancel request before it started executing,</span></span><br><span class="line">    <span class="comment">#                             #    but the action server has not yet confirmed that the goal is canceled</span></span><br><span class="line">    <span class="comment"># uint8 RECALLED        = 8   # The goal received a cancel request before it started executing</span></span><br><span class="line">    <span class="comment">#                             #    and was successfully cancelled (Terminal State)</span></span><br><span class="line">    <span class="comment"># uint8 LOST            = 9   # An action client can determine that a goal is LOST. This should not be</span></span><br><span class="line">    <span class="comment">#                             #    sent over the wire by an action server</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Goal cannot reached has some error :&#x27;</span>,msg.status.status,<span class="string">&quot; try again!!!!&quot;</span></span><br><span class="line">        <span class="keyword">if</span> try_again == 1:</span><br><span class="line">            pose = PoseStamped()</span><br><span class="line">            pose.header.frame_id = <span class="string">&quot;map&quot;</span></span><br><span class="line">            pose.header.stamp = rospy.Time.now()</span><br><span class="line">            pose.pose.position.x = markerArray.markers[index-1].pose.position.x</span><br><span class="line">            pose.pose.position.y = markerArray.markers[index-1].pose.position.y</span><br><span class="line">            pose.pose.orientation.w = 1</span><br><span class="line">            goal_pub.publish(pose)</span><br><span class="line">            try_again = 0</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> index &lt; len(markerArray.markers):</span><br><span class="line">                pose = PoseStamped()</span><br><span class="line">                pose.header.frame_id = <span class="string">&quot;map&quot;</span></span><br><span class="line">                pose.header.stamp = rospy.Time.now()</span><br><span class="line">                pose.pose.position.x = markerArray.markers[index].pose.position.x</span><br><span class="line">                pose.pose.position.y = markerArray.markers[index].pose.position.y</span><br><span class="line">                pose.pose.orientation.w = 1</span><br><span class="line">                goal_pub.publish(pose)</span><br><span class="line">                index += 1</span><br><span class="line"></span><br><span class="line">//rviz界面每点击一个多目标点就提取位置信息追加到markerArray数组中并发布出去</span><br><span class="line">def click_callback(msg):</span><br><span class="line">    global markerArray,count</span><br><span class="line">    global goal_pub,index</span><br><span class="line">    global add_more_point</span><br><span class="line"></span><br><span class="line">    marker = Marker()</span><br><span class="line">    marker.header.frame_id = <span class="string">&quot;map&quot;</span></span><br><span class="line">    marker.header.stamp = rospy.Time.now()</span><br><span class="line">    <span class="comment"># marker.type = marker.TEXT_VIEW_FACING</span></span><br><span class="line">    marker.type = marker.CYLINDER</span><br><span class="line">    marker.action = marker.ADD</span><br><span class="line">    marker.scale.x = 0.2</span><br><span class="line">    marker.scale.y = 0.2</span><br><span class="line">    marker.scale.z = 0.5</span><br><span class="line">    marker.color.a = 1.0</span><br><span class="line">    marker.color.r = 0.0</span><br><span class="line">    marker.color.g = 1.0</span><br><span class="line">    marker.color.b = 0.0</span><br><span class="line">    marker.pose.orientation.x = 0.0</span><br><span class="line">    marker.pose.orientation.y = 0.0</span><br><span class="line">    marker.pose.orientation.z = 0.0</span><br><span class="line">    marker.pose.orientation.w = 1.0</span><br><span class="line">    marker.pose.position.x = msg.pose.position.x</span><br><span class="line">    marker.pose.position.y = msg.pose.position.y</span><br><span class="line">    marker.pose.position.z = msg.pose.position.z</span><br><span class="line"></span><br><span class="line">    markerArray.markers.append(marker)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Renumber the marker IDs</span></span><br><span class="line">    id = 0</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> markerArray.markers:</span><br><span class="line">       m.id = id</span><br><span class="line">       id += 1</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Publish the MarkerArray</span></span><br><span class="line">    mark_pub.publish(markerArray)</span><br><span class="line">    //如果rviz只发布了一个目标点就提取位置信息到pose变量</span><br><span class="line">    //使用goal_pub发布到/move_base_simple/goal话题(真正触发move_base进行导航的话题)</span><br><span class="line">    <span class="comment">#first goal</span></span><br><span class="line">    <span class="keyword">if</span> count==0:</span><br><span class="line">        pose = PoseStamped()</span><br><span class="line">        pose.header.frame_id = <span class="string">&quot;map&quot;</span></span><br><span class="line">        pose.header.stamp = rospy.Time.now()</span><br><span class="line">        pose.pose.position.x = msg.pose.position.x</span><br><span class="line">        pose.pose.position.y = msg.pose.position.y</span><br><span class="line">        pose.pose.position.z = msg.pose.position.z</span><br><span class="line">        pose.pose.orientation.x = msg.pose.orientation.x</span><br><span class="line">        pose.pose.orientation.y = msg.pose.orientation.y</span><br><span class="line">        pose.pose.orientation.z = msg.pose.orientation.z</span><br><span class="line">        pose.pose.orientation.w = msg.pose.orientation.w</span><br><span class="line">        goal_pub.publish(pose)</span><br><span class="line">        index += 1</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> add_more_point and count &gt; 0:</span><br><span class="line">        add_more_point = 0</span><br><span class="line">        move =MoveBaseActionResult()</span><br><span class="line">        move.status.status = 3</span><br><span class="line">        move.header.stamp = rospy.Time.now()</span><br><span class="line">        goal_status_pub.publish(move)</span><br><span class="line">    quaternion = (msg.pose.orientation.x, msg.pose.orientation.y, msg.pose.orientation.z, msg.pose.orientation.w)</span><br><span class="line">    theta = tf.transformations.euler_from_quaternion( quaternion)[2]</span><br><span class="line">    count += 1</span><br><span class="line">    <span class="comment"># print &#x27;add a path goal point %f %f %f&#x27;%(msg.pose.position.x,msg.pose.position.y,theta*180.0/3.14)</span></span><br><span class="line"></span><br><span class="line">//定义一个变量名字为markerArray类型为MarkerArray</span><br><span class="line">//rviz界面每增加一个目标点就会有MarkerArray类型的标记符号</span><br><span class="line">markerArray = MarkerArray()</span><br><span class="line">//发布的目标点数量</span><br><span class="line">count = 0       <span class="comment">#total goal num</span></span><br><span class="line">//统计当前执行到了哪一个目标点</span><br><span class="line">index = 0       <span class="comment">#current goal point index</span></span><br><span class="line">//统计到达所有目标点后有无新增加的目标点</span><br><span class="line">add_more_point = 0 <span class="comment"># after all goal arrive, if add some more goal</span></span><br><span class="line">//没有到达目标点重试一次</span><br><span class="line">try_again = 1  <span class="comment"># try the fail goal once again</span></span><br><span class="line">//创建节点名字为multi_goal_point_demo</span><br><span class="line">rospy.init_node(<span class="string">&#x27;multi_goal_point_demo&#x27;</span>)</span><br><span class="line">//创建发布器发布/path_point_array话题发布类型为MarkerArray</span><br><span class="line">mark_pub = rospy.Publisher(<span class="string">&#x27;/path_point_array&#x27;</span>, MarkerArray,queue_size=100)</span><br><span class="line">//创建订阅器订阅/goal话题--rviz界面多目标点发布的话题，回调函数click_callback</span><br><span class="line">click_goal_sub = rospy.Subscriber(<span class="string">&#x27;/goal&#x27;</span>,PoseStamped,click_callback)</span><br><span class="line">//创建发布器发布/move_base_simple/goal话题(真正触发move_base进行导航的话题)发布类型为PoseStamped</span><br><span class="line">goal_pub = rospy.Publisher(<span class="string">&#x27;/move_base_simple/goal&#x27;</span>,PoseStamped,queue_size=1)</span><br><span class="line">//创建订阅器订阅/move_base/result--move_base导航的结果，回调函数status_callback</span><br><span class="line">goal_status_sub = rospy.Subscriber(<span class="string">&#x27;/move_base/result&#x27;</span>,MoveBaseActionResult,status_callback)</span><br><span class="line"><span class="comment">#after all goal arrive, if add some more goal</span></span><br><span class="line"><span class="comment">#we deleberate pub a topic to trig the goal sent</span></span><br><span class="line">//所有导航点结束/move_base/result话题不再发布，手动发布一下导航结果话题方便继续发布导航点</span><br><span class="line">goal_status_pub = rospy.Publisher(<span class="string">&#x27;/move_base/result&#x27;</span>,MoveBaseActionResult,queue_size=1)</span><br><span class="line">rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" green><summary> way_point.py文件 </summary>              <div class='content'>              <p><p class='p blue'>简介</p><br>获取自动巡航的三个点的坐标以及循环次数，0代表不停止(launch文件可传)如果没有值则默认后面的数据<br>对三个点处理成数组形式<br>判断三个数组是不是相等<br>执行MultiGoals函数功能如下:<br>创建订阅器订阅导航结果move_base/result回调函数为statusCB<br>创建发布器发布move_base_simple/goal话题直接启动move_base进行导航<br>读取巡航点的坐标和循环次数，设置巡航结束标志wayPointFinished为False<br>设置目标点id为0<br>发布第一个目标点的位置信息到move_base_simple/goal话题<br>目标点id加1，到达第一个目标点后move_base/result话题会被发布执行回调函数为statusCB<br>回调函数statusCB功能如下:<br>如果循环次数达到，令wayPointFinished = True<br>如果成功到达且巡航结束标志wayPointFinished = false继续发布下一个目标点位置信息<br>如果没有执行完所有目标点就令目标点id加1，<br>执行完了所有目标点就令目标点id为0并且循环次数标志加1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding=gbk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copyright 2020 Wechange Tech.</span></span><br><span class="line"><span class="comment"># Developer: FuZhi, Liu (liu.fuzhi@wechangetech.com)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line">import rospy</span><br><span class="line">import string</span><br><span class="line">import math</span><br><span class="line">import time</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">from std_msgs.msg import String</span><br><span class="line">from move_base_msgs.msg import MoveBaseActionResult</span><br><span class="line">from actionlib_msgs.msg import GoalStatusArray</span><br><span class="line">from geometry_msgs.msg import PoseStamped</span><br><span class="line">import tf</span><br><span class="line">//创建订阅器订阅导航结果move_base/result回调函数为statusCB</span><br><span class="line">//创建发布器发布move_base_simple/goal话题直接启动move_base进行导航</span><br><span class="line">class MultiGoals:</span><br><span class="line">    def __init__(self, goalListX, goalListY, goalListZ,loopTimes, map_frame):</span><br><span class="line">        self.sub = rospy.Subscriber(<span class="string">&#x27;move_base/result&#x27;</span>, MoveBaseActionResult, self.statusCB, queue_size=10)</span><br><span class="line">        self.pub = rospy.Publisher(<span class="string">&#x27;move_base_simple/goal&#x27;</span>, PoseStamped, queue_size=10)   </span><br><span class="line">        <span class="comment"># params &amp; variables</span></span><br><span class="line">        //读取巡航点的坐标和循环次数，设置巡航结束标志wayPointFinished为False</span><br><span class="line">        self.goalListX = goalListX</span><br><span class="line">        self.goalListY = goalListY</span><br><span class="line">        self.goalListZ = goalListZ</span><br><span class="line">        self.loopTimes = loopTimes</span><br><span class="line">        self.loop = 1</span><br><span class="line">        self.wayPointFinished = False </span><br><span class="line">        //设置目标点id为0</span><br><span class="line">        self.goalId = 0</span><br><span class="line">        self.goalMsg = PoseStamped()</span><br><span class="line">        self.goalMsg.header.frame_id = map_frame</span><br><span class="line">        self.goalMsg.pose.orientation.z = 0.0</span><br><span class="line">        self.goalMsg.pose.orientation.w = 1.0</span><br><span class="line">        <span class="comment"># Publish the first goal</span></span><br><span class="line">        //发布第一个目标点的位置信息</span><br><span class="line">        time.sleep(1)</span><br><span class="line">        self.goalMsg.header.stamp = rospy.Time.now()</span><br><span class="line">        self.goalMsg.pose.position.x = self.goalListX[self.goalId]</span><br><span class="line">        self.goalMsg.pose.position.y = self.goalListY[self.goalId]</span><br><span class="line">        self.goalMsg.pose.orientation.x = 0.0</span><br><span class="line">        self.goalMsg.pose.orientation.y = 0.0</span><br><span class="line">        <span class="keyword">if</span> abs(self.goalListZ[self.goalId]) &gt; 1.0:</span><br><span class="line">            self.goalMsg.pose.orientation.z = 0.0</span><br><span class="line">            self.goalMsg.pose.orientation.w = 1.0</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            w = math.sqrt(1 - (self.goalListZ[self.goalId]) ** 2)</span><br><span class="line">            self.goalMsg.pose.orientation.z = self.goalListZ[self.goalId]</span><br><span class="line">            self.goalMsg.pose.orientation.w = w</span><br><span class="line">        self.pub.publish(self.goalMsg) </span><br><span class="line">        rospy.loginfo(<span class="string">&quot;Current Goal ID is: %d&quot;</span>, self.goalId)</span><br><span class="line">        //目标点id加1，到达第一个目标点后move_base/result话题会被发布执行回调函数为statusCB</span><br><span class="line">        self.goalId = self.goalId + 1 </span><br><span class="line"></span><br><span class="line">    def statusCB(self, data):</span><br><span class="line">    //如果循环次数达到，令wayPointFinished = True</span><br><span class="line">        <span class="keyword">if</span> self.loopTimes and (self.loop &gt; self.loopTimes):</span><br><span class="line">            rospy.loginfo(<span class="string">&quot;Loop: %d Times Finshed&quot;</span>, self.loopTimes)</span><br><span class="line">            self.wayPointFinished = True</span><br><span class="line">     //如果成功到达且巡航结束标志wayPointFinished = <span class="literal">false</span>继续发布下一个目标点位置信息       </span><br><span class="line">        <span class="keyword">if</span> data.status.status == 3 and (not self.wayPointFinished): <span class="comment"># reached</span></span><br><span class="line">            self.goalMsg.header.stamp = rospy.Time.now()                </span><br><span class="line">            self.goalMsg.pose.position.x = self.goalListX[self.goalId]</span><br><span class="line">            self.goalMsg.pose.position.y = self.goalListY[self.goalId]</span><br><span class="line">            <span class="keyword">if</span> abs(self.goalListZ[self.goalId]) &gt; 1.0:</span><br><span class="line">                self.goalMsg.pose.orientation.z = 0.0</span><br><span class="line">                self.goalMsg.pose.orientation.w = 1.0</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                w = math.sqrt(1 - (self.goalListZ[self.goalId]) ** 2)</span><br><span class="line">                self.goalMsg.pose.orientation.z = self.goalListZ[self.goalId]</span><br><span class="line">                self.goalMsg.pose.orientation.w = w</span><br><span class="line">            self.pub.publish(self.goalMsg)  </span><br><span class="line">            rospy.loginfo(<span class="string">&quot;Current Goal ID is: %d&quot;</span>, self.goalId)  </span><br><span class="line">            //如果没有执行完所有目标点就令目标点id加1，</span><br><span class="line">            //执行完了所有目标点就令目标点id为0并且循环次数标志加1            </span><br><span class="line">            <span class="keyword">if</span> self.goalId &lt; (len(self.goalListX)-1):</span><br><span class="line">                self.goalId = self.goalId + 1</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.goalId = 0</span><br><span class="line">                self.loop += 1</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    try:    </span><br><span class="line">        <span class="comment"># ROS Init    </span></span><br><span class="line">        rospy.init_node(<span class="string">&#x27;way_point&#x27;</span>, anonymous=True)</span><br><span class="line">    //获取自动巡航的三个点的坐标以及循环次数，0代表不停止(launch文件可传)如果没有值则默认后面的数据</span><br><span class="line">        <span class="comment"># Get params</span></span><br><span class="line">        goalListX = rospy.get_param(<span class="string">&#x27;~goalListX&#x27;</span>, <span class="string">&#x27;[2.0, 2.0]&#x27;</span>)</span><br><span class="line">        goalListY = rospy.get_param(<span class="string">&#x27;~goalListY&#x27;</span>, <span class="string">&#x27;[2.0, 4.0]&#x27;</span>)</span><br><span class="line">        goalListZ = rospy.get_param(<span class="string">&#x27;~goalListZ&#x27;</span>, <span class="string">&#x27;[0.0, 0.0]&#x27;</span>)</span><br><span class="line">        map_frame = rospy.get_param(<span class="string">&#x27;~map_frame&#x27;</span>, <span class="string">&#x27;map&#x27;</span> )</span><br><span class="line">        loopTimes = int(rospy.get_param(<span class="string">&#x27;~loopTimes&#x27;</span>, <span class="string">&#x27;0&#x27;</span>)) </span><br><span class="line">    //对三个点处理成数组形式</span><br><span class="line">        goalListX = goalListX.replace(<span class="string">&quot;[&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;]&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">        goalListY = goalListY.replace(<span class="string">&quot;[&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;]&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">        goalListZ = goalListZ.replace(<span class="string">&quot;[&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;]&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">        goalListX = [<span class="built_in">float</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> goalListX.split(<span class="string">&quot;,&quot;</span>)]</span><br><span class="line">        goalListY = [<span class="built_in">float</span>(y) <span class="keyword">for</span> y <span class="keyword">in</span> goalListY.split(<span class="string">&quot;,&quot;</span>)]</span><br><span class="line">        goalListZ = [<span class="built_in">float</span>(z) <span class="keyword">for</span> z <span class="keyword">in</span> goalListZ.split(<span class="string">&quot;,&quot;</span>)]</span><br><span class="line">    //判断三个数组是不是相等    </span><br><span class="line">        <span class="keyword">if</span> len(goalListX) == len(goalListY) == len(goalListZ) &amp; len(goalListY) &gt;=2:          </span><br><span class="line">            <span class="comment"># Constract MultiGoals Obj</span></span><br><span class="line"></span><br><span class="line">            rospy.loginfo(<span class="string">&quot;Multi Goals Executing...&quot;</span>)</span><br><span class="line">            mg = MultiGoals(goalListX, goalListY, goalListZ, loopTimes, map_frame) </span><br><span class="line">    //执行MultiGoals函数                 </span><br><span class="line">            rospy.spin()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rospy.errinfo(<span class="string">&quot;Lengths of goal lists are not the same&quot;</span>)</span><br><span class="line">    except KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;shutting down&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" green><summary> initenv.sh文件 </summary>              <div class='content'>              </div>            </details><details class="folding-tag" green><summary> setlidar.sh文件 </summary>              <div class='content'>              </div>            </details>
              </div>
            </details>
<details class="folding-tag" blue><summary> package.xml文件 </summary>
              <div class='content'>
              <p>运行依赖，编译依赖</p>
              </div>
            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-6"><p>simulation_one_robot.launch：<br>这个launch文件是启动机器人的仿真时用到的launch，它启动了stage_ros这个节点。这个节点运行了一个仿真器的环境，它需要一个仿真器的配置作为参数传入。我们以NanoCar为例看一下它的配置文件内容。<br>首先它包含了一个robot.inc文件，这个文件是用于描述我们所要仿真的机器人的信息。它定义了一个雷达传感器包括雷达扫描最远距离，扫描角度，雷达采样点数量以及雷达的尺寸。然后定义了机器人的位置，里程计的误差，机器人的尺寸，机器人的基座标与仿真器仿真出来的机器人立方体模型的偏移，机器人的颜色，机器人的运动学特性，机器人轴距，激光雷达到车身的变换等信息<br>回到maze.world文件，这里需要设置仿真器启动后窗口的大小中心点等信息。<br>配置仿真地图，地图存放在功能包的maps文件下。size参数设置地图的实际大小。地图的规格为200<em>200我们设置的实际尺寸是10米</em>10米也就是每个像素点5厘米。然后设置中心为5<em>5<br>最后把机器人加载进地图当中，在地图的1</em>1位置放置机器人，机器人名设为robot。这里注意机器人位置如果设为0*0会把机器人放到边界上导致出错<br>simulation_one_robot_with_map.launch：<br>这个launch的前半部分和simulation_one_robot.launch是一样的，后半部分它分别启动了一个map_server来载入地图和amcl的节点用于定位机器人。amcl的节点有初始位置作为参数传入节点。<br>map_server载入的地图文件就是maze.yaml文件，它读取的图为maze.png。设置分辨率为0.05也就是一个像素对应5厘米，这与前面设置的实际地图大小是一致的。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
</article><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/media/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3.webp" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/blog/slam%E5%AE%9E%E4%BD%93%E6%9C%BA%E5%99%A8%E4%BA%BA/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/top_img.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">slam实体机器人</div></div></a></div><div class="next-post pull-right"><a href="/blog/ros%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/ros%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ros编程入门</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">one by one</div><div class="author-info__description">存放个人信息</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/guguliu"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:你的邮箱" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/blog/qt-ros/" title="qt-ros"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/top_img.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="qt-ros"/></a><div class="content"><a class="title" href="/blog/qt-ros/" title="qt-ros">qt-ros</a><time datetime="2023-03-29T01:47:57.000Z" title="发表于 2023-03-29 09:47:57">2023-03-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/slam%E5%AE%9E%E4%BD%93%E6%9C%BA%E5%99%A8%E4%BA%BA/" title="slam实体机器人"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/top_img.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="slam实体机器人"/></a><div class="content"><a class="title" href="/blog/slam%E5%AE%9E%E4%BD%93%E6%9C%BA%E5%99%A8%E4%BA%BA/" title="slam实体机器人">slam实体机器人</a><time datetime="2023-03-07T03:32:46.000Z" title="发表于 2023-03-07 11:32:46">2023-03-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3/" title="slam功能包详解"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="slam功能包详解"/></a><div class="content"><a class="title" href="/blog/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3/" title="slam功能包详解">slam功能包详解</a><time datetime="2023-02-02T03:21:55.000Z" title="发表于 2023-02-02 11:21:55">2023-02-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/ros%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/" title="ros编程入门"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/ros%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ros编程入门"/></a><div class="content"><a class="title" href="/blog/ros%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/" title="ros编程入门">ros编程入门</a><time datetime="2023-01-12T10:39:13.000Z" title="发表于 2023-01-12 18:39:13">2023-01-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/ros-slam%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/" title="ros-slam路径规划"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/roll06.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ros-slam路径规划"/></a><div class="content"><a class="title" href="/blog/ros-slam%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/" title="ros-slam路径规划">ros-slam路径规划</a><time datetime="2023-01-08T09:01:29.000Z" title="发表于 2023-01-08 17:01:29">2023-01-08</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By one by one</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      true && mermaid.init()
    })
  }
}</script></div><script defer src="/js/light.js"></script><script async data-pjax src="/js/randombg.js"></script><script defer src="https://cdn.jsdelivr.net/gh/CodeByZach/pace/pace.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 190px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 160px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(/media/roll01.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/qt/&quot;);" href="javascript:void(0);">qt</a><span class="categoryBar-list-count">3</span><span class="categoryBar-list-descr">详情点击</span></li><li class="categoryBar-list-item" style="background:url(/media/roll02.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/linux/&quot;);" href="javascript:void(0);">linux</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">详情点击</span></li><li class="categoryBar-list-item" style="background:url(/media/roll03.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/毕业设计/&quot;);" href="javascript:void(0);">毕业设计</a><span class="categoryBar-list-count">3</span><span class="categoryBar-list-descr">详情点击</span></li><li class="categoryBar-list-item" style="background:url(/media/roll04.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/工具/&quot;);" href="javascript:void(0);">工具</a><span class="categoryBar-list-count">2</span><span class="categoryBar-list-descr">详情点击</span></li><li class="categoryBar-list-item" style="background:url(/media/roll05.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/视频/&quot;);" href="javascript:void(0);">视频</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">详情点击</span></li><li class="categoryBar-list-item" style="background:url(/media/roll06.webp);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/实训/&quot;);" href="javascript:void(0);">实训</a><span class="categoryBar-list-count">2</span><span class="categoryBar-list-descr">详情点击</span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v6.2.0" title=""><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.3.1" title=""><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站采用多线部署，主线路托管于Vercel" title=""><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://dashboard.4everland.org/" style="margin-inline:5px" data-title="本站采用多线部署，备用线路托管于4EVERLAND" title=""><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Hosted-4EVERLAND-22DDDD?style=flat&amp;logo=IPFS" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://www.fomal.cc/static/js/runtime.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;blog/tools/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/工具.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-05-24</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;blog/tools/&quot;);" href="javascript:void(0);" alt="">工具</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;blog/tools/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;blog/videos/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/视频网址.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-05-24</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;blog/videos/&quot;);" href="javascript:void(0);" alt="">视频网址</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;blog/videos/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;blog/linux/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/roll03.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-06-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;blog/linux/&quot;);" href="javascript:void(0);" alt="">linux</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;blog/linux/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;blog/UDP/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/roll02.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-07-23</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;blog/UDP/&quot;);" href="javascript:void(0);" alt="">UDP</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;blog/UDP/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;blog/STM32避障小车/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/STM32避障小车.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-01-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;blog/STM32避障小车/&quot;);" href="javascript:void(0);" alt="">STM32避障小车</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;blog/STM32避障小车/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var qweather_key = '45b78a857b7d4cb2b7841d352f582a80';
  var gaud_map_key = 'edce72c06fcf68f3406d2ecb75d329e0';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '113.34532,23.15624';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__bounceInLeft');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__bounceInRight');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('pagination');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__rotateInDownLeft');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --><script src="/live2d_models/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d_models/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2d_models/assets/wanko.model.json"},"display":{"position":"left","width":100,"height":150,"hOffset":-10,"vOffset":40},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>