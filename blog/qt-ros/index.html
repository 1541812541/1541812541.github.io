<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>qt-ros | 晓</title><meta name="keywords" content="晓氏集团"><meta name="author" content="one by one"><meta name="copyright" content="one by one"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="环境配置机器人仪表盘其他界面设计rviz导航类界面设计源码及图片 常见错误                               编译不成功解决办法删除工作空间的build和develcd catkin_qt&#x2F;catkin_makeqt下编译失败https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_50303783&#x2F;article&#x2F;details&#x2F;117359878?spm&#x3D;1001.">
<meta property="og:type" content="article">
<meta property="og:title" content="qt-ros">
<meta property="og:url" content="http://xiaoxigroup.org/blog/qt-ros/index.html">
<meta property="og:site_name" content="晓">
<meta property="og:description" content="环境配置机器人仪表盘其他界面设计rviz导航类界面设计源码及图片 常见错误                               编译不成功解决办法删除工作空间的build和develcd catkin_qt&#x2F;catkin_makeqt下编译失败https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_50303783&#x2F;article&#x2F;details&#x2F;117359878?spm&#x3D;1001.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://xiaoxigroup.org/media/qt-ros.webp">
<meta property="article:published_time" content="2023-03-29T01:47:57.000Z">
<meta property="article:modified_time" content="2024-03-11T16:04:36.385Z">
<meta property="article:author" content="one by one">
<meta property="article:tag" content="晓氏集团">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://xiaoxigroup.org/media/qt-ros.webp"><link rel="shortcut icon" href="/media/2.jpg"><link rel="canonical" href="http://xiaoxigroup.org/blog/qt-ros/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'qt-ros',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: false,
  postUpdate: '2024-03-12 00:04:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://www.fomal.cc/static/css/runtime.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/1.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/todolist"><span> 计划表</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 我的</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><i class="fa-fw fas fa-book"></i><span> 作业</span></a></li><li><a class="site-page child" href="/myimage/"><i class="fa-fw fas fa-camera"></i><span> 图片</span></a></li><li><a class="site-page child" href="/note"><i class="fa-fw fas fa-file-circle-check"></i><span> 笔记</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://985.so/bmx9r"><i class="fa-fw fas fa-headphones"></i><span> 夜听电脑版</span></a></li><li><a class="site-page child" href="/music-friends"><i class="fa-fw fas fa-headphones"></i><span> 音乐库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 传送门</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="http://985.so/mwb21"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/media/qt-ros.webp')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">晓</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/todolist"><span> 计划表</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 我的</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><i class="fa-fw fas fa-book"></i><span> 作业</span></a></li><li><a class="site-page child" href="/myimage/"><i class="fa-fw fas fa-camera"></i><span> 图片</span></a></li><li><a class="site-page child" href="/note"><i class="fa-fw fas fa-file-circle-check"></i><span> 笔记</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://985.so/bmx9r"><i class="fa-fw fas fa-headphones"></i><span> 夜听电脑版</span></a></li><li><a class="site-page child" href="/music-friends"><i class="fa-fw fas fa-headphones"></i><span> 音乐库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 传送门</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="http://985.so/mwb21"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">qt-ros</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-29T01:47:57.000Z" title="发表于 2023-03-29 09:47:57">2023-03-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-03-11T16:04:36.385Z" title="更新于 2024-03-12 00:04:36">2024-03-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1/">毕业设计</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">16k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>83分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="qt-ros"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><script src="/assets/js/DPlayer.min.js"> </script><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">环境配置</button></li><li class="tab"><button type="button" data-href="#test4-2">机器人仪表盘</button></li><li class="tab"><button type="button" data-href="#test4-3">其他界面设计</button></li><li class="tab"><button type="button" data-href="#test4-4">rviz导航类界面设计</button></li><li class="tab"><button type="button" data-href="#test4-5">源码及图片</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><details class="folding-tag" green><summary> 常见错误 </summary>
              <div class='content'>
              <ol><li><p class='p blue'>编译不成功</p><br>解决办法<br>删除工作空间的build和devel<br>cd catkin_qt/<br>catkin_make</li><li><p class='p blue'>qt下编译失败</p><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_50303783/article/details/117359878?spm=1001.2014.3001.5501">https://blog.csdn.net/weixin_50303783/article/details/117359878?spm=1001.2014.3001.5501</a></li><li><p class='p blue'>qt下编译显示找不到共享文件</p><br>配置qtcreator<br>sudo vim /usr/bin/qtcreator<br>添加如下内容： QT_HOME更改为自己qt安装路径的bin目录<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh </span><br><span class="line"><span class="keyword">export</span> QT_HOME=/home/xxxx/Qtxxx/Tools/QtCreator/bin </span><br><span class="line"><span class="keyword">export</span> QT_HOME=/home/lixiao/Qt5<span class="number">.9</span><span class="number">.9</span>/Tools/QtCreator/bin</span><br><span class="line">$QT_HOME/qtcreator $*</span><br></pre></td></tr></table></figure>更改可执行权限<br>sudo chmod a+x /usr/bin/qtcreator<br>终端输入：<br>qtcreator<br>不要直接点开软件</li></ol>
              </div>
            </details>
<details class="folding-tag" blue><summary> 配置流程 </summary>
              <div class='content'>
              <p>转载古月居 <a target="_blank" rel="noopener" href="http://www.guyuehome.com/6058">http://www.guyuehome.com/6058</a><br>ROS Qt5 librviz人机交互界面开发一（配置QT环境）</p><ol><li><p class='p blue'>首先安装ros对qt pkg的支持</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install update</span><br><span class="line">sudo apt-get install ros-melodic-qt-create</span><br><span class="line">sudo apt-get install ros-melodic-qt-build</span><br></pre></td></tr></table></figure>这样就能通过：catkin_create_qt_pkg命令创建ros gui包了:<br>在src目录下创建包：<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd catkin_ws/src</span><br><span class="line">catkin_create_qt_pkg qt_ros_test roscpp rviz </span><br></pre></td></tr></table></figure></li><li><p class='p blue'>安装qtcreator</p><br><a target="_blank" rel="noopener" href="https://s3.jcloud.sjtu.edu.cn/899a892efef34b1b944a19981040f55b-oss01/rsync/qt/921fa12ae4f32a039557388302b3796dcb5915dd">https://s3.jcloud.sjtu.edu.cn/899a892efef34b1b944a19981040f55b-oss01/rsync/qt/921fa12ae4f32a039557388302b3796dcb5915dd</a><br>更改安装包的可执行权限<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x qt-opensource-linux-x64<span class="number">-5.9</span><span class="number">.9</span>.run</span><br></pre></td></tr></table></figure>双击安装包名安装<br>断网安装<br>安装组件选择上Desktop gcc 64-bit</li><li><p class='p blue'>配置qtcreator</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/bin/qtcreator</span><br></pre></td></tr></table></figure>添加如下内容： QT_HOME更改为自己qt安装路径的bin目录<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh </span><br><span class="line"><span class="keyword">export</span> QT_HOME=/home/xxxx/Qtxxx/Tools/QtCreator/bin </span><br><span class="line"><span class="keyword">export</span> QT_HOME=/home/lixiao/Qt5<span class="number">.9</span><span class="number">.9</span>/Tools/QtCreator/bin</span><br><span class="line">$QT_HOME/qtcreator $*</span><br></pre></td></tr></table></figure>更改可执行权限<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod a+x /usr/bin/qtcreator</span><br></pre></td></tr></table></figure>终端输入：<br>qtcreator<br>文件-&gt;打开项目-&gt;选择工作空间下src下的cmakelist.txt（==注意并非功能包下的==）<br>打开后点击项目： 将build的构建目录改为当前工作空间的build文件夹<br>然后返回编辑右键项目-&gt;执行cmake如果弹出提示框点击第一个按钮change，如果报错<a target="_blank" rel="noopener" href="http://www.guyuehome.com/6058#comment">http://www.guyuehome.com/6058#comment</a></li><li><p class='p blue'>更改功能包main_window.hpp</p><br>由于Q4t中包含QMainWindow在QtGui中，在Qt5中更改为QtWidgets类中，所以需要作更改：进入工作空间下的qt功能包比如上面创建的qt_ros_test ./include/功能包名/main_window.hpp<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QtGui/QMainWindow&gt;</span></span></span><br><span class="line">改为</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QtWidgets/QMainWindow&gt;</span></span></span><br></pre></td></tr></table></figure></li><li><p class='p blue'>运行可执行文件</p><br>在左侧项目-&gt;run-&gt;运行配置 更改要运行的可执行文件名称，并点击绿色三角形运行即可</li></ol>
              </div>
            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><ol>
<li><p><p class='p blue'>原理主要就是订阅机器人的odom话题，然后利用信号与槽更新ui仪表盘控件的信息</p></p>
<details class="folding-tag" green><summary> 一 创建qt项目功能包 </summary>
           <div class='content'>
           <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">catkin_create_qt_pkg命令创建ros gui包了: 在src目录下创建包：</span><br><span class="line">cd catkin_ws/src</span><br><span class="line">catkin_create_qt_pkg qt_ros_test</span><br></pre></td></tr></table></figure>
           </div>
         </details>
<details class="folding-tag" blue><summary> 二 更改功能包main_window.hpp </summary>
           <div class='content'>
           <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">qt功能包比如上面创建的qt_ros_test ./include/功能包名/main_window.hpp</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QtGui/QMainWindow&gt;</span></span></span><br><span class="line">改为</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QtWidgets/QMainWindow&gt;</span></span></span><br></pre></td></tr></table></figure>
           </div>
         </details>
<details class="folding-tag" yellow><summary> 三 返回编辑右键项目->执行cmake </summary>
           <div class='content'>

           </div>
         </details>
<details class="folding-tag" green><summary> 四 开始编写 </summary>
           <div class='content'>
           <ol><li><p class='p blue'>一在工作空间下的src文件夹->qt功能包->include文件夹->qt功能包同名文件夹->建立文件CCtrlDashBoard.hpp</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CCTRLDASHBOARD_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CCTRLDASHBOARD_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CCtrlDashBoard</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">StyleType</span> &#123;</span></span><br><span class="line">        ST_DEFAULT=<span class="number">0</span>,</span><br><span class="line">        ST_ARCBAR</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">CCtrlDashBoard</span><span class="params">(QWidget *parent = <span class="literal">nullptr</span>, StyleType type=ST_DEFAULT)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setValue</span><span class="params">(qreal value)</span></span>&#123;</span><br><span class="line">        m_DashValue = value;</span><br><span class="line">        update();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setBackGroundColor</span><span class="params">(QColor color)</span></span>&#123;</span><br><span class="line">        m_BgColor=color;</span><br><span class="line">        update();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setFrontColor</span><span class="params">(QColor color)</span></span>&#123;</span><br><span class="line">        m_FrontColor=color;</span><br><span class="line">        update();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setBorderColor</span><span class="params">(QColor color)</span></span>&#123;</span><br><span class="line">        m_BorderColor=color;</span><br><span class="line">        update();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setUnitString</span><span class="params">(QString str)</span></span>&#123;</span><br><span class="line">        m_StrUnit=str;</span><br><span class="line">        update();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">drawBackGround</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">drawScaleDials</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">drawIndicator</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">drawIndicatorBar</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span>;</span><br><span class="line">signals:</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent * event)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_StartAngle;</span><br><span class="line">    <span class="keyword">int</span> m_EndAngle;</span><br><span class="line">    <span class="keyword">int</span> m_StyleType;</span><br><span class="line"></span><br><span class="line">    qreal m_LineLength;</span><br><span class="line">    qreal m_DashValue;</span><br><span class="line">    qreal m_MaxValue;</span><br><span class="line">    qreal m_MinValue;</span><br><span class="line">    qreal m_DashNum;</span><br><span class="line"></span><br><span class="line">    QColor m_BgColor;</span><br><span class="line">    QColor m_FrontColor;</span><br><span class="line">    QColor m_BorderColor;</span><br><span class="line">    QString m_StrUnit;</span><br><span class="line"></span><br><span class="line">    qreal m_MaxBorderRadius;</span><br><span class="line">    qreal m_MinBorderRadius;</span><br><span class="line">    qreal m_DialsRadius;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// CCTRLDASHBOARD_H</span></span></span><br></pre></td></tr></table></figure></li><li><p class='p blue'>二在工作空间下的src文件夹->qt功能包->src文件夹->建立文件CCtrlDashBoard.cpp</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../include/qt_ros_test/CCtrlDashBoard.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qmath.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">CCtrlDashBoard::CCtrlDashBoard(QWidget *parent, StyleType type) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    m_StyleType(type)</span><br><span class="line">&#123;</span><br><span class="line">    m_BorderColor = QColor(<span class="number">172</span>,<span class="number">172</span>,<span class="number">172</span>);</span><br><span class="line">    m_BgColor = QColor(<span class="number">40</span>,<span class="number">40</span>,<span class="number">40</span>);</span><br><span class="line">    m_FrontColor = Qt::white;</span><br><span class="line"></span><br><span class="line">    m_DashValue= <span class="number">0</span>;</span><br><span class="line">    m_MinValue = <span class="number">0</span>;</span><br><span class="line">    m_MaxValue = <span class="number">100</span>;</span><br><span class="line">    m_DashNum = <span class="number">1</span>;</span><br><span class="line">    m_LineLength=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    m_StartAngle=<span class="number">90</span>;  <span class="comment">//510</span></span><br><span class="line">    m_EndAngle=<span class="number">0</span>;   <span class="comment">//120</span></span><br><span class="line">    update();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawBackGround</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_MaxBorderRadius = ((hlafWidth*<span class="number">5</span>)/<span class="number">6</span>);</span><br><span class="line">    qreal startX=hlafWidth-m_MaxBorderRadius;</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;setPen(m_BorderColor);</span><br><span class="line">    painter-&gt;setBrush(m_BorderColor);</span><br><span class="line"></span><br><span class="line">    QPainterPath bigCircle;</span><br><span class="line">    bigCircle.addEllipse(startX, startX, (m_MaxBorderRadius*<span class="number">2</span>), (m_MaxBorderRadius*<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    m_MinBorderRadius = m_MaxBorderRadius<span class="number">-15</span>;</span><br><span class="line">    startX=hlafWidth-m_MinBorderRadius;</span><br><span class="line">    QPainterPath smallCircle;</span><br><span class="line">    smallCircle.addEllipse(startX, startX, (m_MinBorderRadius*<span class="number">2</span>), (m_MinBorderRadius*<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    QPainterPath path = bigCircle - smallCircle;</span><br><span class="line">    painter-&gt;drawPath(path);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;setBrush(m_BgColor);</span><br><span class="line">    painter-&gt;drawEllipse(startX,startX,(m_MinBorderRadius*<span class="number">2</span>), (m_MinBorderRadius*<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">if</span>(m_DashValue==<span class="number">0</span>)&#123;</span><br><span class="line">      QString speed = <span class="string">&quot;0.0 cm/s&quot;</span>;</span><br><span class="line">      painter-&gt;drawText(startX+<span class="number">85</span>,startX+<span class="number">170</span>,speed);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      QString speed = QString::number(m_DashValue).mid(<span class="number">0</span>,<span class="number">3</span>) + <span class="string">&quot; cm/s&quot;</span>;</span><br><span class="line">      painter-&gt;drawText(startX+<span class="number">85</span>,startX+<span class="number">170</span>,speed);</span><br><span class="line">    &#125;</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">    m_DialsRadius = m_MinBorderRadius<span class="number">-10</span>;</span><br><span class="line">    <span class="keyword">if</span>(m_DialsRadius &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        m_DialsRadius=<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawScaleDials</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qreal tSteps = (m_MaxValue - m_MinValue)/m_DashNum; <span class="comment">//相乘后的值是分的份数</span></span><br><span class="line">    qreal angleStep = <span class="number">1.0</span>*(<span class="number">360.0</span>-m_StartAngle - m_EndAngle) / tSteps; <span class="comment">//每一个份数的角度</span></span><br><span class="line">    QPen pen ;</span><br><span class="line">    pen.setColor(m_FrontColor); <span class="comment">//推荐使用第二种方式</span></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle);</span><br><span class="line">    m_LineLength = (hlafWidth/<span class="number">16</span>);</span><br><span class="line">    qreal lineStart = m_DialsRadius<span class="number">-4</span>*m_LineLength-m_LineLength;</span><br><span class="line">    qreal lineSmStart = m_DialsRadius<span class="number">-4</span>*m_LineLength-m_LineLength/<span class="number">2</span>;</span><br><span class="line">    qreal lineEnd = m_DialsRadius<span class="number">-4</span>*m_LineLength;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tSteps; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">80</span>) pen.setColor(QColor(<span class="number">250</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">10</span> == <span class="number">0</span>)<span class="comment">//整数刻度显示加粗</span></span><br><span class="line">        &#123;</span><br><span class="line">            pen.setWidth(<span class="number">2</span>); <span class="comment">//设置线宽</span></span><br><span class="line">            painter-&gt;setPen(pen); <span class="comment">//使用面向对象的思想，把画笔关联上画家。通过画家画出来</span></span><br><span class="line">            painter-&gt;drawLine(lineStart,lineStart, lineEnd, lineEnd); <span class="comment">//两个参数应该是两个坐标值</span></span><br><span class="line">            <span class="comment">//painter-&gt;drawText(lineEnd+6,lineEnd+6, tr(&quot;%1&quot;).arg(m_MinValue+i));</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            pen.setWidth(<span class="number">1</span>);</span><br><span class="line">            painter-&gt;setPen(pen);</span><br><span class="line">            painter-&gt;drawLine(lineSmStart, lineSmStart, lineEnd, lineEnd); <span class="comment">//两个参数应该是两个坐标值</span></span><br><span class="line">        &#125;</span><br><span class="line">        painter-&gt;rotate(angleStep);</span><br><span class="line">    &#125;</span><br><span class="line">    pen.setColor(m_FrontColor);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;setPen(pen);</span><br><span class="line">    <span class="comment">//m_startAngle是起始角度，m_endAngle是结束角度，m_scaleMajor在一个量程中分成的刻度数</span></span><br><span class="line">    qreal startRad = ( <span class="number">315</span>-m_StartAngle) * (<span class="number">3.14</span> / <span class="number">180</span>);</span><br><span class="line">    qreal deltaRad = (<span class="number">360</span>-m_StartAngle - m_EndAngle) * (<span class="number">3.14</span> / <span class="number">180</span>) / tSteps;</span><br><span class="line">    qreal sina,cosa;</span><br><span class="line">    qreal x, y;</span><br><span class="line">    <span class="function">QFontMetricsF <span class="title">fm</span><span class="params">(<span class="keyword">this</span>-&gt;font())</span></span>;</span><br><span class="line">    <span class="keyword">double</span> w, h, tmpVal;</span><br><span class="line">    QString str;</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    lineEnd = m_MinBorderRadius<span class="number">-8</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tSteps; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">10</span> == <span class="number">0</span>)<span class="comment">//整数刻度显示加粗</span></span><br><span class="line">        &#123;</span><br><span class="line">            sina = qSin(startRad - i * deltaRad);</span><br><span class="line">            cosa = <span class="built_in">cos</span>(startRad - i * deltaRad);</span><br><span class="line"></span><br><span class="line">            tmpVal = <span class="number">1.0</span> * i *((m_MaxValue - m_MinValue) / tSteps) + m_MinValue;</span><br><span class="line">            str = QString( <span class="string">&quot;%1&quot;</span> ).arg(tmpVal);  <span class="comment">//%1作为占位符   arg()函数比起 sprintf()来是类型安全的</span></span><br><span class="line">            w = fm.size(Qt::TextSingleLine,str).width();</span><br><span class="line">            h = fm.size(Qt::TextSingleLine,str).height();</span><br><span class="line">            x = lineEnd * cosa - w / <span class="number">2</span>;</span><br><span class="line">            y = -lineEnd * sina + h / <span class="number">4</span>;</span><br><span class="line">            painter-&gt;drawText(x, y, str); <span class="comment">//函数的前两个参数是显示的坐标位置，后一个是显示的内容，是字符类型&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawIndicator</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QPolygon pts;</span><br><span class="line">    pts.setPoints(<span class="number">3</span>, <span class="number">-8</span>,<span class="number">0</span>, <span class="number">8</span>,<span class="number">0</span>, <span class="number">0</span>,(<span class="keyword">int</span>)m_DialsRadius<span class="number">-20</span>); <span class="comment">/* (-2,0)/(2,0)/(0,60) */</span><span class="comment">//第一个参数是 ，坐标的个数。后边的是坐标</span></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth, hlafWidth);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle<span class="number">-45</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(m_DashValue&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        qreal tSteps = (m_MaxValue - m_MinValue)/m_DashNum; <span class="comment">//相乘后的值是分的份数</span></span><br><span class="line">        qreal angleStep = <span class="number">1.0</span>*(<span class="number">360.0</span>-m_StartAngle - m_EndAngle) / tSteps; <span class="comment">//每一个份数的角度</span></span><br><span class="line">        <span class="keyword">double</span> degRotate = angleStep*tSteps*(m_DashValue/<span class="number">100.0</span>)+angleStep;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//画指针</span></span><br><span class="line">        <span class="comment">//qDebug() &lt;&lt;&quot;degRotate ==&quot;&lt;&lt;degRotate&lt;&lt;&quot;m_DashValue ==&quot;&lt;&lt;m_DashValue&lt;&lt;m_StartAngle&lt;&lt;m_DialsRadius&lt;&lt;hlafWidth;</span></span><br><span class="line">        <span class="keyword">if</span>(m_DashValue == <span class="number">99</span>)&#123;</span><br><span class="line">            painter-&gt;rotate(m_EndAngle-m_StartAngle);  <span class="comment">//顺时针旋转坐标系统</span></span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            painter-&gt;rotate(degRotate);  <span class="comment">//顺时针旋转坐标系统</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QRadialGradient <span class="title">haloGradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, hlafWidth/<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>;  <span class="comment">//辐射渐变</span></span><br><span class="line">    haloGradient.setColorAt(<span class="number">0</span>, QColor(<span class="number">255</span>,<span class="number">69</span>,<span class="number">0</span>));</span><br><span class="line">    haloGradient.setColorAt(<span class="number">1</span>, QColor(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    painter-&gt;setPen(Qt::white); <span class="comment">//定义线条文本颜色  设置线条的颜色</span></span><br><span class="line">    painter-&gt;setBrush(haloGradient);<span class="comment">//刷子定义形状如何填满 填充后的颜色</span></span><br><span class="line">    painter-&gt;drawConvexPolygon(pts); <span class="comment">//这是个重载函数，绘制多边形。</span></span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画中心点</span></span><br><span class="line">    <span class="function">QColor <span class="title">niceBlue</span><span class="params">(<span class="number">150</span>, <span class="number">150</span>, <span class="number">200</span>)</span></span>;</span><br><span class="line">    <span class="function">QConicalGradient <span class="title">coneGradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-90.0</span>)</span></span>;  <span class="comment">//角度渐变</span></span><br><span class="line">    coneGradient.setColorAt(<span class="number">0.0</span>, Qt::darkGray);</span><br><span class="line">    coneGradient.setColorAt(<span class="number">0.2</span>, niceBlue);</span><br><span class="line">    coneGradient.setColorAt(<span class="number">0.5</span>, Qt::white);</span><br><span class="line">    coneGradient.setColorAt(<span class="number">1.0</span>, Qt::darkGray);</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    painter-&gt;setPen(Qt::NoPen);  <span class="comment">//没有线，填满没有边界</span></span><br><span class="line">    painter-&gt;setBrush(coneGradient);</span><br><span class="line">    painter-&gt;drawEllipse(<span class="number">-10</span>, <span class="number">-10</span>, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawIndicatorBar</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 渐变色</span></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    qreal lineEnd = m_DialsRadius<span class="number">-3</span>*m_LineLength;</span><br><span class="line">    <span class="function">QRadialGradient <span class="title">gradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, lineEnd)</span></span>;</span><br><span class="line">    gradient.setColorAt(<span class="number">0</span>, Qt::white);</span><br><span class="line">    gradient.setColorAt(<span class="number">1.0</span>, Qt::blue);</span><br><span class="line">    painter-&gt;setBrush(gradient);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &lt;&lt; 1（左移1位）相当于radius*2 即：150*2=300</span></span><br><span class="line">    <span class="comment">//QRectF(-150, -150, 300, 300)</span></span><br><span class="line">    <span class="function">QRectF <span class="title">rect</span><span class="params">(-lineEnd, -lineEnd, lineEnd*<span class="number">2</span>, lineEnd*<span class="number">2</span>)</span></span>;</span><br><span class="line">    QPainterPath path;</span><br><span class="line">    path.arcTo(rect, m_StartAngle, <span class="number">270</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// QRectF(-120, -120, 240, 240)</span></span><br><span class="line">    QPainterPath subPath;</span><br><span class="line">    subPath.addEllipse(rect.adjusted(<span class="number">10</span>, <span class="number">10</span>, <span class="number">-10</span>, <span class="number">-10</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// path为扇形 subPath为椭圆</span></span><br><span class="line">    path -= subPath;</span><br><span class="line">    painter-&gt;setPen(Qt::NoPen);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle+<span class="number">45</span>);</span><br><span class="line">    painter-&gt;drawPath(path);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    qreal degRotate=<span class="number">0.1</span>;</span><br><span class="line">    <span class="keyword">if</span>(m_DashValue&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        qreal tSteps = (m_MaxValue - m_MinValue)/m_DashNum; <span class="comment">//相乘后的值是分的份数</span></span><br><span class="line">        qreal angleStep = <span class="number">1.0</span>*(<span class="number">360.0</span>-m_StartAngle - m_EndAngle) / tSteps; <span class="comment">//每一个份数的角度</span></span><br><span class="line">        degRotate = angleStep*tSteps*(m_DashValue/<span class="number">100.0</span>)+angleStep;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//画指针</span></span><br><span class="line">        <span class="comment">//qDebug() &lt;&lt;&quot;degRotate ==&quot;&lt;&lt;degRotate&lt;&lt;&quot;m_DashValue ==&quot;&lt;&lt;m_DashValue&lt;&lt;m_StartAngle&lt;&lt;m_DialsRadius&lt;&lt;hlafWidth;</span></span><br><span class="line">        <span class="comment">/*if(m_DashValue == 99)&#123;</span></span><br><span class="line"><span class="comment">            painter-&gt;rotate(m_EndAngle-m_StartAngle);  //顺时针旋转坐标系统</span></span><br><span class="line"><span class="comment">        &#125;else</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            painter-&gt;rotate(degRotate);  //顺时针旋转坐标系统</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth, hlafWidth);</span><br><span class="line"></span><br><span class="line">    <span class="function">QRadialGradient <span class="title">ftGradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, lineEnd)</span></span>;</span><br><span class="line">    ftGradient.setColorAt(<span class="number">0</span>, Qt::white);</span><br><span class="line">    ftGradient.setColorAt(<span class="number">1.0</span>, Qt::darkYellow);</span><br><span class="line">    painter-&gt;setBrush(ftGradient);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &lt;&lt; 1（左移1位）相当于radius*2 即：150*2=300</span></span><br><span class="line">    <span class="comment">//QRectF(-150, -150, 300, 300)</span></span><br><span class="line">    <span class="function">QRectF <span class="title">ftRect</span><span class="params">(-lineEnd, -lineEnd, lineEnd*<span class="number">2</span>, lineEnd*<span class="number">2</span>)</span></span>;</span><br><span class="line">    QPainterPath ftPath;</span><br><span class="line">    ftPath.arcTo(ftRect, m_EndAngle-m_StartAngle, -degRotate);</span><br><span class="line">    <span class="comment">// path为扇形 subPath为椭圆</span></span><br><span class="line">    ftPath -= subPath;</span><br><span class="line">    painter-&gt;rotate(m_StartAngle<span class="number">-45</span>);</span><br><span class="line">    painter-&gt;drawPath(ftPath);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line">    QPolygon pts;</span><br><span class="line">    <span class="keyword">int</span> pointLength=lineEnd<span class="number">-12</span>;</span><br><span class="line">    pts.setPoints(<span class="number">3</span>, <span class="number">-6</span>,pointLength<span class="number">-10</span>, <span class="number">6</span>,pointLength<span class="number">-10</span>, <span class="number">0</span>,pointLength);</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth, hlafWidth);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle<span class="number">-45</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(m_DashValue == <span class="number">99</span>)&#123;</span><br><span class="line">        painter-&gt;rotate(m_EndAngle-m_StartAngle);  <span class="comment">//顺时针旋转坐标系统</span></span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        painter-&gt;rotate(degRotate);  <span class="comment">//顺时针旋转坐标系统</span></span><br><span class="line">    &#125;</span><br><span class="line">    painter-&gt;setPen(Qt::white); <span class="comment">//定义线条文本颜色  设置线条的颜色</span></span><br><span class="line">    painter-&gt;setBrush(Qt::blue);<span class="comment">//刷子定义形状如何填满 填充后的颜色</span></span><br><span class="line">    painter-&gt;drawConvexPolygon(pts); <span class="comment">//这是个重载函数，绘制多边形。</span></span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::paintEvent</span><span class="params">(QPaintEvent * event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">p</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    qreal width = qMin((<span class="keyword">this</span>-&gt;width()&gt;&gt;<span class="number">1</span>), (<span class="keyword">this</span>-&gt;height()&gt;&gt;<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    p.setRenderHints(QPainter::Antialiasing|QPainter::TextAntialiasing);</span><br><span class="line"></span><br><span class="line">    drawBackGround(&amp;p, width);</span><br><span class="line"></span><br><span class="line">    drawScaleDials(&amp;p, width);</span><br><span class="line">    <span class="keyword">switch</span>(m_StyleType)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> ST_DEFAULT:</span><br><span class="line">        drawIndicator(&amp;p, width);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> ST_ARCBAR:</span><br><span class="line">        drawIndicatorBar(&amp;p, width);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p class='p blue'>三在工作空间下的src文件夹->qt功能包->src文件夹->main_window.cpp</p><br>需要在ui中添加一个widget(需要固定size)，我这里为widget_speed_x，widget_speed_y<br>找到提示区域Implementation [MainWindow]下的<br>MainWindow::MainWindow(int argc, char<em>* argv, QWidget </em>parent)<br> : QMainWindow(parent)<br> , qnode(argc,argv)<br> 函数里的Auto Start提示区域<br>添加代码：<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//init ui</span></span><br><span class="line"> speed_x_dashBoard=<span class="keyword">new</span> CCtrlDashBoard(ui.widget_speed_x);</span><br><span class="line"> speed_y_dashBoard=<span class="keyword">new</span> CCtrlDashBoard(ui.widget_speed_y);</span><br><span class="line"> speed_x_dashBoard-&gt;setGeometry(ui.widget_speed_x-&gt;rect());</span><br><span class="line"> speed_y_dashBoard-&gt;setGeometry(ui.widget_speed_y-&gt;rect());</span><br><span class="line"> speed_x_dashBoard-&gt;setValue(<span class="number">0</span>);</span><br><span class="line"> speed_y_dashBoard-&gt;setValue(<span class="number">0</span>);</span><br><span class="line"> ui.horizontalSlider_linera-&gt;setValue(<span class="number">20</span>);</span><br><span class="line"> ui.horizontalSlider_raw-&gt;setValue(<span class="number">20</span>);</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>订阅odom话题：</p><br>一创建订阅者：<br>在工作空间下的src文件夹-&gt;qt功能包-&gt;src文件夹-&gt;qnode.cpp<br>在bool QNode::init()两个函数中添加<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">odom_sub = n.subscribe(<span class="string">&quot;odom&quot;</span>,<span class="number">1000</span>,&amp;QNode::odom_raw_callback,<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>二回调函数：<br>取出话题中的数据给信号，并在有数据时发送该信号<br>emit就是发送信号</li><li>qnode.hpp中的Q_SIGNALS:加入<br>void speed_vel(float,float);<br>两个参数均为float,分别代表x和y方向的速度。一旦进入回调函数就发送这个信号</li><li>qnode.cpp中下方新起一行建立回调函数<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::odom_raw_callback</span><span class="params">(<span class="keyword">const</span> nav_msgs::Odometry &amp;msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">emit <span class="title">speed_vel</span><span class="params">(msg.twist.twist.linear.x,msg.twist.twist.linear.y)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>三 数据传递给ui<br>在main_window.cpp中创建一个connect以及槽函数，当收到speed_vel信号时执行槽函数slot_update_dashboard(float,float)。<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connect(&amp;qnode,SIGNAL(speed_vel(<span class="keyword">float</span>,<span class="keyword">float</span>)),<span class="keyword">this</span>,SLOT(slot_update_dashboard(<span class="keyword">float</span>,<span class="keyword">float</span>)));</span><br></pre></td></tr></table></figure>这个槽函数会把信号携带速度的信息提取出来并显示。如果值为负数，则在文本框中显示负向。如果值为正数，则在文本框中显示正向。同时由于显示在仪表盘中的数据是厘米每秒所以需要进行单位换算。<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_update_dashboard</span><span class="params">(<span class="keyword">float</span> x,<span class="keyword">float</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;  ui.label_dir_x-&gt;setText(x&gt;<span class="number">0</span>?<span class="string">&quot;正向&quot;</span>:<span class="string">&quot;反向&quot;</span>);</span><br><span class="line">   ui.label_dir_y-&gt;setText(y&gt;<span class="number">0</span>?<span class="string">&quot;正向&quot;</span>:<span class="string">&quot;反向&quot;</span>);</span><br><span class="line">   speed_x_dashBoard-&gt;setValue(<span class="built_in">abs</span>(x)*<span class="number">100</span>);</span><br><span class="line">   speed_y_dashBoard-&gt;setValue(<span class="built_in">abs</span>(y)*<span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>槽函数在main_window.hpp中的public Q_SLOTS:声明<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">slot_update_dashboard</span><span class="params">(<span class="keyword">float</span>,<span class="keyword">float</span>)</span></span>;</span><br></pre></td></tr></table></figure></li></ol>
           </div>
         </details>
</li>
</ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><details class="folding-tag" green><summary> 环境搭建 </summary>
              <div class='content'>
              <p>第一步<br>在qt官网中下载linux版本的qt进行安装，断网跳过注册，选择gcc编译。<br>第二步<br>安装依赖ros-melodic-qt-create和ros-melodic-qt-build。<br>第三步<br>创建qt功能包。<br>第四步<br>编译ROS工程打开qtcreator，在打开项目选择工作空间catkin_qt下的src文件夹里的CmakeList.txt文件。随后配置build目录为工作空间下的build文件夹。<br>第五步<br>编写ros节点，步骤大概分为在节点初始化函数中初始化ros节点、在master中注册节点、发布话题。</p>
              </div>
            </details>
<details class="folding-tag" blue><summary> 编写键盘控制界面 </summary>
              <div class='content'>
              <p>第一步ui设计<br>在ui界面设计中放置8个push button参考ros自带的控制节点，分别把这8个按钮的显示文本为u、i、o、j 、l、 m、 ,、.。<br>第二步<br>在Qnode::init函数中初始化节点，创建一个发布器cmd_vel_pub用来发布速度控制话题，话题名为cmd_vel。建立函数set_cmd_vel，该回调函数传入按钮，线速度，角速度三个参数时会根据绑定的字典得到控制的方向和速度，随后把数据传给消息类型为geometry_msgs::Twist的变量。随后通过发布器把这个控制话题发布出去。</p>
              </div>
            </details>
<details class="folding-tag" yellow><summary> 编写电量显示界面 </summary>
              <div class='content'>
              <p>第一步ui设计<br>放置几个label用来显示文字个图标，放置一个progressBar显示电池电量的百分比。在resources中右击open in editor添加图片方便打包<br>第二步<br>在Qnode::init函数中初始化节点，创建一个订阅器power_sub用来订阅电池信息的话题，话题名为voltage，收到该话题后执行回调函数power_callback,因为需要把信息显示到窗口上。所以在qnode.hpp中声明一个信号power_vel，参数为float类型的。一旦进入回调函数就发送这个信号<br>第三步<br>在main_window.cpp中创建一个connect，当收到power_vel信号时执行槽函数slot_update_power(float)。这个槽函数会把信号携带的信息提取出来并显示。显示百分比时把9.6v作为电池电量的最小值，11.7v作为电池电量最大值。依据的是yahboom小车。</p>
              </div>
            </details>
<details class="folding-tag" green><summary> 编写odom速度信息显示界面 </summary>
              <div class='content'>
              <p>第一步ui设计<br>放置tabWidget用来放置两个widget,一个用来放置x轴的速度仪表盘，名字为widget_speed_x，另一个用来放置y轴的速度仪表盘,名字为widget_speed_y。放置四个label显示速度的正反向。<br>第二步<br>在Qnode::init函数中初始化节点，创建一个订阅器odom_sub用来订阅odom信息的话题,话题名为odom,收到该话题后执行回调函数odom_raw_callback，因为需要把信息显示到窗口上所以在qnode.hpp中声明一个信号speed_vel,两个参数均为float,分别代表x和y方向的速度。一旦进入回调函数就发送这个信号。<br>第三步<br>在main_window.cpp中创建一个connect，当收到speed_vel信号时执行槽函数slot_update_dashboard(float,float)。这个槽函数会把信号携带速度的信息提取出来并显示。如果值为负数，则在文本框中显示负向。如果值为正数，则在文本框中显示正向。同时由于显示在仪表盘中的数据是厘米每秒所以需要进行单位换算。</p>
              </div>
            </details>
<details class="folding-tag" blue><summary> 编写摄像头画面显示界面 </summary>
              <div class='content'>
              <p>第一步<br>在CmakeLists.txt文件中添加三个依赖项cv_bridge、image_transport、sensor_msgs<br>随后包含三者的头文件。<br>第二步ui设计<br>放置一个label用来显示摄像头的图像，放置一个Line Edit用来输入订阅的图像话题的话题名，放置一个Push Button用来触发订阅话题的信号。<br>第三步<br>在头文件中声明图像话题的订阅者和收到图像话题后的回调函数以及把图像格式转化为qt支持的图像显示的函数Mat2QImage。<br>第四步在main_window.cpp中创建一个connect，当收到按钮的点击信号时执行槽函数slot_sub_image()。这个槽函数会把Line Edit上的文本信息作为参数传给接口函数sub_image(QString topic_name)，而这个接口函数会创建一个图像话题的订阅器。当收到图像话题时执行回调函数，回调函数把收到的图像处理成qt可以显示的图像后发送自定义信号image_val(QImage)。在main_window.cpp中创建一个connect，当收到image_val(QImage)信号时执行槽函数slot_update_image(QImage)，这个槽函数会把该信号携带的qt可以显示的图像内容通过setPixmap方法显示到label中</p>
              </div>
            </details>
<details class="folding-tag" yellow><summary> 编写快捷终端显示界面 </summary>
              <div class='content'>
              <p>第一步<br>在main_window.h文件中包含头文件QProcess。<br>第二步ui设计<br>放置两个Text Edit一个用来终端命令的输入一个用来输出终端信息。放置几个label用来给用户提示说明。放置一个Line Edit用来给用户选择命令。放置两个按钮，一个用来点击执行终端命令，一个用来确定自己选择的命令。此外在下面可以放置一些按钮用来提供快捷的命令提示。<br>第三步<br>使用Qprocess新建对象quck_cmd，使用quick_cmd-&gt;start(“bash”)来开启终端。使用quick_cmd-&gt;write(ui.textEdit_cmd-&gt;toPlainText().toLocal8Bit()+’\n’)来执行命令。在此注意每次点击执行终端命令后把两个Text Edit里的文本内容清空。随后使用connect将终端执行命令后的正确信息和错误信息一起输出到第二个文本框中。</p>
              </div>
            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-4"><details class="folding-tag" green><summary> 编写rviz基础显示界面 </summary>
              <div class='content'>
              <p>第一步新建一个类<br>类的名字为qrviz。然后添加依赖项rviz并包含相关头文件。包括rviz下的几个头文件。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/visualization_manager.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/render_panel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/display.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/tool_manager.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/tool.h&gt;</span></span></span><br></pre></td></tr></table></figure><br>第二步ui设计<br>在界面中放置一个Tree Widget用来显示rviz的控件。随后在main_window.cpp中设置treeWidget为两列并隐藏头部。利用new QtreeWidgetItem()添加treeWidget的每一行的第一列，利用new QComboBox()创建ComboBox。利用addItem为ComboBox添加选项。利用setItemWidget把ComboBox添加为tree Widget的第二列。<br>第三步<br> 在qrviz类的构造函数中创建一个rviz的显示容器并把该容器添加到刚刚放置的纵向布局的界面中。随后创建一个rviz的控制对象并初始化Camera实现放大缩小的功能。然后初始化rviz控制对象。<br>第四步<br>  设置参考坐标系，在treeWidget界面上添加一行的第一列为参考坐标系，第二列放一个ComboBox用来供用户选择。在此关闭下拉框防止闪退，当连接到master后在使能下拉框。为下拉框设置几个基本的选项比如base_link,map，odom等。创建一个connect，当收到ComboBox里的文本改变信号时执行槽函数slot_treewidget_value_change(QString)。这个槽函数会把ComboBox里的文本内容作为参数值给Set_FixedFrame(QString Frame_name)函数。该函数可以把rviz控制对象的固定坐标系设置为文本设置的坐标系。<br>第五步添加图层。<br>按照上述方法添加ui界面后创建图层函数Display* createDisplay(const  Qstring&amp; class_lookup_name, const Qstring&amp; name, bool enabled);其中class_lookup_name代表图层类名比如“rviz/Grid”，“rviz/RobotModel”，”rviz/Map”，”rviz/LaserScan”等等。最后设置图层属性函数比如颜色，线条尺寸等，通过subProp(Qstring prop_name)-&gt;setValue(Qvariant value)设置。通过以上办法可以将rviz显示的图层界面添加进来显示</p>
              </div>
            </details>
<details class="folding-tag" blue><summary> 编写rviz初始状态估计 </summary>
              <div class='content'>
              <p>第一步放置一个按钮<br>文本显示为初始状态估计，并添加图标。<br>第二步<br>在main_window.cpp中创建一个connect，当收到按钮的点击信号时执行槽函数slot_set_start_pose()，该槽函数会执行函数Set_Start_Pose()，该函数会生成一个初始状态估计的rviz工具对象，并把该对象设置为当前使用的rviz工具。</p>
              </div>
            </details>
<details class="folding-tag" yellow><summary> 编写rviz单点导航 </summary>
              <div class='content'>
              <p>放置一个按钮，文本显示为单点导航，并添加图标。在main_window.cpp中创建一个connect，当收到按钮的点击信号时执行槽函数slot_set_goal_pose()，该槽函数会执行函数Set_Goal_Pose()，该函数会生成一个设置目标点的rviz工具对象，并获取该对象的属性容器，通过属性容器发布导航目标点的话题/move_base_simple/goal。随后把该对象设置为当前使用的rviz工具。</p>
              </div>
            </details>
<details class="folding-tag" blue><summary> 编写rviz设置返航点 </summary>
              <div class='content'>
              <p>第一步放置一个按钮<br>文本显示为设置返航点，并添加图标。放置六个label用来显示当前amcl估计的坐标和返航点坐标。<br>第二步<br>在qnode.cpp中订阅amcl_pose话题，一旦收到该话题的内容执行amcl_pose_callback回调函数。该回调函数会把amcl_pose话题里的位置信息提取出来并发送信号position(double x,double y,double z)。 在main_window.cpp中创建一个connect，当收到该信号时执行槽函数slot_update_pos(double,double,double)，该槽函数会把信号携带的位置信息显示到label上。<br>第三步<br>在main_window.cpp中创建一个connect，当收到按钮的点击信号时执行槽函数slot_set_return_pos()，该槽函数会把label上显示的amcl估计的当前坐标显示到下面一行返航点的label上。</p>
              </div>
            </details>
<details class="folding-tag" green><summary> 编写rviz开始返航 </summary>
              <div class='content'>
              <p>第一步放置一个按钮<br>文本显示为开始返航，并添加图标。<br>第二步<br>在qnode.cpp中创建发布器发布move_base_simple/goal话题，随后编写函数set_goal(double x,double y,double z) 用来发布目标点。第三步在main_window.cpp中创建一个connect，当收到按钮的点击信号时执行槽函数slot_return()，该槽函数会调用set_goal(double x,double y,double z)把ui界面上的返航点坐标的label上的值作为参数值传给该函数，该函数会调用发布器发布目标点的坐标。</p>
              </div>
            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-5"><p>工作空间的CMakeLists.txt<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># toplevel CMakeLists.txt for a catkin workspace</span></span><br><span class="line"><span class="meta"># catkin/cmake/toplevel.cmake</span></span><br><span class="line"></span><br><span class="line">cmake_minimum_required(VERSION <span class="number">3.0</span><span class="number">.2</span>)</span><br><span class="line"></span><br><span class="line">project(Project)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CATKIN_TOPLEVEL TRUE)</span><br><span class="line"></span><br><span class="line"><span class="meta"># search for catkin within the workspace</span></span><br><span class="line"><span class="built_in">set</span>(_cmd <span class="string">&quot;catkin_find_pkg&quot;</span> <span class="string">&quot;catkin&quot;</span> <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;&quot;</span>)</span><br><span class="line">execute_process(COMMAND $&#123;_cmd&#125;</span><br><span class="line">  RESULT_VARIABLE _res</span><br><span class="line">  OUTPUT_VARIABLE _out</span><br><span class="line">  ERROR_VARIABLE _err</span><br><span class="line">  OUTPUT_STRIP_TRAILING_WHITESPACE</span><br><span class="line">  ERROR_STRIP_TRAILING_WHITESPACE</span><br><span class="line">)</span><br><span class="line"><span class="keyword">if</span>(NOT _res EQUAL <span class="number">0</span> AND NOT _res EQUAL <span class="number">2</span>)</span><br><span class="line">  <span class="meta"># searching fot catkin resulted in an <span class="meta-keyword">error</span></span></span><br><span class="line">  <span class="built_in">string</span>(REPLACE <span class="string">&quot;;&quot;</span> <span class="string">&quot; &quot;</span> _cmd_str <span class="string">&quot;$&#123;_cmd&#125;&quot;</span>)</span><br><span class="line">  message(FATAL_ERROR <span class="string">&quot;Search for &#x27;catkin&#x27; in workspace failed ($&#123;_cmd_str&#125;): $&#123;_err&#125;&quot;</span>)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> catkin from workspace or via find_package()</span></span><br><span class="line"><span class="keyword">if</span>(_res EQUAL <span class="number">0</span>)</span><br><span class="line">  <span class="built_in">set</span>(catkin_EXTRAS_DIR <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/$&#123;_out&#125;/cmake&quot;</span>)</span><br><span class="line">  <span class="meta"># <span class="meta-keyword">include</span> all.cmake without add_subdirectory to let it operate in same scope</span></span><br><span class="line">  include($&#123;catkin_EXTRAS_DIR&#125;/all.cmake NO_POLICY_SCOPE)</span><br><span class="line">  add_subdirectory(<span class="string">&quot;$&#123;_out&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="meta"># use either CMAKE_PREFIX_PATH explicitly passed to CMake as a command <span class="meta-keyword">line</span> argument</span></span><br><span class="line">  <span class="meta"># or CMAKE_PREFIX_PATH from the environment</span></span><br><span class="line">  <span class="keyword">if</span>(NOT DEFINED CMAKE_PREFIX_PATH)</span><br><span class="line">    <span class="keyword">if</span>(NOT <span class="string">&quot;$ENV&#123;CMAKE_PREFIX_PATH&#125;&quot;</span> STREQUAL <span class="string">&quot;&quot;</span>)</span><br><span class="line">      <span class="keyword">if</span>(NOT WIN32)</span><br><span class="line">        <span class="built_in">string</span>(REPLACE <span class="string">&quot;:&quot;</span> <span class="string">&quot;;&quot;</span> CMAKE_PREFIX_PATH $ENV&#123;CMAKE_PREFIX_PATH&#125;)</span><br><span class="line">      <span class="keyword">else</span>()</span><br><span class="line">        <span class="built_in">set</span>(CMAKE_PREFIX_PATH $ENV&#123;CMAKE_PREFIX_PATH&#125;)</span><br><span class="line">      endif()</span><br><span class="line">    endif()</span><br><span class="line">  endif()</span><br><span class="line"></span><br><span class="line">  <span class="meta"># list of catkin workspaces</span></span><br><span class="line">  <span class="built_in">set</span>(catkin_search_path <span class="string">&quot;&quot;</span>)</span><br><span class="line">  foreach(path $&#123;CMAKE_PREFIX_PATH&#125;)</span><br><span class="line">    <span class="keyword">if</span>(EXISTS <span class="string">&quot;$&#123;path&#125;/.catkin&quot;</span>)</span><br><span class="line">      <span class="built_in">list</span>(FIND catkin_search_path $&#123;path&#125; _index)</span><br><span class="line">      <span class="keyword">if</span>(_index EQUAL <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">list</span>(APPEND catkin_search_path $&#123;path&#125;)</span><br><span class="line">      endif()</span><br><span class="line">    endif()</span><br><span class="line">  endforeach()</span><br><span class="line"></span><br><span class="line">  <span class="meta"># search for catkin in all workspaces</span></span><br><span class="line">  <span class="built_in">set</span>(CATKIN_TOPLEVEL_FIND_PACKAGE TRUE)</span><br><span class="line">  find_package(catkin QUIET</span><br><span class="line">    NO_POLICY_SCOPE</span><br><span class="line">    PATHS $&#123;catkin_search_path&#125;</span><br><span class="line">    NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)</span><br><span class="line">  unset(CATKIN_TOPLEVEL_FIND_PACKAGE)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(NOT catkin_FOUND)</span><br><span class="line">    message(FATAL_ERROR <span class="string">&quot;find_package(catkin) failed. catkin was neither found in the workspace nor in the CMAKE_PREFIX_PATH. One reason may be that no ROS setup.sh was sourced before.&quot;</span>)</span><br><span class="line">  endif()</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line">catkin_workspace()</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>功能包下的CMakeLists.txt<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">##############################################################################</span><br><span class="line"># CMake</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br><span class="line">cmake_minimum_required(VERSION <span class="number">2.8</span><span class="number">.0</span>)</span><br><span class="line">project(qt_ros_test)</span><br><span class="line"><span class="built_in">set</span>(CMAKE_INCLUDE_CURRENT_DIR ON)</span><br><span class="line">##############################################################################</span><br><span class="line"># Catkin</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br><span class="line"># qt_build provides the qt cmake glue, roscpp the comms <span class="keyword">for</span> a <span class="keyword">default</span> talker</span><br><span class="line">## find_package(catkin REQUIRED COMPONENTS qt_build rviz roscpp)</span><br><span class="line">find_package(catkin REQUIRED COMPONENTS qt_build rviz roscpp sensor_msgs</span><br><span class="line">    cv_bridge</span><br><span class="line">    std_msgs</span><br><span class="line">    image_transport</span><br><span class="line">    )</span><br><span class="line">include_directories($&#123;catkin_INCLUDE_DIRS&#125;)</span><br><span class="line">find_package(Qt5 REQUIRED Core Widgets)</span><br><span class="line"><span class="built_in">set</span>(QT_LIBRARIES Qt5::Widgets)</span><br><span class="line"># Use this to define what the package will export (e.g. libs, headers).</span><br><span class="line"># Since the <span class="keyword">default</span> here is to produce only a binary, we don<span class="number">&#x27;</span>t worry about</span><br><span class="line"><span class="meta"># exporting anything. </span></span><br><span class="line">catkin_package()</span><br><span class="line"></span><br><span class="line">##############################################################################</span><br><span class="line"># Qt Environment</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br><span class="line"># this comes from qt_build&#x27;s qt-ros.cmake which is automatically </span><br><span class="line"><span class="meta"># included via the dependency call in package.xml</span></span><br><span class="line"># rosbuild_prepare_qt4(QtCore QtGui) # Add the appropriate components to the component <span class="built_in">list</span> here</span><br><span class="line"></span><br><span class="line">##############################################################################</span><br><span class="line"># Sections</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br><span class="line">file(GLOB QT_FORMS RELATIVE $&#123;CMAKE_CURRENT_SOURCE_DIR&#125; ui<span class="comment">/*.ui)</span></span><br><span class="line"><span class="comment">file(GLOB QT_RESOURCES RELATIVE $&#123;CMAKE_CURRENT_SOURCE_DIR&#125; resources/*.qrc)</span></span><br><span class="line"><span class="comment">file(GLOB_RECURSE QT_MOC RELATIVE $&#123;CMAKE_CURRENT_SOURCE_DIR&#125; FOLLOW_SYMLINKS include/qt_ros_test/*.hpp)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">QT5_ADD_RESOURCES(QT_RESOURCES_CPP $&#123;QT_RESOURCES&#125;)</span></span><br><span class="line"><span class="comment">QT5_WRAP_UI(QT_FORMS_HPP $&#123;QT_FORMS&#125;)</span></span><br><span class="line"><span class="comment">QT5_WRAP_CPP(QT_MOC_HPP $&#123;QT_MOC&#125;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment"># Sources</span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">file(GLOB_RECURSE QT_SOURCES RELATIVE $&#123;CMAKE_CURRENT_SOURCE_DIR&#125; FOLLOW_SYMLINKS src/*.cpp)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment"># Binaries</span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">add_executable(qt_ros_test $&#123;QT_SOURCES&#125; $&#123;QT_RESOURCES_CPP&#125; $&#123;QT_FORMS_HPP&#125; $&#123;QT_MOC_HPP&#125;)</span></span><br><span class="line"><span class="comment">target_link_libraries(qt_ros_test $&#123;QT_LIBRARIES&#125; $&#123;catkin_LIBRARIES&#125;)</span></span><br><span class="line"><span class="comment">install(TARGETS qt_ros_test RUNTIME DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></figure><br>功能包里的src下的cpp<br>CCtrlDashBoard.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../include/qt_ros_test/CCtrlDashBoard.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qmath.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">CCtrlDashBoard::CCtrlDashBoard(QWidget *parent, StyleType type) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    m_StyleType(type)</span><br><span class="line">&#123;</span><br><span class="line">    m_BorderColor = QColor(<span class="number">172</span>,<span class="number">172</span>,<span class="number">172</span>);</span><br><span class="line">    m_BgColor = QColor(<span class="number">40</span>,<span class="number">40</span>,<span class="number">40</span>);</span><br><span class="line">    m_FrontColor = Qt::white;</span><br><span class="line"></span><br><span class="line">    m_DashValue= <span class="number">0</span>;</span><br><span class="line">    m_MinValue = <span class="number">0</span>;</span><br><span class="line">    m_MaxValue = <span class="number">100</span>;</span><br><span class="line">    m_DashNum = <span class="number">1</span>;</span><br><span class="line">    m_LineLength=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    m_StartAngle=<span class="number">90</span>;  <span class="comment">//510</span></span><br><span class="line">    m_EndAngle=<span class="number">0</span>;   <span class="comment">//120</span></span><br><span class="line">    update();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawBackGround</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_MaxBorderRadius = ((hlafWidth*<span class="number">5</span>)/<span class="number">6</span>);</span><br><span class="line">    qreal startX=hlafWidth-m_MaxBorderRadius;</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;setPen(m_BorderColor);</span><br><span class="line">    painter-&gt;setBrush(m_BorderColor);</span><br><span class="line"></span><br><span class="line">    QPainterPath bigCircle;</span><br><span class="line">    bigCircle.addEllipse(startX, startX, (m_MaxBorderRadius*<span class="number">2</span>), (m_MaxBorderRadius*<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    m_MinBorderRadius = m_MaxBorderRadius<span class="number">-15</span>;</span><br><span class="line">    startX=hlafWidth-m_MinBorderRadius;</span><br><span class="line">    QPainterPath smallCircle;</span><br><span class="line">    smallCircle.addEllipse(startX, startX, (m_MinBorderRadius*<span class="number">2</span>), (m_MinBorderRadius*<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    QPainterPath path = bigCircle - smallCircle;</span><br><span class="line">    painter-&gt;drawPath(path);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;setBrush(m_BgColor);</span><br><span class="line">    painter-&gt;drawEllipse(startX,startX,(m_MinBorderRadius*<span class="number">2</span>), (m_MinBorderRadius*<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">if</span>(m_DashValue==<span class="number">0</span>)&#123;</span><br><span class="line">      QString speed = <span class="string">&quot;0.0 cm/s&quot;</span>;</span><br><span class="line">      painter-&gt;drawText(startX+<span class="number">85</span>,startX+<span class="number">170</span>,speed);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      QString speed = QString::number(m_DashValue).mid(<span class="number">0</span>,<span class="number">3</span>) + <span class="string">&quot; cm/s&quot;</span>;</span><br><span class="line">      painter-&gt;drawText(startX+<span class="number">85</span>,startX+<span class="number">170</span>,speed);</span><br><span class="line">    &#125;</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">    m_DialsRadius = m_MinBorderRadius<span class="number">-10</span>;</span><br><span class="line">    <span class="keyword">if</span>(m_DialsRadius &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        m_DialsRadius=<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawScaleDials</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qreal tSteps = (m_MaxValue - m_MinValue)/m_DashNum; <span class="comment">//相乘后的值是分的份数</span></span><br><span class="line">    qreal angleStep = <span class="number">1.0</span>*(<span class="number">360.0</span>-m_StartAngle - m_EndAngle) / tSteps; <span class="comment">//每一个份数的角度</span></span><br><span class="line">    QPen pen ;</span><br><span class="line">    pen.setColor(m_FrontColor); <span class="comment">//推荐使用第二种方式</span></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle);</span><br><span class="line">    m_LineLength = (hlafWidth/<span class="number">16</span>);</span><br><span class="line">    qreal lineStart = m_DialsRadius<span class="number">-4</span>*m_LineLength-m_LineLength;</span><br><span class="line">    qreal lineSmStart = m_DialsRadius<span class="number">-4</span>*m_LineLength-m_LineLength/<span class="number">2</span>;</span><br><span class="line">    qreal lineEnd = m_DialsRadius<span class="number">-4</span>*m_LineLength;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tSteps; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">80</span>) pen.setColor(QColor(<span class="number">250</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">10</span> == <span class="number">0</span>)<span class="comment">//整数刻度显示加粗</span></span><br><span class="line">        &#123;</span><br><span class="line">            pen.setWidth(<span class="number">2</span>); <span class="comment">//设置线宽</span></span><br><span class="line">            painter-&gt;setPen(pen); <span class="comment">//使用面向对象的思想，把画笔关联上画家。通过画家画出来</span></span><br><span class="line">            painter-&gt;drawLine(lineStart,lineStart, lineEnd, lineEnd); <span class="comment">//两个参数应该是两个坐标值</span></span><br><span class="line">            <span class="comment">//painter-&gt;drawText(lineEnd+6,lineEnd+6, tr(&quot;%1&quot;).arg(m_MinValue+i));</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            pen.setWidth(<span class="number">1</span>);</span><br><span class="line">            painter-&gt;setPen(pen);</span><br><span class="line">            painter-&gt;drawLine(lineSmStart, lineSmStart, lineEnd, lineEnd); <span class="comment">//两个参数应该是两个坐标值</span></span><br><span class="line">        &#125;</span><br><span class="line">        painter-&gt;rotate(angleStep);</span><br><span class="line">    &#125;</span><br><span class="line">    pen.setColor(m_FrontColor);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;setPen(pen);</span><br><span class="line">    <span class="comment">//m_startAngle是起始角度，m_endAngle是结束角度，m_scaleMajor在一个量程中分成的刻度数</span></span><br><span class="line">    qreal startRad = ( <span class="number">315</span>-m_StartAngle) * (<span class="number">3.14</span> / <span class="number">180</span>);</span><br><span class="line">    qreal deltaRad = (<span class="number">360</span>-m_StartAngle - m_EndAngle) * (<span class="number">3.14</span> / <span class="number">180</span>) / tSteps;</span><br><span class="line">    qreal sina,cosa;</span><br><span class="line">    qreal x, y;</span><br><span class="line">    <span class="function">QFontMetricsF <span class="title">fm</span><span class="params">(<span class="keyword">this</span>-&gt;font())</span></span>;</span><br><span class="line">    <span class="keyword">double</span> w, h, tmpVal;</span><br><span class="line">    QString str;</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    lineEnd = m_MinBorderRadius<span class="number">-8</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tSteps; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">10</span> == <span class="number">0</span>)<span class="comment">//整数刻度显示加粗</span></span><br><span class="line">        &#123;</span><br><span class="line">            sina = qSin(startRad - i * deltaRad);</span><br><span class="line">            cosa = <span class="built_in">cos</span>(startRad - i * deltaRad);</span><br><span class="line"></span><br><span class="line">            tmpVal = <span class="number">1.0</span> * i *((m_MaxValue - m_MinValue) / tSteps) + m_MinValue;</span><br><span class="line">            str = QString( <span class="string">&quot;%1&quot;</span> ).arg(tmpVal);  <span class="comment">//%1作为占位符   arg()函数比起 sprintf()来是类型安全的</span></span><br><span class="line">            w = fm.size(Qt::TextSingleLine,str).width();</span><br><span class="line">            h = fm.size(Qt::TextSingleLine,str).height();</span><br><span class="line">            x = lineEnd * cosa - w / <span class="number">2</span>;</span><br><span class="line">            y = -lineEnd * sina + h / <span class="number">4</span>;</span><br><span class="line">            painter-&gt;drawText(x, y, str); <span class="comment">//函数的前两个参数是显示的坐标位置，后一个是显示的内容，是字符类型&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawIndicator</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QPolygon pts;</span><br><span class="line">    pts.setPoints(<span class="number">3</span>, <span class="number">-8</span>,<span class="number">0</span>, <span class="number">8</span>,<span class="number">0</span>, <span class="number">0</span>,(<span class="keyword">int</span>)m_DialsRadius<span class="number">-20</span>); <span class="comment">/* (-2,0)/(2,0)/(0,60) */</span><span class="comment">//第一个参数是 ，坐标的个数。后边的是坐标</span></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth, hlafWidth);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle<span class="number">-45</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(m_DashValue&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        qreal tSteps = (m_MaxValue - m_MinValue)/m_DashNum; <span class="comment">//相乘后的值是分的份数</span></span><br><span class="line">        qreal angleStep = <span class="number">1.0</span>*(<span class="number">360.0</span>-m_StartAngle - m_EndAngle) / tSteps; <span class="comment">//每一个份数的角度</span></span><br><span class="line">        <span class="keyword">double</span> degRotate = angleStep*tSteps*(m_DashValue/<span class="number">100.0</span>)+angleStep;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//画指针</span></span><br><span class="line">        <span class="comment">//qDebug() &lt;&lt;&quot;degRotate ==&quot;&lt;&lt;degRotate&lt;&lt;&quot;m_DashValue ==&quot;&lt;&lt;m_DashValue&lt;&lt;m_StartAngle&lt;&lt;m_DialsRadius&lt;&lt;hlafWidth;</span></span><br><span class="line">        <span class="keyword">if</span>(m_DashValue == <span class="number">99</span>)&#123;</span><br><span class="line">            painter-&gt;rotate(m_EndAngle-m_StartAngle);  <span class="comment">//顺时针旋转坐标系统</span></span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            painter-&gt;rotate(degRotate);  <span class="comment">//顺时针旋转坐标系统</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QRadialGradient <span class="title">haloGradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, hlafWidth/<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>;  <span class="comment">//辐射渐变</span></span><br><span class="line">    haloGradient.setColorAt(<span class="number">0</span>, QColor(<span class="number">255</span>,<span class="number">69</span>,<span class="number">0</span>));</span><br><span class="line">    haloGradient.setColorAt(<span class="number">1</span>, QColor(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    painter-&gt;setPen(Qt::white); <span class="comment">//定义线条文本颜色  设置线条的颜色</span></span><br><span class="line">    painter-&gt;setBrush(haloGradient);<span class="comment">//刷子定义形状如何填满 填充后的颜色</span></span><br><span class="line">    painter-&gt;drawConvexPolygon(pts); <span class="comment">//这是个重载函数，绘制多边形。</span></span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画中心点</span></span><br><span class="line">    <span class="function">QColor <span class="title">niceBlue</span><span class="params">(<span class="number">150</span>, <span class="number">150</span>, <span class="number">200</span>)</span></span>;</span><br><span class="line">    <span class="function">QConicalGradient <span class="title">coneGradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-90.0</span>)</span></span>;  <span class="comment">//角度渐变</span></span><br><span class="line">    coneGradient.setColorAt(<span class="number">0.0</span>, Qt::darkGray);</span><br><span class="line">    coneGradient.setColorAt(<span class="number">0.2</span>, niceBlue);</span><br><span class="line">    coneGradient.setColorAt(<span class="number">0.5</span>, Qt::white);</span><br><span class="line">    coneGradient.setColorAt(<span class="number">1.0</span>, Qt::darkGray);</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    painter-&gt;setPen(Qt::NoPen);  <span class="comment">//没有线，填满没有边界</span></span><br><span class="line">    painter-&gt;setBrush(coneGradient);</span><br><span class="line">    painter-&gt;drawEllipse(<span class="number">-10</span>, <span class="number">-10</span>, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawIndicatorBar</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 渐变色</span></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    qreal lineEnd = m_DialsRadius<span class="number">-3</span>*m_LineLength;</span><br><span class="line">    <span class="function">QRadialGradient <span class="title">gradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, lineEnd)</span></span>;</span><br><span class="line">    gradient.setColorAt(<span class="number">0</span>, Qt::white);</span><br><span class="line">    gradient.setColorAt(<span class="number">1.0</span>, Qt::blue);</span><br><span class="line">    painter-&gt;setBrush(gradient);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &lt;&lt; 1（左移1位）相当于radius*2 即：150*2=300</span></span><br><span class="line">    <span class="comment">//QRectF(-150, -150, 300, 300)</span></span><br><span class="line">    <span class="function">QRectF <span class="title">rect</span><span class="params">(-lineEnd, -lineEnd, lineEnd*<span class="number">2</span>, lineEnd*<span class="number">2</span>)</span></span>;</span><br><span class="line">    QPainterPath path;</span><br><span class="line">    path.arcTo(rect, m_StartAngle, <span class="number">270</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// QRectF(-120, -120, 240, 240)</span></span><br><span class="line">    QPainterPath subPath;</span><br><span class="line">    subPath.addEllipse(rect.adjusted(<span class="number">10</span>, <span class="number">10</span>, <span class="number">-10</span>, <span class="number">-10</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// path为扇形 subPath为椭圆</span></span><br><span class="line">    path -= subPath;</span><br><span class="line">    painter-&gt;setPen(Qt::NoPen);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle+<span class="number">45</span>);</span><br><span class="line">    painter-&gt;drawPath(path);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    qreal degRotate=<span class="number">0.1</span>;</span><br><span class="line">    <span class="keyword">if</span>(m_DashValue&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        qreal tSteps = (m_MaxValue - m_MinValue)/m_DashNum; <span class="comment">//相乘后的值是分的份数</span></span><br><span class="line">        qreal angleStep = <span class="number">1.0</span>*(<span class="number">360.0</span>-m_StartAngle - m_EndAngle) / tSteps; <span class="comment">//每一个份数的角度</span></span><br><span class="line">        degRotate = angleStep*tSteps*(m_DashValue/<span class="number">100.0</span>)+angleStep;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//画指针</span></span><br><span class="line">        <span class="comment">//qDebug() &lt;&lt;&quot;degRotate ==&quot;&lt;&lt;degRotate&lt;&lt;&quot;m_DashValue ==&quot;&lt;&lt;m_DashValue&lt;&lt;m_StartAngle&lt;&lt;m_DialsRadius&lt;&lt;hlafWidth;</span></span><br><span class="line">        <span class="comment">/*if(m_DashValue == 99)&#123;</span></span><br><span class="line"><span class="comment">            painter-&gt;rotate(m_EndAngle-m_StartAngle);  //顺时针旋转坐标系统</span></span><br><span class="line"><span class="comment">        &#125;else</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            painter-&gt;rotate(degRotate);  //顺时针旋转坐标系统</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth, hlafWidth);</span><br><span class="line"></span><br><span class="line">    <span class="function">QRadialGradient <span class="title">ftGradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, lineEnd)</span></span>;</span><br><span class="line">    ftGradient.setColorAt(<span class="number">0</span>, Qt::white);</span><br><span class="line">    ftGradient.setColorAt(<span class="number">1.0</span>, Qt::darkYellow);</span><br><span class="line">    painter-&gt;setBrush(ftGradient);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &lt;&lt; 1（左移1位）相当于radius*2 即：150*2=300</span></span><br><span class="line">    <span class="comment">//QRectF(-150, -150, 300, 300)</span></span><br><span class="line">    <span class="function">QRectF <span class="title">ftRect</span><span class="params">(-lineEnd, -lineEnd, lineEnd*<span class="number">2</span>, lineEnd*<span class="number">2</span>)</span></span>;</span><br><span class="line">    QPainterPath ftPath;</span><br><span class="line">    ftPath.arcTo(ftRect, m_EndAngle-m_StartAngle, -degRotate);</span><br><span class="line">    <span class="comment">// path为扇形 subPath为椭圆</span></span><br><span class="line">    ftPath -= subPath;</span><br><span class="line">    painter-&gt;rotate(m_StartAngle<span class="number">-45</span>);</span><br><span class="line">    painter-&gt;drawPath(ftPath);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line">    QPolygon pts;</span><br><span class="line">    <span class="keyword">int</span> pointLength=lineEnd<span class="number">-12</span>;</span><br><span class="line">    pts.setPoints(<span class="number">3</span>, <span class="number">-6</span>,pointLength<span class="number">-10</span>, <span class="number">6</span>,pointLength<span class="number">-10</span>, <span class="number">0</span>,pointLength);</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth, hlafWidth);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle<span class="number">-45</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(m_DashValue == <span class="number">99</span>)&#123;</span><br><span class="line">        painter-&gt;rotate(m_EndAngle-m_StartAngle);  <span class="comment">//顺时针旋转坐标系统</span></span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        painter-&gt;rotate(degRotate);  <span class="comment">//顺时针旋转坐标系统</span></span><br><span class="line">    &#125;</span><br><span class="line">    painter-&gt;setPen(Qt::white); <span class="comment">//定义线条文本颜色  设置线条的颜色</span></span><br><span class="line">    painter-&gt;setBrush(Qt::blue);<span class="comment">//刷子定义形状如何填满 填充后的颜色</span></span><br><span class="line">    painter-&gt;drawConvexPolygon(pts); <span class="comment">//这是个重载函数，绘制多边形。</span></span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::paintEvent</span><span class="params">(QPaintEvent * event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">p</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    qreal width = qMin((<span class="keyword">this</span>-&gt;width()&gt;&gt;<span class="number">1</span>), (<span class="keyword">this</span>-&gt;height()&gt;&gt;<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    p.setRenderHints(QPainter::Antialiasing|QPainter::TextAntialiasing);</span><br><span class="line"></span><br><span class="line">    drawBackGround(&amp;p, width);</span><br><span class="line"></span><br><span class="line">    drawScaleDials(&amp;p, width);</span><br><span class="line">    <span class="keyword">switch</span>(m_StyleType)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> ST_DEFAULT:</span><br><span class="line">        drawIndicator(&amp;p, width);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> ST_ARCBAR:</span><br><span class="line">        drawIndicatorBar(&amp;p, width);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>main.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file /src/main.cpp</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @brief Qt based gui.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @date November 2010</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Includes</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtGui&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../include/qt_ros_test/main_window.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Main</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*********************</span></span><br><span class="line"><span class="comment">    ** Qt</span></span><br><span class="line"><span class="comment">    **********************/</span></span><br><span class="line">    <span class="function">QApplication <span class="title">app</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    <span class="function">qt_ros_test::MainWindow <span class="title">w</span><span class="params">(argc,argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    w.show();</span><br><span class="line">    app.connect(&amp;app, SIGNAL(lastWindowClosed()), &amp;app, SLOT(quit()));</span><br><span class="line">    <span class="keyword">int</span> result = app.exec();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>main_window.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file /src/main_window.cpp</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @brief Implementation for the qt gui.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @date February 2011</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Includes</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtGui&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QMessageBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../include/qt_ros_test/main_window.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Namespaces</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> qt_ros_test &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Qt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Implementation [MainWindow]</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line">MainWindow::MainWindow(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv, QWidget *parent)</span><br><span class="line">	: QMainWindow(parent)</span><br><span class="line">	, qnode(argc,argv)</span><br><span class="line">&#123;</span><br><span class="line">	ui.setupUi(<span class="keyword">this</span>); <span class="comment">// Calling this incidentally connects all ui&#x27;s triggers to on_...() callbacks in this class.</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;loadStyleSheet(<span class="string">&quot;://images/myStyleSheet1.qss&quot;</span>);</span><br><span class="line">    QObject::connect(ui.actionAbout_Qt, SIGNAL(triggered(<span class="keyword">bool</span>)), qApp, SLOT(aboutQt())); <span class="comment">// qApp is a global variable for the application</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ReadSettings();</span><br><span class="line">    setWindowIcon(QIcon(<span class="string">&quot;://images/icon1.png&quot;</span>));</span><br><span class="line">	ui.tab_manager-&gt;setCurrentIndex(<span class="number">0</span>); <span class="comment">// ensure the first tab is showing - qt-designer should have this already hardwired, but often loses it (settings?).</span></span><br><span class="line">    QObject::connect(&amp;qnode, SIGNAL(rosShutdown()), <span class="keyword">this</span>, SLOT(close()));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*********************</span></span><br><span class="line"><span class="comment">	** Logging</span></span><br><span class="line"><span class="comment">	**********************/</span></span><br><span class="line">	ui.view_logging-&gt;setModel(qnode.loggingModel());</span><br><span class="line">    QObject::connect(&amp;qnode, SIGNAL(loggingUpdated()), <span class="keyword">this</span>, SLOT(updateLoggingView()));</span><br><span class="line">    <span class="comment">/*********************</span></span><br><span class="line"><span class="comment">    ** Auto Start</span></span><br><span class="line"><span class="comment">    **********************/</span></span><br><span class="line">    <span class="keyword">if</span> ( ui.checkbox_remember_settings-&gt;isChecked() ) &#123;</span><br><span class="line">        on_button_connect_clicked(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    connect(ui.horizontalSlider_linera,SIGNAL(valueChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_linera_change(<span class="keyword">int</span>)));</span><br><span class="line">    connect(ui.horizontalSlider_raw,SIGNAL(valueChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_raw_change(<span class="keyword">int</span>)));</span><br><span class="line">    connect(ui.pushButton_u,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_i,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_o,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_j,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_l,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_m,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_1,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_2,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    <span class="comment">//init ui</span></span><br><span class="line">     speed_x_dashBoard=<span class="keyword">new</span> CCtrlDashBoard(ui.widget_speed_x);</span><br><span class="line">     speed_y_dashBoard=<span class="keyword">new</span> CCtrlDashBoard(ui.widget_speed_y);</span><br><span class="line">     speed_x_dashBoard-&gt;setGeometry(ui.widget_speed_x-&gt;rect());</span><br><span class="line">     speed_y_dashBoard-&gt;setGeometry(ui.widget_speed_y-&gt;rect());</span><br><span class="line">     speed_x_dashBoard-&gt;setValue(<span class="number">0</span>);</span><br><span class="line">     speed_y_dashBoard-&gt;setValue(<span class="number">0</span>);</span><br><span class="line">     ui.horizontalSlider_linera-&gt;setValue(<span class="number">20</span>);</span><br><span class="line">     ui.horizontalSlider_raw-&gt;setValue(<span class="number">20</span>);</span><br><span class="line">     <span class="comment">//header</span></span><br><span class="line">     ui.treeWidget-&gt;setHeaderLabels(QStringList()&lt;&lt;<span class="string">&quot;功能&quot;</span>&lt;&lt;<span class="string">&quot;选项&quot;</span>);</span><br><span class="line">     ui.treeWidget-&gt;setHeaderHidden(<span class="literal">true</span>);</span><br><span class="line">     <span class="comment">//GLobal Options</span></span><br><span class="line">     QTreeWidgetItem* Global=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;Global Options&quot;</span>);</span><br><span class="line">     Global-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/options.png&quot;</span>));</span><br><span class="line">     ui.treeWidget-&gt;addTopLevelItem(Global);</span><br><span class="line">     Global-&gt;setExpanded(<span class="literal">true</span>);</span><br><span class="line">     <span class="comment">//FixFrame</span></span><br><span class="line">     QTreeWidgetItem* Fixed_frame=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;参考坐标系&quot;</span>);</span><br><span class="line">     fixed_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">     fixed_box-&gt;addItem(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">     <span class="comment">// 关闭下拉框防止闪退</span></span><br><span class="line">     fixed_box-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">     fixed_box-&gt;addItem(<span class="string">&quot;base_link&quot;</span>);</span><br><span class="line">     fixed_box-&gt;addItem(<span class="string">&quot;base_laser_link&quot;</span>);</span><br><span class="line">     fixed_box-&gt;addItem(<span class="string">&quot;base_footprint&quot;</span>);</span><br><span class="line">     fixed_box-&gt;addItem(<span class="string">&quot;odom&quot;</span>);</span><br><span class="line">     fixed_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">     fixed_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">     connect(fixed_box,SIGNAL(currentTextChanged(QString)),<span class="keyword">this</span>,SLOT(slot_treewidget_value_change(QString)));</span><br><span class="line">     Global-&gt;addChild(Fixed_frame);</span><br><span class="line">     ui.treeWidget-&gt;setItemWidget(Fixed_frame,<span class="number">1</span>,fixed_box);</span><br><span class="line">     <span class="comment">//Grid</span></span><br><span class="line">     QTreeWidgetItem* Grid=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;图层/栅格&quot;</span>);</span><br><span class="line">     <span class="comment">//设置图标</span></span><br><span class="line">     Grid-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/&#x27;grid.png&#x27;&quot;</span>));</span><br><span class="line">       <span class="comment">//checkbox</span></span><br><span class="line">         Grid_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">         Grid_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">         connect(Grid_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_grid(<span class="keyword">int</span>)));</span><br><span class="line">      <span class="comment">//添加top节点</span></span><br><span class="line">         ui.treeWidget-&gt;addTopLevelItem(Grid);</span><br><span class="line">      <span class="comment">//添加checkbox</span></span><br><span class="line">         ui.treeWidget-&gt;setItemWidget(Grid,<span class="number">1</span>,Grid_Check);</span><br><span class="line">      <span class="comment">//设置grid默认展开状态</span></span><br><span class="line">         Grid-&gt;setExpanded(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">         <span class="comment">//添加Cell Count子节点</span></span><br><span class="line">         QTreeWidgetItem* Cell_Count=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;栅格个数&quot;</span>);</span><br><span class="line">         Grid-&gt;addChild(Cell_Count);</span><br><span class="line">         <span class="comment">//CellCount添加SpinBox</span></span><br><span class="line">         Cell_Count_Box=<span class="keyword">new</span> QSpinBox();</span><br><span class="line">         Cell_Count_Box-&gt;setValue(<span class="number">7</span>);</span><br><span class="line">         <span class="comment">//设置Spinbox的宽度</span></span><br><span class="line">         Cell_Count_Box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">         ui.treeWidget-&gt;setItemWidget(Cell_Count,<span class="number">1</span>,Cell_Count_Box);</span><br><span class="line"></span><br><span class="line">         <span class="comment">//添加color子节点</span></span><br><span class="line">         QTreeWidgetItem* Grid_Color=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;栅格颜色&quot;</span>);</span><br><span class="line">         Grid-&gt;addChild(Grid_Color);</span><br><span class="line">         <span class="comment">//Color添加ComboBox</span></span><br><span class="line">         Grid_Color_Box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">         Grid_Color_Box-&gt;addItem(<span class="string">&quot;0;160;160&quot;</span>);</span><br><span class="line">         <span class="comment">//设置Comboox可编辑</span></span><br><span class="line">         Grid_Color_Box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">         <span class="comment">//设置Combox的宽度</span></span><br><span class="line">         Grid_Color_Box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(Grid_Color,<span class="number">1</span>,Grid_Color_Box);</span><br><span class="line">         <span class="comment">//TF ui</span></span><br><span class="line">         QTreeWidgetItem* TF=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;图层/TF&quot;</span>);</span><br><span class="line">         <span class="comment">//设置图标</span></span><br><span class="line">         TF-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/moverotate.svg&quot;</span>));</span><br><span class="line">         <span class="comment">//checkbox</span></span><br><span class="line">         TF_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">         TF_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">         connect(TF_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_tf(<span class="keyword">int</span>)));</span><br><span class="line">         <span class="comment">//向Treewidget添加TF Top节点</span></span><br><span class="line">         ui.treeWidget-&gt;addTopLevelItem(TF);</span><br><span class="line">         <span class="comment">//向TF添加checkbox</span></span><br><span class="line">         ui.treeWidget-&gt;setItemWidget(TF,<span class="number">1</span>,TF_Check);</span><br><span class="line">         <span class="comment">//LaserScan ui</span></span><br><span class="line">         QTreeWidgetItem* LaserScan=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;图层/雷达&quot;</span>);</span><br><span class="line">         <span class="comment">//设置图标</span></span><br><span class="line">         LaserScan-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/default_class_icon.png&quot;</span>));</span><br><span class="line">         <span class="comment">//checkbox</span></span><br><span class="line">         Laser_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">         Laser_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">         connect(Laser_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_laser(<span class="keyword">int</span>)));</span><br><span class="line">         <span class="comment">//向Treewidget添加laserscan Top节点</span></span><br><span class="line">         ui.treeWidget-&gt;addTopLevelItem(LaserScan);</span><br><span class="line">         <span class="comment">//向laserscan添加checkbox</span></span><br><span class="line">         ui.treeWidget-&gt;setItemWidget(LaserScan,<span class="number">1</span>,Laser_Check);</span><br><span class="line">         <span class="comment">//laser topic</span></span><br><span class="line">         QTreeWidgetItem* LaserTopic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;订阅话题&quot;</span>);</span><br><span class="line">         Laser_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">         Laser_Topic_box-&gt;addItem(<span class="string">&quot;/scan&quot;</span>);</span><br><span class="line">         Laser_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">         Laser_Topic_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">         LaserScan-&gt;addChild(LaserTopic);</span><br><span class="line">         ui.treeWidget-&gt;setItemWidget(LaserTopic,<span class="number">1</span>,Laser_Topic_box);</span><br><span class="line"></span><br><span class="line">         <span class="comment">//RobotModel ui</span></span><br><span class="line">         QTreeWidgetItem* RobotModel=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;图层/机器人模型&quot;</span>);</span><br><span class="line">         <span class="comment">//设置图标</span></span><br><span class="line">         RobotModel-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/robot.png&quot;</span>));</span><br><span class="line">         <span class="comment">//checkbox</span></span><br><span class="line">         RobotModel_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">         RobotModel_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">         connect(RobotModel_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_RobotModel(<span class="keyword">int</span>)));</span><br><span class="line">         <span class="comment">//向Treewidget添加TF Top节点</span></span><br><span class="line">         ui.treeWidget-&gt;addTopLevelItem(RobotModel);</span><br><span class="line">         <span class="comment">//向TF添加checkbox</span></span><br><span class="line">         ui.treeWidget-&gt;setItemWidget(RobotModel,<span class="number">1</span>,RobotModel_Check);</span><br><span class="line">         <span class="comment">//Map ui</span></span><br><span class="line">          QTreeWidgetItem* Map=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;图层/地图&quot;</span>);</span><br><span class="line">          <span class="comment">//设置图标</span></span><br><span class="line">          Map-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/crosshair.svg&quot;</span>));</span><br><span class="line">          <span class="comment">//checkbox</span></span><br><span class="line">          Map_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">          Map_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">          connect(Map_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_Map(<span class="keyword">int</span>)));</span><br><span class="line">          <span class="comment">//向Treewidget添加Map Top节点</span></span><br><span class="line">          ui.treeWidget-&gt;addTopLevelItem(Map);</span><br><span class="line">          <span class="comment">//向Map添加checkbox</span></span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(Map,<span class="number">1</span>,Map_Check);</span><br><span class="line">          <span class="comment">//Map topic</span></span><br><span class="line">          QTreeWidgetItem* MapTopic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;订阅话题&quot;</span>);</span><br><span class="line">          Map_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Map_Topic_box-&gt;addItem(<span class="string">&quot;/map&quot;</span>);</span><br><span class="line">          Map_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Map_Topic_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Map-&gt;addChild(MapTopic);</span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(MapTopic,<span class="number">1</span>,Map_Topic_box);</span><br><span class="line">          <span class="comment">//Map color scheme</span></span><br><span class="line">          QTreeWidgetItem* MapColorScheme=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;地图样式&quot;</span>);</span><br><span class="line">          Map_Color_Scheme_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Map_Color_Scheme_box-&gt;addItem(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">          Map_Color_Scheme_box-&gt;addItem(<span class="string">&quot;costmap&quot;</span>);</span><br><span class="line">          Map_Color_Scheme_box-&gt;addItem(<span class="string">&quot;raw&quot;</span>);</span><br><span class="line">          Map_Color_Scheme_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Map-&gt;addChild(MapColorScheme);</span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(MapColorScheme,<span class="number">1</span>,Map_Color_Scheme_box);</span><br><span class="line">          <span class="comment">//Path ui</span></span><br><span class="line">          QTreeWidgetItem* Path=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;图层/路径&quot;</span>);</span><br><span class="line">          <span class="comment">//设置图标</span></span><br><span class="line">          Path-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/move1d.svg&quot;</span>));</span><br><span class="line">          <span class="comment">//checkbox</span></span><br><span class="line">          Path_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">          Path_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">          connect(Path_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_Path(<span class="keyword">int</span>)));</span><br><span class="line">          <span class="comment">//向Treewidget添加Path Top节点</span></span><br><span class="line">          ui.treeWidget-&gt;addTopLevelItem(Path);</span><br><span class="line">          <span class="comment">//向Path添加checkbox</span></span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(Path,<span class="number">1</span>,Path_Check);</span><br><span class="line">          <span class="comment">//Path topic</span></span><br><span class="line">          QTreeWidgetItem* PathTopic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;订阅话题&quot;</span>);</span><br><span class="line">          Path_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Path_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/GlobalPlanner/plan&quot;</span>);</span><br><span class="line">          Path_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/TebLocalPlannerROS/global_plan&quot;</span>);</span><br><span class="line">          Path_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/TebLocalPlannerROS/local_plan&quot;</span>);</span><br><span class="line">          Path_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/DWAPlannerROS/local_plan&quot;</span>);</span><br><span class="line">          Path_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/DWAPlannerROS/global_plan&quot;</span>);</span><br><span class="line">          Path_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Path_Topic_box-&gt;setMaximumWidth(<span class="number">300</span>);</span><br><span class="line">          Path-&gt;addChild(PathTopic);</span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(PathTopic,<span class="number">1</span>,Path_Topic_box);</span><br><span class="line">          <span class="comment">//Path color scheme</span></span><br><span class="line">          QTreeWidgetItem* PathColorScheme=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;路径颜色&quot;</span>);</span><br><span class="line">          Path_Color_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Path_Color_box-&gt;addItem(<span class="string">&quot;0;12;255&quot;</span>);</span><br><span class="line">          Path_Color_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Path_Color_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Path-&gt;addChild(PathColorScheme);</span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(PathColorScheme,<span class="number">1</span>,Path_Color_box);</span><br><span class="line">          <span class="comment">//导航treeWidget</span></span><br><span class="line">          <span class="comment">//header</span></span><br><span class="line">          ui.treeWidget_2-&gt;setHeaderLabels(QStringList()&lt;&lt;<span class="string">&quot;功能&quot;</span>&lt;&lt;<span class="string">&quot;选项&quot;</span>);</span><br><span class="line">          <span class="comment">// TreeWidget 自动列宽</span></span><br><span class="line">          ui.treeWidget_2-&gt;header()-&gt;setSectionResizeMode(QHeaderView::ResizeToContents);</span><br><span class="line"></span><br><span class="line">          ui.treeWidget_2-&gt;setHeaderHidden(<span class="literal">true</span>);</span><br><span class="line">          <span class="comment">//GLobal Options</span></span><br><span class="line">          QTreeWidgetItem* na=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;导航显示&quot;</span>);</span><br><span class="line">          na-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/options.png&quot;</span>));</span><br><span class="line">          ui.treeWidget_2-&gt;addTopLevelItem(na);</span><br><span class="line">          na-&gt;setExpanded(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//*******机器人Navigate 相关UI********************************</span></span><br><span class="line">          <span class="comment">//Golabal Map***************************************</span></span><br><span class="line">          QTreeWidgetItem* GlobalMap=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;全局地图&quot;</span>);</span><br><span class="line">          GlobalMap-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/crosshair.svg&quot;</span>));</span><br><span class="line">          GlobalMap_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">          GlobalMap_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">          connect(GlobalMap_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_global_map(<span class="keyword">int</span>)));</span><br><span class="line">          ui.treeWidget_2-&gt;addTopLevelItem(GlobalMap);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(GlobalMap,<span class="number">1</span>,GlobalMap_Check);</span><br><span class="line">          GlobalMap-&gt;setExpanded(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          <span class="comment">//Global CostMap</span></span><br><span class="line">          QTreeWidgetItem* Global_CostMap=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;全局代价地图&quot;</span>);</span><br><span class="line">          <span class="comment">//设置图标</span></span><br><span class="line">          Global_CostMap-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/classes/Map.png&quot;</span>));</span><br><span class="line">          <span class="comment">//Global Map添加子节点</span></span><br><span class="line">          GlobalMap-&gt;addChild(Global_CostMap);</span><br><span class="line">          <span class="comment">//Map topic</span></span><br><span class="line">          QTreeWidgetItem* Global_CostMap_Topic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;订阅话题&quot;</span>);</span><br><span class="line">          Global_CostMap_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Global_CostMap_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/global_costmap/costmap&quot;</span>);</span><br><span class="line"></span><br><span class="line">          Global_CostMap_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Global_CostMap_Topic_box-&gt;setMaximumWidth(<span class="number">300</span>);</span><br><span class="line">          Global_CostMap-&gt;addChild(Global_CostMap_Topic);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(Global_CostMap_Topic,<span class="number">1</span>,Global_CostMap_Topic_box);</span><br><span class="line">          <span class="comment">//Map color scheme</span></span><br><span class="line">          QTreeWidgetItem* GlobalMapColorScheme=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;地图样式&quot;</span>);</span><br><span class="line">          GlobalMapColorScheme_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          GlobalMapColorScheme_box-&gt;addItem(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">          GlobalMapColorScheme_box-&gt;addItem(<span class="string">&quot;costmap&quot;</span>);</span><br><span class="line">          GlobalMapColorScheme_box-&gt;addItem(<span class="string">&quot;raw&quot;</span>);</span><br><span class="line">          GlobalMapColorScheme_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Global_CostMap-&gt;addChild(GlobalMapColorScheme);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(GlobalMapColorScheme,<span class="number">1</span>,GlobalMapColorScheme_box);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//Global Planner</span></span><br><span class="line">          QTreeWidgetItem* Global_Planner=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;全局路径&quot;</span>);</span><br><span class="line">          <span class="comment">//设置图标</span></span><br><span class="line">          Global_Planner-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/classes/Path.png&quot;</span>));</span><br><span class="line">          <span class="comment">//向TGlobal Map添加Path Top节点</span></span><br><span class="line">          GlobalMap-&gt;addChild(Global_Planner);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//Path topic</span></span><br><span class="line">          QTreeWidgetItem* Global_Planner_Topic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;订阅话题&quot;</span>);</span><br><span class="line">          Global_Planner_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Global_Planner_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/TebLocalPlannerROS/global_plan&quot;</span>);</span><br><span class="line">          Global_Planner_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/DWAPlannerROS/global_plan&quot;</span>);</span><br><span class="line">          Global_Planner_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/GlobalPlanner/plan&quot;</span>);</span><br><span class="line">          Global_Planner_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Global_Planner_Topic_box-&gt;setMaximumWidth(<span class="number">300</span>);</span><br><span class="line">          Global_Planner-&gt;addChild(Global_Planner_Topic);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(Global_Planner_Topic,<span class="number">1</span>,Global_Planner_Topic_box);</span><br><span class="line">          <span class="comment">//Path color scheme</span></span><br><span class="line">          QTreeWidgetItem* Global_Planner_Color_Scheme=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;路径颜色&quot;</span>);</span><br><span class="line">          Global_Planner_Color_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Global_Planner_Color_box-&gt;addItem(<span class="string">&quot;255;0;0&quot;</span>);</span><br><span class="line">          Global_Planner_Color_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Global_Planner_Color_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Global_Planner-&gt;addChild(Global_Planner_Color_Scheme);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(Global_Planner_Color_Scheme,<span class="number">1</span>,Global_Planner_Color_box);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//Local Map***********************************************</span></span><br><span class="line">          QTreeWidgetItem* LocalMap=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;局部地图&quot;</span>);</span><br><span class="line">          LocalMap-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/crosshair.svg&quot;</span>));</span><br><span class="line">          LocalMap_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">          LocalMap_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">          connect(LocalMap_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_local_map(<span class="keyword">int</span>)));</span><br><span class="line">          ui.treeWidget_2-&gt;addTopLevelItem(LocalMap);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(LocalMap,<span class="number">1</span>,LocalMap_Check);</span><br><span class="line">          LocalMap-&gt;setExpanded(<span class="literal">true</span>);</span><br><span class="line">          <span class="comment">//Local CostMap</span></span><br><span class="line">          QTreeWidgetItem* Local_CostMap=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;局部代价地图&quot;</span>);</span><br><span class="line">          <span class="comment">//设置图标</span></span><br><span class="line">          Local_CostMap-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/classes/Map.png&quot;</span>));</span><br><span class="line">          <span class="comment">//Local Map添加子节点</span></span><br><span class="line">          LocalMap-&gt;addChild(Local_CostMap);</span><br><span class="line">          <span class="comment">//Map topic</span></span><br><span class="line">          QTreeWidgetItem* Local_CostMap_Topic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;订阅话题&quot;</span>);</span><br><span class="line">          Local_CostMap_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Local_CostMap_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/local_costmap/costmap&quot;</span>);</span><br><span class="line">          Local_CostMap_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Local_CostMap_Topic_box-&gt;setMaximumWidth(<span class="number">300</span>);</span><br><span class="line">          Local_CostMap-&gt;addChild(Local_CostMap_Topic);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(Local_CostMap_Topic,<span class="number">1</span>,Local_CostMap_Topic_box);</span><br><span class="line">          <span class="comment">//Map color scheme</span></span><br><span class="line">          QTreeWidgetItem* LocalMapColorScheme=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;地图样式&quot;</span>);</span><br><span class="line">          LocalMapColorScheme_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          LocalMapColorScheme_box-&gt;addItem(<span class="string">&quot;costmap&quot;</span>);</span><br><span class="line">          LocalMapColorScheme_box-&gt;addItem(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">          LocalMapColorScheme_box-&gt;addItem(<span class="string">&quot;raw&quot;</span>);</span><br><span class="line">          LocalMapColorScheme_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Local_CostMap-&gt;addChild(LocalMapColorScheme);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(LocalMapColorScheme,<span class="number">1</span>,LocalMapColorScheme_box);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//Local Planner</span></span><br><span class="line">          QTreeWidgetItem* Local_Planner=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;局部路径&quot;</span>);</span><br><span class="line">          <span class="comment">//设置图标</span></span><br><span class="line">          Local_Planner-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/classes/Path.png&quot;</span>));</span><br><span class="line">          <span class="comment">//向TLocal Map添加Path Top节点</span></span><br><span class="line">          LocalMap-&gt;addChild(Local_Planner);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//Path topic</span></span><br><span class="line">          QTreeWidgetItem* Local_Planner_Topic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;订阅话题&quot;</span>);</span><br><span class="line">          Local_Planner_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Local_Planner_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/TebLocalPlannerROS/local_plan&quot;</span>);</span><br><span class="line">          Local_Planner_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/DWAPlannerROS/local_plan&quot;</span>);</span><br><span class="line">          Local_Planner_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Local_Planner_Topic_box-&gt;setMaximumWidth(<span class="number">300</span>);</span><br><span class="line">          Local_Planner-&gt;addChild(Local_Planner_Topic);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(Local_Planner_Topic,<span class="number">1</span>,Local_Planner_Topic_box);</span><br><span class="line">          <span class="comment">//Path color scheme</span></span><br><span class="line">          QTreeWidgetItem* Local_Planner_Color_Scheme=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;路径颜色&quot;</span>);</span><br><span class="line">          Local_Planner_Color_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Local_Planner_Color_box-&gt;addItem(<span class="string">&quot;0;12;255&quot;</span>);</span><br><span class="line">          Local_Planner_Color_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Local_Planner_Color_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Local_Planner-&gt;addChild(Local_Planner_Color_Scheme);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(Local_Planner_Color_Scheme,<span class="number">1</span>,Local_Planner_Color_box);</span><br><span class="line"> <span class="comment">//**********************************************************************************************</span></span><br><span class="line">     connect(&amp;qnode,SIGNAL(speed_vel(<span class="keyword">float</span>,<span class="keyword">float</span>)),<span class="keyword">this</span>,SLOT(slot_update_dashboard(<span class="keyword">float</span>,<span class="keyword">float</span>)));</span><br><span class="line">     connect(&amp;qnode,SIGNAL(power_vel(<span class="keyword">float</span>)),<span class="keyword">this</span>,SLOT(slot_update_power(<span class="keyword">float</span>)));</span><br><span class="line">     connect(&amp;qnode,SIGNAL(image_val(QImage)),<span class="keyword">this</span>,SLOT(slot_update_image(QImage)));</span><br><span class="line">     connect(ui.pushButton_sub_image,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_sub_image()));</span><br><span class="line">     connect(&amp;qnode,SIGNAL(position(<span class="keyword">double</span>,<span class="keyword">double</span>,<span class="keyword">double</span>)),<span class="keyword">this</span>,SLOT(slot_update_pos(<span class="keyword">double</span>,<span class="keyword">double</span>,<span class="keyword">double</span>)));</span><br><span class="line">     <span class="comment">//set start and goal pose</span></span><br><span class="line">     connect(ui.set_start_btn,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_set_start_pose()));</span><br><span class="line">     connect(ui.set_goal_btn,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_set_goal_pose()));</span><br><span class="line">     <span class="comment">// set return pose</span></span><br><span class="line">     connect(ui.set_return_pos_btn,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_set_return_pos()));</span><br><span class="line">     connect(ui.return_btn,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_return()));</span><br><span class="line">    <span class="comment">//cmd</span></span><br><span class="line">    connect(ui.cmd_btn,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_clicked()));</span><br><span class="line">    connect(ui.cmd_home,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_home_clicked()));</span><br><span class="line">    connect(ui.cmd_pei,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_pei_clicked()));</span><br><span class="line">    connect(ui.cmd_message,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_message_clicked()));</span><br><span class="line">    connect(ui.cmd_topic,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_topic_clicked()));</span><br><span class="line">    connect(ui.cmd_topic_content,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_topic_content_clicked()));</span><br><span class="line">    connect(ui.cmd_pubtopic,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_pubtopic_clicked()));</span><br><span class="line">    connect(ui.cmd_node,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_node_clicked()));</span><br><span class="line">    connect(ui.cmd_plot,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_plot_clicked()));</span><br><span class="line">    connect(ui.cmd_slam,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_slam_clicked()));</span><br><span class="line">    connect(ui.cmd_saver_map,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_saver_map_clicked()));</span><br><span class="line">    connect(ui.cmd_pub_map,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_pub_map_clicked()));</span><br><span class="line">    connect(ui.cmd_amcl,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_amcl_clicked()));</span><br><span class="line">    connect(ui.cmd_choose,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_choose_clicked()));</span><br><span class="line">    connect(ui.cmd_hector,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_hector_clicked()));</span><br><span class="line">    connect(ui.cmd_cartographer,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_cartographer_clicked()));</span><br><span class="line">    connect(ui.cmd_dijkstra_teb,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_dijkstra_teb_clicked()));</span><br><span class="line">    connect(ui.cmd_dijkstra_DWA,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_dijkstra_DWA_clicked()));</span><br><span class="line">    connect(ui.cmd_A_teb,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_A_teb_clicked()));</span><br><span class="line">    connect(ui.cmd_A_DWA,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_A_DWA_clicked()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//***********cmd*****</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_choose_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(cmd_saver_map_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;rosrun map_server map_saver -f &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_saver_map_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_pub_map_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;rosrun map_server map_server &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_pub_map_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_amcl_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_amcl_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_slam_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_slam_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_hector_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_hector_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(cmd_cartographer_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_cartographer_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_dijkstra_teb_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_dijkstra_teb_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(cmd_dijkstra_DWA_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_dijkstra_DWA_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_A_teb_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_A_teb_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_A_DWA_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_A_DWA_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_A_DWA_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;robot_navigation move_base.launch use_dijkstra:=false planner:=dwa&quot;</span>);</span><br><span class="line">    cmd_A_DWA_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_A_teb_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;robot_navigation move_base.launch use_dijkstra:=false planner:=teb&quot;</span>);</span><br><span class="line">   cmd_A_teb_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_dijkstra_DWA_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;robot_navigation move_base.launch planner:=dwa&quot;</span>);</span><br><span class="line">   cmd_dijkstra_DWA_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_dijkstra_teb_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;robot_navigation move_base.launch planner:=teb&quot;</span>);</span><br><span class="line">   cmd_dijkstra_teb_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_cartographer_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;请先进行以下操作&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;安装cartographer:https://blog.csdn.net/wxc_1998/article/details/122802419&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;roscd cartographer_ros&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;找到这个包里的configuration_files文件夹里的revo_lds.lua复制内容&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;新建 config文件夹和revo_lds.lua文件粘贴内容并修改&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;tracking_frame更改为我们机器人的基坐标tf，一般是base_footprint&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;odom_frame更改为odom&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;按照map-&gt;odom_frame-&gt;publisher_frame-&gt;tracking_frame&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;published_frame更改为odom&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;use_odometry更改为true&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;provide_odom_frame更改为false&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;odometry_sampling_ratio更改为0.1&quot;</span>);</span><br><span class="line"></span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;roscd cartographer_ros&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;找到这个包里的launch文件夹里的demo_revo_lds.launch复制内容&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;新建 launch 文件粘贴内容并修改&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;更改下面的configuration_directory为刚刚配置文件的包和目录&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;更改下面的configuration_basename为刚刚配置文件的名字&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;remap from=\&quot;scan\&quot; to=\&quot;scan\&quot;/&gt;&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;remap from=\&quot;odom\&quot; to=\&quot;odom\&quot;/&gt;&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;删除倒数第一个第二个node标签&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;node pkg=\&quot;joint_state_publisher\&quot; name=\&quot;joint_state_publisher\&quot; type=\&quot;joint_state_publisher\&quot; /&gt;&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;node pkg=\&quot;robot_state_publisher\&quot; name=\&quot;robot_state_publisher\&quot; type=\&quot;robot_state_publisher\&quot; /&gt;&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;最后两个在整个程序中必须被启动，否则无法正确显示机器人模型&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;然后输入你编写cartographer建图启动的launch文件所在的功能包名和launch文件名比如&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;nav_demo nav03_slam.launch &quot;</span>);</span><br><span class="line">     cmd_hector_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_hector_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;请先进行以下操作&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;安装 hector-slam包(用于构建地图):sudo apt install ros-ROS版本-hector-slam&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;安装地图服务包(用于保存与读取地图):sudo apt install ros-ROS版本-map-server&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;安装 navigation 包(用于定位以及路径规划):sudo apt install ros-ROS版本-navigation&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;新建功能包，并导入依赖: hector_slam map_server amcl move_base&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;新建 launch 文件&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;复制 https://www.guyuehome.com/42755 launch 文件内容&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;删除第二个第三个node标签&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;做如下修改和添加&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;param name=\&quot;base_frame\&quot; value=\&quot;base_footprint\&quot;/&gt;&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;param name=\&quot;odom_frame\&quot; value=\&quot;odom\&quot;/&gt;&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;node pkg=\&quot;joint_state_publisher\&quot; name=\&quot;joint_state_publisher\&quot; type=\&quot;joint_state_publisher\&quot; /&gt;&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;node pkg=\&quot;robot_state_publisher\&quot; name=\&quot;robot_state_publisher\&quot; type=\&quot;robot_state_publisher\&quot; /&gt;&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;最后两个在整个程序中必须被启动，否则无法正确显示机器人模型&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;然后输入你编写hector建图启动的launch文件所在的功能包名和launch文件名比如&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;nav_demo nav02_slam.launch &quot;</span>);</span><br><span class="line">    cmd_hector_flag =<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_slam_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;请先进行以下操作&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;安装 gmapping包(用于构建地图):sudo apt install ros-ROS版本-gmapping&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;安装地图服务包(用于保存与读取地图):sudo apt install ros-ROS版本-map-server&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;安装 navigation 包(用于定位以及路径规划):sudo apt install ros-ROS版本-navigation&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;新建功能包，并导入依赖: gmapping map_server amcl move_base&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;新建 launch 文件&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;复制 https://github.com/ros-perception/slam_gmapping/blob/melodic-devel/gmapping/launch/slam_gmapping_pr2.launch 文件内容&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;编写新的launch文件做如下修改和添加&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;remap from=\&quot;scan\&quot; to=\&quot;scan\&quot;/&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;param name=\&quot;base_frame\&quot; value=\&quot;base_footprint\&quot;/&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;param name=\&quot;odom_frame\&quot; value=\&quot;odom\&quot;/&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;node pkg=\&quot;joint_state_publisher\&quot; name=\&quot;joint_state_publisher\&quot; type=\&quot;joint_state_publisher\&quot; /&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;node pkg=\&quot;robot_state_publisher\&quot; name=\&quot;robot_state_publisher\&quot; type=\&quot;robot_state_publisher\&quot; /&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;最后两个在整个程序中必须被启动，否则无法正确显示机器人模型&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;然后输入你编写gmapping建图启动的launch文件所在的功能包名和launch文件名比如&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;nav_demo nav01_slam.launch &quot;</span>);</span><br><span class="line">   cmd_slam_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_amcl_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;请先进行以下操作&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;sudo apt install ros-ROS版本-navigation&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;新建功能包，并导入依赖: amcl move_base&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;执行roscd amcl 和ls examples ,新建 launch 文件，复制 amcl_diff.launch 文件内容编写新的launch文件&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;在&lt;param name=\&quot;odom_frame_id\&quot; value=\&quot;odom\&quot;/&gt;下添加&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;param name=\&quot;base_frame_id\&quot; value=\&quot;base_footprint\&quot;/&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;param name=\&quot;global_frame_id\&quot; value=\&quot;map\&quot;/&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;完成后请确保你已经启动发布地图，机器人模型&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;然后输入你编写amcl启动的launch文件所在的功能包名和launch文件名比如&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;nav_demo amcl.launch&quot;</span>);</span><br><span class="line">   cmd_amcl_flag=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_pub_map_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;请在选择框输入后点击确定&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;请输入你要发布地图的地址,比如&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;~/catkin_ws/src/map/my_map.yaml&quot;</span>);</span><br><span class="line">    cmd_pub_map_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_saver_map_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;请在选择框输入后点击确定&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;请输入你要保存地图的地址,比如&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;~/catkin_ws/src/map/my_map&quot;</span>);</span><br><span class="line">   cmd_saver_map_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_plot_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_cmd-&gt;append(<span class="string">&quot;rqt_plot&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_node_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_cmd-&gt;append(<span class="string">&quot;rqt_graph&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_pubtopic_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_cmd-&gt;append(<span class="string">&quot;rostopic pub /cmd_vel 两次tab&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_topic_content_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_cmd-&gt;append(<span class="string">&quot;rostopic echo /cmd_vel&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_topic_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_cmd-&gt;append(<span class="string">&quot;rostopic info /cmd_vel&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_message_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_cmd-&gt;append(<span class="string">&quot;rosmsg show geometry_msgs/Twist&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_pei_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ui.textEdit_cmd-&gt;append(<span class="string">&quot;ssh-keygen -t rsa&quot;</span>);</span><br><span class="line">  ui.textEdit_cmd-&gt;append(<span class="string">&quot;ssh-copy-id 用户名@远程主机ip&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_home_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ui.textEdit_cmd-&gt;append(<span class="string">&quot;cd ~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_quick_output-&gt;clear();</span><br><span class="line">    quick_cmd=<span class="keyword">new</span> QProcess;</span><br><span class="line">    quick_cmd-&gt;start(<span class="string">&quot;bash&quot;</span>);</span><br><span class="line">    quick_cmd-&gt;write(ui.textEdit_cmd-&gt;toPlainText().toLocal8Bit()+<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    ui.textEdit_cmd-&gt;clear();</span><br><span class="line"></span><br><span class="line">    connect(quick_cmd,SIGNAL(readyReadStandardOutput()),<span class="keyword">this</span>,SLOT(slot_quick_output()));</span><br><span class="line">    connect(quick_cmd,SIGNAL(readyReadStandardError()),<span class="keyword">this</span>,SLOT(slot_quick_output()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_quick_output</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;font color=\&quot;#FF000000\&quot;&gt;&quot;</span>+quick_cmd-&gt;readAllStandardOutput()+<span class="string">&quot;&lt;/font&gt;&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;font color=\&quot;#FF0000\&quot;&gt;&quot;</span>+quick_cmd-&gt;readAllStandardError()+<span class="string">&quot;&lt;/font&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//***************</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_set_return_pos</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ui.return_x-&gt;setText(ui.pos_x-&gt;text());</span><br><span class="line">   ui.return_y-&gt;setText(ui.pos_y-&gt;text());</span><br><span class="line">    ui.return_z-&gt;setText(ui.pos_z-&gt;text());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_return</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  qnode.set_goal(ui.return_x-&gt;text().toDouble(),ui.return_y-&gt;text().toDouble(),ui.return_z-&gt;text().toDouble());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_update_pos</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">double</span> y,<span class="keyword">double</span> z)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.pos_x-&gt;setText(QString::number(x));</span><br><span class="line">    ui.pos_y-&gt;setText(QString::number(y));</span><br><span class="line">    ui.pos_z-&gt;setText(QString::number(z));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_local_map</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">      QStringList qli=Local_Planner_Color_box-&gt;currentText().split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">      QColor color=QColor(qli[<span class="number">0</span>].toInt(),qli[<span class="number">1</span>].toInt(),qli[<span class="number">2</span>].toInt());</span><br><span class="line">      myrviz-&gt;Display_Local_Map(Local_CostMap_Topic_box-&gt;currentText(),LocalMapColorScheme_box-&gt;currentText(),Local_Planner_Topic_box-&gt;currentText(),color,enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_global_map</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">      QStringList qli=Global_Planner_Color_box-&gt;currentText().split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">      QColor color=QColor(qli[<span class="number">0</span>].toInt(),qli[<span class="number">1</span>].toInt(),qli[<span class="number">2</span>].toInt());</span><br><span class="line">      myrviz-&gt;Display_Global_Map(Global_CostMap_Topic_box-&gt;currentText(),GlobalMapColorScheme_box-&gt;currentText(),Global_Planner_Topic_box-&gt;currentText(),color,enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_set_start_pose</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myrviz-&gt;Set_Start_Pose();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_set_goal_pose</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myrviz-&gt;Set_Goal_Pose();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_Path</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">    QStringList qli=Path_Color_box-&gt;currentText().split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">    QColor color=QColor(qli[<span class="number">0</span>].toInt(),qli[<span class="number">1</span>].toInt(),qli[<span class="number">2</span>].toInt());</span><br><span class="line">    myrviz-&gt;Display_Path(Path_Topic_box-&gt;currentText(),color,enable);</span><br><span class="line">    qDebug()&lt;&lt;Path_Topic_box-&gt;currentText();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_Map</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">    myrviz-&gt;Display_Map(Map_Topic_box-&gt;currentText(),Map_Color_Scheme_box-&gt;currentText(),enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_RobotModel</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">    myrviz-&gt;Display_RobotModel(enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_laser</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">    myrviz-&gt;Display_LaserScan(Laser_Topic_box-&gt;currentText(),enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_tf</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">    myrviz-&gt;Display_TF(enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_grid</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">    QStringList qli=Grid_Color_Box-&gt;currentText().split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">    QColor color=QColor(qli[<span class="number">0</span>].toInt(),qli[<span class="number">1</span>].toInt(),qli[<span class="number">2</span>].toInt());</span><br><span class="line">    myrviz-&gt;Display_Grid(Cell_Count_Box-&gt;text().toInt(),color,enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_treewidget_value_change</span><span class="params">(QString)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myrviz-&gt;Set_FixedFrame(fixed_box-&gt;currentText());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_update_image</span><span class="params">(QImage im)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.label_image-&gt;setPixmap(QPixmap::fromImage(im));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_sub_image</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qnode.sub_image(ui.lineEdit_image_topic-&gt;text());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_update_power</span><span class="params">(<span class="keyword">float</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     ui.label_power_val-&gt;setText(QString::number(value).mid(<span class="number">0</span>,<span class="number">5</span>)+<span class="string">&quot;V&quot;</span>);</span><br><span class="line">     <span class="keyword">double</span> n=(value<span class="number">-9.6</span>)/(<span class="number">11.7</span><span class="number">-9.6</span>);</span><br><span class="line">     <span class="keyword">int</span> val=n*<span class="number">100</span>;</span><br><span class="line">     ui.progressBar-&gt;setValue(val);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_update_dashboard</span><span class="params">(<span class="keyword">float</span> x,<span class="keyword">float</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;  ui.label_dir_x-&gt;setText(x&gt;<span class="number">0</span>?<span class="string">&quot;正向&quot;</span>:<span class="string">&quot;反向&quot;</span>);</span><br><span class="line">   ui.label_dir_y-&gt;setText(y&gt;<span class="number">0</span>?<span class="string">&quot;正向&quot;</span>:<span class="string">&quot;反向&quot;</span>);</span><br><span class="line">   speed_x_dashBoard-&gt;setValue(<span class="built_in">abs</span>(x)*<span class="number">100</span>);</span><br><span class="line">   speed_y_dashBoard-&gt;setValue(<span class="built_in">abs</span>(y)*<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_linera_change</span><span class="params">(<span class="keyword">int</span> value)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      ui.label_linera-&gt;setText(QString::number(value));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_raw_change</span><span class="params">(<span class="keyword">int</span> value)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      ui.label_raw-&gt;setText(QString::number(value));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_pushbtn_click</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      QPushButton* btn =qobject_cast&lt;QPushButton*&gt;(sender());</span><br><span class="line">      <span class="comment">//qDebug() &lt;&lt;btn-&gt;text();</span></span><br><span class="line">      <span class="keyword">char</span> k=btn-&gt;text().toStdString()[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">bool</span> is_all=ui.checkBox_is_all-&gt;isChecked();</span><br><span class="line">      <span class="keyword">float</span> linear=ui.label_linera-&gt;text().toFloat()*<span class="number">0.01</span>;</span><br><span class="line">      <span class="keyword">float</span> angular=ui.label_raw-&gt;text().toFloat()*<span class="number">0.01</span>;</span><br><span class="line">      <span class="keyword">switch</span> (k) &#123;</span><br><span class="line">         <span class="keyword">case</span> <span class="string">&#x27;i&#x27;</span>:</span><br><span class="line">          qnode.set_cmd_vel(is_all?<span class="string">&#x27;I&#x27;</span>:<span class="string">&#x27;i&#x27;</span>,linear,angular);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;U&#x27;</span>:<span class="string">&#x27;u&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;o&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;O&#x27;</span>:<span class="string">&#x27;o&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;j&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;J&#x27;</span>:<span class="string">&#x27;j&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;L&#x27;</span>:<span class="string">&#x27;l&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;m&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;M&#x27;</span>:<span class="string">&#x27;m&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;,&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;&lt;&#x27;</span>:<span class="string">&#x27;,&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;&gt;&#x27;</span>:<span class="string">&#x27;.&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line">MainWindow::~MainWindow() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Implementation [Slots]</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::showNoMasterMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	QMessageBox msgBox;</span><br><span class="line">	msgBox.setText(<span class="string">&quot;Couldn&#x27;t find the ros master.&quot;</span>);</span><br><span class="line">	msgBox.exec();</span><br><span class="line">    close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * These triggers whenever the button is clicked, regardless of whether it</span></span><br><span class="line"><span class="comment"> * is already checked or not.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_button_connect_clicked</span><span class="params">(<span class="keyword">bool</span> check )</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( ui.checkbox_use_environment-&gt;isChecked() ) &#123;</span><br><span class="line">		<span class="keyword">if</span> ( !qnode.init() ) &#123;</span><br><span class="line">			showNoMasterMessage();</span><br><span class="line">            fixed_box-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            ui.pushButton_sub_image-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">            ui.treeWidget-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			ui.button_connect-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">            ui.pushButton_sub_image-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.treeWidget-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            fixed_box-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Grid_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            TF_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Laser_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            RobotModel_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Map_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Path_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            GlobalMap_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            LocalMap_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_u-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_i-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_o-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_j-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_l-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_m-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_1-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_2-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.set_goal_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.set_start_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.set_return_pos_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.return_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            myrviz=<span class="keyword">new</span> qrviz(ui.layout_rviz);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> ( ! qnode.init(ui.line_edit_master-&gt;text().toStdString(),</span><br><span class="line">				   ui.line_edit_host-&gt;text().toStdString()) ) &#123;</span><br><span class="line">			showNoMasterMessage();</span><br><span class="line">            ui.pushButton_sub_image-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">            ui.treeWidget-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">            fixed_box-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			ui.button_connect-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">			ui.line_edit_master-&gt;setReadOnly(<span class="literal">true</span>);</span><br><span class="line">			ui.line_edit_host-&gt;setReadOnly(<span class="literal">true</span>);</span><br><span class="line">			ui.line_edit_topic-&gt;setReadOnly(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_sub_image-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.treeWidget-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            fixed_box-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Grid_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            TF_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Laser_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            RobotModel_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Map_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Path_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            GlobalMap_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            LocalMap_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_u-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_i-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_o-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_j-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_l-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_m-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_1-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_2-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.set_goal_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.set_start_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.set_return_pos_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.return_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            myrviz=<span class="keyword">new</span> qrviz(ui.layout_rviz);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_checkbox_use_environment_stateChanged</span><span class="params">(<span class="keyword">int</span> state)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">bool</span> enabled;</span><br><span class="line">	<span class="keyword">if</span> ( state == <span class="number">0</span> ) &#123;</span><br><span class="line">		enabled = <span class="literal">true</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		enabled = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ui.line_edit_master-&gt;setEnabled(enabled);</span><br><span class="line">	ui.line_edit_host-&gt;setEnabled(enabled);</span><br><span class="line">	<span class="comment">//ui.line_edit_topic-&gt;setEnabled(enabled);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Implemenation [Slots][manually connected]</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This function is signalled by the underlying model. When the model changes,</span></span><br><span class="line"><span class="comment"> * this will drop the cursor down to the last line in the QListview to ensure</span></span><br><span class="line"><span class="comment"> * the user can always see the latest log message.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::updateLoggingView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ui.view_logging-&gt;scrollToBottom();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Implementation [Menu]</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_actionAbout_triggered</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QMessageBox::about(<span class="keyword">this</span>, tr(<span class="string">&quot;About ...&quot;</span>),tr(<span class="string">&quot;&lt;h2&gt;PACKAGE_NAME Test Program 0.10&lt;/h2&gt;&lt;p&gt;Copyright Yujin Robot&lt;/p&gt;&lt;p&gt;This package needs an about description.&lt;/p&gt;&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Implementation [Configuration]</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::ReadSettings</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">QSettings <span class="title">settings</span><span class="params">(<span class="string">&quot;Qt-Ros Package&quot;</span>, <span class="string">&quot;qt_ros_test&quot;</span>)</span></span>;</span><br><span class="line">    restoreGeometry(settings.value(<span class="string">&quot;geometry&quot;</span>).toByteArray());</span><br><span class="line">    restoreState(settings.value(<span class="string">&quot;windowState&quot;</span>).toByteArray());</span><br><span class="line">    QString master_url = settings.value(<span class="string">&quot;master_url&quot;</span>,QString(<span class="string">&quot;http://192.168.1.2:11311/&quot;</span>)).toString();</span><br><span class="line">    QString host_url = settings.value(<span class="string">&quot;host_url&quot;</span>, QString(<span class="string">&quot;192.168.1.3&quot;</span>)).toString();</span><br><span class="line">    <span class="comment">//QString topic_name = settings.value(&quot;topic_name&quot;, QString(&quot;/chatter&quot;)).toString();</span></span><br><span class="line">    ui.line_edit_master-&gt;setText(master_url);</span><br><span class="line">    ui.line_edit_host-&gt;setText(host_url);</span><br><span class="line">    <span class="comment">//ui.line_edit_topic-&gt;setText(topic_name);</span></span><br><span class="line">    <span class="keyword">bool</span> remember = settings.value(<span class="string">&quot;remember_settings&quot;</span>, <span class="literal">false</span>).toBool();</span><br><span class="line">    ui.checkbox_remember_settings-&gt;setChecked(remember);</span><br><span class="line">    <span class="keyword">bool</span> checked = settings.value(<span class="string">&quot;use_environment_variables&quot;</span>, <span class="literal">false</span>).toBool();</span><br><span class="line">    ui.checkbox_use_environment-&gt;setChecked(checked);</span><br><span class="line">    <span class="keyword">if</span> ( checked ) &#123;</span><br><span class="line">    	ui.line_edit_master-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">    	ui.line_edit_host-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">    	<span class="comment">//ui.line_edit_topic-&gt;setEnabled(false);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::WriteSettings</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">QSettings <span class="title">settings</span><span class="params">(<span class="string">&quot;Qt-Ros Package&quot;</span>, <span class="string">&quot;qt_ros_test&quot;</span>)</span></span>;</span><br><span class="line">    settings.setValue(<span class="string">&quot;master_url&quot;</span>,ui.line_edit_master-&gt;text());</span><br><span class="line">    settings.setValue(<span class="string">&quot;host_url&quot;</span>,ui.line_edit_host-&gt;text());</span><br><span class="line">    <span class="comment">//settings.setValue(&quot;topic_name&quot;,ui.line_edit_topic-&gt;text());</span></span><br><span class="line">    settings.setValue(<span class="string">&quot;use_environment_variables&quot;</span>,QVariant(ui.checkbox_use_environment-&gt;isChecked()));</span><br><span class="line">    settings.setValue(<span class="string">&quot;geometry&quot;</span>, saveGeometry());</span><br><span class="line">    settings.setValue(<span class="string">&quot;windowState&quot;</span>, saveState());</span><br><span class="line">    settings.setValue(<span class="string">&quot;remember_settings&quot;</span>,QVariant(ui.checkbox_remember_settings-&gt;isChecked()));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::loadStyleSheet</span><span class="params">(<span class="keyword">const</span> QString &amp;styleSheetFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(styleSheetFile)</span></span>;</span><br><span class="line">    file.open(QFile::ReadOnly);</span><br><span class="line">    <span class="keyword">if</span> (file.isOpen())</span><br><span class="line">    &#123;</span><br><span class="line">        QString styleSheet = <span class="keyword">this</span>-&gt;styleSheet();</span><br><span class="line">        styleSheet += QLatin1String(file.readAll());<span class="comment">//读取样式表文件</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;setStyleSheet(styleSheet);<span class="comment">//把文件内容传参</span></span><br><span class="line">        file.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        QMessageBox::information(<span class="keyword">this</span>,<span class="string">&quot;tip&quot;</span>,<span class="string">&quot;cannot find qss file&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::closeEvent</span><span class="params">(QCloseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	WriteSettings();</span><br><span class="line">	QMainWindow::closeEvent(event);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace qt_ros_test</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> qt_ros_test::MainWindow::on_btn_theme_1_clicked()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>qnode.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file /src/qnode.cpp</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @brief Ros communication central!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @date February 2011</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Includes</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/network.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;std_msgs/String.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../include/qt_ros_test/qnode.hpp&quot;</span></span></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Namespaces</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> qt_ros_test &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Implementation</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line">QNode::QNode(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv ) :</span><br><span class="line">	init_argc(argc),</span><br><span class="line">	init_argv(argv)</span><br><span class="line">	&#123;&#125;</span><br><span class="line"></span><br><span class="line">QNode::~QNode() &#123;</span><br><span class="line">    <span class="keyword">if</span>(ros::isStarted()) &#123;</span><br><span class="line">      ros::shutdown(); <span class="comment">// explicitly needed since we use ros::start();</span></span><br><span class="line">      ros::waitForShutdown();</span><br><span class="line">    &#125;</span><br><span class="line">	wait();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">QNode::init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	ros::init(init_argc,init_argv,<span class="string">&quot;qt_ros_test&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> ( ! ros::master::check() ) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ros::start(); <span class="comment">// explicitly needed since our nodehandle is going out of scope.</span></span><br><span class="line">	ros::NodeHandle n;</span><br><span class="line">	<span class="comment">// Add your ros communications here.</span></span><br><span class="line">	chatter_publisher = n.advertise&lt;std_msgs::String&gt;(<span class="string">&quot;chatter&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">    cmd_vel_pub = n.advertise&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;cmd_vel&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">    odom_sub = n.subscribe(<span class="string">&quot;odom&quot;</span>,<span class="number">1000</span>,&amp;QNode::odom_raw_callback,<span class="keyword">this</span>);</span><br><span class="line">    power_sub = n.subscribe(<span class="string">&quot;voltage&quot;</span>,<span class="number">1000</span>,&amp;QNode::power_callback,<span class="keyword">this</span>);</span><br><span class="line">    amcl_pose_sub =n.subscribe(<span class="string">&quot;amcl_pose&quot;</span>,<span class="number">1000</span>,&amp;QNode::amcl_pose_callback,<span class="keyword">this</span>);</span><br><span class="line">    goal_pub=n.advertise&lt;geometry_msgs::PoseStamped&gt;(<span class="string">&quot;move_base_simple/goal&quot;</span>,<span class="number">1000</span>);</span><br><span class="line">    start();</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">QNode::init</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;master_url, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;host_url)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>,<span class="built_in">std</span>::<span class="built_in">string</span>&gt; remappings;</span><br><span class="line">	remappings[<span class="string">&quot;__master&quot;</span>] = master_url;</span><br><span class="line">	remappings[<span class="string">&quot;__hostname&quot;</span>] = host_url;</span><br><span class="line">	ros::init(remappings,<span class="string">&quot;qt_ros_test&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> ( ! ros::master::check() ) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ros::start(); <span class="comment">// explicitly needed since our nodehandle is going out of scope.</span></span><br><span class="line">	ros::NodeHandle n;</span><br><span class="line">	<span class="comment">// Add your ros communications here.</span></span><br><span class="line">	chatter_publisher = n.advertise&lt;std_msgs::String&gt;(<span class="string">&quot;chatter&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">    cmd_vel_pub = n.advertise&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;cmd_vel&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">    odom_sub = n.subscribe(<span class="string">&quot;odom&quot;</span>,<span class="number">1000</span>,&amp;QNode::odom_raw_callback,<span class="keyword">this</span>);</span><br><span class="line">    power_sub = n.subscribe(<span class="string">&quot;voltage&quot;</span>,<span class="number">1000</span>,&amp;QNode::power_callback,<span class="keyword">this</span>);</span><br><span class="line">    amcl_pose_sub =n.subscribe(<span class="string">&quot;amcl_pose&quot;</span>,<span class="number">1000</span>,&amp;QNode::amcl_pose_callback,<span class="keyword">this</span>);</span><br><span class="line">    goal_pub=n.advertise&lt;geometry_msgs::PoseStamped&gt;(<span class="string">&quot;move_base_simple/goal&quot;</span>,<span class="number">1000</span>);</span><br><span class="line">    start();</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::set_goal</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">double</span> y,<span class="keyword">double</span> z)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    geometry_msgs::PoseStamped goal;</span><br><span class="line">    <span class="comment">//设置frame</span></span><br><span class="line">    goal.header.frame_id=<span class="string">&quot;map&quot;</span>;</span><br><span class="line">    <span class="comment">//设置时刻</span></span><br><span class="line">    goal.header.stamp=ros::Time::now();</span><br><span class="line">    goal.pose.position.x=x;</span><br><span class="line">    goal.pose.position.y=y;</span><br><span class="line">    goal.pose.orientation.z=z;</span><br><span class="line">    goal_pub.publish(goal);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::amcl_pose_callback</span><span class="params">(<span class="keyword">const</span> geometry_msgs::PoseWithCovarianceStamped &amp;msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">emit <span class="title">position</span><span class="params">(msg.pose.pose.position.x,msg.pose.pose.position.y,msg.pose.pose.orientation.z)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> QNode:: sub_image(QString topic_name)</span><br><span class="line">&#123;</span><br><span class="line">   ros::NodeHandle n;</span><br><span class="line">   <span class="function">image_transport::ImageTransport <span class="title">it_</span><span class="params">(n)</span></span>;</span><br><span class="line">   image_sub=it_.subscribe(topic_name.toStdString(),<span class="number">1000</span>,&amp;QNode::image_callback,<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::image_callback</span><span class="params">(<span class="keyword">const</span> sensor_msgs::ImageConstPtr &amp;msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   cv_bridge::CvImagePtr cv_ptr;</span><br><span class="line">   cv_ptr=cv_bridge::toCvCopy(msg,msg-&gt;encoding);</span><br><span class="line">   QImage im=Mat2QImage(cv_ptr-&gt;image);</span><br><span class="line"></span><br><span class="line">      <span class="function">emit <span class="title">image_val</span><span class="params">(im)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">QImage <span class="title">QNode::Mat2QImage</span><span class="params">(cv::Mat <span class="keyword">const</span>&amp; src)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="function">QImage <span class="title">dest</span><span class="params">(src.cols, src.rows, QImage::Format_ARGB32)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">float</span> scale = <span class="number">255.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (src.depth() == CV_8U) &#123;</span><br><span class="line">    <span class="keyword">if</span> (src.channels() == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; src.rows; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.cols; ++j) &#123;</span><br><span class="line">          <span class="keyword">int</span> level = src.at&lt;quint8&gt;(i, j);</span><br><span class="line">          dest.setPixel(j, i, qRgb(level, level, level));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (src.channels() == <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; src.rows; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.cols; ++j) &#123;</span><br><span class="line">          cv::Vec3b bgr = src.at&lt;cv::Vec3b&gt;(i, j);</span><br><span class="line">          dest.setPixel(j, i, qRgb(bgr[<span class="number">2</span>], bgr[<span class="number">1</span>], bgr[<span class="number">0</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (src.depth() == CV_32F) &#123;</span><br><span class="line">    <span class="keyword">if</span> (src.channels() == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; src.rows; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.cols; ++j) &#123;</span><br><span class="line">          <span class="keyword">int</span> level = scale * src.at&lt;<span class="keyword">float</span>&gt;(i, j);</span><br><span class="line">          dest.setPixel(j, i, qRgb(level, level, level));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (src.channels() == <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; src.rows; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.cols; ++j) &#123;</span><br><span class="line">          cv::Vec3f bgr = scale * src.at&lt;cv::Vec3f&gt;(i, j);</span><br><span class="line">          dest.setPixel(j, i, qRgb(bgr[<span class="number">2</span>], bgr[<span class="number">1</span>], bgr[<span class="number">0</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dest;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::power_callback</span><span class="params">(<span class="keyword">const</span> std_msgs::Float32 &amp;msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="function">emit <span class="title">power_vel</span><span class="params">(msg.data)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::odom_raw_callback</span><span class="params">(<span class="keyword">const</span> nav_msgs::Odometry &amp;msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">emit <span class="title">speed_vel</span><span class="params">(msg.twist.twist.linear.x,msg.twist.twist.linear.y)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::set_cmd_vel</span><span class="params">(<span class="keyword">char</span> k, <span class="keyword">float</span> linear, <span class="keyword">float</span> angular)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Map for movement keys</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;&gt; moveBindings</span><br><span class="line">    &#123;</span><br><span class="line">      &#123;<span class="string">&#x27;i&#x27;</span>, &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;o&#x27;</span>, &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;j&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;l&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;u&#x27;</span>, &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;,&#x27;</span>, &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;.&#x27;</span>, &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;m&#x27;</span>, &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;O&#x27;</span>, &#123;<span class="number">1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;I&#x27;</span>, &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;J&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;L&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;U&#x27;</span>, &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;&lt;&#x27;</span>, &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;&gt;&#x27;</span>, &#123;<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;M&#x27;</span>, &#123;<span class="number">-1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;t&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;b&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;k&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;K&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">char</span> key=k;</span><br><span class="line">    <span class="comment">// Grab the direction data</span></span><br><span class="line">       <span class="keyword">int</span>  x = moveBindings[key][<span class="number">0</span>];</span><br><span class="line">       <span class="keyword">int</span>  y = moveBindings[key][<span class="number">1</span>];</span><br><span class="line">       <span class="keyword">int</span>  z = moveBindings[key][<span class="number">2</span>];</span><br><span class="line">       <span class="keyword">int</span>  th = moveBindings[key][<span class="number">3</span>];</span><br><span class="line">     geometry_msgs::Twist twist;</span><br><span class="line">     twist.linear.x=x*linear;</span><br><span class="line">     twist.linear.y=y*linear;</span><br><span class="line">     twist.linear.z=z*linear;</span><br><span class="line">     twist.angular.x=<span class="number">0</span>;</span><br><span class="line">     twist.angular.y=<span class="number">0</span>;</span><br><span class="line">     twist.angular.z=th*angular;</span><br><span class="line">     cmd_vel_pub.publish(twist);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> ( ros::ok() ) &#123;</span><br><span class="line"></span><br><span class="line">		std_msgs::String msg;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">stringstream</span> ss;</span><br><span class="line">		ss &lt;&lt; <span class="string">&quot;hello world &quot;</span> &lt;&lt; count;</span><br><span class="line">		msg.data = ss.str();</span><br><span class="line">		chatter_publisher.publish(msg);</span><br><span class="line">		<span class="built_in">log</span>(Info,<span class="built_in">std</span>::<span class="built_in">string</span>(<span class="string">&quot;I sent: &quot;</span>)+msg.data);</span><br><span class="line">		ros::spinOnce();</span><br><span class="line">		loop_rate.sleep();</span><br><span class="line">		++count;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Ros shutdown, proceeding to close the gui.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	<span class="function">Q_EMIT <span class="title">rosShutdown</span><span class="params">()</span></span>; <span class="comment">// used to signal the gui for a shutdown (useful to roslaunch)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::log</span><span class="params">( <span class="keyword">const</span> LogLevel &amp;level, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;msg)</span> </span>&#123;</span><br><span class="line">	logging_model.insertRows(logging_model.rowCount(),<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">stringstream</span> logging_model_msg;</span><br><span class="line">	<span class="keyword">switch</span> ( level ) &#123;</span><br><span class="line">		<span class="keyword">case</span>(Debug) : &#123;</span><br><span class="line">				ROS_DEBUG_STREAM(msg);</span><br><span class="line">				logging_model_msg &lt;&lt; <span class="string">&quot;[DEBUG] [&quot;</span> &lt;&lt; ros::Time::now() &lt;&lt; <span class="string">&quot;]: &quot;</span> &lt;&lt; msg;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">case</span>(Info) : &#123;</span><br><span class="line">				ROS_INFO_STREAM(msg);</span><br><span class="line">				logging_model_msg &lt;&lt; <span class="string">&quot;[INFO] [&quot;</span> &lt;&lt; ros::Time::now() &lt;&lt; <span class="string">&quot;]: &quot;</span> &lt;&lt; msg;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">case</span>(Warn) : &#123;</span><br><span class="line">				ROS_WARN_STREAM(msg);</span><br><span class="line">				logging_model_msg &lt;&lt; <span class="string">&quot;[INFO] [&quot;</span> &lt;&lt; ros::Time::now() &lt;&lt; <span class="string">&quot;]: &quot;</span> &lt;&lt; msg;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">case</span>(Error) : &#123;</span><br><span class="line">				ROS_ERROR_STREAM(msg);</span><br><span class="line">				logging_model_msg &lt;&lt; <span class="string">&quot;[ERROR] [&quot;</span> &lt;&lt; ros::Time::now() &lt;&lt; <span class="string">&quot;]: &quot;</span> &lt;&lt; msg;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">case</span>(Fatal) : &#123;</span><br><span class="line">				ROS_FATAL_STREAM(msg);</span><br><span class="line">				logging_model_msg &lt;&lt; <span class="string">&quot;[FATAL] [&quot;</span> &lt;&lt; ros::Time::now() &lt;&lt; <span class="string">&quot;]: &quot;</span> &lt;&lt; msg;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">QVariant <span class="title">new_row</span><span class="params">(QString(logging_model_msg.str().c_str()))</span></span>;</span><br><span class="line">	logging_model.setData(logging_model.index(logging_model.rowCount()<span class="number">-1</span>),new_row);</span><br><span class="line">	<span class="function">Q_EMIT <span class="title">loggingUpdated</span><span class="params">()</span></span>; <span class="comment">// used to readjust the scrollbar</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace qt_ros_test</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>qrviz.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../include/qt_ros_test/qrviz.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QException&gt;</span></span></span><br><span class="line">qrviz::qrviz(QVBoxLayout* layout)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建rviz panel</span></span><br><span class="line">    render_panel_=<span class="keyword">new</span> rviz::RenderPanel();</span><br><span class="line">    <span class="comment">//向layout添加</span></span><br><span class="line">    layout-&gt;addWidget(render_panel_);</span><br><span class="line">    <span class="comment">//创建rviz控制对象</span></span><br><span class="line">    manager_=<span class="keyword">new</span> rviz::VisualizationManager(render_panel_);</span><br><span class="line">    tool_manager_=manager_-&gt;getToolManager();</span><br><span class="line">    ROS_ASSERT(manager_!=<span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">//初始化render_panel 实现放大缩小等操作</span></span><br><span class="line">    render_panel_-&gt;initialize(manager_-&gt;getSceneManager(),manager_);</span><br><span class="line"></span><br><span class="line">    manager_-&gt;setFixedFrame(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">    <span class="comment">//初始化rviz控制对象</span></span><br><span class="line">    manager_-&gt;initialize();</span><br><span class="line">    manager_-&gt;startUpdate();</span><br><span class="line">    manager_-&gt;removeAllDisplays();</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_Local_Map</span><span class="params">(QString map_topic,QString map_color,QString planner_topic,QColor planner_color,<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Local_Map_!=<span class="literal">NULL</span>||Local_Planner_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> Local_Map_;</span><br><span class="line">        <span class="keyword">delete</span>  Local_Planner_;</span><br><span class="line">        Local_Map_=<span class="literal">NULL</span>;</span><br><span class="line">        Local_Planner_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Local_Map_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Map&quot;</span>,<span class="string">&quot;LocalMap&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(Local_Map_!=<span class="literal">NULL</span>);</span><br><span class="line">    Local_Planner_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Path&quot;</span>,<span class="string">&quot;LocalPlanner&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(Local_Planner_!=<span class="literal">NULL</span>);</span><br><span class="line">    Local_Map_-&gt;subProp(<span class="string">&quot;Topic&quot;</span>)-&gt;setValue(map_topic);</span><br><span class="line">    Local_Map_-&gt;subProp(<span class="string">&quot;Color Scheme&quot;</span>)-&gt;setValue(map_color);</span><br><span class="line"><span class="comment">//    Local_Planner_-&gt;subProp(&quot;Topic&quot;)-&gt;setValue(planner_topic);</span></span><br><span class="line"><span class="comment">//    Local_Planner_-&gt;subProp(&quot;Color&quot;)-&gt;setValue(planner_color);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_Global_Map</span><span class="params">(QString map_topic,QString map_color,QString planner_topic,QColor planner_color,<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Global_Map_!=<span class="literal">NULL</span>||Global_Planner_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> Global_Map_;</span><br><span class="line">        <span class="keyword">delete</span>  Global_Planner_;</span><br><span class="line">        Global_Map_=<span class="literal">NULL</span>;</span><br><span class="line">        Global_Planner_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Global_Map_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Map&quot;</span>,<span class="string">&quot;GlobalMap&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(Global_Map_!=<span class="literal">NULL</span>);</span><br><span class="line">    Global_Planner_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Path&quot;</span>,<span class="string">&quot;GlobalPlanner&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(Global_Planner_!=<span class="literal">NULL</span>);</span><br><span class="line">    Global_Map_-&gt;subProp(<span class="string">&quot;Topic&quot;</span>)-&gt;setValue(map_topic);</span><br><span class="line">    Global_Map_-&gt;subProp(<span class="string">&quot;Color Scheme&quot;</span>)-&gt;setValue(map_color);</span><br><span class="line"><span class="comment">//    Global_Planner_-&gt;subProp(&quot;Topic&quot;)-&gt;setValue(planner_topic);</span></span><br><span class="line"><span class="comment">//    Global_Planner_-&gt;subProp(&quot;Color&quot;)-&gt;setValue(planner_color);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Set_Start_Pose</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    rviz::Tool* current_tool_=tool_manager_-&gt;addTool(<span class="string">&quot;rviz/SetInitialPose&quot;</span>);</span><br><span class="line">    <span class="comment">//设置当前使用的工具</span></span><br><span class="line">    tool_manager_-&gt;setCurrentTool(current_tool_);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Set_Goal_Pose</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     rviz::Tool* current_tool_=tool_manager_-&gt;addTool(<span class="string">&quot;rviz/SetGoal&quot;</span>);</span><br><span class="line">     <span class="comment">//获取属性容器</span></span><br><span class="line">     rviz::Property* pro=current_tool_-&gt;getPropertyContainer();</span><br><span class="line">     <span class="comment">//设置发布导航目标点的topic</span></span><br><span class="line">     pro-&gt;subProp(<span class="string">&quot;Topic&quot;</span>)-&gt;setValue(<span class="string">&quot;/move_base_simple/goal&quot;</span>);</span><br><span class="line">     <span class="comment">//设置当前使用的工具</span></span><br><span class="line">     tool_manager_-&gt;setCurrentTool(current_tool_);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Set_FixedFrame</span><span class="params">(QString Frame_name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    manager_-&gt;setFixedFrame(Frame_name);</span><br><span class="line">    qDebug()&lt;&lt;manager_-&gt;getFixedFrame();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_Grid</span><span class="params">(<span class="keyword">int</span> Cell_Count,QColor color,<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Grid_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> Grid_;</span><br><span class="line">        Grid_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Grid_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Grid&quot;</span>,<span class="string">&quot;myGrid&quot;</span>,enable);</span><br><span class="line">    <span class="comment">//设置cell Count</span></span><br><span class="line">    Grid_-&gt;subProp(<span class="string">&quot;Plane Cell Count&quot;</span>)-&gt;setValue(Cell_Count);</span><br><span class="line">    <span class="comment">//设置颜色</span></span><br><span class="line">    Grid_-&gt;subProp(<span class="string">&quot;Color&quot;</span>)-&gt;setValue(color);</span><br><span class="line">    ROS_ASSERT(Grid_!=<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_TF</span><span class="params">(<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(TF_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> TF_;</span><br><span class="line">        TF_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    TF_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/TF&quot;</span>,<span class="string">&quot;myTF&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(TF_!=<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_LaserScan</span><span class="params">(QString laser_topic,<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(LaserScan_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> LaserScan_;</span><br><span class="line">        LaserScan_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    LaserScan_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/LaserScan&quot;</span>,<span class="string">&quot;myLaser&quot;</span>,enable);</span><br><span class="line">    LaserScan_-&gt;subProp(<span class="string">&quot;Topic&quot;</span>)-&gt;setValue(laser_topic);</span><br><span class="line">    LaserScan_-&gt;subProp(<span class="string">&quot;Size&quot;</span>)-&gt;setValue(<span class="number">0.05</span>);</span><br><span class="line">    ROS_ASSERT(LaserScan_!=<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_RobotModel</span><span class="params">(<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(RobotModel_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> RobotModel_;</span><br><span class="line">        RobotModel_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    RobotModel_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/RobotModel&quot;</span>,<span class="string">&quot;myRobotModel&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(RobotModel_!=<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_Map</span><span class="params">(QString topic,QString color_scheme,<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Map_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> Map_;</span><br><span class="line">        Map_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Map_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Map&quot;</span>,<span class="string">&quot;myMap&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(Map_!=<span class="literal">NULL</span>);</span><br><span class="line">    Map_-&gt;subProp(<span class="string">&quot;Topic&quot;</span>)-&gt;setValue(topic);</span><br><span class="line">    Map_-&gt;subProp(<span class="string">&quot;Color Scheme&quot;</span>)-&gt;setValue(color_scheme);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_Path</span><span class="params">(QString topic,QColor color,<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Path_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> Path_;</span><br><span class="line">        Path_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Path_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Path&quot;</span>,<span class="string">&quot;myPath&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(Path_!=<span class="literal">NULL</span>);</span><br><span class="line">    Path_-&gt;subProp(<span class="string">&quot;Topic&quot;</span>)-&gt;setValue(topic);</span><br><span class="line">    Path_-&gt;subProp(<span class="string">&quot;Color&quot;</span>)-&gt;setValue(color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>main_window.hpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file /include/qt_ros_test/main_window.hpp</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @brief Qt based gui for qt_ros_test.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @date November 2010</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> qt_ros_test_MAIN_WINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> qt_ros_test_MAIN_WINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Includes</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QtWidgets/QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ui_main_window.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;qnode.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;CCtrlDashBoard.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QImage&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QProcess&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QComboBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QSpinBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;qrviz.hpp&quot;</span></span></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Namespace</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> qt_ros_test &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Interface [MainWindow]</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Qt central, all operations relating to the view part here.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainWindow</span> :</span> <span class="keyword">public</span> QMainWindow &#123;</span><br><span class="line">Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	MainWindow(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv, QWidget *parent = <span class="number">0</span>);</span><br><span class="line">	~MainWindow();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ReadSettings</span><span class="params">()</span></span>; <span class="comment">// Load up qt program settings at startup</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">WriteSettings</span><span class="params">()</span></span>; <span class="comment">// Save qt program settings when closing</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">closeEvent</span><span class="params">(QCloseEvent *event)</span></span>; <span class="comment">// Overloaded function</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">showNoMasterMessage</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">loadStyleSheet</span><span class="params">(<span class="keyword">const</span> QString &amp;styleSheetFile)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Q_SLOTS:</span><br><span class="line">	<span class="comment">/******************************************</span></span><br><span class="line"><span class="comment">	** Auto-connections (connectSlotsByName())</span></span><br><span class="line"><span class="comment">	*******************************************/</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">on_actionAbout_triggered</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">on_button_connect_clicked</span><span class="params">(<span class="keyword">bool</span> check )</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">on_checkbox_use_environment_stateChanged</span><span class="params">(<span class="keyword">int</span> state)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/******************************************</span></span><br><span class="line"><span class="comment">    ** Manual connections</span></span><br><span class="line"><span class="comment">    *******************************************/</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateLoggingView</span><span class="params">()</span></span>; <span class="comment">// no idea why this can&#x27;t connect automatically</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_linera_change</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_raw_change</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_pushbtn_click</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_update_dashboard</span><span class="params">(<span class="keyword">float</span>,<span class="keyword">float</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_update_power</span><span class="params">(<span class="keyword">float</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_update_image</span><span class="params">(QImage)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_sub_image</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_treewidget_value_change</span><span class="params">(QString)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_grid</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_tf</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_laser</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_RobotModel</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_Map</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_Path</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_set_start_pose</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_set_goal_pose</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_local_map</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_global_map</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_update_pos</span><span class="params">(<span class="keyword">double</span>,<span class="keyword">double</span>,<span class="keyword">double</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_set_return_pos</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_return</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_quick_output</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_home_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_pei_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_message_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_topic_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_topic_content_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_pubtopic_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_node_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_plot_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_saver_map_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_choose_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_pub_map_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_amcl_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_slam_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_hector_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_cartographer_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_dijkstra_teb_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_dijkstra_DWA_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_A_teb_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_A_DWA_clicked</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btn_theme_1_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Ui::MainWindowDesign ui;</span><br><span class="line">	QNode qnode;</span><br><span class="line">    CCtrlDashBoard* speed_x_dashBoard;</span><br><span class="line">    CCtrlDashBoard* speed_y_dashBoard;</span><br><span class="line">    qrviz* myrviz;</span><br><span class="line">    QComboBox* fixed_box;</span><br><span class="line">    QCheckBox* Grid_Check;</span><br><span class="line">    QSpinBox* Cell_Count_Box;</span><br><span class="line">    QComboBox*  Grid_Color_Box;</span><br><span class="line">    QCheckBox* TF_Check;</span><br><span class="line">    QComboBox* Laser_Topic_box;</span><br><span class="line">    QCheckBox* Laser_Check;</span><br><span class="line">    QCheckBox* RobotModel_Check;</span><br><span class="line">    QComboBox* Map_Color_Scheme_box;</span><br><span class="line">    QComboBox* Map_Topic_box;</span><br><span class="line">    QCheckBox* Map_Check;</span><br><span class="line">    QComboBox* Path_Topic_box;</span><br><span class="line">    QComboBox* Path_Color_box;</span><br><span class="line">    QCheckBox* Path_Check;</span><br><span class="line">    QCheckBox* GlobalMap_Check;</span><br><span class="line">    QCheckBox* LocalMap_Check;</span><br><span class="line">    QComboBox* Global_CostMap_Topic_box;</span><br><span class="line">    QComboBox* GlobalMapColorScheme_box;</span><br><span class="line">    QComboBox* Global_Planner_Topic_box;</span><br><span class="line">    QComboBox* Global_Planner_Color_box;</span><br><span class="line">    QComboBox* Local_CostMap_Topic_box;</span><br><span class="line">    QComboBox* LocalMapColorScheme_box;</span><br><span class="line">    QComboBox* Local_Planner_Topic_box;</span><br><span class="line">    QComboBox* Local_Planner_Color_box;</span><br><span class="line">    QProcess* quick_cmd;</span><br><span class="line">    <span class="keyword">int</span> cmd_saver_map_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_slam_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_pub_map_flag = <span class="number">0</span>  ;</span><br><span class="line">    <span class="keyword">int</span> cmd_amcl_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_hector_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_cartographer_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_dijkstra_teb_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_dijkstra_DWA_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_A_teb_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_A_DWA_flag = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace qt_ros_test</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// qt_ros_test_MAIN_WINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>qnode.hpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file /include/qt_ros_test/qnode.hpp</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @brief Communications central!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @date February 2011</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Ifdefs</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> qt_ros_test_QNODE_HPP_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> qt_ros_test_QNODE_HPP_</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Includes</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// To workaround boost/qt4 problems that won&#x27;t be bugfixed. Refer to</span></span><br><span class="line"><span class="comment">//    https://bugreports.qt.io/browse/QTBUG-22829</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Q_MOC_RUN</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QThread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QStringListModel&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;geometry_msgs/Twist.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;nav_msgs/Odometry.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;std_msgs/Float32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;image_transport/image_transport.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cv_bridge/cv_bridge.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sensor_msgs/image_encodings.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;geometry_msgs/PoseWithCovarianceStamped.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;geometry_msgs/PoseStamped.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QImage&gt;</span></span></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Namespaces</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> qt_ros_test &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Class</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QNode</span> :</span> <span class="keyword">public</span> QThread &#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	QNode(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv );</span><br><span class="line">	<span class="keyword">virtual</span> ~QNode();</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">init</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;master_url, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;host_url)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_cmd_vel</span><span class="params">(<span class="keyword">char</span> k,<span class="keyword">float</span> linear, <span class="keyword">float</span> angular)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sub_image</span><span class="params">(QString topic_name)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_goal</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">double</span> y,<span class="keyword">double</span> z)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/*********************</span></span><br><span class="line"><span class="comment">	** Logging</span></span><br><span class="line"><span class="comment">	**********************/</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">LogLevel</span> &#123;</span></span><br><span class="line">	         Debug,</span><br><span class="line">	         Info,</span><br><span class="line">	         Warn,</span><br><span class="line">	         Error,</span><br><span class="line">	         Fatal</span><br><span class="line">	 &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="function">QStringListModel* <span class="title">loggingModel</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> &amp;logging_model; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">log</span><span class="params">( <span class="keyword">const</span> LogLevel &amp;level, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;msg)</span></span>;</span><br><span class="line"></span><br><span class="line">Q_SIGNALS:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">loggingUpdated</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rosShutdown</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">speed_vel</span><span class="params">(<span class="keyword">float</span>,<span class="keyword">float</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">power_vel</span><span class="params">(<span class="keyword">float</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">image_val</span><span class="params">(QImage)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">position</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">double</span> y,<span class="keyword">double</span> z)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">int</span> init_argc;</span><br><span class="line">	<span class="keyword">char</span>** init_argv;</span><br><span class="line">	ros::Publisher chatter_publisher;</span><br><span class="line">    ros::Publisher cmd_vel_pub;</span><br><span class="line">    ros::Publisher goal_pub;</span><br><span class="line">    ros::Subscriber odom_sub;</span><br><span class="line">    ros::Subscriber power_sub;</span><br><span class="line">    ros::Subscriber amcl_pose_sub;</span><br><span class="line">    image_transport::Subscriber image_sub;</span><br><span class="line">    QStringListModel logging_model;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">image_callback</span><span class="params">(<span class="keyword">const</span> sensor_msgs::ImageConstPtr &amp;msg)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">odom_raw_callback</span><span class="params">(<span class="keyword">const</span> nav_msgs::Odometry &amp;msg)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">power_callback</span><span class="params">(<span class="keyword">const</span> std_msgs::Float32 &amp;msg)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">amcl_pose_callback</span><span class="params">(<span class="keyword">const</span> geometry_msgs::PoseWithCovarianceStamped &amp;msg)</span></span>;</span><br><span class="line">    <span class="function">QImage <span class="title">Mat2QImage</span><span class="params">(cv::Mat <span class="keyword">const</span>&amp; src)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace qt_ros_test</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* qt_ros_test_QNODE_HPP_ */</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>qrviz.hpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> QRVIZ_HPP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> QRVIZ_HPP</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/visualization_manager.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/render_panel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/display.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/tool_manager.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/tool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QVBoxLayout&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">qrviz</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    qrviz(QVBoxLayout* layout);</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Set_FixedFrame</span><span class="params">(QString Frame_name)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_Grid</span><span class="params">(<span class="keyword">int</span> Cell_Count,QColor color,<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_TF</span><span class="params">(<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_LaserScan</span><span class="params">(QString laser_topic,<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_RobotModel</span><span class="params">(<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_Map</span><span class="params">(QString topic,QString color_scheme, <span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_Path</span><span class="params">(QString topic,QColor color,<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Set_Start_Pose</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Set_Goal_Pose</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_Local_Map</span><span class="params">(QString map_topic,QString map_color,QString planner_topic,QColor planner_color,<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_Global_Map</span><span class="params">(QString map_topic,QString map_color,QString planner_topic,QColor planner_color,<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    rviz::RenderPanel* render_panel_;</span><br><span class="line">    rviz::VisualizationManager* manager_;</span><br><span class="line">    rviz::ToolManager* tool_manager_;</span><br><span class="line">    rviz::Display* Grid_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* TF_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* LaserScan_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* RobotModel_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* Map_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* Path_=<span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">//navigate</span></span><br><span class="line">    rviz::Display* Global_Map_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* Global_Planner_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* Local_Map_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* Local_Planner_=<span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// QRVIZ_HPP</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
</article><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/media/qt-ros.webp" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/blog/C-%E5%9F%BA%E7%A1%80/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/C++%E5%9F%BA%E7%A1%80/C++%E5%9F%BA%E7%A1%80.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">C++基础</div></div></a></div><div class="next-post pull-right"><a href="/blog/slam%E5%AE%9E%E4%BD%93%E6%9C%BA%E5%99%A8%E4%BA%BA/"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/SLAM%E5%AE%9E%E4%BD%93%E6%9C%BA%E5%99%A8%E4%BA%BA.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">slam实体机器人</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/1.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">one by one</div><div class="author-info__description">存放个人信息</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Xiaoxigroup-official"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:你的邮箱" target="_blank" title="xiaoxigroup@gmail.com"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/blog/%E9%AD%94%E6%94%B9hexo/" title="魔改hexo"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/%E9%AD%94%E6%94%B9hexo/%E9%AD%94%E6%94%B9hexo.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="魔改hexo"/></a><div class="content"><a class="title" href="/blog/%E9%AD%94%E6%94%B9hexo/" title="魔改hexo">魔改hexo</a><time datetime="2025-01-06T13:59:06.000Z" title="发表于 2025-01-06 21:59:06">2025-01-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/C-%E5%9F%BA%E7%A1%80/" title="C++基础"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/C++%E5%9F%BA%E7%A1%80/C++%E5%9F%BA%E7%A1%80.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C++基础"/></a><div class="content"><a class="title" href="/blog/C-%E5%9F%BA%E7%A1%80/" title="C++基础">C++基础</a><time datetime="2024-03-24T09:06:04.000Z" title="发表于 2024-03-24 17:06:04">2024-03-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/qt-ros/" title="qt-ros"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/qt-ros.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="qt-ros"/></a><div class="content"><a class="title" href="/blog/qt-ros/" title="qt-ros">qt-ros</a><time datetime="2023-03-29T01:47:57.000Z" title="发表于 2023-03-29 09:47:57">2023-03-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/slam%E5%AE%9E%E4%BD%93%E6%9C%BA%E5%99%A8%E4%BA%BA/" title="slam实体机器人"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/SLAM%E5%AE%9E%E4%BD%93%E6%9C%BA%E5%99%A8%E4%BA%BA.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="slam实体机器人"/></a><div class="content"><a class="title" href="/blog/slam%E5%AE%9E%E4%BD%93%E6%9C%BA%E5%99%A8%E4%BA%BA/" title="slam实体机器人">slam实体机器人</a><time datetime="2023-03-07T03:32:46.000Z" title="发表于 2023-03-07 11:32:46">2023-03-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3/" title="slam功能包详解"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="slam功能包详解"/></a><div class="content"><a class="title" href="/blog/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3/" title="slam功能包详解">slam功能包详解</a><time datetime="2023-02-02T03:21:55.000Z" title="发表于 2023-02-02 11:21:55">2023-02-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By one by one</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      true && mermaid.init()
    })
  }
}</script></div><script defer src="/js/light.js"></script><script async data-pjax src="/js/randombg.js"></script><div class="aplayer no-destroy" data-id="7911809559" data-server="tencent" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script defer src="https://cdn.jsdelivr.net/gh/CodeByZach/pace/pace.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v6.2.0" title=""><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.3.1" title=""><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站采用多线部署，主线路托管于Vercel" title=""><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://dashboard.4everland.org/" style="margin-inline:5px" data-title="本站采用多线部署，备用线路托管于4EVERLAND" title=""><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Hosted-4EVERLAND-22DDDD?style=flat&amp;logo=IPFS" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://www.fomal.cc/static/js/runtime.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;blog/tools/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/工具.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-05-24</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;blog/tools/&quot;);" href="javascript:void(0);" alt="">工具</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;blog/tools/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;blog/videos/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/视频网址.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-05-24</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;blog/videos/&quot;);" href="javascript:void(0);" alt="">视频网址</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;blog/videos/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;blog/linux/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/工具.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-06-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;blog/linux/&quot;);" href="javascript:void(0);" alt="">linux</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;blog/linux/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;blog/UDP/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/roll02.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-07-23</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;blog/UDP/&quot;);" href="javascript:void(0);" alt="">UDP</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;blog/UDP/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;blog/STM32避障小车/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/media/STM32避障小车.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-01-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;blog/STM32避障小车/&quot;);" href="javascript:void(0);" alt="">STM32避障小车</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;blog/STM32避障小车/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__bounceInLeft');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__bounceInRight');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('pagination');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__rotateInDownLeft');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --><script src="/live2d_models/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d_models/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2d_models/assets/wanko.model.json"},"display":{"position":"left","width":100,"height":150,"hOffset":-10,"vOffset":40},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>