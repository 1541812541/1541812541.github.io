<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>AIåŸºç¡€ç¯å¢ƒæ­å»º</title>
      <link href="blog/AI%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
      <url>blog/AI%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">windows</button></li><li class="tab"><button type="button" data-href="#test4-2">linux</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><h1 id="ğŸš€-Condaç¯å¢ƒåˆ›å»ºä¸PyTorchå®‰è£…å®Œæ•´æŒ‡å—"><a href="#ğŸš€-Condaç¯å¢ƒåˆ›å»ºä¸PyTorchå®‰è£…å®Œæ•´æŒ‡å—" class="headerlink" title="ğŸš€ Condaç¯å¢ƒåˆ›å»ºä¸PyTorchå®‰è£…å®Œæ•´æŒ‡å—"></a>ğŸš€ Condaç¯å¢ƒåˆ›å»ºä¸PyTorchå®‰è£…å®Œæ•´æŒ‡å—</h1><p>æœ¬æŒ‡å—å°†å¸®åŠ©ä½ ä»é›¶å¼€å§‹åˆ›å»ºä¸€ä¸ªåä¸º <code>DL</code> çš„æ·±åº¦å­¦ä¹ ç¯å¢ƒï¼Œå¹¶å®ŒæˆPyTorchçš„å®‰è£…é…ç½®ã€‚</p><hr><h2 id="ğŸ“¦-ä¸€ã€å®‰è£…Anaconda"><a href="#ğŸ“¦-ä¸€ã€å®‰è£…Anaconda" class="headerlink" title="ğŸ“¦ ä¸€ã€å®‰è£…Anaconda"></a>ğŸ“¦ ä¸€ã€å®‰è£…Anaconda</h2><h3 id="1-1-ä¸‹è½½Anaconda"><a href="#1-1-ä¸‹è½½Anaconda" class="headerlink" title="1.1 ä¸‹è½½Anaconda"></a>1.1 ä¸‹è½½Anaconda</h3><p>è®¿é—®ä»¥ä¸‹é“¾æ¥ä¸‹è½½Anacondaå®‰è£…åŒ…ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;repo.anaconda.com&#x2F;archive&#x2F;Anaconda3-2024.06-1-Windows-x86_64.exe</span><br></pre></td></tr></table></figure></p><h3 id="1-2-è¿è¡Œå®‰è£…ç¨‹åº"><a href="#1-2-è¿è¡Œå®‰è£…ç¨‹åº" class="headerlink" title="1.2 è¿è¡Œå®‰è£…ç¨‹åº"></a>1.2 è¿è¡Œå®‰è£…ç¨‹åº</h3><p>åŒå‡»ä¸‹è½½çš„ <code>.exe</code> æ–‡ä»¶ï¼ŒæŒ‰ç…§å‘å¯¼å®Œæˆå®‰è£…ã€‚</p><hr><h2 id="ğŸ”§-äºŒã€åˆ›å»ºCondaç¯å¢ƒ"><a href="#ğŸ”§-äºŒã€åˆ›å»ºCondaç¯å¢ƒ" class="headerlink" title="ğŸ”§ äºŒã€åˆ›å»ºCondaç¯å¢ƒ"></a>ğŸ”§ äºŒã€åˆ›å»ºCondaç¯å¢ƒ</h2><h3 id="2-1-æ‰“å¼€Anaconda-Prompt"><a href="#2-1-æ‰“å¼€Anaconda-Prompt" class="headerlink" title="2.1 æ‰“å¼€Anaconda Prompt"></a>2.1 æ‰“å¼€Anaconda Prompt</h3><p><strong>æ–¹å¼ä¸€</strong>ï¼šåœ¨Windowsæœç´¢æ ä¸­è¾“å…¥ <code>Anaconda Prompt</code>ï¼Œç‚¹å‡»æ‰“å¼€</p><p><strong>æ–¹å¼äºŒ</strong>ï¼š</p><ol><li>æŒ‰ <code>Win + R</code> æ‰“å¼€è¿è¡Œçª—å£</li><li>è¾“å…¥ <code>cmd</code> å¹¶æŒ‰å›è½¦</li><li>è¾“å…¥ <code>activate</code> å¹¶æŒ‰å›è½¦</li></ol><h3 id="2-2-åˆ›å»ºPython-3-9ç¯å¢ƒ"><a href="#2-2-åˆ›å»ºPython-3-9ç¯å¢ƒ" class="headerlink" title="2.2 åˆ›å»ºPython 3.9ç¯å¢ƒ"></a>2.2 åˆ›å»ºPython 3.9ç¯å¢ƒ</h3><p>åœ¨Anaconda Promptä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n DL python=3.9 -y</span><br></pre></td></tr></table></figure><blockquote><p>ğŸ’¡ <strong>è¯´æ˜</strong>ï¼š<code>-n DL</code> æŒ‡å®šç¯å¢ƒåç§°ï¼Œ<code>python=3.9</code> æŒ‡å®šPythonç‰ˆæœ¬ï¼Œ<code>-y</code> è‡ªåŠ¨ç¡®è®¤å®‰è£…</p></blockquote><h3 id="2-3-æ¿€æ´»ç¯å¢ƒ"><a href="#2-3-æ¿€æ´»ç¯å¢ƒ" class="headerlink" title="2.3 æ¿€æ´»ç¯å¢ƒ"></a>2.3 æ¿€æ´»ç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate DL</span><br></pre></td></tr></table></figure><blockquote><p>âš ï¸ <strong>é‡åˆ°é—®é¢˜ï¼Ÿ</strong> å¦‚æœæ¿€æ´»å¤±è´¥ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>è¾“å…¥ <code>conda init</code> å¹¶æŒ‰å›è½¦</li><li>å…³é—­å½“å‰çª—å£</li><li>é‡æ–°æ‰“å¼€Anaconda Prompt</li><li>å†æ¬¡æ‰§è¡Œ <code>conda activate DL</code></li></ol></blockquote><hr><h2 id="ğŸ”¥-ä¸‰ã€å®‰è£…PyTorch"><a href="#ğŸ”¥-ä¸‰ã€å®‰è£…PyTorch" class="headerlink" title="ğŸ”¥ ä¸‰ã€å®‰è£…PyTorch"></a>ğŸ”¥ ä¸‰ã€å®‰è£…PyTorch</h2><h3 id="3-1-æ£€æŸ¥CUDAç‰ˆæœ¬"><a href="#3-1-æ£€æŸ¥CUDAç‰ˆæœ¬" class="headerlink" title="3.1 æ£€æŸ¥CUDAç‰ˆæœ¬"></a>3.1 æ£€æŸ¥CUDAç‰ˆæœ¬</h3><ol><li>æŒ‰ <code>Win + R</code> æ‰“å¼€è¿è¡Œçª—å£</li><li>è¾“å…¥ <code>cmd</code> å¹¶æŒ‰å›è½¦</li><li>è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvidia-smi</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¾“å‡ºä¸­çš„ <code>CUDA Version</code> ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼š<code>12.8</code>ï¼‰</p><blockquote><p>ğŸ“Œ <strong>æ³¨æ„</strong>ï¼šå¦‚æœæ²¡æœ‰NVIDIAæ˜¾å¡æˆ–æœªå®‰è£…CUDAï¼Œåªèƒ½ä½¿ç”¨CPUç‰ˆæœ¬çš„PyTorch</p></blockquote><h3 id="3-2-è·å–å®‰è£…å‘½ä»¤"><a href="#3-2-è·å–å®‰è£…å‘½ä»¤" class="headerlink" title="3.2 è·å–å®‰è£…å‘½ä»¤"></a>3.2 è·å–å®‰è£…å‘½ä»¤</h3><p>è®¿é—®PyTorchå®˜ç½‘ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;pytorch.org&#x2F;get-started&#x2F;locally</span><br></pre></td></tr></table></figure></p><p>æ ¹æ®ä½ çš„é…ç½®é€‰æ‹©ï¼š</p><ul><li><strong>PyTorch Build</strong>: Stable</li><li><strong>Your OS</strong>: Windows</li><li><strong>Package</strong>: Pip</li><li><strong>Language</strong>: Python</li><li><strong>Compute Platform</strong>: æ ¹æ®ä½ çš„CUDAç‰ˆæœ¬é€‰æ‹©ï¼ˆå¦‚ CUDA 12.8ï¼‰</li></ul><p><strong>ç¤ºä¾‹å‘½ä»¤</strong>ï¼š</p><ul><li><p><strong>CUDAç‰ˆæœ¬</strong>ï¼ˆå¦‚CUDA 12.8ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install torch torchvision --index-url https://download.pytorch.org/whl/cu128</span><br></pre></td></tr></table></figure></li><li><p><strong>CPUç‰ˆæœ¬</strong>ï¼ˆæ— æ˜¾å¡ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install torch torchvision</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-3-æ‰§è¡Œå®‰è£…"><a href="#3-3-æ‰§è¡Œå®‰è£…" class="headerlink" title="3.3 æ‰§è¡Œå®‰è£…"></a>3.3 æ‰§è¡Œå®‰è£…</h3><p>åœ¨<strong>å·²æ¿€æ´»DLç¯å¢ƒ</strong>çš„Anaconda Promptä¸­ï¼Œç²˜è´´ä¸Šè¿°å‘½ä»¤å¹¶æŒ‰å›è½¦ã€‚</p><hr><h2 id="âœ…-å››ã€éªŒè¯å®‰è£…"><a href="#âœ…-å››ã€éªŒè¯å®‰è£…" class="headerlink" title="âœ… å››ã€éªŒè¯å®‰è£…"></a>âœ… å››ã€éªŒè¯å®‰è£…</h2><h3 id="4-1-åˆ›å»ºæµ‹è¯•è„šæœ¬"><a href="#4-1-åˆ›å»ºæµ‹è¯•è„šæœ¬" class="headerlink" title="4.1 åˆ›å»ºæµ‹è¯•è„šæœ¬"></a>4.1 åˆ›å»ºæµ‹è¯•è„šæœ¬</h3><p>åœ¨Dç›˜çš„testæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºæ–‡ä»¶ <code>verify_installation.py</code>ï¼Œç²˜è´´å†…å®¹å¦‚ä¸‹ï¼š</p><ul><li>åˆ›å»ºçš„æ—¶å€™å¯ä»¥å…ˆå³é”®åˆ›å»ºæ–‡ä»¶åæ–°å»ºæ–‡æœ¬æ–‡æ¡£ï¼Œç„¶åå‘½åä¸ºverify_installation.pyï¼Œå‰ææ˜¯ç¡®ä¿æ–‡ä»¶æ‰©å±•åæ˜¾ç¤ºã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">print(<span class="string">f&quot;PyTorchç‰ˆæœ¬: <span class="subst">&#123;torch.__version__&#125;</span>&quot;</span>)</span><br><span class="line">print(<span class="string">f&quot;CUDAæ˜¯å¦å¯ç”¨: <span class="subst">&#123;torch.cuda.is_available()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">    print(<span class="string">f&quot;CUDAç‰ˆæœ¬: <span class="subst">&#123;torch.version.cuda&#125;</span>&quot;</span>)</span><br><span class="line">    print(<span class="string">f&quot;GPUè®¾å¤‡åç§°: <span class="subst">&#123;torch.cuda.get_device_name(<span class="number">0</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    print(<span class="string">f&quot;å½“å‰GPUè®¾å¤‡ç´¢å¼•: <span class="subst">&#123;torch.cuda.current_device()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&quot;å½“å‰ä½¿ç”¨CPUæ¨¡å¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•å¼ é‡è¿ç®—</span></span><br><span class="line">x = torch.randn(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">y = torch.randn(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">z = x + y</span><br><span class="line">print(<span class="string">f&quot;âœ“ å¼ é‡è¿ç®—æµ‹è¯•æˆåŠŸï¼Œç»“æœå½¢çŠ¶: <span class="subst">&#123;z.shape&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>ğŸ’¡ <strong>æç¤º</strong>ï¼šç¡®ä¿æ–‡ä»¶æ‰©å±•åæ˜¾ç¤º</p><ol><li>æ‰“å¼€â€æ­¤ç”µè„‘â€</li><li>ç‚¹å‡»é¡¶éƒ¨èœå•æ çš„â€æŸ¥çœ‹â€</li><li>å‹¾é€‰â€æ–‡ä»¶æ‰©å±•åâ€</li></ol></blockquote><h3 id="4-2-è¿è¡Œæµ‹è¯•"><a href="#4-2-è¿è¡Œæµ‹è¯•" class="headerlink" title="4.2 è¿è¡Œæµ‹è¯•"></a>4.2 è¿è¡Œæµ‹è¯•</h3><p>åœ¨æ¿€æ´»çš„DLç¯å¢ƒä¸­ï¼Œåˆ‡æ¢åˆ°Dç›˜testæ–‡ä»¶å¤¹ä¸‹å¹¶è¿è¡Œè„šæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> D:\<span class="built_in">test</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python verify_installation.py</span><br></pre></td></tr></table></figure><p><strong>é¢„æœŸè¾“å‡º</strong>ï¼š</p><ul><li>PyTorchç‰ˆæœ¬ä¿¡æ¯</li><li>CUDAå¯ç”¨æ€§çŠ¶æ€</li><li>GPUä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰</li><li>å¼ é‡è¿ç®—æµ‹è¯•æˆåŠŸ</li></ul><hr><h2 id="ğŸ‰-å®Œæˆï¼"><a href="#ğŸ‰-å®Œæˆï¼" class="headerlink" title="ğŸ‰ å®Œæˆï¼"></a>ğŸ‰ å®Œæˆï¼</h2><p>æ­å–œï¼ä½ å·²ç»æˆåŠŸåˆ›å»ºäº†åä¸º <code>DL</code> çš„æ·±åº¦å­¦ä¹ ç¯å¢ƒå¹¶å®‰è£…äº†PyTorchï¼</p><hr><h2 id="ğŸ“š-å¸¸ç”¨å‘½ä»¤å‚è€ƒ"><a href="#ğŸ“š-å¸¸ç”¨å‘½ä»¤å‚è€ƒ" class="headerlink" title="ğŸ“š å¸¸ç”¨å‘½ä»¤å‚è€ƒ"></a>ğŸ“š å¸¸ç”¨å‘½ä»¤å‚è€ƒ</h2><h3 id="ç¯å¢ƒç®¡ç†"><a href="#ç¯å¢ƒç®¡ç†" class="headerlink" title="ç¯å¢ƒç®¡ç†"></a>ç¯å¢ƒç®¡ç†</h3><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td><strong>æ¿€æ´»ç¯å¢ƒ</strong></td><td><code>conda activate DL</code></td></tr><tr><td><strong>é€€å‡ºç¯å¢ƒ</strong></td><td><code>conda deactivate</code></td></tr><tr><td><strong>æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒ</strong></td><td><code>conda env list</code></td></tr><tr><td><strong>åˆ é™¤ç¯å¢ƒ</strong></td><td><code>conda env remove -n DL</code></td></tr><tr><td><strong>æŸ¥çœ‹å·²å®‰è£…åŒ…</strong></td><td><code>conda list</code></td></tr></tbody></table></div><h3 id="åˆ›å»ºå…¶ä»–ç¯å¢ƒ"><a href="#åˆ›å»ºå…¶ä»–ç¯å¢ƒ" class="headerlink" title="åˆ›å»ºå…¶ä»–ç¯å¢ƒ"></a>åˆ›å»ºå…¶ä»–ç¯å¢ƒ</h3><p>å¦‚æœéœ€è¦åˆ›å»ºæ–°ç¯å¢ƒï¼ˆä¾‹å¦‚ <code>DLone</code>ï¼‰ï¼Œåªéœ€å°†ä¸Šè¿°æ‰€æœ‰å‘½ä»¤ä¸­çš„ <code>DL</code> æ›¿æ¢ä¸º <code>DLone</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda create -n DLone python=3.9 -y</span><br><span class="line">conda activate DLone</span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ†˜-å¸¸è§é—®é¢˜"><a href="#ğŸ†˜-å¸¸è§é—®é¢˜" class="headerlink" title="ğŸ†˜ å¸¸è§é—®é¢˜"></a>ğŸ†˜ å¸¸è§é—®é¢˜</h2><p><strong>Q: ä¸ºä»€ä¹ˆ <code>conda activate</code> ä¸å·¥ä½œï¼Ÿ</strong><br>A: æ‰§è¡Œ <code>conda init</code>ï¼Œç„¶åé‡å¯ç»ˆç«¯</p><p><strong>Q: å®‰è£…PyTorchæ—¶é€Ÿåº¦å¾ˆæ…¢ï¼Ÿ</strong><br>A: å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒæºï¼Œæˆ–ç­‰å¾…ä¸‹è½½å®Œæˆ</p><p><strong>Q: å¦‚ä½•ç¡®è®¤GPUæ˜¯å¦è¢«PyTorchè¯†åˆ«ï¼Ÿ</strong><br>A: è¿è¡ŒéªŒè¯è„šæœ¬ï¼ŒæŸ¥çœ‹ <code>CUDAæ˜¯å¦å¯ç”¨</code> æ˜¯å¦ä¸º <code>True</code></p><hr><blockquote><p>ğŸ“ <strong>æç¤º</strong>ï¼šå»ºè®®ä¸ºä¸åŒé¡¹ç›®åˆ›å»ºç‹¬ç«‹çš„condaç¯å¢ƒï¼Œé¿å…åŒ…ç‰ˆæœ¬å†²çªï¼</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é­”æ”¹hexo</title>
      <link href="blog/%E9%AD%94%E6%94%B9hexo/"/>
      <url>blog/%E9%AD%94%E6%94%B9hexo/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åŠ è½½moc3æ–‡ä»¶<br><a href="https://oml2d.com/guide/hexo.html">https://oml2d.com/guide/hexo.html</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>C++åŸºç¡€</title>
      <link href="blog/C-%E5%9F%BA%E7%A1%80/"/>
      <url>blog/C-%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">åŸºæœ¬è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#test4-2">è¿›é˜¶ä½¿ç”¨</button></li><li class="tab"><button type="button" data-href="#test4-3">å¸¸ç”¨å‡½æ•°</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><details class="folding-tag" green><summary> å¾ªç¯ </summary>              <div class='content'>              <ol><li>for<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">printf</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>while<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i&lt;<span class="number">5</span>) </span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">printf</span>();</span><br><span class="line">   i++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> æ§åˆ¶æµ </summary>              <div class='content'>              <ol><li>continue æ‰§è¡Œåè¿›å…¥è¿™ä¸ªå¾ªç¯çš„ä¸‹ä¸€æ¬¡è¿­ä»£<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>;i++)</span><br><span class="line">&#123;  <span class="keyword">if</span> (i&lt;<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">cin</span>.get();</span><br></pre></td></tr></table></figure></li><li>break æ‰§è¡Œåè·³å‡ºå¾ªç¯å³ç»ˆæ­¢å¾ªç¯<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>;i++)</span><br><span class="line">&#123;  <span class="keyword">if</span> (i&lt;<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">cin</span>.get();</span><br></pre></td></tr></table></figure></li><li>return è¿”å›å€¼</li></ol>              </div>            </details><details class="folding-tag" green><summary> æŒ‡é’ˆ </summary>              <div class='content'>              <ol><li>æŒ‡é’ˆæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä¸€ä¸ªä¿å­˜å†…å­˜åœ°å€çš„æ•°å­—,é€†å‘å¼•ç”¨å¯ä»¥æ”¹å˜åœ°å€å‚¨å­˜çš„æ•°æ®<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* ptr = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">int</span> var = <span class="number">8</span>;</span><br><span class="line">  ptr = &amp;var; <span class="comment">//ptré—®varï¼Œä¼™è®¡ä½ çš„åœ°å€è®©æˆ‘çœ‹çœ‹</span></span><br><span class="line">  *ptr = <span class="number">10</span>;  <span class="comment">//å¯¹ptrå‚¨å­˜çš„åœ°å€å†™å…¥æ•°æ®10</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; var &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  <span class="comment">//æ­¤æ—¶varå€¼ä¸º10</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cin</span>.get();</span><br></pre></td></tr></table></figure></li><li>å¼€è¾Ÿä¸€å—å†…å­˜ï¼Œå¹¶è¿”å›æŒ‡å‘é‚£å—å†…å­˜å¼€å§‹çš„æŒ‡é’ˆ<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">char</span>* buffer = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">8</span>] </span><br><span class="line"><span class="built_in">memset</span>(buffer,<span class="number">0</span>,<span class="number">8</span>); <span class="comment">//ç”¨æŒ‡å®šçš„æ•°æ®å¡«å……ä¸€ä¸ªå†…å­˜å—</span></span><br><span class="line"><span class="comment">//å‚æ•°ï¼š å†…å­˜å—å¼€å§‹çš„æŒ‡é’ˆï¼Œ å¡«å……æ•°æ®ï¼Œå†…å­˜å¤§å°</span></span><br><span class="line"><span class="keyword">delete</span>[] buffer;</span><br></pre></td></tr></table></figure></li><li>åŒæŒ‡é’ˆ<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>* buffer = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">8</span>] </span><br><span class="line"><span class="built_in">memset</span>(buffer,<span class="number">0</span>,<span class="number">8</span>); <span class="comment">//ç”¨æŒ‡å®šçš„æ•°æ®å¡«å……ä¸€ä¸ªå†…å­˜å—</span></span><br><span class="line"><span class="comment">//å‚æ•°ï¼š å†…å­˜å—å¼€å§‹çš„æŒ‡é’ˆï¼Œ å¡«å……æ•°æ®ï¼Œå†…å­˜å¤§å°</span></span><br><span class="line"><span class="keyword">char</span>** ptr = &amp;buffer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span>[] buffer;</span><br><span class="line">buffer=<span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">delete</span> ptr;</span><br><span class="line">ptr=<span class="literal">NULL</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>æŒ‡é’ˆä¼ å‚æ”¹å˜å‡½æ•°é‡Œçš„å€¼<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Increment</span><span class="params">(<span class="keyword">int</span>* value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   (*value)++; <span class="comment">//å…ˆé€†æŒ‡é’ˆæ“ä½œè¯¥åœ°å€çš„å€¼ï¼Œè‡ªåŠ ä¸€</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a=<span class="number">5</span>;</span><br><span class="line">    Increment(&amp;a);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;<span class="comment">//açš„å€¼ä¸º6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> å¼•ç”¨ </summary>              <div class='content'>              <ol><li>å¼•ç”¨å¿…é¡»å¼•ç”¨å·²ç»å­˜åœ¨çš„å˜é‡ï¼Œå¹¶ä¸å ç”¨å†…å­˜<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a=<span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span>&amp; ref = a;<span class="comment">//ç»™aåˆ›å»ºåˆ«åä¸ºref </span></span><br><span class="line">ref = <span class="number">2</span>;<span class="comment">//é€šè¿‡refæ”¹å˜açš„å€¼</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;<span class="comment">//açš„å€¼ä¸º2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>å¼•ç”¨ä¼ å‚æ•°<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Increment</span><span class="params">(<span class="keyword">int</span>&amp; value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   value++; <span class="comment">//å…ˆé€†æŒ‡é’ˆæ“ä½œè¯¥åœ°å€çš„å€¼ï¼Œè‡ªåŠ ä¸€</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a=<span class="number">5</span>;</span><br><span class="line">    Increment(a);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;<span class="comment">//açš„å€¼ä¸º6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> c++ç±» </summary>              <div class='content'>              <ol><li>ç±»æ˜¯å°†å˜é‡åˆ†ç»„åˆ°ä¸€ä¸ªç±»å‹ä¸­ï¼Œå¹¶ä¸ºè¿™äº›å˜é‡æ·»åŠ åŠŸèƒ½</li><li>ç±»ä¸­çš„ç§æœ‰å˜é‡åªæœ‰ç±»ä¸­çš„å‡½æ•°æ‰èƒ½è®¿é—®</li><li>ç±»å†…çš„å‡½æ•°ç§°ä¸ºæ–¹æ³•â€”æ”¹å˜å¯¹è±¡çš„å€¼çš„å‡½æ•°</li><li>ç±»ä¸ç»“æ„ä½“çš„åŒºåˆ«æ˜¯ç»“æ„ä½“ç›¸å½“äºéƒ½æ˜¯å…¬æœ‰å˜é‡å’Œå‡½æ•°<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    <span class="keyword">int</span> speed;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Move</span><span class="params">(<span class="keyword">int</span> xa,<span class="keyword">int</span> ya)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">    player.x += xa*player.speed;</span><br><span class="line">    player.y += ya*player.speed;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line">  Player player;<span class="comment">//å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">  player.x = <span class="number">5</span>;</span><br><span class="line">  player.Move(<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> é™æ€static </summary>              <div class='content'>              <ol><li>staticä»£è¡¨ä»…åœ¨è¯¥ç¿»è¯‘å•å…ƒâ€”cppæ–‡ä»¶ä¸­ä½¿ç”¨,åˆ«çš„cppæ— æ³•å¯»æ‰¾åˆ°<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> speed=<span class="number">5</span>;</span><br></pre></td></tr></table></figure></li><li>è‹¥è¦ä½¿ç”¨åˆ«çš„cppä¸­çš„å˜é‡æˆ–è€…å‡½æ•°ï¼Œéœ€è¦æœ¬æ–‡ä»¶åŠ ä¸Šextern//staticå˜é‡ä»ç„¶æ— æ³•è¢«æ‰¾åˆ°<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> speed</span><br></pre></td></tr></table></figure></li><li>æ²¡æœ‰åŠ staticçš„å…¨å±€å˜é‡ï¼Œç¼–è¯‘å™¨ä¼šè·¨ç¿»è¯‘å•å…ƒå¯»æ‰¾ï¼Œå³1.cppä¸­å¯ä»¥ä½¿ç”¨2.cppå®šä¹‰çš„å˜é‡ï¼Œå¦‚æœ1.cppå®šä¹‰äº†ç›¸åŒå˜é‡åˆ™ä¼šå‡ºé”™</li><li>ç±»å’Œç»“æ„ä½“ä¸­çš„é™æ€staticâ€”æ•°æ®ä¸ä¼šå†ç±»å®ä¾‹ä¹‹é—´å˜åŒ–ï¼ˆä¸€å—å†…å­˜)å¯ä»¥ç”¨æ¥å…±äº«æ•°æ®ï¼›é™æ€æ–¹æ³•ä¸èƒ½è®¿é—®éé™æ€å˜é‡<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> x,y;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">         <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; y &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> Entity::x;<span class="comment">//å¿…é¡»å®šä¹‰é™æ€å˜é‡</span></span><br><span class="line"><span class="keyword">int</span> Entity::y;</span><br><span class="line">   Entity e;</span><br><span class="line">   e.x =<span class="number">2</span>;</span><br><span class="line">   e.y =<span class="number">3</span>;</span><br><span class="line">   Entity e1;</span><br><span class="line">   e1.x =<span class="number">5</span>;</span><br><span class="line">   e2.y =<span class="number">8</span>;</span><br><span class="line">   e.Print();</span><br><span class="line">   e1.Print();</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">cin</span>.get();</span><br><span class="line">   <span class="comment">//è¾“å‡ºä¸º</span></span><br><span class="line">   <span class="comment">//5ï¼Œ8</span></span><br><span class="line">   <span class="comment">//5ï¼Œ8</span></span><br><span class="line">          </span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> æšä¸¾ </summary>              <div class='content'>              <ol><li>æšä¸¾å®ä¾‹åŒ–ååªèƒ½æ˜¯å…¶ä¸­çš„ä¸€ä¸ªæ•°,æšä¸¾ä¸­çš„å†…å®¹åˆ†åˆ«å­˜æ”¾çš„æ•°æ®ä¸º0ï¼Œ1ï¼Œ2â€¦..//é»˜è®¤ï¼Œä¹Ÿå¯ä»¥è‡ªå·±èµ‹å€¼ä½†æ˜¯åªèƒ½æ•´æ•°<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Example</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    A,B,C</span><br><span class="line">&#125;;</span><br><span class="line">Example value =B;</span><br><span class="line"><span class="keyword">if</span>(value ==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;<span class="comment">//valueçš„å€¼ä¸º1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> æ„é€ å‡½æ•° </summary>              <div class='content'>              <ol><li>æ„é€ å‡½æ•°ç›®çš„æ˜¯åœ¨å®ä¾‹åŒ–å¯¹è±¡æ—¶ä½œçš„åˆå§‹åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬å˜é‡çš„åˆå§‹åŒ–<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">    <span class="keyword">float</span>  X,Y;</span><br><span class="line">    Entity()</span><br><span class="line">    &#123;</span><br><span class="line">        X=<span class="number">0.0f</span>;</span><br><span class="line">        Y=<span class="number">0.0f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">    Entity e;</span><br><span class="line">     <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; e.X &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; e.Y &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">     <span class="comment">//è¾“å‡ºä¸º0ï¼Œ0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> ææ„å‡½æ•° </summary>              <div class='content'>              <ol><li>ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡åœ¨é”€æ¯æ—¶ï¼Œææ„å‡½æ•°ä¼šè‡ªåŠ¨è°ƒç”¨<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">    <span class="keyword">float</span>  X,Y;</span><br><span class="line">    Entity()</span><br><span class="line">    &#123;</span><br><span class="line">        X=<span class="number">0.0f</span>;</span><br><span class="line">        Y=<span class="number">0.0f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Entity()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;å¯¹è±¡å·²ç»æ¶ˆé™¤&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">    Entity e;</span><br><span class="line">     <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; e.X &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; e.Y &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">     <span class="comment">//è¾“å‡ºä¸º0ï¼Œ0 </span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> ç»§æ‰¿ </summary>              <div class='content'>              <ol><li>å­ç±»å°†å…·æœ‰çˆ¶ç±»æ‰€æœ‰å˜é‡å’Œå‡½æ•°ï¼ŒåŒæ—¶å¢åŠ äº†æ–°çš„å˜é‡æˆ–å‡½æ•°<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">    <span class="keyword">float</span>  X,Y;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Move</span><span class="params">(<span class="keyword">float</span> xa,<span class="keyword">float</span> ya)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        X +=xa;</span><br><span class="line">        Y +=ya;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> :</span> <span class="keyword">public</span> Entity</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span>* Name;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">PrintName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; Name &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> Player player;</span><br><span class="line"> player.Move(<span class="number">5</span>,<span class="number">5</span>);</span><br><span class="line"> player.X=<span class="number">2</span>;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> è™šå‡½æ•° </summary>              <div class='content'>              <ol><li>è™šå‡½æ•°ç›®çš„æ˜¯æŒ‡ä¸ºå­ç±»é‡å†™æ¥è‡ªç»§æ‰¿çˆ¶ç±»çš„å‡½æ•°ï¼Œè®©å®ƒåšå…¶ä»–äº‹ï¼Œçˆ¶ç±»çš„å‡½æ•°è¦åŠ ä¸Švirtual<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">   <span class="function"><span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">GetName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Entity&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> :</span> <span class="keyword">public</span> Entity</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:    </span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> m_Name;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  Player(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; name)</span><br><span class="line">      : m_Name(name)&#123;&#125;<span class="comment">//:çš„ä½œç”¨æ˜¯åˆå§‹åŒ–å˜é‡m_Nameçš„å€¼ä¸ºnameä¼ å…¥çš„å€¼</span></span><br><span class="line"> <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">GetName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> m_Name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> Entity* e = <span class="keyword">new</span> Entity();</span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; e-&gt;GetName() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"> Player*p =<span class="keyword">new</span> player(<span class="string">&quot;Cherno&quot;</span>);</span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; p-&gt;GetName() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">//è¾“å‡ºä¸º  Entity Cherno</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> çº¯è™šå‡½æ•° </summary>              <div class='content'>              <ol><li>çº¯è™šå‡½æ•°å…è®¸åœ¨åŸºç±»ä¸­å®šä¹‰ä¸€ä¸ªæ²¡æœ‰å®ç°çš„å‡½æ•°ï¼Œå¼ºåˆ¶å­ç±»å»å®ç°è¯¥å‡½æ•°(æ¥å£)<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">   <span class="function"><span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">GetName</span><span class="params">()</span></span>=<span class="number">0</span>ï¼›<span class="comment">//æ­¤æ—¶ä¸ºçº¯è™šå‡½æ•°</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> å¯è§æ€§ </summary>              <div class='content'>              <ol><li>private åªæœ‰è¯¥ç±»ä»¥åŠå‹å…ƒå¯è§ï¼Œå­ç±»ä¸å¯è§</li><li>protect åªæœ‰è¯¥ç±»ï¼Œå‹å…ƒï¼Œå­ç±»å¯è§</li><li>public å‡å¯è§</li></ol>              </div>            </details><details class="folding-tag" green><summary> æ•°ç»„ </summary>              <div class='content'>              <ol><li>æ•°ç»„åå°±æ˜¯æŒ‡é’ˆç±»å‹<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> example[<span class="number">5</span>];</span><br><span class="line">example[<span class="number">0</span>]=<span class="number">2</span>;</span><br><span class="line">example[<span class="number">4</span>]=<span class="number">4</span>;</span><br><span class="line"><span class="comment">//æ‰“å°æŸä¸ªç´¢å¼•å¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; example[<span class="number">0</span>] &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">//æ‰“å°æ•´ä¸ªæ•°ç»„çš„å€¼åªéœ€è¦æ‰“å°è¿™ä¸ªæ•°ç»„çš„åœ°å€--æ•°ç»„åå°±æ˜¯æŒ‡é’ˆç±»å‹</span></span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; example &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>;i++)</span><br><span class="line">   example[i]=<span class="number">2</span>;</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">cin</span>.get();</span><br></pre></td></tr></table></figure></li><li>æŒ‡é’ˆæ§åˆ¶æ•°ç»„<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> example[<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span>* ptr = example;</span><br><span class="line">example[<span class="number">2</span>]=<span class="number">4</span>;<span class="comment">//æ”¹å˜example[4]çš„å€¼ä¸º4 </span></span><br><span class="line">*(ptr + <span class="number">2</span>)=<span class="number">6</span>;<span class="comment">//æ”¹å˜example[4]çš„å€¼ä¸º6</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>newåˆ›å»ºæ•°ç»„â€”ç›´æ¥åˆ›å»ºçš„æ˜¯åœ¨æ ˆä¸Šï¼Œç”Ÿå­˜åœ¨å‡½æ•°é‡Œï¼Œnewæ˜¯åœ¨å †ä¸Šï¼Œé”€æ¯å‰ä¸€ç›´å­˜åœ¨<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">int</span> example[<span class="number">5</span>];<span class="comment">//åˆ›å»ºæ•°ç»„åä¸ºexampleçš„æ•°ç»„</span></span><br><span class="line"> <span class="keyword">int</span>* another=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">5</span>];<span class="comment">//åˆ›å»ºæ•°ç»„åä¸ºanotherçš„æ•°ç»„</span></span><br><span class="line"><span class="keyword">delete</span>[] another;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> å­—ç¬¦ä¸² </summary>              <div class='content'>              <ol><li>å­—ç¬¦ä¸²æ•°ç»„æœ€åä¸€ä½é»˜è®¤ä¸º0ï¼Œé‡åˆ°0æ‰çŸ¥é“æ•°ç»„æ•°æ®åˆ°å“ªåœæ­¢</li><li>å­—ç¬¦ä¸²æ•°ç»„å•ä¸ªæ”¾å€¼æ—¶ï¼Œè‡ªå·±åŠ ä¸Šéšè—ä½0<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>* name =<span class="string">&quot;Cherno&quot;</span>;<span class="comment">//å­—ç¬¦ä¸²æ•°ç»„</span></span><br><span class="line">name[<span class="number">2</span>] =<span class="string">&#x27;a&#x27;</span>;<span class="comment">//nameæ•°ç»„æ­¤æ—¶ä¸ºCharno</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; name &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;<span class="comment">//nameæ•°ç»„æ­¤æ—¶ä¸ºCharno</span></span><br><span class="line"><span class="keyword">char</span>* name2[<span class="number">7</span>] =&#123;<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;o&#x27;</span>,<span class="number">0</span>&#125;;<span class="comment">//å­—ç¬¦ä¸²æ•°ç»„</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; name2 &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;<span class="comment">//name2æ•°ç»„æ­¤æ—¶ä¸ºCharno</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨std::string ,é»˜è®¤æ˜¯const char*ç±»å‹<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> name =<span class="string">&quot;Cherno&quot;</span>;<span class="comment">//å­—ç¬¦ä¸²æ•°ç»„</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; name &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;<span class="comment">//nameæ•°ç»„æ­¤æ—¶ä¸ºCharno</span></span><br></pre></td></tr></table></figure></li><li>å­—ç¬¦ä¸²æ“ä½œ<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> name =<span class="string">&quot;Cherno&quot;</span>;<span class="comment">//å­—ç¬¦ä¸²æ•°ç»„</span></span><br><span class="line">  <span class="comment">//å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line">  <span class="built_in">strlen</span>(name)ï¼›</span><br><span class="line">  <span class="comment">//å¤åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="built_in">strcpy</span>(name);</span><br><span class="line">  <span class="comment">//è¿½åŠ å­—ç¬¦ä¸²</span></span><br><span class="line">  name =<span class="built_in">std</span>::<span class="built_in">string</span>(<span class="string">&quot;Cherno&quot;</span>)+<span class="string">&quot;hello&quot;</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; name &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;<span class="comment">//nameæ•°ç»„æ­¤æ—¶ä¸ºCharnohello</span></span><br><span class="line">  <span class="comment">//æŸ¥æ‰¾å­—ç¬¦ä¸²--è¿”å›çš„æ˜¯æŸ¥æ‰¾å­—ç¬¦ä¸²çš„é¦–ä½ç½®</span></span><br><span class="line">  name.find(<span class="string">&quot;no&quot;</span>)<span class="comment">//åœ¨nameæ•°ç»„å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾no</span></span><br><span class="line">  <span class="comment">//æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨æŸå­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="keyword">bool</span> contains=name.find(<span class="string">&quot;no&quot;</span>)!=<span class="built_in">std</span>::<span class="built_in">string</span>::npos;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> const--å¸¸é‡ </summary>              <div class='content'>              <ol><li>ä¸å¯ä¿®æ”¹ï¼Œåªè¯»<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> a=<span class="number">5</span>;</span><br><span class="line">a=<span class="number">2</span>;<span class="comment">//æç¤ºé”™è¯¯ï¼Œä¸å¯æ›´æ”¹</span></span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; <span class="title">GetName</span><span class="params">()</span> <span class="keyword">const</span><span class="comment">//è¯¥å‡½æ•°ä¸å…è®¸ä¿®æ”¹å€¼</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> m_Name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªä¸å…è®¸ä¿®æ”¹çš„å¸¸é‡</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨ </summary>              <div class='content'>              <ol><li>æ„é€ å‡½æ•°æ‰§è¡Œæ—¶åˆå§‹åŒ–ç±»æˆå‘˜ï¼ˆå˜é‡ï¼‰æ–¹æ³•ä¸€<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> m_Name;</span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">    <span class="comment">//é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    Entity()</span><br><span class="line">    &#123;</span><br><span class="line">        m_Name=<span class="string">&quot;Unknow&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ¥å—nameä½œä¸ºå‚æ•°çš„æ„é€ å‡½æ•°</span></span><br><span class="line">    Entity(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; name)</span><br><span class="line">    &#123;</span><br><span class="line">        m_Name=name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; <span class="title">GetName</span><span class="params">()</span> <span class="keyword">const</span><span class="comment">//è¯¥å‡½æ•°ä¸å…è®¸ä¿®æ”¹å€¼</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> m_Name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="function">Entity <span class="title">e</span><span class="params">(<span class="string">&quot;Cherno&quot;</span>)</span></span>;</span><br><span class="line">     <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; e.GetName() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">     <span class="comment">//è¾“å‡ºä¸ºCherno</span></span><br></pre></td></tr></table></figure></li><li>æ–¹æ³•äºŒ<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> m_Name;</span><br><span class="line">    <span class="keyword">int</span> m_Score;</span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–ç±»æˆå‘˜m_Nameä¸ºUnknow,m_Scoreä¸º0</span></span><br><span class="line">    Entity()</span><br><span class="line">       :m_Name(<span class="string">&quot;Unknow&quot;</span>),m_Score(<span class="number">0</span>);</span><br><span class="line">    &#123;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; <span class="title">GetName</span><span class="params">()</span> <span class="keyword">const</span><span class="comment">//è¯¥å‡½æ•°ä¸å…è®¸ä¿®æ”¹å€¼</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> m_Name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">    Entity e;</span><br><span class="line">     <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; e.GetName() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">     <span class="comment">//è¾“å‡ºä¸ºUnknow</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> ä¸‰å…ƒæ“ä½œç¬¦ </summary>              <div class='content'>              <ol><li>å’Œç®€å•çš„ifå¯ç­‰ä»·ä½†æ˜¯æ“ä½œæ›´å¿«<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span> (a&gt;<span class="number">5</span>)</span><br><span class="line">    b=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    b=<span class="number">1</span>; </span><br><span class="line"><span class="comment">//ä¸‰å…ƒæ“ä½œç¬¦</span></span><br><span class="line">b=a&gt;<span class="number">5</span>?<span class="number">0</span>:<span class="number">1</span>;<span class="comment">//aå¤§äº5åˆ™bå–0ï¼Œå¦åˆ™bå–1</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> rank = a&gt;<span class="number">10</span>? <span class="string">&quot;Master&quot;</span>:<span class="string">&quot;Beginner&quot;</span>;<span class="comment">//aå¤§äº5åˆ™rankå–Masterï¼Œå¦åˆ™rankå–Beginner</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> åˆå§‹åŒ–å¯¹è±¡ </summary>              <div class='content'>              <ol><li>æ ˆé‡Œåˆå§‹åŒ–ï¼Œç¦»å¼€ä½œç”¨åŸŸä¼šè¢«é‡Šæ”¾//æ ˆå¾ˆå°1-2M<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">   </span><br><span class="line">&#125;;</span><br><span class="line">    Entity e;</span><br></pre></td></tr></table></figure></li><li>å †é‡Œåˆå§‹åŒ–ï¼Œç¨‹åºå‘˜ä¸‹å‘é‡Šæ”¾å†…å­˜æŒ‡ä»¤å‰ä¸€ç›´éƒ½åœ¨//èŠ±è´¹æ—¶é—´é•¿<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">   </span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line">    Entity* e=<span class="keyword">new</span> Entity;</span><br><span class="line">    <span class="keyword">delete</span> e;<span class="comment">//åˆ é™¤æŒ‡é’ˆ</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> new </summary>              <div class='content'>              <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* b=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">50</span>];<span class="comment">//200 bytes,bä¸ºæ•°å­—é•¿åº¦50</span></span><br><span class="line">Entity* e=<span class="keyword">new</span> Entity[<span class="number">50</span>];<span class="comment">//å¯ä»¥æ”¾50ä¸ªæ­¤ç±»å‹å¯¹è±¡</span></span><br><span class="line"><span class="keyword">delete</span>[] e;</span><br><span class="line"><span class="keyword">delete</span>[] b;</span><br></pre></td></tr></table></figure>              </div>            </details><details class="folding-tag" green><summary> this </summary>              <div class='content'>              <ol><li>thisæ˜¯æŒ‡å‘å½“å‰å¯¹è±¡å®ä¾‹çš„æŒ‡é’ˆ,this-&gt;è®¿é—®å¯¹è±¡é‡Œçš„æ•°æ®,*thiså°±æ˜¯å¯¹è±¡<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PrintEntity</span><span class="params">(<span class="keyword">const</span> Entity&amp; e)</span><span class="comment">//å‚æ•°æ˜¯ä¸€ä¸ªEntityç±»çš„å¯¹è±¡ï¼Œeæ˜¯åˆ«å</span></span></span><br><span class="line"><span class="function">class Entity</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">    <span class="keyword">int</span> x,y</span><br><span class="line">    Entity(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;x=x;<span class="comment">//æŠŠä¼ å…¥çš„å˜é‡xçš„å€¼ç»™è¯¥å¯¹è±¡çš„æˆå‘˜å˜é‡x</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;y=y;<span class="comment">//æŠŠä¼ å…¥çš„å˜é‡yçš„å€¼ç»™è¯¥å¯¹è±¡çš„æˆå‘˜å˜é‡y</span></span><br><span class="line">        PrintEntity(*<span class="keyword">this</span>)<span class="comment">//æŠŠè¿™ä¸ªå¯¹è±¡ä¼ ç»™å‡½æ•°</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">&#125;;</span><br><span class="line">    </span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> æ™ºèƒ½æŒ‡é’ˆ </summary>              <div class='content'>              <ol><li>ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆunique_ptr(ä¼˜å…ˆä½¿ç”¨)ï¼Œè¶…å‡ºä½œç”¨åŸŸ{}ä¼šè‡ªåŠ¨é”€æ¯<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">   Entity()</span><br><span class="line">   &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;åˆ›å»ºæˆåŠŸ&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   ~Entity()</span><br><span class="line">   &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;é”€æ¯æˆåŠŸ&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">    &#123; <span class="comment">//åˆ›å»ºä¸€ä¸ªEntityç±»çš„å¯¹è±¡e</span></span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;Entity&gt; e=<span class="built_in">std</span>::make_unique&lt;Entity&gt;()</span><br><span class="line">      e-&gt;Print();</span><br><span class="line">      <span class="comment">//æ­¤æ—¶è¾“å‡ºåˆ›å»ºæˆåŠŸ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ­¤æ—¶è¾“å‡ºé”€æ¯æˆåŠŸ</span></span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆshared_ptrå°†å¯¹è±¡ä¼ é€’åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸­æˆ–ç±»ä¸­ï¼Œç›¸å½“äºå¯¹è±¡çš„æ¥æ›¿è€…ï¼Œå¼•ç”¨è®¡æ•°ï¼Œè®¡æ•°ä¸º0åˆ™åˆ é™¤æŒ‡é’ˆï¼Œå†…å­˜é‡Šæ”¾<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">   Entity()</span><br><span class="line">   &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;åˆ›å»ºæˆåŠŸ&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   ~Entity()</span><br><span class="line">   &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;é”€æ¯æˆåŠŸ&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#123;   <span class="comment">////åˆ›å»ºEntityç±»å®ä¾‹åŒ–å¯¹è±¡e0çš„æ™ºèƒ½æŒ‡é’ˆ</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Entity&gt; e0;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºEntityç±»å®ä¾‹åŒ–å¯¹è±¡eçš„æ™ºèƒ½æŒ‡é’ˆ</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Entity&gt; e=<span class="built_in">std</span>::make_shared&lt;Entity&gt;();</span><br><span class="line">      <span class="comment">//æ­¤æ—¶è¾“å‡ºåˆ›å»ºæˆåŠŸ</span></span><br><span class="line">     e0=e;<span class="comment">//å¤åˆ¶æŒ‡é’ˆe0æŒ‡å‘è¯¥å¯¹è±¡ï¼Œå³ä½¿eæ­»äº†e0ä»ç„¶ä»£æ›¿eä½¿ç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//eå¯¹è±¡æ­»äº†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//e0æ­»äº† è¯¥å¯¹è±¡å½»åº•ç©äº†ï¼Œæ­¤æ—¶è¾“å‡ºé”€æ¯æˆåŠŸ</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><details class="folding-tag" green><summary> å¸®åŠ© </summary>              <div class='content'>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><details class="folding-tag" green><summary> å¸®åŠ© </summary>              <div class='content'>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>qt-ros</title>
      <link href="blog/qt-ros/"/>
      <url>blog/qt-ros/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">ç¯å¢ƒé…ç½®</button></li><li class="tab"><button type="button" data-href="#test4-2">æœºå™¨äººä»ªè¡¨ç›˜</button></li><li class="tab"><button type="button" data-href="#test4-3">å…¶ä»–ç•Œé¢è®¾è®¡</button></li><li class="tab"><button type="button" data-href="#test4-4">rvizå¯¼èˆªç±»ç•Œé¢è®¾è®¡</button></li><li class="tab"><button type="button" data-href="#test4-5">æºç åŠå›¾ç‰‡</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><details class="folding-tag" green><summary> å¸¸è§é”™è¯¯ </summary>              <div class='content'>              <ol><li><p class='p blue'>ç¼–è¯‘ä¸æˆåŠŸ</p><br>è§£å†³åŠæ³•<br>åˆ é™¤å·¥ä½œç©ºé—´çš„buildå’Œdevel<br>cd catkin_qt/<br>catkin_make</li><li><p class='p blue'>qtä¸‹ç¼–è¯‘å¤±è´¥</p><br><a href="https://blog.csdn.net/weixin_50303783/article/details/117359878?spm=1001.2014.3001.5501">https://blog.csdn.net/weixin_50303783/article/details/117359878?spm=1001.2014.3001.5501</a></li><li><p class='p blue'>qtä¸‹ç¼–è¯‘æ˜¾ç¤ºæ‰¾ä¸åˆ°å…±äº«æ–‡ä»¶</p><br>é…ç½®qtcreator<br>sudo vim /usr/bin/qtcreator<br>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š QT_HOMEæ›´æ”¹ä¸ºè‡ªå·±qtå®‰è£…è·¯å¾„çš„binç›®å½•<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh </span><br><span class="line"><span class="keyword">export</span> QT_HOME=/home/xxxx/Qtxxx/Tools/QtCreator/bin </span><br><span class="line"><span class="keyword">export</span> QT_HOME=/home/lixiao/Qt5<span class="number">.9</span><span class="number">.9</span>/Tools/QtCreator/bin</span><br><span class="line">$QT_HOME/qtcreator $*</span><br></pre></td></tr></table></figure>æ›´æ”¹å¯æ‰§è¡Œæƒé™<br>sudo chmod a+x /usr/bin/qtcreator<br>ç»ˆç«¯è¾“å…¥ï¼š<br>qtcreator<br>ä¸è¦ç›´æ¥ç‚¹å¼€è½¯ä»¶</li></ol>              </div>            </details><details class="folding-tag" blue><summary> é…ç½®æµç¨‹ </summary>              <div class='content'>              <p>è½¬è½½å¤æœˆå±… <a href="http://www.guyuehome.com/6058">http://www.guyuehome.com/6058</a><br>ROS Qt5 librvizäººæœºäº¤äº’ç•Œé¢å¼€å‘ä¸€ï¼ˆé…ç½®QTç¯å¢ƒï¼‰</p><ol><li><p class='p blue'>é¦–å…ˆå®‰è£…roså¯¹qt pkgçš„æ”¯æŒ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install update</span><br><span class="line">sudo apt-get install ros-melodic-qt-create</span><br><span class="line">sudo apt-get install ros-melodic-qt-build</span><br></pre></td></tr></table></figure>è¿™æ ·å°±èƒ½é€šè¿‡ï¼šcatkin_create_qt_pkgå‘½ä»¤åˆ›å»ºros guiåŒ…äº†:<br>åœ¨srcç›®å½•ä¸‹åˆ›å»ºåŒ…ï¼š<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd catkin_ws/src</span><br><span class="line">catkin_create_qt_pkg qt_ros_test roscpp rviz </span><br></pre></td></tr></table></figure></li><li><p class='p blue'>å®‰è£…qtcreator</p><br><a href="https://s3.jcloud.sjtu.edu.cn/899a892efef34b1b944a19981040f55b-oss01/rsync/qt/921fa12ae4f32a039557388302b3796dcb5915dd">https://s3.jcloud.sjtu.edu.cn/899a892efef34b1b944a19981040f55b-oss01/rsync/qt/921fa12ae4f32a039557388302b3796dcb5915dd</a><br>æ›´æ”¹å®‰è£…åŒ…çš„å¯æ‰§è¡Œæƒé™<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x qt-opensource-linux-x64<span class="number">-5.9</span><span class="number">.9</span>.run</span><br></pre></td></tr></table></figure>åŒå‡»å®‰è£…åŒ…åå®‰è£…<br>æ–­ç½‘å®‰è£…<br>å®‰è£…ç»„ä»¶é€‰æ‹©ä¸ŠDesktop gcc 64-bit</li><li><p class='p blue'>é…ç½®qtcreator</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/bin/qtcreator</span><br></pre></td></tr></table></figure>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š QT_HOMEæ›´æ”¹ä¸ºè‡ªå·±qtå®‰è£…è·¯å¾„çš„binç›®å½•<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh </span><br><span class="line"><span class="keyword">export</span> QT_HOME=/home/xxxx/Qtxxx/Tools/QtCreator/bin </span><br><span class="line"><span class="keyword">export</span> QT_HOME=/home/lixiao/Qt5<span class="number">.9</span><span class="number">.9</span>/Tools/QtCreator/bin</span><br><span class="line">$QT_HOME/qtcreator $*</span><br></pre></td></tr></table></figure>æ›´æ”¹å¯æ‰§è¡Œæƒé™<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod a+x /usr/bin/qtcreator</span><br></pre></td></tr></table></figure>ç»ˆç«¯è¾“å…¥ï¼š<br>qtcreator<br>æ–‡ä»¶-&gt;æ‰“å¼€é¡¹ç›®-&gt;é€‰æ‹©å·¥ä½œç©ºé—´ä¸‹srcä¸‹çš„cmakelist.txtï¼ˆ==æ³¨æ„å¹¶éåŠŸèƒ½åŒ…ä¸‹çš„==ï¼‰<br>æ‰“å¼€åç‚¹å‡»é¡¹ç›®ï¼š å°†buildçš„æ„å»ºç›®å½•æ”¹ä¸ºå½“å‰å·¥ä½œç©ºé—´çš„buildæ–‡ä»¶å¤¹<br>ç„¶åè¿”å›ç¼–è¾‘å³é”®é¡¹ç›®-&gt;æ‰§è¡Œcmakeå¦‚æœå¼¹å‡ºæç¤ºæ¡†ç‚¹å‡»ç¬¬ä¸€ä¸ªæŒ‰é’®changeï¼Œå¦‚æœæŠ¥é”™<a href="http://www.guyuehome.com/6058#comment">http://www.guyuehome.com/6058#comment</a></li><li><p class='p blue'>æ›´æ”¹åŠŸèƒ½åŒ…main_window.hpp</p><br>ç”±äºQ4tä¸­åŒ…å«QMainWindowåœ¨QtGuiä¸­ï¼Œåœ¨Qt5ä¸­æ›´æ”¹ä¸ºQtWidgetsç±»ä¸­ï¼Œæ‰€ä»¥éœ€è¦ä½œæ›´æ”¹ï¼šè¿›å…¥å·¥ä½œç©ºé—´ä¸‹çš„qtåŠŸèƒ½åŒ…æ¯”å¦‚ä¸Šé¢åˆ›å»ºçš„qt_ros_test ./include/åŠŸèƒ½åŒ…å/main_window.hpp<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QtGui/QMainWindow&gt;</span></span></span><br><span class="line">æ”¹ä¸º</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QtWidgets/QMainWindow&gt;</span></span></span><br></pre></td></tr></table></figure></li><li><p class='p blue'>è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶</p><br>åœ¨å·¦ä¾§é¡¹ç›®-&gt;run-&gt;è¿è¡Œé…ç½® æ›´æ”¹è¦è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶åç§°ï¼Œå¹¶ç‚¹å‡»ç»¿è‰²ä¸‰è§’å½¢è¿è¡Œå³å¯</li></ol>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><ol><li><p><p class='p blue'>åŸç†ä¸»è¦å°±æ˜¯è®¢é˜…æœºå™¨äººçš„odomè¯é¢˜ï¼Œç„¶ååˆ©ç”¨ä¿¡å·ä¸æ§½æ›´æ–°uiä»ªè¡¨ç›˜æ§ä»¶çš„ä¿¡æ¯</p></p><details class="folding-tag" green><summary> ä¸€ åˆ›å»ºqté¡¹ç›®åŠŸèƒ½åŒ… </summary>           <div class='content'>           <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">catkin_create_qt_pkgå‘½ä»¤åˆ›å»ºros guiåŒ…äº†: åœ¨srcç›®å½•ä¸‹åˆ›å»ºåŒ…ï¼š</span><br><span class="line">cd catkin_ws/src</span><br><span class="line">catkin_create_qt_pkg qt_ros_test</span><br></pre></td></tr></table></figure>           </div>         </details><details class="folding-tag" blue><summary> äºŒ æ›´æ”¹åŠŸèƒ½åŒ…main_window.hpp </summary>           <div class='content'>           <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">qtåŠŸèƒ½åŒ…æ¯”å¦‚ä¸Šé¢åˆ›å»ºçš„qt_ros_test ./include/åŠŸèƒ½åŒ…å/main_window.hpp</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QtGui/QMainWindow&gt;</span></span></span><br><span class="line">æ”¹ä¸º</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QtWidgets/QMainWindow&gt;</span></span></span><br></pre></td></tr></table></figure>           </div>         </details><details class="folding-tag" yellow><summary> ä¸‰ è¿”å›ç¼–è¾‘å³é”®é¡¹ç›®->æ‰§è¡Œcmake </summary>           <div class='content'>           </div>         </details><details class="folding-tag" green><summary> å›› å¼€å§‹ç¼–å†™ </summary>           <div class='content'>           <ol><li><p class='p blue'>ä¸€åœ¨å·¥ä½œç©ºé—´ä¸‹çš„srcæ–‡ä»¶å¤¹->qtåŠŸèƒ½åŒ…->includeæ–‡ä»¶å¤¹->qtåŠŸèƒ½åŒ…åŒåæ–‡ä»¶å¤¹->å»ºç«‹æ–‡ä»¶CCtrlDashBoard.hpp</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CCTRLDASHBOARD_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CCTRLDASHBOARD_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CCtrlDashBoard</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">StyleType</span> &#123;</span></span><br><span class="line">        ST_DEFAULT=<span class="number">0</span>,</span><br><span class="line">        ST_ARCBAR</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">CCtrlDashBoard</span><span class="params">(QWidget *parent = <span class="literal">nullptr</span>, StyleType type=ST_DEFAULT)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setValue</span><span class="params">(qreal value)</span></span>&#123;</span><br><span class="line">        m_DashValue = value;</span><br><span class="line">        update();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setBackGroundColor</span><span class="params">(QColor color)</span></span>&#123;</span><br><span class="line">        m_BgColor=color;</span><br><span class="line">        update();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setFrontColor</span><span class="params">(QColor color)</span></span>&#123;</span><br><span class="line">        m_FrontColor=color;</span><br><span class="line">        update();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setBorderColor</span><span class="params">(QColor color)</span></span>&#123;</span><br><span class="line">        m_BorderColor=color;</span><br><span class="line">        update();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setUnitString</span><span class="params">(QString str)</span></span>&#123;</span><br><span class="line">        m_StrUnit=str;</span><br><span class="line">        update();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">drawBackGround</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">drawScaleDials</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">drawIndicator</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">drawIndicatorBar</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span>;</span><br><span class="line">signals:</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent * event)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_StartAngle;</span><br><span class="line">    <span class="keyword">int</span> m_EndAngle;</span><br><span class="line">    <span class="keyword">int</span> m_StyleType;</span><br><span class="line"></span><br><span class="line">    qreal m_LineLength;</span><br><span class="line">    qreal m_DashValue;</span><br><span class="line">    qreal m_MaxValue;</span><br><span class="line">    qreal m_MinValue;</span><br><span class="line">    qreal m_DashNum;</span><br><span class="line"></span><br><span class="line">    QColor m_BgColor;</span><br><span class="line">    QColor m_FrontColor;</span><br><span class="line">    QColor m_BorderColor;</span><br><span class="line">    QString m_StrUnit;</span><br><span class="line"></span><br><span class="line">    qreal m_MaxBorderRadius;</span><br><span class="line">    qreal m_MinBorderRadius;</span><br><span class="line">    qreal m_DialsRadius;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// CCTRLDASHBOARD_H</span></span></span><br></pre></td></tr></table></figure></li><li><p class='p blue'>äºŒåœ¨å·¥ä½œç©ºé—´ä¸‹çš„srcæ–‡ä»¶å¤¹->qtåŠŸèƒ½åŒ…->srcæ–‡ä»¶å¤¹->å»ºç«‹æ–‡ä»¶CCtrlDashBoard.cpp</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../include/qt_ros_test/CCtrlDashBoard.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qmath.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">CCtrlDashBoard::CCtrlDashBoard(QWidget *parent, StyleType type) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    m_StyleType(type)</span><br><span class="line">&#123;</span><br><span class="line">    m_BorderColor = QColor(<span class="number">172</span>,<span class="number">172</span>,<span class="number">172</span>);</span><br><span class="line">    m_BgColor = QColor(<span class="number">40</span>,<span class="number">40</span>,<span class="number">40</span>);</span><br><span class="line">    m_FrontColor = Qt::white;</span><br><span class="line"></span><br><span class="line">    m_DashValue= <span class="number">0</span>;</span><br><span class="line">    m_MinValue = <span class="number">0</span>;</span><br><span class="line">    m_MaxValue = <span class="number">100</span>;</span><br><span class="line">    m_DashNum = <span class="number">1</span>;</span><br><span class="line">    m_LineLength=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    m_StartAngle=<span class="number">90</span>;  <span class="comment">//510</span></span><br><span class="line">    m_EndAngle=<span class="number">0</span>;   <span class="comment">//120</span></span><br><span class="line">    update();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawBackGround</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_MaxBorderRadius = ((hlafWidth*<span class="number">5</span>)/<span class="number">6</span>);</span><br><span class="line">    qreal startX=hlafWidth-m_MaxBorderRadius;</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;setPen(m_BorderColor);</span><br><span class="line">    painter-&gt;setBrush(m_BorderColor);</span><br><span class="line"></span><br><span class="line">    QPainterPath bigCircle;</span><br><span class="line">    bigCircle.addEllipse(startX, startX, (m_MaxBorderRadius*<span class="number">2</span>), (m_MaxBorderRadius*<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    m_MinBorderRadius = m_MaxBorderRadius<span class="number">-15</span>;</span><br><span class="line">    startX=hlafWidth-m_MinBorderRadius;</span><br><span class="line">    QPainterPath smallCircle;</span><br><span class="line">    smallCircle.addEllipse(startX, startX, (m_MinBorderRadius*<span class="number">2</span>), (m_MinBorderRadius*<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    QPainterPath path = bigCircle - smallCircle;</span><br><span class="line">    painter-&gt;drawPath(path);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;setBrush(m_BgColor);</span><br><span class="line">    painter-&gt;drawEllipse(startX,startX,(m_MinBorderRadius*<span class="number">2</span>), (m_MinBorderRadius*<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">if</span>(m_DashValue==<span class="number">0</span>)&#123;</span><br><span class="line">      QString speed = <span class="string">&quot;0.0 cm/s&quot;</span>;</span><br><span class="line">      painter-&gt;drawText(startX+<span class="number">85</span>,startX+<span class="number">170</span>,speed);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      QString speed = QString::number(m_DashValue).mid(<span class="number">0</span>,<span class="number">3</span>) + <span class="string">&quot; cm/s&quot;</span>;</span><br><span class="line">      painter-&gt;drawText(startX+<span class="number">85</span>,startX+<span class="number">170</span>,speed);</span><br><span class="line">    &#125;</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">    m_DialsRadius = m_MinBorderRadius<span class="number">-10</span>;</span><br><span class="line">    <span class="keyword">if</span>(m_DialsRadius &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        m_DialsRadius=<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawScaleDials</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qreal tSteps = (m_MaxValue - m_MinValue)/m_DashNum; <span class="comment">//ç›¸ä¹˜åçš„å€¼æ˜¯åˆ†çš„ä»½æ•°</span></span><br><span class="line">    qreal angleStep = <span class="number">1.0</span>*(<span class="number">360.0</span>-m_StartAngle - m_EndAngle) / tSteps; <span class="comment">//æ¯ä¸€ä¸ªä»½æ•°çš„è§’åº¦</span></span><br><span class="line">    QPen pen ;</span><br><span class="line">    pen.setColor(m_FrontColor); <span class="comment">//æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹å¼</span></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle);</span><br><span class="line">    m_LineLength = (hlafWidth/<span class="number">16</span>);</span><br><span class="line">    qreal lineStart = m_DialsRadius<span class="number">-4</span>*m_LineLength-m_LineLength;</span><br><span class="line">    qreal lineSmStart = m_DialsRadius<span class="number">-4</span>*m_LineLength-m_LineLength/<span class="number">2</span>;</span><br><span class="line">    qreal lineEnd = m_DialsRadius<span class="number">-4</span>*m_LineLength;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tSteps; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">80</span>) pen.setColor(QColor(<span class="number">250</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">10</span> == <span class="number">0</span>)<span class="comment">//æ•´æ•°åˆ»åº¦æ˜¾ç¤ºåŠ ç²—</span></span><br><span class="line">        &#123;</span><br><span class="line">            pen.setWidth(<span class="number">2</span>); <span class="comment">//è®¾ç½®çº¿å®½</span></span><br><span class="line">            painter-&gt;setPen(pen); <span class="comment">//ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ€æƒ³ï¼ŒæŠŠç”»ç¬”å…³è”ä¸Šç”»å®¶ã€‚é€šè¿‡ç”»å®¶ç”»å‡ºæ¥</span></span><br><span class="line">            painter-&gt;drawLine(lineStart,lineStart, lineEnd, lineEnd); <span class="comment">//ä¸¤ä¸ªå‚æ•°åº”è¯¥æ˜¯ä¸¤ä¸ªåæ ‡å€¼</span></span><br><span class="line">            <span class="comment">//painter-&gt;drawText(lineEnd+6,lineEnd+6, tr(&quot;%1&quot;).arg(m_MinValue+i));</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            pen.setWidth(<span class="number">1</span>);</span><br><span class="line">            painter-&gt;setPen(pen);</span><br><span class="line">            painter-&gt;drawLine(lineSmStart, lineSmStart, lineEnd, lineEnd); <span class="comment">//ä¸¤ä¸ªå‚æ•°åº”è¯¥æ˜¯ä¸¤ä¸ªåæ ‡å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">        painter-&gt;rotate(angleStep);</span><br><span class="line">    &#125;</span><br><span class="line">    pen.setColor(m_FrontColor);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;setPen(pen);</span><br><span class="line">    <span class="comment">//m_startAngleæ˜¯èµ·å§‹è§’åº¦ï¼Œm_endAngleæ˜¯ç»“æŸè§’åº¦ï¼Œm_scaleMajoråœ¨ä¸€ä¸ªé‡ç¨‹ä¸­åˆ†æˆçš„åˆ»åº¦æ•°</span></span><br><span class="line">    qreal startRad = ( <span class="number">315</span>-m_StartAngle) * (<span class="number">3.14</span> / <span class="number">180</span>);</span><br><span class="line">    qreal deltaRad = (<span class="number">360</span>-m_StartAngle - m_EndAngle) * (<span class="number">3.14</span> / <span class="number">180</span>) / tSteps;</span><br><span class="line">    qreal sina,cosa;</span><br><span class="line">    qreal x, y;</span><br><span class="line">    <span class="function">QFontMetricsF <span class="title">fm</span><span class="params">(<span class="keyword">this</span>-&gt;font())</span></span>;</span><br><span class="line">    <span class="keyword">double</span> w, h, tmpVal;</span><br><span class="line">    QString str;</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    lineEnd = m_MinBorderRadius<span class="number">-8</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tSteps; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">10</span> == <span class="number">0</span>)<span class="comment">//æ•´æ•°åˆ»åº¦æ˜¾ç¤ºåŠ ç²—</span></span><br><span class="line">        &#123;</span><br><span class="line">            sina = qSin(startRad - i * deltaRad);</span><br><span class="line">            cosa = <span class="built_in">cos</span>(startRad - i * deltaRad);</span><br><span class="line"></span><br><span class="line">            tmpVal = <span class="number">1.0</span> * i *((m_MaxValue - m_MinValue) / tSteps) + m_MinValue;</span><br><span class="line">            str = QString( <span class="string">&quot;%1&quot;</span> ).arg(tmpVal);  <span class="comment">//%1ä½œä¸ºå ä½ç¬¦   arg()å‡½æ•°æ¯”èµ· sprintf()æ¥æ˜¯ç±»å‹å®‰å…¨çš„</span></span><br><span class="line">            w = fm.size(Qt::TextSingleLine,str).width();</span><br><span class="line">            h = fm.size(Qt::TextSingleLine,str).height();</span><br><span class="line">            x = lineEnd * cosa - w / <span class="number">2</span>;</span><br><span class="line">            y = -lineEnd * sina + h / <span class="number">4</span>;</span><br><span class="line">            painter-&gt;drawText(x, y, str); <span class="comment">//å‡½æ•°çš„å‰ä¸¤ä¸ªå‚æ•°æ˜¯æ˜¾ç¤ºçš„åæ ‡ä½ç½®ï¼Œåä¸€ä¸ªæ˜¯æ˜¾ç¤ºçš„å†…å®¹ï¼Œæ˜¯å­—ç¬¦ç±»å‹&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawIndicator</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QPolygon pts;</span><br><span class="line">    pts.setPoints(<span class="number">3</span>, <span class="number">-8</span>,<span class="number">0</span>, <span class="number">8</span>,<span class="number">0</span>, <span class="number">0</span>,(<span class="keyword">int</span>)m_DialsRadius<span class="number">-20</span>); <span class="comment">/* (-2,0)/(2,0)/(0,60) */</span><span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ ï¼Œåæ ‡çš„ä¸ªæ•°ã€‚åè¾¹çš„æ˜¯åæ ‡</span></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth, hlafWidth);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle<span class="number">-45</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(m_DashValue&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        qreal tSteps = (m_MaxValue - m_MinValue)/m_DashNum; <span class="comment">//ç›¸ä¹˜åçš„å€¼æ˜¯åˆ†çš„ä»½æ•°</span></span><br><span class="line">        qreal angleStep = <span class="number">1.0</span>*(<span class="number">360.0</span>-m_StartAngle - m_EndAngle) / tSteps; <span class="comment">//æ¯ä¸€ä¸ªä»½æ•°çš„è§’åº¦</span></span><br><span class="line">        <span class="keyword">double</span> degRotate = angleStep*tSteps*(m_DashValue/<span class="number">100.0</span>)+angleStep;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”»æŒ‡é’ˆ</span></span><br><span class="line">        <span class="comment">//qDebug() &lt;&lt;&quot;degRotate ==&quot;&lt;&lt;degRotate&lt;&lt;&quot;m_DashValue ==&quot;&lt;&lt;m_DashValue&lt;&lt;m_StartAngle&lt;&lt;m_DialsRadius&lt;&lt;hlafWidth;</span></span><br><span class="line">        <span class="keyword">if</span>(m_DashValue == <span class="number">99</span>)&#123;</span><br><span class="line">            painter-&gt;rotate(m_EndAngle-m_StartAngle);  <span class="comment">//é¡ºæ—¶é’ˆæ—‹è½¬åæ ‡ç³»ç»Ÿ</span></span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            painter-&gt;rotate(degRotate);  <span class="comment">//é¡ºæ—¶é’ˆæ—‹è½¬åæ ‡ç³»ç»Ÿ</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QRadialGradient <span class="title">haloGradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, hlafWidth/<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>;  <span class="comment">//è¾å°„æ¸å˜</span></span><br><span class="line">    haloGradient.setColorAt(<span class="number">0</span>, QColor(<span class="number">255</span>,<span class="number">69</span>,<span class="number">0</span>));</span><br><span class="line">    haloGradient.setColorAt(<span class="number">1</span>, QColor(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    painter-&gt;setPen(Qt::white); <span class="comment">//å®šä¹‰çº¿æ¡æ–‡æœ¬é¢œè‰²  è®¾ç½®çº¿æ¡çš„é¢œè‰²</span></span><br><span class="line">    painter-&gt;setBrush(haloGradient);<span class="comment">//åˆ·å­å®šä¹‰å½¢çŠ¶å¦‚ä½•å¡«æ»¡ å¡«å……åçš„é¢œè‰²</span></span><br><span class="line">    painter-&gt;drawConvexPolygon(pts); <span class="comment">//è¿™æ˜¯ä¸ªé‡è½½å‡½æ•°ï¼Œç»˜åˆ¶å¤šè¾¹å½¢ã€‚</span></span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”»ä¸­å¿ƒç‚¹</span></span><br><span class="line">    <span class="function">QColor <span class="title">niceBlue</span><span class="params">(<span class="number">150</span>, <span class="number">150</span>, <span class="number">200</span>)</span></span>;</span><br><span class="line">    <span class="function">QConicalGradient <span class="title">coneGradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-90.0</span>)</span></span>;  <span class="comment">//è§’åº¦æ¸å˜</span></span><br><span class="line">    coneGradient.setColorAt(<span class="number">0.0</span>, Qt::darkGray);</span><br><span class="line">    coneGradient.setColorAt(<span class="number">0.2</span>, niceBlue);</span><br><span class="line">    coneGradient.setColorAt(<span class="number">0.5</span>, Qt::white);</span><br><span class="line">    coneGradient.setColorAt(<span class="number">1.0</span>, Qt::darkGray);</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    painter-&gt;setPen(Qt::NoPen);  <span class="comment">//æ²¡æœ‰çº¿ï¼Œå¡«æ»¡æ²¡æœ‰è¾¹ç•Œ</span></span><br><span class="line">    painter-&gt;setBrush(coneGradient);</span><br><span class="line">    painter-&gt;drawEllipse(<span class="number">-10</span>, <span class="number">-10</span>, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawIndicatorBar</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ¸å˜è‰²</span></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    qreal lineEnd = m_DialsRadius<span class="number">-3</span>*m_LineLength;</span><br><span class="line">    <span class="function">QRadialGradient <span class="title">gradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, lineEnd)</span></span>;</span><br><span class="line">    gradient.setColorAt(<span class="number">0</span>, Qt::white);</span><br><span class="line">    gradient.setColorAt(<span class="number">1.0</span>, Qt::blue);</span><br><span class="line">    painter-&gt;setBrush(gradient);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &lt;&lt; 1ï¼ˆå·¦ç§»1ä½ï¼‰ç›¸å½“äºradius*2 å³ï¼š150*2=300</span></span><br><span class="line">    <span class="comment">//QRectF(-150, -150, 300, 300)</span></span><br><span class="line">    <span class="function">QRectF <span class="title">rect</span><span class="params">(-lineEnd, -lineEnd, lineEnd*<span class="number">2</span>, lineEnd*<span class="number">2</span>)</span></span>;</span><br><span class="line">    QPainterPath path;</span><br><span class="line">    path.arcTo(rect, m_StartAngle, <span class="number">270</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// QRectF(-120, -120, 240, 240)</span></span><br><span class="line">    QPainterPath subPath;</span><br><span class="line">    subPath.addEllipse(rect.adjusted(<span class="number">10</span>, <span class="number">10</span>, <span class="number">-10</span>, <span class="number">-10</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// pathä¸ºæ‰‡å½¢ subPathä¸ºæ¤­åœ†</span></span><br><span class="line">    path -= subPath;</span><br><span class="line">    painter-&gt;setPen(Qt::NoPen);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle+<span class="number">45</span>);</span><br><span class="line">    painter-&gt;drawPath(path);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    qreal degRotate=<span class="number">0.1</span>;</span><br><span class="line">    <span class="keyword">if</span>(m_DashValue&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        qreal tSteps = (m_MaxValue - m_MinValue)/m_DashNum; <span class="comment">//ç›¸ä¹˜åçš„å€¼æ˜¯åˆ†çš„ä»½æ•°</span></span><br><span class="line">        qreal angleStep = <span class="number">1.0</span>*(<span class="number">360.0</span>-m_StartAngle - m_EndAngle) / tSteps; <span class="comment">//æ¯ä¸€ä¸ªä»½æ•°çš„è§’åº¦</span></span><br><span class="line">        degRotate = angleStep*tSteps*(m_DashValue/<span class="number">100.0</span>)+angleStep;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”»æŒ‡é’ˆ</span></span><br><span class="line">        <span class="comment">//qDebug() &lt;&lt;&quot;degRotate ==&quot;&lt;&lt;degRotate&lt;&lt;&quot;m_DashValue ==&quot;&lt;&lt;m_DashValue&lt;&lt;m_StartAngle&lt;&lt;m_DialsRadius&lt;&lt;hlafWidth;</span></span><br><span class="line">        <span class="comment">/*if(m_DashValue == 99)&#123;</span></span><br><span class="line"><span class="comment">            painter-&gt;rotate(m_EndAngle-m_StartAngle);  //é¡ºæ—¶é’ˆæ—‹è½¬åæ ‡ç³»ç»Ÿ</span></span><br><span class="line"><span class="comment">        &#125;else</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            painter-&gt;rotate(degRotate);  //é¡ºæ—¶é’ˆæ—‹è½¬åæ ‡ç³»ç»Ÿ</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth, hlafWidth);</span><br><span class="line"></span><br><span class="line">    <span class="function">QRadialGradient <span class="title">ftGradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, lineEnd)</span></span>;</span><br><span class="line">    ftGradient.setColorAt(<span class="number">0</span>, Qt::white);</span><br><span class="line">    ftGradient.setColorAt(<span class="number">1.0</span>, Qt::darkYellow);</span><br><span class="line">    painter-&gt;setBrush(ftGradient);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &lt;&lt; 1ï¼ˆå·¦ç§»1ä½ï¼‰ç›¸å½“äºradius*2 å³ï¼š150*2=300</span></span><br><span class="line">    <span class="comment">//QRectF(-150, -150, 300, 300)</span></span><br><span class="line">    <span class="function">QRectF <span class="title">ftRect</span><span class="params">(-lineEnd, -lineEnd, lineEnd*<span class="number">2</span>, lineEnd*<span class="number">2</span>)</span></span>;</span><br><span class="line">    QPainterPath ftPath;</span><br><span class="line">    ftPath.arcTo(ftRect, m_EndAngle-m_StartAngle, -degRotate);</span><br><span class="line">    <span class="comment">// pathä¸ºæ‰‡å½¢ subPathä¸ºæ¤­åœ†</span></span><br><span class="line">    ftPath -= subPath;</span><br><span class="line">    painter-&gt;rotate(m_StartAngle<span class="number">-45</span>);</span><br><span class="line">    painter-&gt;drawPath(ftPath);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line">    QPolygon pts;</span><br><span class="line">    <span class="keyword">int</span> pointLength=lineEnd<span class="number">-12</span>;</span><br><span class="line">    pts.setPoints(<span class="number">3</span>, <span class="number">-6</span>,pointLength<span class="number">-10</span>, <span class="number">6</span>,pointLength<span class="number">-10</span>, <span class="number">0</span>,pointLength);</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth, hlafWidth);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle<span class="number">-45</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(m_DashValue == <span class="number">99</span>)&#123;</span><br><span class="line">        painter-&gt;rotate(m_EndAngle-m_StartAngle);  <span class="comment">//é¡ºæ—¶é’ˆæ—‹è½¬åæ ‡ç³»ç»Ÿ</span></span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        painter-&gt;rotate(degRotate);  <span class="comment">//é¡ºæ—¶é’ˆæ—‹è½¬åæ ‡ç³»ç»Ÿ</span></span><br><span class="line">    &#125;</span><br><span class="line">    painter-&gt;setPen(Qt::white); <span class="comment">//å®šä¹‰çº¿æ¡æ–‡æœ¬é¢œè‰²  è®¾ç½®çº¿æ¡çš„é¢œè‰²</span></span><br><span class="line">    painter-&gt;setBrush(Qt::blue);<span class="comment">//åˆ·å­å®šä¹‰å½¢çŠ¶å¦‚ä½•å¡«æ»¡ å¡«å……åçš„é¢œè‰²</span></span><br><span class="line">    painter-&gt;drawConvexPolygon(pts); <span class="comment">//è¿™æ˜¯ä¸ªé‡è½½å‡½æ•°ï¼Œç»˜åˆ¶å¤šè¾¹å½¢ã€‚</span></span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::paintEvent</span><span class="params">(QPaintEvent * event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">p</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    qreal width = qMin((<span class="keyword">this</span>-&gt;width()&gt;&gt;<span class="number">1</span>), (<span class="keyword">this</span>-&gt;height()&gt;&gt;<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    p.setRenderHints(QPainter::Antialiasing|QPainter::TextAntialiasing);</span><br><span class="line"></span><br><span class="line">    drawBackGround(&amp;p, width);</span><br><span class="line"></span><br><span class="line">    drawScaleDials(&amp;p, width);</span><br><span class="line">    <span class="keyword">switch</span>(m_StyleType)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> ST_DEFAULT:</span><br><span class="line">        drawIndicator(&amp;p, width);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> ST_ARCBAR:</span><br><span class="line">        drawIndicatorBar(&amp;p, width);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p class='p blue'>ä¸‰åœ¨å·¥ä½œç©ºé—´ä¸‹çš„srcæ–‡ä»¶å¤¹->qtåŠŸèƒ½åŒ…->srcæ–‡ä»¶å¤¹->main_window.cpp</p><br>éœ€è¦åœ¨uiä¸­æ·»åŠ ä¸€ä¸ªwidget(éœ€è¦å›ºå®šsize)ï¼Œæˆ‘è¿™é‡Œä¸ºwidget_speed_xï¼Œwidget_speed_y<br>æ‰¾åˆ°æç¤ºåŒºåŸŸImplementation [MainWindow]ä¸‹çš„<br>MainWindow::MainWindow(int argc, char<em>* argv, QWidget </em>parent)<br> : QMainWindow(parent)<br> , qnode(argc,argv)<br> å‡½æ•°é‡Œçš„Auto Startæç¤ºåŒºåŸŸ<br>æ·»åŠ ä»£ç ï¼š<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//init ui</span></span><br><span class="line"> speed_x_dashBoard=<span class="keyword">new</span> CCtrlDashBoard(ui.widget_speed_x);</span><br><span class="line"> speed_y_dashBoard=<span class="keyword">new</span> CCtrlDashBoard(ui.widget_speed_y);</span><br><span class="line"> speed_x_dashBoard-&gt;setGeometry(ui.widget_speed_x-&gt;rect());</span><br><span class="line"> speed_y_dashBoard-&gt;setGeometry(ui.widget_speed_y-&gt;rect());</span><br><span class="line"> speed_x_dashBoard-&gt;setValue(<span class="number">0</span>);</span><br><span class="line"> speed_y_dashBoard-&gt;setValue(<span class="number">0</span>);</span><br><span class="line"> ui.horizontalSlider_linera-&gt;setValue(<span class="number">20</span>);</span><br><span class="line"> ui.horizontalSlider_raw-&gt;setValue(<span class="number">20</span>);</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>è®¢é˜…odomè¯é¢˜ï¼š</p><br>ä¸€åˆ›å»ºè®¢é˜…è€…ï¼š<br>åœ¨å·¥ä½œç©ºé—´ä¸‹çš„srcæ–‡ä»¶å¤¹-&gt;qtåŠŸèƒ½åŒ…-&gt;srcæ–‡ä»¶å¤¹-&gt;qnode.cpp<br>åœ¨bool QNode::init()ä¸¤ä¸ªå‡½æ•°ä¸­æ·»åŠ <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">odom_sub = n.subscribe(<span class="string">&quot;odom&quot;</span>,<span class="number">1000</span>,&amp;QNode::odom_raw_callback,<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>äºŒå›è°ƒå‡½æ•°ï¼š<br>å–å‡ºè¯é¢˜ä¸­çš„æ•°æ®ç»™ä¿¡å·ï¼Œå¹¶åœ¨æœ‰æ•°æ®æ—¶å‘é€è¯¥ä¿¡å·<br>emitå°±æ˜¯å‘é€ä¿¡å·</li><li>qnode.hppä¸­çš„Q_SIGNALS:åŠ å…¥<br>void speed_vel(float,float);<br>ä¸¤ä¸ªå‚æ•°å‡ä¸ºfloat,åˆ†åˆ«ä»£è¡¨xå’Œyæ–¹å‘çš„é€Ÿåº¦ã€‚ä¸€æ—¦è¿›å…¥å›è°ƒå‡½æ•°å°±å‘é€è¿™ä¸ªä¿¡å·</li><li>qnode.cppä¸­ä¸‹æ–¹æ–°èµ·ä¸€è¡Œå»ºç«‹å›è°ƒå‡½æ•°<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::odom_raw_callback</span><span class="params">(<span class="keyword">const</span> nav_msgs::Odometry &amp;msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">emit <span class="title">speed_vel</span><span class="params">(msg.twist.twist.linear.x,msg.twist.twist.linear.y)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>ä¸‰ æ•°æ®ä¼ é€’ç»™ui<br>åœ¨main_window.cppä¸­åˆ›å»ºä¸€ä¸ªconnectä»¥åŠæ§½å‡½æ•°ï¼Œå½“æ”¶åˆ°speed_velä¿¡å·æ—¶æ‰§è¡Œæ§½å‡½æ•°slot_update_dashboard(float,float)ã€‚<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connect(&amp;qnode,SIGNAL(speed_vel(<span class="keyword">float</span>,<span class="keyword">float</span>)),<span class="keyword">this</span>,SLOT(slot_update_dashboard(<span class="keyword">float</span>,<span class="keyword">float</span>)));</span><br></pre></td></tr></table></figure>è¿™ä¸ªæ§½å‡½æ•°ä¼šæŠŠä¿¡å·æºå¸¦é€Ÿåº¦çš„ä¿¡æ¯æå–å‡ºæ¥å¹¶æ˜¾ç¤ºã€‚å¦‚æœå€¼ä¸ºè´Ÿæ•°ï¼Œåˆ™åœ¨æ–‡æœ¬æ¡†ä¸­æ˜¾ç¤ºè´Ÿå‘ã€‚å¦‚æœå€¼ä¸ºæ­£æ•°ï¼Œåˆ™åœ¨æ–‡æœ¬æ¡†ä¸­æ˜¾ç¤ºæ­£å‘ã€‚åŒæ—¶ç”±äºæ˜¾ç¤ºåœ¨ä»ªè¡¨ç›˜ä¸­çš„æ•°æ®æ˜¯å˜ç±³æ¯ç§’æ‰€ä»¥éœ€è¦è¿›è¡Œå•ä½æ¢ç®—ã€‚<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_update_dashboard</span><span class="params">(<span class="keyword">float</span> x,<span class="keyword">float</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;  ui.label_dir_x-&gt;setText(x&gt;<span class="number">0</span>?<span class="string">&quot;æ­£å‘&quot;</span>:<span class="string">&quot;åå‘&quot;</span>);</span><br><span class="line">   ui.label_dir_y-&gt;setText(y&gt;<span class="number">0</span>?<span class="string">&quot;æ­£å‘&quot;</span>:<span class="string">&quot;åå‘&quot;</span>);</span><br><span class="line">   speed_x_dashBoard-&gt;setValue(<span class="built_in">abs</span>(x)*<span class="number">100</span>);</span><br><span class="line">   speed_y_dashBoard-&gt;setValue(<span class="built_in">abs</span>(y)*<span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>æ§½å‡½æ•°åœ¨main_window.hppä¸­çš„public Q_SLOTS:å£°æ˜<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">slot_update_dashboard</span><span class="params">(<span class="keyword">float</span>,<span class="keyword">float</span>)</span></span>;</span><br></pre></td></tr></table></figure></li></ol>           </div>         </details></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><details class="folding-tag" green><summary> ç¯å¢ƒæ­å»º </summary>              <div class='content'>              <p>ç¬¬ä¸€æ­¥<br>åœ¨qtå®˜ç½‘ä¸­ä¸‹è½½linuxç‰ˆæœ¬çš„qtè¿›è¡Œå®‰è£…ï¼Œæ–­ç½‘è·³è¿‡æ³¨å†Œï¼Œé€‰æ‹©gccç¼–è¯‘ã€‚<br>ç¬¬äºŒæ­¥<br>å®‰è£…ä¾èµ–ros-melodic-qt-createå’Œros-melodic-qt-buildã€‚<br>ç¬¬ä¸‰æ­¥<br>åˆ›å»ºqtåŠŸèƒ½åŒ…ã€‚<br>ç¬¬å››æ­¥<br>ç¼–è¯‘ROSå·¥ç¨‹æ‰“å¼€qtcreatorï¼Œåœ¨æ‰“å¼€é¡¹ç›®é€‰æ‹©å·¥ä½œç©ºé—´catkin_qtä¸‹çš„srcæ–‡ä»¶å¤¹é‡Œçš„CmakeList.txtæ–‡ä»¶ã€‚éšåé…ç½®buildç›®å½•ä¸ºå·¥ä½œç©ºé—´ä¸‹çš„buildæ–‡ä»¶å¤¹ã€‚<br>ç¬¬äº”æ­¥<br>ç¼–å†™rosèŠ‚ç‚¹ï¼Œæ­¥éª¤å¤§æ¦‚åˆ†ä¸ºåœ¨èŠ‚ç‚¹åˆå§‹åŒ–å‡½æ•°ä¸­åˆå§‹åŒ–rosèŠ‚ç‚¹ã€åœ¨masterä¸­æ³¨å†ŒèŠ‚ç‚¹ã€å‘å¸ƒè¯é¢˜ã€‚</p>              </div>            </details><details class="folding-tag" blue><summary> ç¼–å†™é”®ç›˜æ§åˆ¶ç•Œé¢ </summary>              <div class='content'>              <p>ç¬¬ä¸€æ­¥uiè®¾è®¡<br>åœ¨uiç•Œé¢è®¾è®¡ä¸­æ”¾ç½®8ä¸ªpush buttonå‚è€ƒrosè‡ªå¸¦çš„æ§åˆ¶èŠ‚ç‚¹ï¼Œåˆ†åˆ«æŠŠè¿™8ä¸ªæŒ‰é’®çš„æ˜¾ç¤ºæ–‡æœ¬ä¸ºuã€iã€oã€j ã€lã€ mã€ ,ã€.ã€‚<br>ç¬¬äºŒæ­¥<br>åœ¨Qnode::initå‡½æ•°ä¸­åˆå§‹åŒ–èŠ‚ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªå‘å¸ƒå™¨cmd_vel_pubç”¨æ¥å‘å¸ƒé€Ÿåº¦æ§åˆ¶è¯é¢˜ï¼Œè¯é¢˜åä¸ºcmd_velã€‚å»ºç«‹å‡½æ•°set_cmd_velï¼Œè¯¥å›è°ƒå‡½æ•°ä¼ å…¥æŒ‰é’®ï¼Œçº¿é€Ÿåº¦ï¼Œè§’é€Ÿåº¦ä¸‰ä¸ªå‚æ•°æ—¶ä¼šæ ¹æ®ç»‘å®šçš„å­—å…¸å¾—åˆ°æ§åˆ¶çš„æ–¹å‘å’Œé€Ÿåº¦ï¼ŒéšåæŠŠæ•°æ®ä¼ ç»™æ¶ˆæ¯ç±»å‹ä¸ºgeometry_msgs::Twistçš„å˜é‡ã€‚éšåé€šè¿‡å‘å¸ƒå™¨æŠŠè¿™ä¸ªæ§åˆ¶è¯é¢˜å‘å¸ƒå‡ºå»ã€‚</p>              </div>            </details><details class="folding-tag" yellow><summary> ç¼–å†™ç”µé‡æ˜¾ç¤ºç•Œé¢ </summary>              <div class='content'>              <p>ç¬¬ä¸€æ­¥uiè®¾è®¡<br>æ”¾ç½®å‡ ä¸ªlabelç”¨æ¥æ˜¾ç¤ºæ–‡å­—ä¸ªå›¾æ ‡ï¼Œæ”¾ç½®ä¸€ä¸ªprogressBaræ˜¾ç¤ºç”µæ± ç”µé‡çš„ç™¾åˆ†æ¯”ã€‚åœ¨resourcesä¸­å³å‡»open in editoræ·»åŠ å›¾ç‰‡æ–¹ä¾¿æ‰“åŒ…<br>ç¬¬äºŒæ­¥<br>åœ¨Qnode::initå‡½æ•°ä¸­åˆå§‹åŒ–èŠ‚ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªè®¢é˜…å™¨power_subç”¨æ¥è®¢é˜…ç”µæ± ä¿¡æ¯çš„è¯é¢˜ï¼Œè¯é¢˜åä¸ºvoltageï¼Œæ”¶åˆ°è¯¥è¯é¢˜åæ‰§è¡Œå›è°ƒå‡½æ•°power_callback,å› ä¸ºéœ€è¦æŠŠä¿¡æ¯æ˜¾ç¤ºåˆ°çª—å£ä¸Šã€‚æ‰€ä»¥åœ¨qnode.hppä¸­å£°æ˜ä¸€ä¸ªä¿¡å·power_velï¼Œå‚æ•°ä¸ºfloatç±»å‹çš„ã€‚ä¸€æ—¦è¿›å…¥å›è°ƒå‡½æ•°å°±å‘é€è¿™ä¸ªä¿¡å·<br>ç¬¬ä¸‰æ­¥<br>åœ¨main_window.cppä¸­åˆ›å»ºä¸€ä¸ªconnectï¼Œå½“æ”¶åˆ°power_velä¿¡å·æ—¶æ‰§è¡Œæ§½å‡½æ•°slot_update_power(float)ã€‚è¿™ä¸ªæ§½å‡½æ•°ä¼šæŠŠä¿¡å·æºå¸¦çš„ä¿¡æ¯æå–å‡ºæ¥å¹¶æ˜¾ç¤ºã€‚æ˜¾ç¤ºç™¾åˆ†æ¯”æ—¶æŠŠ9.6vä½œä¸ºç”µæ± ç”µé‡çš„æœ€å°å€¼ï¼Œ11.7vä½œä¸ºç”µæ± ç”µé‡æœ€å¤§å€¼ã€‚ä¾æ®çš„æ˜¯yahboomå°è½¦ã€‚</p>              </div>            </details><details class="folding-tag" green><summary> ç¼–å†™odomé€Ÿåº¦ä¿¡æ¯æ˜¾ç¤ºç•Œé¢ </summary>              <div class='content'>              <p>ç¬¬ä¸€æ­¥uiè®¾è®¡<br>æ”¾ç½®tabWidgetç”¨æ¥æ”¾ç½®ä¸¤ä¸ªwidget,ä¸€ä¸ªç”¨æ¥æ”¾ç½®xè½´çš„é€Ÿåº¦ä»ªè¡¨ç›˜ï¼Œåå­—ä¸ºwidget_speed_xï¼Œå¦ä¸€ä¸ªç”¨æ¥æ”¾ç½®yè½´çš„é€Ÿåº¦ä»ªè¡¨ç›˜,åå­—ä¸ºwidget_speed_yã€‚æ”¾ç½®å››ä¸ªlabelæ˜¾ç¤ºé€Ÿåº¦çš„æ­£åå‘ã€‚<br>ç¬¬äºŒæ­¥<br>åœ¨Qnode::initå‡½æ•°ä¸­åˆå§‹åŒ–èŠ‚ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªè®¢é˜…å™¨odom_subç”¨æ¥è®¢é˜…odomä¿¡æ¯çš„è¯é¢˜,è¯é¢˜åä¸ºodom,æ”¶åˆ°è¯¥è¯é¢˜åæ‰§è¡Œå›è°ƒå‡½æ•°odom_raw_callbackï¼Œå› ä¸ºéœ€è¦æŠŠä¿¡æ¯æ˜¾ç¤ºåˆ°çª—å£ä¸Šæ‰€ä»¥åœ¨qnode.hppä¸­å£°æ˜ä¸€ä¸ªä¿¡å·speed_vel,ä¸¤ä¸ªå‚æ•°å‡ä¸ºfloat,åˆ†åˆ«ä»£è¡¨xå’Œyæ–¹å‘çš„é€Ÿåº¦ã€‚ä¸€æ—¦è¿›å…¥å›è°ƒå‡½æ•°å°±å‘é€è¿™ä¸ªä¿¡å·ã€‚<br>ç¬¬ä¸‰æ­¥<br>åœ¨main_window.cppä¸­åˆ›å»ºä¸€ä¸ªconnectï¼Œå½“æ”¶åˆ°speed_velä¿¡å·æ—¶æ‰§è¡Œæ§½å‡½æ•°slot_update_dashboard(float,float)ã€‚è¿™ä¸ªæ§½å‡½æ•°ä¼šæŠŠä¿¡å·æºå¸¦é€Ÿåº¦çš„ä¿¡æ¯æå–å‡ºæ¥å¹¶æ˜¾ç¤ºã€‚å¦‚æœå€¼ä¸ºè´Ÿæ•°ï¼Œåˆ™åœ¨æ–‡æœ¬æ¡†ä¸­æ˜¾ç¤ºè´Ÿå‘ã€‚å¦‚æœå€¼ä¸ºæ­£æ•°ï¼Œåˆ™åœ¨æ–‡æœ¬æ¡†ä¸­æ˜¾ç¤ºæ­£å‘ã€‚åŒæ—¶ç”±äºæ˜¾ç¤ºåœ¨ä»ªè¡¨ç›˜ä¸­çš„æ•°æ®æ˜¯å˜ç±³æ¯ç§’æ‰€ä»¥éœ€è¦è¿›è¡Œå•ä½æ¢ç®—ã€‚</p>              </div>            </details><details class="folding-tag" blue><summary> ç¼–å†™æ‘„åƒå¤´ç”»é¢æ˜¾ç¤ºç•Œé¢ </summary>              <div class='content'>              <p>ç¬¬ä¸€æ­¥<br>åœ¨CmakeLists.txtæ–‡ä»¶ä¸­æ·»åŠ ä¸‰ä¸ªä¾èµ–é¡¹cv_bridgeã€image_transportã€sensor_msgs<br>éšååŒ…å«ä¸‰è€…çš„å¤´æ–‡ä»¶ã€‚<br>ç¬¬äºŒæ­¥uiè®¾è®¡<br>æ”¾ç½®ä¸€ä¸ªlabelç”¨æ¥æ˜¾ç¤ºæ‘„åƒå¤´çš„å›¾åƒï¼Œæ”¾ç½®ä¸€ä¸ªLine Editç”¨æ¥è¾“å…¥è®¢é˜…çš„å›¾åƒè¯é¢˜çš„è¯é¢˜åï¼Œæ”¾ç½®ä¸€ä¸ªPush Buttonç”¨æ¥è§¦å‘è®¢é˜…è¯é¢˜çš„ä¿¡å·ã€‚<br>ç¬¬ä¸‰æ­¥<br>åœ¨å¤´æ–‡ä»¶ä¸­å£°æ˜å›¾åƒè¯é¢˜çš„è®¢é˜…è€…å’Œæ”¶åˆ°å›¾åƒè¯é¢˜åçš„å›è°ƒå‡½æ•°ä»¥åŠæŠŠå›¾åƒæ ¼å¼è½¬åŒ–ä¸ºqtæ”¯æŒçš„å›¾åƒæ˜¾ç¤ºçš„å‡½æ•°Mat2QImageã€‚<br>ç¬¬å››æ­¥åœ¨main_window.cppä¸­åˆ›å»ºä¸€ä¸ªconnectï¼Œå½“æ”¶åˆ°æŒ‰é’®çš„ç‚¹å‡»ä¿¡å·æ—¶æ‰§è¡Œæ§½å‡½æ•°slot_sub_image()ã€‚è¿™ä¸ªæ§½å‡½æ•°ä¼šæŠŠLine Editä¸Šçš„æ–‡æœ¬ä¿¡æ¯ä½œä¸ºå‚æ•°ä¼ ç»™æ¥å£å‡½æ•°sub_image(QString topic_name)ï¼Œè€Œè¿™ä¸ªæ¥å£å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªå›¾åƒè¯é¢˜çš„è®¢é˜…å™¨ã€‚å½“æ”¶åˆ°å›¾åƒè¯é¢˜æ—¶æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°æŠŠæ”¶åˆ°çš„å›¾åƒå¤„ç†æˆqtå¯ä»¥æ˜¾ç¤ºçš„å›¾åƒåå‘é€è‡ªå®šä¹‰ä¿¡å·image_val(QImage)ã€‚åœ¨main_window.cppä¸­åˆ›å»ºä¸€ä¸ªconnectï¼Œå½“æ”¶åˆ°image_val(QImage)ä¿¡å·æ—¶æ‰§è¡Œæ§½å‡½æ•°slot_update_image(QImage)ï¼Œè¿™ä¸ªæ§½å‡½æ•°ä¼šæŠŠè¯¥ä¿¡å·æºå¸¦çš„qtå¯ä»¥æ˜¾ç¤ºçš„å›¾åƒå†…å®¹é€šè¿‡setPixmapæ–¹æ³•æ˜¾ç¤ºåˆ°labelä¸­</p>              </div>            </details><details class="folding-tag" yellow><summary> ç¼–å†™å¿«æ·ç»ˆç«¯æ˜¾ç¤ºç•Œé¢ </summary>              <div class='content'>              <p>ç¬¬ä¸€æ­¥<br>åœ¨main_window.hæ–‡ä»¶ä¸­åŒ…å«å¤´æ–‡ä»¶QProcessã€‚<br>ç¬¬äºŒæ­¥uiè®¾è®¡<br>æ”¾ç½®ä¸¤ä¸ªText Editä¸€ä¸ªç”¨æ¥ç»ˆç«¯å‘½ä»¤çš„è¾“å…¥ä¸€ä¸ªç”¨æ¥è¾“å‡ºç»ˆç«¯ä¿¡æ¯ã€‚æ”¾ç½®å‡ ä¸ªlabelç”¨æ¥ç»™ç”¨æˆ·æç¤ºè¯´æ˜ã€‚æ”¾ç½®ä¸€ä¸ªLine Editç”¨æ¥ç»™ç”¨æˆ·é€‰æ‹©å‘½ä»¤ã€‚æ”¾ç½®ä¸¤ä¸ªæŒ‰é’®ï¼Œä¸€ä¸ªç”¨æ¥ç‚¹å‡»æ‰§è¡Œç»ˆç«¯å‘½ä»¤ï¼Œä¸€ä¸ªç”¨æ¥ç¡®å®šè‡ªå·±é€‰æ‹©çš„å‘½ä»¤ã€‚æ­¤å¤–åœ¨ä¸‹é¢å¯ä»¥æ”¾ç½®ä¸€äº›æŒ‰é’®ç”¨æ¥æä¾›å¿«æ·çš„å‘½ä»¤æç¤ºã€‚<br>ç¬¬ä¸‰æ­¥<br>ä½¿ç”¨Qprocessæ–°å»ºå¯¹è±¡quck_cmdï¼Œä½¿ç”¨quick_cmd-&gt;start(â€œbashâ€)æ¥å¼€å¯ç»ˆç«¯ã€‚ä½¿ç”¨quick_cmd-&gt;write(ui.textEdit_cmd-&gt;toPlainText().toLocal8Bit()+â€™\nâ€™)æ¥æ‰§è¡Œå‘½ä»¤ã€‚åœ¨æ­¤æ³¨æ„æ¯æ¬¡ç‚¹å‡»æ‰§è¡Œç»ˆç«¯å‘½ä»¤åæŠŠä¸¤ä¸ªText Edité‡Œçš„æ–‡æœ¬å†…å®¹æ¸…ç©ºã€‚éšåä½¿ç”¨connectå°†ç»ˆç«¯æ‰§è¡Œå‘½ä»¤åçš„æ­£ç¡®ä¿¡æ¯å’Œé”™è¯¯ä¿¡æ¯ä¸€èµ·è¾“å‡ºåˆ°ç¬¬äºŒä¸ªæ–‡æœ¬æ¡†ä¸­ã€‚</p>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-4"><details class="folding-tag" green><summary> ç¼–å†™rvizåŸºç¡€æ˜¾ç¤ºç•Œé¢ </summary>              <div class='content'>              <p>ç¬¬ä¸€æ­¥æ–°å»ºä¸€ä¸ªç±»<br>ç±»çš„åå­—ä¸ºqrvizã€‚ç„¶åæ·»åŠ ä¾èµ–é¡¹rvizå¹¶åŒ…å«ç›¸å…³å¤´æ–‡ä»¶ã€‚åŒ…æ‹¬rvizä¸‹çš„å‡ ä¸ªå¤´æ–‡ä»¶ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/visualization_manager.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/render_panel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/display.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/tool_manager.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/tool.h&gt;</span></span></span><br></pre></td></tr></table></figure><br>ç¬¬äºŒæ­¥uiè®¾è®¡<br>åœ¨ç•Œé¢ä¸­æ”¾ç½®ä¸€ä¸ªTree Widgetç”¨æ¥æ˜¾ç¤ºrvizçš„æ§ä»¶ã€‚éšååœ¨main_window.cppä¸­è®¾ç½®treeWidgetä¸ºä¸¤åˆ—å¹¶éšè—å¤´éƒ¨ã€‚åˆ©ç”¨new QtreeWidgetItem()æ·»åŠ treeWidgetçš„æ¯ä¸€è¡Œçš„ç¬¬ä¸€åˆ—ï¼Œåˆ©ç”¨new QComboBox()åˆ›å»ºComboBoxã€‚åˆ©ç”¨addItemä¸ºComboBoxæ·»åŠ é€‰é¡¹ã€‚åˆ©ç”¨setItemWidgetæŠŠComboBoxæ·»åŠ ä¸ºtree Widgetçš„ç¬¬äºŒåˆ—ã€‚<br>ç¬¬ä¸‰æ­¥<br> åœ¨qrvizç±»çš„æ„é€ å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªrvizçš„æ˜¾ç¤ºå®¹å™¨å¹¶æŠŠè¯¥å®¹å™¨æ·»åŠ åˆ°åˆšåˆšæ”¾ç½®çš„çºµå‘å¸ƒå±€çš„ç•Œé¢ä¸­ã€‚éšååˆ›å»ºä¸€ä¸ªrvizçš„æ§åˆ¶å¯¹è±¡å¹¶åˆå§‹åŒ–Cameraå®ç°æ”¾å¤§ç¼©å°çš„åŠŸèƒ½ã€‚ç„¶ååˆå§‹åŒ–rvizæ§åˆ¶å¯¹è±¡ã€‚<br>ç¬¬å››æ­¥<br>  è®¾ç½®å‚è€ƒåæ ‡ç³»ï¼Œåœ¨treeWidgetç•Œé¢ä¸Šæ·»åŠ ä¸€è¡Œçš„ç¬¬ä¸€åˆ—ä¸ºå‚è€ƒåæ ‡ç³»ï¼Œç¬¬äºŒåˆ—æ”¾ä¸€ä¸ªComboBoxç”¨æ¥ä¾›ç”¨æˆ·é€‰æ‹©ã€‚åœ¨æ­¤å…³é—­ä¸‹æ‹‰æ¡†é˜²æ­¢é—ªé€€ï¼Œå½“è¿æ¥åˆ°masterååœ¨ä½¿èƒ½ä¸‹æ‹‰æ¡†ã€‚ä¸ºä¸‹æ‹‰æ¡†è®¾ç½®å‡ ä¸ªåŸºæœ¬çš„é€‰é¡¹æ¯”å¦‚base_link,mapï¼Œodomç­‰ã€‚åˆ›å»ºä¸€ä¸ªconnectï¼Œå½“æ”¶åˆ°ComboBoxé‡Œçš„æ–‡æœ¬æ”¹å˜ä¿¡å·æ—¶æ‰§è¡Œæ§½å‡½æ•°slot_treewidget_value_change(QString)ã€‚è¿™ä¸ªæ§½å‡½æ•°ä¼šæŠŠComboBoxé‡Œçš„æ–‡æœ¬å†…å®¹ä½œä¸ºå‚æ•°å€¼ç»™Set_FixedFrame(QString Frame_name)å‡½æ•°ã€‚è¯¥å‡½æ•°å¯ä»¥æŠŠrvizæ§åˆ¶å¯¹è±¡çš„å›ºå®šåæ ‡ç³»è®¾ç½®ä¸ºæ–‡æœ¬è®¾ç½®çš„åæ ‡ç³»ã€‚<br>ç¬¬äº”æ­¥æ·»åŠ å›¾å±‚ã€‚<br>æŒ‰ç…§ä¸Šè¿°æ–¹æ³•æ·»åŠ uiç•Œé¢ååˆ›å»ºå›¾å±‚å‡½æ•°Display* createDisplay(const  Qstring&amp; class_lookup_name, const Qstring&amp; name, bool enabled);å…¶ä¸­class_lookup_nameä»£è¡¨å›¾å±‚ç±»åæ¯”å¦‚â€œrviz/Gridâ€ï¼Œâ€œrviz/RobotModelâ€ï¼Œâ€rviz/Mapâ€ï¼Œâ€rviz/LaserScanâ€ç­‰ç­‰ã€‚æœ€åè®¾ç½®å›¾å±‚å±æ€§å‡½æ•°æ¯”å¦‚é¢œè‰²ï¼Œçº¿æ¡å°ºå¯¸ç­‰ï¼Œé€šè¿‡subProp(Qstring prop_name)-&gt;setValue(Qvariant value)è®¾ç½®ã€‚é€šè¿‡ä»¥ä¸ŠåŠæ³•å¯ä»¥å°†rvizæ˜¾ç¤ºçš„å›¾å±‚ç•Œé¢æ·»åŠ è¿›æ¥æ˜¾ç¤º</p>              </div>            </details><details class="folding-tag" blue><summary> ç¼–å†™rvizåˆå§‹çŠ¶æ€ä¼°è®¡ </summary>              <div class='content'>              <p>ç¬¬ä¸€æ­¥æ”¾ç½®ä¸€ä¸ªæŒ‰é’®<br>æ–‡æœ¬æ˜¾ç¤ºä¸ºåˆå§‹çŠ¶æ€ä¼°è®¡ï¼Œå¹¶æ·»åŠ å›¾æ ‡ã€‚<br>ç¬¬äºŒæ­¥<br>åœ¨main_window.cppä¸­åˆ›å»ºä¸€ä¸ªconnectï¼Œå½“æ”¶åˆ°æŒ‰é’®çš„ç‚¹å‡»ä¿¡å·æ—¶æ‰§è¡Œæ§½å‡½æ•°slot_set_start_pose()ï¼Œè¯¥æ§½å‡½æ•°ä¼šæ‰§è¡Œå‡½æ•°Set_Start_Pose()ï¼Œè¯¥å‡½æ•°ä¼šç”Ÿæˆä¸€ä¸ªåˆå§‹çŠ¶æ€ä¼°è®¡çš„rvizå·¥å…·å¯¹è±¡ï¼Œå¹¶æŠŠè¯¥å¯¹è±¡è®¾ç½®ä¸ºå½“å‰ä½¿ç”¨çš„rvizå·¥å…·ã€‚</p>              </div>            </details><details class="folding-tag" yellow><summary> ç¼–å†™rvizå•ç‚¹å¯¼èˆª </summary>              <div class='content'>              <p>æ”¾ç½®ä¸€ä¸ªæŒ‰é’®ï¼Œæ–‡æœ¬æ˜¾ç¤ºä¸ºå•ç‚¹å¯¼èˆªï¼Œå¹¶æ·»åŠ å›¾æ ‡ã€‚åœ¨main_window.cppä¸­åˆ›å»ºä¸€ä¸ªconnectï¼Œå½“æ”¶åˆ°æŒ‰é’®çš„ç‚¹å‡»ä¿¡å·æ—¶æ‰§è¡Œæ§½å‡½æ•°slot_set_goal_pose()ï¼Œè¯¥æ§½å‡½æ•°ä¼šæ‰§è¡Œå‡½æ•°Set_Goal_Pose()ï¼Œè¯¥å‡½æ•°ä¼šç”Ÿæˆä¸€ä¸ªè®¾ç½®ç›®æ ‡ç‚¹çš„rvizå·¥å…·å¯¹è±¡ï¼Œå¹¶è·å–è¯¥å¯¹è±¡çš„å±æ€§å®¹å™¨ï¼Œé€šè¿‡å±æ€§å®¹å™¨å‘å¸ƒå¯¼èˆªç›®æ ‡ç‚¹çš„è¯é¢˜/move_base_simple/goalã€‚éšåæŠŠè¯¥å¯¹è±¡è®¾ç½®ä¸ºå½“å‰ä½¿ç”¨çš„rvizå·¥å…·ã€‚</p>              </div>            </details><details class="folding-tag" blue><summary> ç¼–å†™rvizè®¾ç½®è¿”èˆªç‚¹ </summary>              <div class='content'>              <p>ç¬¬ä¸€æ­¥æ”¾ç½®ä¸€ä¸ªæŒ‰é’®<br>æ–‡æœ¬æ˜¾ç¤ºä¸ºè®¾ç½®è¿”èˆªç‚¹ï¼Œå¹¶æ·»åŠ å›¾æ ‡ã€‚æ”¾ç½®å…­ä¸ªlabelç”¨æ¥æ˜¾ç¤ºå½“å‰amclä¼°è®¡çš„åæ ‡å’Œè¿”èˆªç‚¹åæ ‡ã€‚<br>ç¬¬äºŒæ­¥<br>åœ¨qnode.cppä¸­è®¢é˜…amcl_poseè¯é¢˜ï¼Œä¸€æ—¦æ”¶åˆ°è¯¥è¯é¢˜çš„å†…å®¹æ‰§è¡Œamcl_pose_callbackå›è°ƒå‡½æ•°ã€‚è¯¥å›è°ƒå‡½æ•°ä¼šæŠŠamcl_poseè¯é¢˜é‡Œçš„ä½ç½®ä¿¡æ¯æå–å‡ºæ¥å¹¶å‘é€ä¿¡å·position(double x,double y,double z)ã€‚ åœ¨main_window.cppä¸­åˆ›å»ºä¸€ä¸ªconnectï¼Œå½“æ”¶åˆ°è¯¥ä¿¡å·æ—¶æ‰§è¡Œæ§½å‡½æ•°slot_update_pos(double,double,double)ï¼Œè¯¥æ§½å‡½æ•°ä¼šæŠŠä¿¡å·æºå¸¦çš„ä½ç½®ä¿¡æ¯æ˜¾ç¤ºåˆ°labelä¸Šã€‚<br>ç¬¬ä¸‰æ­¥<br>åœ¨main_window.cppä¸­åˆ›å»ºä¸€ä¸ªconnectï¼Œå½“æ”¶åˆ°æŒ‰é’®çš„ç‚¹å‡»ä¿¡å·æ—¶æ‰§è¡Œæ§½å‡½æ•°slot_set_return_pos()ï¼Œè¯¥æ§½å‡½æ•°ä¼šæŠŠlabelä¸Šæ˜¾ç¤ºçš„amclä¼°è®¡çš„å½“å‰åæ ‡æ˜¾ç¤ºåˆ°ä¸‹é¢ä¸€è¡Œè¿”èˆªç‚¹çš„labelä¸Šã€‚</p>              </div>            </details><details class="folding-tag" green><summary> ç¼–å†™rvizå¼€å§‹è¿”èˆª </summary>              <div class='content'>              <p>ç¬¬ä¸€æ­¥æ”¾ç½®ä¸€ä¸ªæŒ‰é’®<br>æ–‡æœ¬æ˜¾ç¤ºä¸ºå¼€å§‹è¿”èˆªï¼Œå¹¶æ·»åŠ å›¾æ ‡ã€‚<br>ç¬¬äºŒæ­¥<br>åœ¨qnode.cppä¸­åˆ›å»ºå‘å¸ƒå™¨å‘å¸ƒmove_base_simple/goalè¯é¢˜ï¼Œéšåç¼–å†™å‡½æ•°set_goal(double x,double y,double z) ç”¨æ¥å‘å¸ƒç›®æ ‡ç‚¹ã€‚ç¬¬ä¸‰æ­¥åœ¨main_window.cppä¸­åˆ›å»ºä¸€ä¸ªconnectï¼Œå½“æ”¶åˆ°æŒ‰é’®çš„ç‚¹å‡»ä¿¡å·æ—¶æ‰§è¡Œæ§½å‡½æ•°slot_return()ï¼Œè¯¥æ§½å‡½æ•°ä¼šè°ƒç”¨set_goal(double x,double y,double z)æŠŠuiç•Œé¢ä¸Šçš„è¿”èˆªç‚¹åæ ‡çš„labelä¸Šçš„å€¼ä½œä¸ºå‚æ•°å€¼ä¼ ç»™è¯¥å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè°ƒç”¨å‘å¸ƒå™¨å‘å¸ƒç›®æ ‡ç‚¹çš„åæ ‡ã€‚</p>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-5"><p>å·¥ä½œç©ºé—´çš„CMakeLists.txt<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># toplevel CMakeLists.txt for a catkin workspace</span></span><br><span class="line"><span class="meta"># catkin/cmake/toplevel.cmake</span></span><br><span class="line"></span><br><span class="line">cmake_minimum_required(VERSION <span class="number">3.0</span><span class="number">.2</span>)</span><br><span class="line"></span><br><span class="line">project(Project)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CATKIN_TOPLEVEL TRUE)</span><br><span class="line"></span><br><span class="line"><span class="meta"># search for catkin within the workspace</span></span><br><span class="line"><span class="built_in">set</span>(_cmd <span class="string">&quot;catkin_find_pkg&quot;</span> <span class="string">&quot;catkin&quot;</span> <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;&quot;</span>)</span><br><span class="line">execute_process(COMMAND $&#123;_cmd&#125;</span><br><span class="line">  RESULT_VARIABLE _res</span><br><span class="line">  OUTPUT_VARIABLE _out</span><br><span class="line">  ERROR_VARIABLE _err</span><br><span class="line">  OUTPUT_STRIP_TRAILING_WHITESPACE</span><br><span class="line">  ERROR_STRIP_TRAILING_WHITESPACE</span><br><span class="line">)</span><br><span class="line"><span class="keyword">if</span>(NOT _res EQUAL <span class="number">0</span> AND NOT _res EQUAL <span class="number">2</span>)</span><br><span class="line">  <span class="meta"># searching fot catkin resulted in an <span class="meta-keyword">error</span></span></span><br><span class="line">  <span class="built_in">string</span>(REPLACE <span class="string">&quot;;&quot;</span> <span class="string">&quot; &quot;</span> _cmd_str <span class="string">&quot;$&#123;_cmd&#125;&quot;</span>)</span><br><span class="line">  message(FATAL_ERROR <span class="string">&quot;Search for &#x27;catkin&#x27; in workspace failed ($&#123;_cmd_str&#125;): $&#123;_err&#125;&quot;</span>)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> catkin from workspace or via find_package()</span></span><br><span class="line"><span class="keyword">if</span>(_res EQUAL <span class="number">0</span>)</span><br><span class="line">  <span class="built_in">set</span>(catkin_EXTRAS_DIR <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/$&#123;_out&#125;/cmake&quot;</span>)</span><br><span class="line">  <span class="meta"># <span class="meta-keyword">include</span> all.cmake without add_subdirectory to let it operate in same scope</span></span><br><span class="line">  include($&#123;catkin_EXTRAS_DIR&#125;/all.cmake NO_POLICY_SCOPE)</span><br><span class="line">  add_subdirectory(<span class="string">&quot;$&#123;_out&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="meta"># use either CMAKE_PREFIX_PATH explicitly passed to CMake as a command <span class="meta-keyword">line</span> argument</span></span><br><span class="line">  <span class="meta"># or CMAKE_PREFIX_PATH from the environment</span></span><br><span class="line">  <span class="keyword">if</span>(NOT DEFINED CMAKE_PREFIX_PATH)</span><br><span class="line">    <span class="keyword">if</span>(NOT <span class="string">&quot;$ENV&#123;CMAKE_PREFIX_PATH&#125;&quot;</span> STREQUAL <span class="string">&quot;&quot;</span>)</span><br><span class="line">      <span class="keyword">if</span>(NOT WIN32)</span><br><span class="line">        <span class="built_in">string</span>(REPLACE <span class="string">&quot;:&quot;</span> <span class="string">&quot;;&quot;</span> CMAKE_PREFIX_PATH $ENV&#123;CMAKE_PREFIX_PATH&#125;)</span><br><span class="line">      <span class="keyword">else</span>()</span><br><span class="line">        <span class="built_in">set</span>(CMAKE_PREFIX_PATH $ENV&#123;CMAKE_PREFIX_PATH&#125;)</span><br><span class="line">      endif()</span><br><span class="line">    endif()</span><br><span class="line">  endif()</span><br><span class="line"></span><br><span class="line">  <span class="meta"># list of catkin workspaces</span></span><br><span class="line">  <span class="built_in">set</span>(catkin_search_path <span class="string">&quot;&quot;</span>)</span><br><span class="line">  foreach(path $&#123;CMAKE_PREFIX_PATH&#125;)</span><br><span class="line">    <span class="keyword">if</span>(EXISTS <span class="string">&quot;$&#123;path&#125;/.catkin&quot;</span>)</span><br><span class="line">      <span class="built_in">list</span>(FIND catkin_search_path $&#123;path&#125; _index)</span><br><span class="line">      <span class="keyword">if</span>(_index EQUAL <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">list</span>(APPEND catkin_search_path $&#123;path&#125;)</span><br><span class="line">      endif()</span><br><span class="line">    endif()</span><br><span class="line">  endforeach()</span><br><span class="line"></span><br><span class="line">  <span class="meta"># search for catkin in all workspaces</span></span><br><span class="line">  <span class="built_in">set</span>(CATKIN_TOPLEVEL_FIND_PACKAGE TRUE)</span><br><span class="line">  find_package(catkin QUIET</span><br><span class="line">    NO_POLICY_SCOPE</span><br><span class="line">    PATHS $&#123;catkin_search_path&#125;</span><br><span class="line">    NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)</span><br><span class="line">  unset(CATKIN_TOPLEVEL_FIND_PACKAGE)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(NOT catkin_FOUND)</span><br><span class="line">    message(FATAL_ERROR <span class="string">&quot;find_package(catkin) failed. catkin was neither found in the workspace nor in the CMAKE_PREFIX_PATH. One reason may be that no ROS setup.sh was sourced before.&quot;</span>)</span><br><span class="line">  endif()</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line">catkin_workspace()</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>åŠŸèƒ½åŒ…ä¸‹çš„CMakeLists.txt<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">##############################################################################</span><br><span class="line"># CMake</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br><span class="line">cmake_minimum_required(VERSION <span class="number">2.8</span><span class="number">.0</span>)</span><br><span class="line">project(qt_ros_test)</span><br><span class="line"><span class="built_in">set</span>(CMAKE_INCLUDE_CURRENT_DIR ON)</span><br><span class="line">##############################################################################</span><br><span class="line"># Catkin</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br><span class="line"># qt_build provides the qt cmake glue, roscpp the comms <span class="keyword">for</span> a <span class="keyword">default</span> talker</span><br><span class="line">## find_package(catkin REQUIRED COMPONENTS qt_build rviz roscpp)</span><br><span class="line">find_package(catkin REQUIRED COMPONENTS qt_build rviz roscpp sensor_msgs</span><br><span class="line">    cv_bridge</span><br><span class="line">    std_msgs</span><br><span class="line">    image_transport</span><br><span class="line">    )</span><br><span class="line">include_directories($&#123;catkin_INCLUDE_DIRS&#125;)</span><br><span class="line">find_package(Qt5 REQUIRED Core Widgets)</span><br><span class="line"><span class="built_in">set</span>(QT_LIBRARIES Qt5::Widgets)</span><br><span class="line"># Use this to define what the package will export (e.g. libs, headers).</span><br><span class="line"># Since the <span class="keyword">default</span> here is to produce only a binary, we don<span class="number">&#x27;</span>t worry about</span><br><span class="line"><span class="meta"># exporting anything. </span></span><br><span class="line">catkin_package()</span><br><span class="line"></span><br><span class="line">##############################################################################</span><br><span class="line"># Qt Environment</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br><span class="line"># this comes from qt_build&#x27;s qt-ros.cmake which is automatically </span><br><span class="line"><span class="meta"># included via the dependency call in package.xml</span></span><br><span class="line"># rosbuild_prepare_qt4(QtCore QtGui) # Add the appropriate components to the component <span class="built_in">list</span> here</span><br><span class="line"></span><br><span class="line">##############################################################################</span><br><span class="line"># Sections</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br><span class="line">file(GLOB QT_FORMS RELATIVE $&#123;CMAKE_CURRENT_SOURCE_DIR&#125; ui<span class="comment">/*.ui)</span></span><br><span class="line"><span class="comment">file(GLOB QT_RESOURCES RELATIVE $&#123;CMAKE_CURRENT_SOURCE_DIR&#125; resources/*.qrc)</span></span><br><span class="line"><span class="comment">file(GLOB_RECURSE QT_MOC RELATIVE $&#123;CMAKE_CURRENT_SOURCE_DIR&#125; FOLLOW_SYMLINKS include/qt_ros_test/*.hpp)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">QT5_ADD_RESOURCES(QT_RESOURCES_CPP $&#123;QT_RESOURCES&#125;)</span></span><br><span class="line"><span class="comment">QT5_WRAP_UI(QT_FORMS_HPP $&#123;QT_FORMS&#125;)</span></span><br><span class="line"><span class="comment">QT5_WRAP_CPP(QT_MOC_HPP $&#123;QT_MOC&#125;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment"># Sources</span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">file(GLOB_RECURSE QT_SOURCES RELATIVE $&#123;CMAKE_CURRENT_SOURCE_DIR&#125; FOLLOW_SYMLINKS src/*.cpp)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment"># Binaries</span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">add_executable(qt_ros_test $&#123;QT_SOURCES&#125; $&#123;QT_RESOURCES_CPP&#125; $&#123;QT_FORMS_HPP&#125; $&#123;QT_MOC_HPP&#125;)</span></span><br><span class="line"><span class="comment">target_link_libraries(qt_ros_test $&#123;QT_LIBRARIES&#125; $&#123;catkin_LIBRARIES&#125;)</span></span><br><span class="line"><span class="comment">install(TARGETS qt_ros_test RUNTIME DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></figure><br>åŠŸèƒ½åŒ…é‡Œçš„srcä¸‹çš„cpp<br>CCtrlDashBoard.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../include/qt_ros_test/CCtrlDashBoard.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qmath.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">CCtrlDashBoard::CCtrlDashBoard(QWidget *parent, StyleType type) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    m_StyleType(type)</span><br><span class="line">&#123;</span><br><span class="line">    m_BorderColor = QColor(<span class="number">172</span>,<span class="number">172</span>,<span class="number">172</span>);</span><br><span class="line">    m_BgColor = QColor(<span class="number">40</span>,<span class="number">40</span>,<span class="number">40</span>);</span><br><span class="line">    m_FrontColor = Qt::white;</span><br><span class="line"></span><br><span class="line">    m_DashValue= <span class="number">0</span>;</span><br><span class="line">    m_MinValue = <span class="number">0</span>;</span><br><span class="line">    m_MaxValue = <span class="number">100</span>;</span><br><span class="line">    m_DashNum = <span class="number">1</span>;</span><br><span class="line">    m_LineLength=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    m_StartAngle=<span class="number">90</span>;  <span class="comment">//510</span></span><br><span class="line">    m_EndAngle=<span class="number">0</span>;   <span class="comment">//120</span></span><br><span class="line">    update();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawBackGround</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_MaxBorderRadius = ((hlafWidth*<span class="number">5</span>)/<span class="number">6</span>);</span><br><span class="line">    qreal startX=hlafWidth-m_MaxBorderRadius;</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;setPen(m_BorderColor);</span><br><span class="line">    painter-&gt;setBrush(m_BorderColor);</span><br><span class="line"></span><br><span class="line">    QPainterPath bigCircle;</span><br><span class="line">    bigCircle.addEllipse(startX, startX, (m_MaxBorderRadius*<span class="number">2</span>), (m_MaxBorderRadius*<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    m_MinBorderRadius = m_MaxBorderRadius<span class="number">-15</span>;</span><br><span class="line">    startX=hlafWidth-m_MinBorderRadius;</span><br><span class="line">    QPainterPath smallCircle;</span><br><span class="line">    smallCircle.addEllipse(startX, startX, (m_MinBorderRadius*<span class="number">2</span>), (m_MinBorderRadius*<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    QPainterPath path = bigCircle - smallCircle;</span><br><span class="line">    painter-&gt;drawPath(path);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;setBrush(m_BgColor);</span><br><span class="line">    painter-&gt;drawEllipse(startX,startX,(m_MinBorderRadius*<span class="number">2</span>), (m_MinBorderRadius*<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">if</span>(m_DashValue==<span class="number">0</span>)&#123;</span><br><span class="line">      QString speed = <span class="string">&quot;0.0 cm/s&quot;</span>;</span><br><span class="line">      painter-&gt;drawText(startX+<span class="number">85</span>,startX+<span class="number">170</span>,speed);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      QString speed = QString::number(m_DashValue).mid(<span class="number">0</span>,<span class="number">3</span>) + <span class="string">&quot; cm/s&quot;</span>;</span><br><span class="line">      painter-&gt;drawText(startX+<span class="number">85</span>,startX+<span class="number">170</span>,speed);</span><br><span class="line">    &#125;</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">    m_DialsRadius = m_MinBorderRadius<span class="number">-10</span>;</span><br><span class="line">    <span class="keyword">if</span>(m_DialsRadius &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        m_DialsRadius=<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawScaleDials</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qreal tSteps = (m_MaxValue - m_MinValue)/m_DashNum; <span class="comment">//ç›¸ä¹˜åçš„å€¼æ˜¯åˆ†çš„ä»½æ•°</span></span><br><span class="line">    qreal angleStep = <span class="number">1.0</span>*(<span class="number">360.0</span>-m_StartAngle - m_EndAngle) / tSteps; <span class="comment">//æ¯ä¸€ä¸ªä»½æ•°çš„è§’åº¦</span></span><br><span class="line">    QPen pen ;</span><br><span class="line">    pen.setColor(m_FrontColor); <span class="comment">//æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹å¼</span></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle);</span><br><span class="line">    m_LineLength = (hlafWidth/<span class="number">16</span>);</span><br><span class="line">    qreal lineStart = m_DialsRadius<span class="number">-4</span>*m_LineLength-m_LineLength;</span><br><span class="line">    qreal lineSmStart = m_DialsRadius<span class="number">-4</span>*m_LineLength-m_LineLength/<span class="number">2</span>;</span><br><span class="line">    qreal lineEnd = m_DialsRadius<span class="number">-4</span>*m_LineLength;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tSteps; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">80</span>) pen.setColor(QColor(<span class="number">250</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">10</span> == <span class="number">0</span>)<span class="comment">//æ•´æ•°åˆ»åº¦æ˜¾ç¤ºåŠ ç²—</span></span><br><span class="line">        &#123;</span><br><span class="line">            pen.setWidth(<span class="number">2</span>); <span class="comment">//è®¾ç½®çº¿å®½</span></span><br><span class="line">            painter-&gt;setPen(pen); <span class="comment">//ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ€æƒ³ï¼ŒæŠŠç”»ç¬”å…³è”ä¸Šç”»å®¶ã€‚é€šè¿‡ç”»å®¶ç”»å‡ºæ¥</span></span><br><span class="line">            painter-&gt;drawLine(lineStart,lineStart, lineEnd, lineEnd); <span class="comment">//ä¸¤ä¸ªå‚æ•°åº”è¯¥æ˜¯ä¸¤ä¸ªåæ ‡å€¼</span></span><br><span class="line">            <span class="comment">//painter-&gt;drawText(lineEnd+6,lineEnd+6, tr(&quot;%1&quot;).arg(m_MinValue+i));</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            pen.setWidth(<span class="number">1</span>);</span><br><span class="line">            painter-&gt;setPen(pen);</span><br><span class="line">            painter-&gt;drawLine(lineSmStart, lineSmStart, lineEnd, lineEnd); <span class="comment">//ä¸¤ä¸ªå‚æ•°åº”è¯¥æ˜¯ä¸¤ä¸ªåæ ‡å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">        painter-&gt;rotate(angleStep);</span><br><span class="line">    &#125;</span><br><span class="line">    pen.setColor(m_FrontColor);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;setPen(pen);</span><br><span class="line">    <span class="comment">//m_startAngleæ˜¯èµ·å§‹è§’åº¦ï¼Œm_endAngleæ˜¯ç»“æŸè§’åº¦ï¼Œm_scaleMajoråœ¨ä¸€ä¸ªé‡ç¨‹ä¸­åˆ†æˆçš„åˆ»åº¦æ•°</span></span><br><span class="line">    qreal startRad = ( <span class="number">315</span>-m_StartAngle) * (<span class="number">3.14</span> / <span class="number">180</span>);</span><br><span class="line">    qreal deltaRad = (<span class="number">360</span>-m_StartAngle - m_EndAngle) * (<span class="number">3.14</span> / <span class="number">180</span>) / tSteps;</span><br><span class="line">    qreal sina,cosa;</span><br><span class="line">    qreal x, y;</span><br><span class="line">    <span class="function">QFontMetricsF <span class="title">fm</span><span class="params">(<span class="keyword">this</span>-&gt;font())</span></span>;</span><br><span class="line">    <span class="keyword">double</span> w, h, tmpVal;</span><br><span class="line">    QString str;</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    lineEnd = m_MinBorderRadius<span class="number">-8</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tSteps; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">10</span> == <span class="number">0</span>)<span class="comment">//æ•´æ•°åˆ»åº¦æ˜¾ç¤ºåŠ ç²—</span></span><br><span class="line">        &#123;</span><br><span class="line">            sina = qSin(startRad - i * deltaRad);</span><br><span class="line">            cosa = <span class="built_in">cos</span>(startRad - i * deltaRad);</span><br><span class="line"></span><br><span class="line">            tmpVal = <span class="number">1.0</span> * i *((m_MaxValue - m_MinValue) / tSteps) + m_MinValue;</span><br><span class="line">            str = QString( <span class="string">&quot;%1&quot;</span> ).arg(tmpVal);  <span class="comment">//%1ä½œä¸ºå ä½ç¬¦   arg()å‡½æ•°æ¯”èµ· sprintf()æ¥æ˜¯ç±»å‹å®‰å…¨çš„</span></span><br><span class="line">            w = fm.size(Qt::TextSingleLine,str).width();</span><br><span class="line">            h = fm.size(Qt::TextSingleLine,str).height();</span><br><span class="line">            x = lineEnd * cosa - w / <span class="number">2</span>;</span><br><span class="line">            y = -lineEnd * sina + h / <span class="number">4</span>;</span><br><span class="line">            painter-&gt;drawText(x, y, str); <span class="comment">//å‡½æ•°çš„å‰ä¸¤ä¸ªå‚æ•°æ˜¯æ˜¾ç¤ºçš„åæ ‡ä½ç½®ï¼Œåä¸€ä¸ªæ˜¯æ˜¾ç¤ºçš„å†…å®¹ï¼Œæ˜¯å­—ç¬¦ç±»å‹&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawIndicator</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QPolygon pts;</span><br><span class="line">    pts.setPoints(<span class="number">3</span>, <span class="number">-8</span>,<span class="number">0</span>, <span class="number">8</span>,<span class="number">0</span>, <span class="number">0</span>,(<span class="keyword">int</span>)m_DialsRadius<span class="number">-20</span>); <span class="comment">/* (-2,0)/(2,0)/(0,60) */</span><span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ ï¼Œåæ ‡çš„ä¸ªæ•°ã€‚åè¾¹çš„æ˜¯åæ ‡</span></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth, hlafWidth);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle<span class="number">-45</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(m_DashValue&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        qreal tSteps = (m_MaxValue - m_MinValue)/m_DashNum; <span class="comment">//ç›¸ä¹˜åçš„å€¼æ˜¯åˆ†çš„ä»½æ•°</span></span><br><span class="line">        qreal angleStep = <span class="number">1.0</span>*(<span class="number">360.0</span>-m_StartAngle - m_EndAngle) / tSteps; <span class="comment">//æ¯ä¸€ä¸ªä»½æ•°çš„è§’åº¦</span></span><br><span class="line">        <span class="keyword">double</span> degRotate = angleStep*tSteps*(m_DashValue/<span class="number">100.0</span>)+angleStep;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”»æŒ‡é’ˆ</span></span><br><span class="line">        <span class="comment">//qDebug() &lt;&lt;&quot;degRotate ==&quot;&lt;&lt;degRotate&lt;&lt;&quot;m_DashValue ==&quot;&lt;&lt;m_DashValue&lt;&lt;m_StartAngle&lt;&lt;m_DialsRadius&lt;&lt;hlafWidth;</span></span><br><span class="line">        <span class="keyword">if</span>(m_DashValue == <span class="number">99</span>)&#123;</span><br><span class="line">            painter-&gt;rotate(m_EndAngle-m_StartAngle);  <span class="comment">//é¡ºæ—¶é’ˆæ—‹è½¬åæ ‡ç³»ç»Ÿ</span></span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            painter-&gt;rotate(degRotate);  <span class="comment">//é¡ºæ—¶é’ˆæ—‹è½¬åæ ‡ç³»ç»Ÿ</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QRadialGradient <span class="title">haloGradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, hlafWidth/<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>;  <span class="comment">//è¾å°„æ¸å˜</span></span><br><span class="line">    haloGradient.setColorAt(<span class="number">0</span>, QColor(<span class="number">255</span>,<span class="number">69</span>,<span class="number">0</span>));</span><br><span class="line">    haloGradient.setColorAt(<span class="number">1</span>, QColor(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    painter-&gt;setPen(Qt::white); <span class="comment">//å®šä¹‰çº¿æ¡æ–‡æœ¬é¢œè‰²  è®¾ç½®çº¿æ¡çš„é¢œè‰²</span></span><br><span class="line">    painter-&gt;setBrush(haloGradient);<span class="comment">//åˆ·å­å®šä¹‰å½¢çŠ¶å¦‚ä½•å¡«æ»¡ å¡«å……åçš„é¢œè‰²</span></span><br><span class="line">    painter-&gt;drawConvexPolygon(pts); <span class="comment">//è¿™æ˜¯ä¸ªé‡è½½å‡½æ•°ï¼Œç»˜åˆ¶å¤šè¾¹å½¢ã€‚</span></span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”»ä¸­å¿ƒç‚¹</span></span><br><span class="line">    <span class="function">QColor <span class="title">niceBlue</span><span class="params">(<span class="number">150</span>, <span class="number">150</span>, <span class="number">200</span>)</span></span>;</span><br><span class="line">    <span class="function">QConicalGradient <span class="title">coneGradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-90.0</span>)</span></span>;  <span class="comment">//è§’åº¦æ¸å˜</span></span><br><span class="line">    coneGradient.setColorAt(<span class="number">0.0</span>, Qt::darkGray);</span><br><span class="line">    coneGradient.setColorAt(<span class="number">0.2</span>, niceBlue);</span><br><span class="line">    coneGradient.setColorAt(<span class="number">0.5</span>, Qt::white);</span><br><span class="line">    coneGradient.setColorAt(<span class="number">1.0</span>, Qt::darkGray);</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    painter-&gt;setPen(Qt::NoPen);  <span class="comment">//æ²¡æœ‰çº¿ï¼Œå¡«æ»¡æ²¡æœ‰è¾¹ç•Œ</span></span><br><span class="line">    painter-&gt;setBrush(coneGradient);</span><br><span class="line">    painter-&gt;drawEllipse(<span class="number">-10</span>, <span class="number">-10</span>, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::drawIndicatorBar</span><span class="params">(QPainter *painter, qreal hlafWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ¸å˜è‰²</span></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth,hlafWidth);</span><br><span class="line">    qreal lineEnd = m_DialsRadius<span class="number">-3</span>*m_LineLength;</span><br><span class="line">    <span class="function">QRadialGradient <span class="title">gradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, lineEnd)</span></span>;</span><br><span class="line">    gradient.setColorAt(<span class="number">0</span>, Qt::white);</span><br><span class="line">    gradient.setColorAt(<span class="number">1.0</span>, Qt::blue);</span><br><span class="line">    painter-&gt;setBrush(gradient);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &lt;&lt; 1ï¼ˆå·¦ç§»1ä½ï¼‰ç›¸å½“äºradius*2 å³ï¼š150*2=300</span></span><br><span class="line">    <span class="comment">//QRectF(-150, -150, 300, 300)</span></span><br><span class="line">    <span class="function">QRectF <span class="title">rect</span><span class="params">(-lineEnd, -lineEnd, lineEnd*<span class="number">2</span>, lineEnd*<span class="number">2</span>)</span></span>;</span><br><span class="line">    QPainterPath path;</span><br><span class="line">    path.arcTo(rect, m_StartAngle, <span class="number">270</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// QRectF(-120, -120, 240, 240)</span></span><br><span class="line">    QPainterPath subPath;</span><br><span class="line">    subPath.addEllipse(rect.adjusted(<span class="number">10</span>, <span class="number">10</span>, <span class="number">-10</span>, <span class="number">-10</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// pathä¸ºæ‰‡å½¢ subPathä¸ºæ¤­åœ†</span></span><br><span class="line">    path -= subPath;</span><br><span class="line">    painter-&gt;setPen(Qt::NoPen);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle+<span class="number">45</span>);</span><br><span class="line">    painter-&gt;drawPath(path);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    qreal degRotate=<span class="number">0.1</span>;</span><br><span class="line">    <span class="keyword">if</span>(m_DashValue&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        qreal tSteps = (m_MaxValue - m_MinValue)/m_DashNum; <span class="comment">//ç›¸ä¹˜åçš„å€¼æ˜¯åˆ†çš„ä»½æ•°</span></span><br><span class="line">        qreal angleStep = <span class="number">1.0</span>*(<span class="number">360.0</span>-m_StartAngle - m_EndAngle) / tSteps; <span class="comment">//æ¯ä¸€ä¸ªä»½æ•°çš„è§’åº¦</span></span><br><span class="line">        degRotate = angleStep*tSteps*(m_DashValue/<span class="number">100.0</span>)+angleStep;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”»æŒ‡é’ˆ</span></span><br><span class="line">        <span class="comment">//qDebug() &lt;&lt;&quot;degRotate ==&quot;&lt;&lt;degRotate&lt;&lt;&quot;m_DashValue ==&quot;&lt;&lt;m_DashValue&lt;&lt;m_StartAngle&lt;&lt;m_DialsRadius&lt;&lt;hlafWidth;</span></span><br><span class="line">        <span class="comment">/*if(m_DashValue == 99)&#123;</span></span><br><span class="line"><span class="comment">            painter-&gt;rotate(m_EndAngle-m_StartAngle);  //é¡ºæ—¶é’ˆæ—‹è½¬åæ ‡ç³»ç»Ÿ</span></span><br><span class="line"><span class="comment">        &#125;else</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            painter-&gt;rotate(degRotate);  //é¡ºæ—¶é’ˆæ—‹è½¬åæ ‡ç³»ç»Ÿ</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth, hlafWidth);</span><br><span class="line"></span><br><span class="line">    <span class="function">QRadialGradient <span class="title">ftGradient</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, lineEnd)</span></span>;</span><br><span class="line">    ftGradient.setColorAt(<span class="number">0</span>, Qt::white);</span><br><span class="line">    ftGradient.setColorAt(<span class="number">1.0</span>, Qt::darkYellow);</span><br><span class="line">    painter-&gt;setBrush(ftGradient);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &lt;&lt; 1ï¼ˆå·¦ç§»1ä½ï¼‰ç›¸å½“äºradius*2 å³ï¼š150*2=300</span></span><br><span class="line">    <span class="comment">//QRectF(-150, -150, 300, 300)</span></span><br><span class="line">    <span class="function">QRectF <span class="title">ftRect</span><span class="params">(-lineEnd, -lineEnd, lineEnd*<span class="number">2</span>, lineEnd*<span class="number">2</span>)</span></span>;</span><br><span class="line">    QPainterPath ftPath;</span><br><span class="line">    ftPath.arcTo(ftRect, m_EndAngle-m_StartAngle, -degRotate);</span><br><span class="line">    <span class="comment">// pathä¸ºæ‰‡å½¢ subPathä¸ºæ¤­åœ†</span></span><br><span class="line">    ftPath -= subPath;</span><br><span class="line">    painter-&gt;rotate(m_StartAngle<span class="number">-45</span>);</span><br><span class="line">    painter-&gt;drawPath(ftPath);</span><br><span class="line">    painter-&gt;restore();</span><br><span class="line"></span><br><span class="line">    QPolygon pts;</span><br><span class="line">    <span class="keyword">int</span> pointLength=lineEnd<span class="number">-12</span>;</span><br><span class="line">    pts.setPoints(<span class="number">3</span>, <span class="number">-6</span>,pointLength<span class="number">-10</span>, <span class="number">6</span>,pointLength<span class="number">-10</span>, <span class="number">0</span>,pointLength);</span><br><span class="line">    painter-&gt;save();</span><br><span class="line">    painter-&gt;translate(hlafWidth, hlafWidth);</span><br><span class="line">    painter-&gt;rotate(m_StartAngle<span class="number">-45</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(m_DashValue == <span class="number">99</span>)&#123;</span><br><span class="line">        painter-&gt;rotate(m_EndAngle-m_StartAngle);  <span class="comment">//é¡ºæ—¶é’ˆæ—‹è½¬åæ ‡ç³»ç»Ÿ</span></span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        painter-&gt;rotate(degRotate);  <span class="comment">//é¡ºæ—¶é’ˆæ—‹è½¬åæ ‡ç³»ç»Ÿ</span></span><br><span class="line">    &#125;</span><br><span class="line">    painter-&gt;setPen(Qt::white); <span class="comment">//å®šä¹‰çº¿æ¡æ–‡æœ¬é¢œè‰²  è®¾ç½®çº¿æ¡çš„é¢œè‰²</span></span><br><span class="line">    painter-&gt;setBrush(Qt::blue);<span class="comment">//åˆ·å­å®šä¹‰å½¢çŠ¶å¦‚ä½•å¡«æ»¡ å¡«å……åçš„é¢œè‰²</span></span><br><span class="line">    painter-&gt;drawConvexPolygon(pts); <span class="comment">//è¿™æ˜¯ä¸ªé‡è½½å‡½æ•°ï¼Œç»˜åˆ¶å¤šè¾¹å½¢ã€‚</span></span><br><span class="line">    painter-&gt;restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CCtrlDashBoard::paintEvent</span><span class="params">(QPaintEvent * event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">p</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    qreal width = qMin((<span class="keyword">this</span>-&gt;width()&gt;&gt;<span class="number">1</span>), (<span class="keyword">this</span>-&gt;height()&gt;&gt;<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    p.setRenderHints(QPainter::Antialiasing|QPainter::TextAntialiasing);</span><br><span class="line"></span><br><span class="line">    drawBackGround(&amp;p, width);</span><br><span class="line"></span><br><span class="line">    drawScaleDials(&amp;p, width);</span><br><span class="line">    <span class="keyword">switch</span>(m_StyleType)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> ST_DEFAULT:</span><br><span class="line">        drawIndicator(&amp;p, width);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> ST_ARCBAR:</span><br><span class="line">        drawIndicatorBar(&amp;p, width);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>main.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file /src/main.cpp</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @brief Qt based gui.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @date November 2010</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Includes</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtGui&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../include/qt_ros_test/main_window.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Main</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*********************</span></span><br><span class="line"><span class="comment">    ** Qt</span></span><br><span class="line"><span class="comment">    **********************/</span></span><br><span class="line">    <span class="function">QApplication <span class="title">app</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    <span class="function">qt_ros_test::MainWindow <span class="title">w</span><span class="params">(argc,argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    w.show();</span><br><span class="line">    app.connect(&amp;app, SIGNAL(lastWindowClosed()), &amp;app, SLOT(quit()));</span><br><span class="line">    <span class="keyword">int</span> result = app.exec();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>main_window.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file /src/main_window.cpp</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @brief Implementation for the qt gui.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @date February 2011</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Includes</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtGui&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QMessageBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../include/qt_ros_test/main_window.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Namespaces</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> qt_ros_test &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Qt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Implementation [MainWindow]</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line">MainWindow::MainWindow(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv, QWidget *parent)</span><br><span class="line">: QMainWindow(parent)</span><br><span class="line">, qnode(argc,argv)</span><br><span class="line">&#123;</span><br><span class="line">ui.setupUi(<span class="keyword">this</span>); <span class="comment">// Calling this incidentally connects all ui&#x27;s triggers to on_...() callbacks in this class.</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;loadStyleSheet(<span class="string">&quot;://images/myStyleSheet1.qss&quot;</span>);</span><br><span class="line">    QObject::connect(ui.actionAbout_Qt, SIGNAL(triggered(<span class="keyword">bool</span>)), qApp, SLOT(aboutQt())); <span class="comment">// qApp is a global variable for the application</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ReadSettings();</span><br><span class="line">    setWindowIcon(QIcon(<span class="string">&quot;://images/icon1.png&quot;</span>));</span><br><span class="line">ui.tab_manager-&gt;setCurrentIndex(<span class="number">0</span>); <span class="comment">// ensure the first tab is showing - qt-designer should have this already hardwired, but often loses it (settings?).</span></span><br><span class="line">    QObject::connect(&amp;qnode, SIGNAL(rosShutdown()), <span class="keyword">this</span>, SLOT(close()));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*********************</span></span><br><span class="line"><span class="comment">** Logging</span></span><br><span class="line"><span class="comment">**********************/</span></span><br><span class="line">ui.view_logging-&gt;setModel(qnode.loggingModel());</span><br><span class="line">    QObject::connect(&amp;qnode, SIGNAL(loggingUpdated()), <span class="keyword">this</span>, SLOT(updateLoggingView()));</span><br><span class="line">    <span class="comment">/*********************</span></span><br><span class="line"><span class="comment">    ** Auto Start</span></span><br><span class="line"><span class="comment">    **********************/</span></span><br><span class="line">    <span class="keyword">if</span> ( ui.checkbox_remember_settings-&gt;isChecked() ) &#123;</span><br><span class="line">        on_button_connect_clicked(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    connect(ui.horizontalSlider_linera,SIGNAL(valueChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_linera_change(<span class="keyword">int</span>)));</span><br><span class="line">    connect(ui.horizontalSlider_raw,SIGNAL(valueChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_raw_change(<span class="keyword">int</span>)));</span><br><span class="line">    connect(ui.pushButton_u,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_i,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_o,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_j,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_l,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_m,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_1,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    connect(ui.pushButton_2,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_pushbtn_click()));</span><br><span class="line">    <span class="comment">//init ui</span></span><br><span class="line">     speed_x_dashBoard=<span class="keyword">new</span> CCtrlDashBoard(ui.widget_speed_x);</span><br><span class="line">     speed_y_dashBoard=<span class="keyword">new</span> CCtrlDashBoard(ui.widget_speed_y);</span><br><span class="line">     speed_x_dashBoard-&gt;setGeometry(ui.widget_speed_x-&gt;rect());</span><br><span class="line">     speed_y_dashBoard-&gt;setGeometry(ui.widget_speed_y-&gt;rect());</span><br><span class="line">     speed_x_dashBoard-&gt;setValue(<span class="number">0</span>);</span><br><span class="line">     speed_y_dashBoard-&gt;setValue(<span class="number">0</span>);</span><br><span class="line">     ui.horizontalSlider_linera-&gt;setValue(<span class="number">20</span>);</span><br><span class="line">     ui.horizontalSlider_raw-&gt;setValue(<span class="number">20</span>);</span><br><span class="line">     <span class="comment">//header</span></span><br><span class="line">     ui.treeWidget-&gt;setHeaderLabels(QStringList()&lt;&lt;<span class="string">&quot;åŠŸèƒ½&quot;</span>&lt;&lt;<span class="string">&quot;é€‰é¡¹&quot;</span>);</span><br><span class="line">     ui.treeWidget-&gt;setHeaderHidden(<span class="literal">true</span>);</span><br><span class="line">     <span class="comment">//GLobal Options</span></span><br><span class="line">     QTreeWidgetItem* Global=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;Global Options&quot;</span>);</span><br><span class="line">     Global-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/options.png&quot;</span>));</span><br><span class="line">     ui.treeWidget-&gt;addTopLevelItem(Global);</span><br><span class="line">     Global-&gt;setExpanded(<span class="literal">true</span>);</span><br><span class="line">     <span class="comment">//FixFrame</span></span><br><span class="line">     QTreeWidgetItem* Fixed_frame=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å‚è€ƒåæ ‡ç³»&quot;</span>);</span><br><span class="line">     fixed_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">     fixed_box-&gt;addItem(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">     <span class="comment">// å…³é—­ä¸‹æ‹‰æ¡†é˜²æ­¢é—ªé€€</span></span><br><span class="line">     fixed_box-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">     fixed_box-&gt;addItem(<span class="string">&quot;base_link&quot;</span>);</span><br><span class="line">     fixed_box-&gt;addItem(<span class="string">&quot;base_laser_link&quot;</span>);</span><br><span class="line">     fixed_box-&gt;addItem(<span class="string">&quot;base_footprint&quot;</span>);</span><br><span class="line">     fixed_box-&gt;addItem(<span class="string">&quot;odom&quot;</span>);</span><br><span class="line">     fixed_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">     fixed_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">     connect(fixed_box,SIGNAL(currentTextChanged(QString)),<span class="keyword">this</span>,SLOT(slot_treewidget_value_change(QString)));</span><br><span class="line">     Global-&gt;addChild(Fixed_frame);</span><br><span class="line">     ui.treeWidget-&gt;setItemWidget(Fixed_frame,<span class="number">1</span>,fixed_box);</span><br><span class="line">     <span class="comment">//Grid</span></span><br><span class="line">     QTreeWidgetItem* Grid=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å›¾å±‚/æ …æ ¼&quot;</span>);</span><br><span class="line">     <span class="comment">//è®¾ç½®å›¾æ ‡</span></span><br><span class="line">     Grid-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/&#x27;grid.png&#x27;&quot;</span>));</span><br><span class="line">       <span class="comment">//checkbox</span></span><br><span class="line">         Grid_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">         Grid_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">         connect(Grid_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_grid(<span class="keyword">int</span>)));</span><br><span class="line">      <span class="comment">//æ·»åŠ topèŠ‚ç‚¹</span></span><br><span class="line">         ui.treeWidget-&gt;addTopLevelItem(Grid);</span><br><span class="line">      <span class="comment">//æ·»åŠ checkbox</span></span><br><span class="line">         ui.treeWidget-&gt;setItemWidget(Grid,<span class="number">1</span>,Grid_Check);</span><br><span class="line">      <span class="comment">//è®¾ç½®gridé»˜è®¤å±•å¼€çŠ¶æ€</span></span><br><span class="line">         Grid-&gt;setExpanded(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">         <span class="comment">//æ·»åŠ Cell Countå­èŠ‚ç‚¹</span></span><br><span class="line">         QTreeWidgetItem* Cell_Count=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;æ …æ ¼ä¸ªæ•°&quot;</span>);</span><br><span class="line">         Grid-&gt;addChild(Cell_Count);</span><br><span class="line">         <span class="comment">//CellCountæ·»åŠ SpinBox</span></span><br><span class="line">         Cell_Count_Box=<span class="keyword">new</span> QSpinBox();</span><br><span class="line">         Cell_Count_Box-&gt;setValue(<span class="number">7</span>);</span><br><span class="line">         <span class="comment">//è®¾ç½®Spinboxçš„å®½åº¦</span></span><br><span class="line">         Cell_Count_Box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">         ui.treeWidget-&gt;setItemWidget(Cell_Count,<span class="number">1</span>,Cell_Count_Box);</span><br><span class="line"></span><br><span class="line">         <span class="comment">//æ·»åŠ colorå­èŠ‚ç‚¹</span></span><br><span class="line">         QTreeWidgetItem* Grid_Color=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;æ …æ ¼é¢œè‰²&quot;</span>);</span><br><span class="line">         Grid-&gt;addChild(Grid_Color);</span><br><span class="line">         <span class="comment">//Coloræ·»åŠ ComboBox</span></span><br><span class="line">         Grid_Color_Box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">         Grid_Color_Box-&gt;addItem(<span class="string">&quot;0;160;160&quot;</span>);</span><br><span class="line">         <span class="comment">//è®¾ç½®Combooxå¯ç¼–è¾‘</span></span><br><span class="line">         Grid_Color_Box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">         <span class="comment">//è®¾ç½®Comboxçš„å®½åº¦</span></span><br><span class="line">         Grid_Color_Box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(Grid_Color,<span class="number">1</span>,Grid_Color_Box);</span><br><span class="line">         <span class="comment">//TF ui</span></span><br><span class="line">         QTreeWidgetItem* TF=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å›¾å±‚/TF&quot;</span>);</span><br><span class="line">         <span class="comment">//è®¾ç½®å›¾æ ‡</span></span><br><span class="line">         TF-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/moverotate.svg&quot;</span>));</span><br><span class="line">         <span class="comment">//checkbox</span></span><br><span class="line">         TF_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">         TF_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">         connect(TF_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_tf(<span class="keyword">int</span>)));</span><br><span class="line">         <span class="comment">//å‘Treewidgetæ·»åŠ TF TopèŠ‚ç‚¹</span></span><br><span class="line">         ui.treeWidget-&gt;addTopLevelItem(TF);</span><br><span class="line">         <span class="comment">//å‘TFæ·»åŠ checkbox</span></span><br><span class="line">         ui.treeWidget-&gt;setItemWidget(TF,<span class="number">1</span>,TF_Check);</span><br><span class="line">         <span class="comment">//LaserScan ui</span></span><br><span class="line">         QTreeWidgetItem* LaserScan=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å›¾å±‚/é›·è¾¾&quot;</span>);</span><br><span class="line">         <span class="comment">//è®¾ç½®å›¾æ ‡</span></span><br><span class="line">         LaserScan-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/default_class_icon.png&quot;</span>));</span><br><span class="line">         <span class="comment">//checkbox</span></span><br><span class="line">         Laser_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">         Laser_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">         connect(Laser_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_laser(<span class="keyword">int</span>)));</span><br><span class="line">         <span class="comment">//å‘Treewidgetæ·»åŠ laserscan TopèŠ‚ç‚¹</span></span><br><span class="line">         ui.treeWidget-&gt;addTopLevelItem(LaserScan);</span><br><span class="line">         <span class="comment">//å‘laserscanæ·»åŠ checkbox</span></span><br><span class="line">         ui.treeWidget-&gt;setItemWidget(LaserScan,<span class="number">1</span>,Laser_Check);</span><br><span class="line">         <span class="comment">//laser topic</span></span><br><span class="line">         QTreeWidgetItem* LaserTopic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;è®¢é˜…è¯é¢˜&quot;</span>);</span><br><span class="line">         Laser_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">         Laser_Topic_box-&gt;addItem(<span class="string">&quot;/scan&quot;</span>);</span><br><span class="line">         Laser_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">         Laser_Topic_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">         LaserScan-&gt;addChild(LaserTopic);</span><br><span class="line">         ui.treeWidget-&gt;setItemWidget(LaserTopic,<span class="number">1</span>,Laser_Topic_box);</span><br><span class="line"></span><br><span class="line">         <span class="comment">//RobotModel ui</span></span><br><span class="line">         QTreeWidgetItem* RobotModel=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å›¾å±‚/æœºå™¨äººæ¨¡å‹&quot;</span>);</span><br><span class="line">         <span class="comment">//è®¾ç½®å›¾æ ‡</span></span><br><span class="line">         RobotModel-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/robot.png&quot;</span>));</span><br><span class="line">         <span class="comment">//checkbox</span></span><br><span class="line">         RobotModel_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">         RobotModel_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">         connect(RobotModel_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_RobotModel(<span class="keyword">int</span>)));</span><br><span class="line">         <span class="comment">//å‘Treewidgetæ·»åŠ TF TopèŠ‚ç‚¹</span></span><br><span class="line">         ui.treeWidget-&gt;addTopLevelItem(RobotModel);</span><br><span class="line">         <span class="comment">//å‘TFæ·»åŠ checkbox</span></span><br><span class="line">         ui.treeWidget-&gt;setItemWidget(RobotModel,<span class="number">1</span>,RobotModel_Check);</span><br><span class="line">         <span class="comment">//Map ui</span></span><br><span class="line">          QTreeWidgetItem* Map=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å›¾å±‚/åœ°å›¾&quot;</span>);</span><br><span class="line">          <span class="comment">//è®¾ç½®å›¾æ ‡</span></span><br><span class="line">          Map-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/crosshair.svg&quot;</span>));</span><br><span class="line">          <span class="comment">//checkbox</span></span><br><span class="line">          Map_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">          Map_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">          connect(Map_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_Map(<span class="keyword">int</span>)));</span><br><span class="line">          <span class="comment">//å‘Treewidgetæ·»åŠ Map TopèŠ‚ç‚¹</span></span><br><span class="line">          ui.treeWidget-&gt;addTopLevelItem(Map);</span><br><span class="line">          <span class="comment">//å‘Mapæ·»åŠ checkbox</span></span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(Map,<span class="number">1</span>,Map_Check);</span><br><span class="line">          <span class="comment">//Map topic</span></span><br><span class="line">          QTreeWidgetItem* MapTopic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;è®¢é˜…è¯é¢˜&quot;</span>);</span><br><span class="line">          Map_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Map_Topic_box-&gt;addItem(<span class="string">&quot;/map&quot;</span>);</span><br><span class="line">          Map_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Map_Topic_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Map-&gt;addChild(MapTopic);</span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(MapTopic,<span class="number">1</span>,Map_Topic_box);</span><br><span class="line">          <span class="comment">//Map color scheme</span></span><br><span class="line">          QTreeWidgetItem* MapColorScheme=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;åœ°å›¾æ ·å¼&quot;</span>);</span><br><span class="line">          Map_Color_Scheme_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Map_Color_Scheme_box-&gt;addItem(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">          Map_Color_Scheme_box-&gt;addItem(<span class="string">&quot;costmap&quot;</span>);</span><br><span class="line">          Map_Color_Scheme_box-&gt;addItem(<span class="string">&quot;raw&quot;</span>);</span><br><span class="line">          Map_Color_Scheme_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Map-&gt;addChild(MapColorScheme);</span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(MapColorScheme,<span class="number">1</span>,Map_Color_Scheme_box);</span><br><span class="line">          <span class="comment">//Path ui</span></span><br><span class="line">          QTreeWidgetItem* Path=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å›¾å±‚/è·¯å¾„&quot;</span>);</span><br><span class="line">          <span class="comment">//è®¾ç½®å›¾æ ‡</span></span><br><span class="line">          Path-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/move1d.svg&quot;</span>));</span><br><span class="line">          <span class="comment">//checkbox</span></span><br><span class="line">          Path_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">          Path_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">          connect(Path_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_Path(<span class="keyword">int</span>)));</span><br><span class="line">          <span class="comment">//å‘Treewidgetæ·»åŠ Path TopèŠ‚ç‚¹</span></span><br><span class="line">          ui.treeWidget-&gt;addTopLevelItem(Path);</span><br><span class="line">          <span class="comment">//å‘Pathæ·»åŠ checkbox</span></span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(Path,<span class="number">1</span>,Path_Check);</span><br><span class="line">          <span class="comment">//Path topic</span></span><br><span class="line">          QTreeWidgetItem* PathTopic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;è®¢é˜…è¯é¢˜&quot;</span>);</span><br><span class="line">          Path_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Path_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/GlobalPlanner/plan&quot;</span>);</span><br><span class="line">          Path_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/TebLocalPlannerROS/global_plan&quot;</span>);</span><br><span class="line">          Path_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/TebLocalPlannerROS/local_plan&quot;</span>);</span><br><span class="line">          Path_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/DWAPlannerROS/local_plan&quot;</span>);</span><br><span class="line">          Path_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/DWAPlannerROS/global_plan&quot;</span>);</span><br><span class="line">          Path_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Path_Topic_box-&gt;setMaximumWidth(<span class="number">300</span>);</span><br><span class="line">          Path-&gt;addChild(PathTopic);</span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(PathTopic,<span class="number">1</span>,Path_Topic_box);</span><br><span class="line">          <span class="comment">//Path color scheme</span></span><br><span class="line">          QTreeWidgetItem* PathColorScheme=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;è·¯å¾„é¢œè‰²&quot;</span>);</span><br><span class="line">          Path_Color_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Path_Color_box-&gt;addItem(<span class="string">&quot;0;12;255&quot;</span>);</span><br><span class="line">          Path_Color_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Path_Color_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Path-&gt;addChild(PathColorScheme);</span><br><span class="line">          ui.treeWidget-&gt;setItemWidget(PathColorScheme,<span class="number">1</span>,Path_Color_box);</span><br><span class="line">          <span class="comment">//å¯¼èˆªtreeWidget</span></span><br><span class="line">          <span class="comment">//header</span></span><br><span class="line">          ui.treeWidget_2-&gt;setHeaderLabels(QStringList()&lt;&lt;<span class="string">&quot;åŠŸèƒ½&quot;</span>&lt;&lt;<span class="string">&quot;é€‰é¡¹&quot;</span>);</span><br><span class="line">          <span class="comment">// TreeWidget è‡ªåŠ¨åˆ—å®½</span></span><br><span class="line">          ui.treeWidget_2-&gt;header()-&gt;setSectionResizeMode(QHeaderView::ResizeToContents);</span><br><span class="line"></span><br><span class="line">          ui.treeWidget_2-&gt;setHeaderHidden(<span class="literal">true</span>);</span><br><span class="line">          <span class="comment">//GLobal Options</span></span><br><span class="line">          QTreeWidgetItem* na=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å¯¼èˆªæ˜¾ç¤º&quot;</span>);</span><br><span class="line">          na-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/options.png&quot;</span>));</span><br><span class="line">          ui.treeWidget_2-&gt;addTopLevelItem(na);</span><br><span class="line">          na-&gt;setExpanded(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//*******æœºå™¨äººNavigate ç›¸å…³UI********************************</span></span><br><span class="line">          <span class="comment">//Golabal Map***************************************</span></span><br><span class="line">          QTreeWidgetItem* GlobalMap=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å…¨å±€åœ°å›¾&quot;</span>);</span><br><span class="line">          GlobalMap-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/crosshair.svg&quot;</span>));</span><br><span class="line">          GlobalMap_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">          GlobalMap_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">          connect(GlobalMap_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_global_map(<span class="keyword">int</span>)));</span><br><span class="line">          ui.treeWidget_2-&gt;addTopLevelItem(GlobalMap);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(GlobalMap,<span class="number">1</span>,GlobalMap_Check);</span><br><span class="line">          GlobalMap-&gt;setExpanded(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          <span class="comment">//Global CostMap</span></span><br><span class="line">          QTreeWidgetItem* Global_CostMap=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å…¨å±€ä»£ä»·åœ°å›¾&quot;</span>);</span><br><span class="line">          <span class="comment">//è®¾ç½®å›¾æ ‡</span></span><br><span class="line">          Global_CostMap-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/classes/Map.png&quot;</span>));</span><br><span class="line">          <span class="comment">//Global Mapæ·»åŠ å­èŠ‚ç‚¹</span></span><br><span class="line">          GlobalMap-&gt;addChild(Global_CostMap);</span><br><span class="line">          <span class="comment">//Map topic</span></span><br><span class="line">          QTreeWidgetItem* Global_CostMap_Topic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;è®¢é˜…è¯é¢˜&quot;</span>);</span><br><span class="line">          Global_CostMap_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Global_CostMap_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/global_costmap/costmap&quot;</span>);</span><br><span class="line"></span><br><span class="line">          Global_CostMap_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Global_CostMap_Topic_box-&gt;setMaximumWidth(<span class="number">300</span>);</span><br><span class="line">          Global_CostMap-&gt;addChild(Global_CostMap_Topic);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(Global_CostMap_Topic,<span class="number">1</span>,Global_CostMap_Topic_box);</span><br><span class="line">          <span class="comment">//Map color scheme</span></span><br><span class="line">          QTreeWidgetItem* GlobalMapColorScheme=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;åœ°å›¾æ ·å¼&quot;</span>);</span><br><span class="line">          GlobalMapColorScheme_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          GlobalMapColorScheme_box-&gt;addItem(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">          GlobalMapColorScheme_box-&gt;addItem(<span class="string">&quot;costmap&quot;</span>);</span><br><span class="line">          GlobalMapColorScheme_box-&gt;addItem(<span class="string">&quot;raw&quot;</span>);</span><br><span class="line">          GlobalMapColorScheme_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Global_CostMap-&gt;addChild(GlobalMapColorScheme);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(GlobalMapColorScheme,<span class="number">1</span>,GlobalMapColorScheme_box);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//Global Planner</span></span><br><span class="line">          QTreeWidgetItem* Global_Planner=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å…¨å±€è·¯å¾„&quot;</span>);</span><br><span class="line">          <span class="comment">//è®¾ç½®å›¾æ ‡</span></span><br><span class="line">          Global_Planner-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/classes/Path.png&quot;</span>));</span><br><span class="line">          <span class="comment">//å‘TGlobal Mapæ·»åŠ Path TopèŠ‚ç‚¹</span></span><br><span class="line">          GlobalMap-&gt;addChild(Global_Planner);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//Path topic</span></span><br><span class="line">          QTreeWidgetItem* Global_Planner_Topic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;è®¢é˜…è¯é¢˜&quot;</span>);</span><br><span class="line">          Global_Planner_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Global_Planner_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/TebLocalPlannerROS/global_plan&quot;</span>);</span><br><span class="line">          Global_Planner_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/DWAPlannerROS/global_plan&quot;</span>);</span><br><span class="line">          Global_Planner_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/GlobalPlanner/plan&quot;</span>);</span><br><span class="line">          Global_Planner_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Global_Planner_Topic_box-&gt;setMaximumWidth(<span class="number">300</span>);</span><br><span class="line">          Global_Planner-&gt;addChild(Global_Planner_Topic);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(Global_Planner_Topic,<span class="number">1</span>,Global_Planner_Topic_box);</span><br><span class="line">          <span class="comment">//Path color scheme</span></span><br><span class="line">          QTreeWidgetItem* Global_Planner_Color_Scheme=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;è·¯å¾„é¢œè‰²&quot;</span>);</span><br><span class="line">          Global_Planner_Color_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Global_Planner_Color_box-&gt;addItem(<span class="string">&quot;255;0;0&quot;</span>);</span><br><span class="line">          Global_Planner_Color_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Global_Planner_Color_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Global_Planner-&gt;addChild(Global_Planner_Color_Scheme);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(Global_Planner_Color_Scheme,<span class="number">1</span>,Global_Planner_Color_box);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//Local Map***********************************************</span></span><br><span class="line">          QTreeWidgetItem* LocalMap=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å±€éƒ¨åœ°å›¾&quot;</span>);</span><br><span class="line">          LocalMap-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/crosshair.svg&quot;</span>));</span><br><span class="line">          LocalMap_Check=<span class="keyword">new</span> QCheckBox();</span><br><span class="line">          LocalMap_Check-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">          connect(LocalMap_Check,SIGNAL(stateChanged(<span class="keyword">int</span>)),<span class="keyword">this</span>,SLOT(slot_display_local_map(<span class="keyword">int</span>)));</span><br><span class="line">          ui.treeWidget_2-&gt;addTopLevelItem(LocalMap);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(LocalMap,<span class="number">1</span>,LocalMap_Check);</span><br><span class="line">          LocalMap-&gt;setExpanded(<span class="literal">true</span>);</span><br><span class="line">          <span class="comment">//Local CostMap</span></span><br><span class="line">          QTreeWidgetItem* Local_CostMap=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å±€éƒ¨ä»£ä»·åœ°å›¾&quot;</span>);</span><br><span class="line">          <span class="comment">//è®¾ç½®å›¾æ ‡</span></span><br><span class="line">          Local_CostMap-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/classes/Map.png&quot;</span>));</span><br><span class="line">          <span class="comment">//Local Mapæ·»åŠ å­èŠ‚ç‚¹</span></span><br><span class="line">          LocalMap-&gt;addChild(Local_CostMap);</span><br><span class="line">          <span class="comment">//Map topic</span></span><br><span class="line">          QTreeWidgetItem* Local_CostMap_Topic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;è®¢é˜…è¯é¢˜&quot;</span>);</span><br><span class="line">          Local_CostMap_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Local_CostMap_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/local_costmap/costmap&quot;</span>);</span><br><span class="line">          Local_CostMap_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Local_CostMap_Topic_box-&gt;setMaximumWidth(<span class="number">300</span>);</span><br><span class="line">          Local_CostMap-&gt;addChild(Local_CostMap_Topic);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(Local_CostMap_Topic,<span class="number">1</span>,Local_CostMap_Topic_box);</span><br><span class="line">          <span class="comment">//Map color scheme</span></span><br><span class="line">          QTreeWidgetItem* LocalMapColorScheme=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;åœ°å›¾æ ·å¼&quot;</span>);</span><br><span class="line">          LocalMapColorScheme_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          LocalMapColorScheme_box-&gt;addItem(<span class="string">&quot;costmap&quot;</span>);</span><br><span class="line">          LocalMapColorScheme_box-&gt;addItem(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">          LocalMapColorScheme_box-&gt;addItem(<span class="string">&quot;raw&quot;</span>);</span><br><span class="line">          LocalMapColorScheme_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Local_CostMap-&gt;addChild(LocalMapColorScheme);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(LocalMapColorScheme,<span class="number">1</span>,LocalMapColorScheme_box);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//Local Planner</span></span><br><span class="line">          QTreeWidgetItem* Local_Planner=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;å±€éƒ¨è·¯å¾„&quot;</span>);</span><br><span class="line">          <span class="comment">//è®¾ç½®å›¾æ ‡</span></span><br><span class="line">          Local_Planner-&gt;setIcon(<span class="number">0</span>,QIcon(<span class="string">&quot;://images/classes/Path.png&quot;</span>));</span><br><span class="line">          <span class="comment">//å‘TLocal Mapæ·»åŠ Path TopèŠ‚ç‚¹</span></span><br><span class="line">          LocalMap-&gt;addChild(Local_Planner);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//Path topic</span></span><br><span class="line">          QTreeWidgetItem* Local_Planner_Topic=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;è®¢é˜…è¯é¢˜&quot;</span>);</span><br><span class="line">          Local_Planner_Topic_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Local_Planner_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/TebLocalPlannerROS/local_plan&quot;</span>);</span><br><span class="line">          Local_Planner_Topic_box-&gt;addItem(<span class="string">&quot;/move_base/DWAPlannerROS/local_plan&quot;</span>);</span><br><span class="line">          Local_Planner_Topic_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Local_Planner_Topic_box-&gt;setMaximumWidth(<span class="number">300</span>);</span><br><span class="line">          Local_Planner-&gt;addChild(Local_Planner_Topic);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(Local_Planner_Topic,<span class="number">1</span>,Local_Planner_Topic_box);</span><br><span class="line">          <span class="comment">//Path color scheme</span></span><br><span class="line">          QTreeWidgetItem* Local_Planner_Color_Scheme=<span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">&quot;è·¯å¾„é¢œè‰²&quot;</span>);</span><br><span class="line">          Local_Planner_Color_box=<span class="keyword">new</span> QComboBox();</span><br><span class="line">          Local_Planner_Color_box-&gt;addItem(<span class="string">&quot;0;12;255&quot;</span>);</span><br><span class="line">          Local_Planner_Color_box-&gt;setEditable(<span class="literal">true</span>);</span><br><span class="line">          Local_Planner_Color_box-&gt;setMaximumWidth(<span class="number">150</span>);</span><br><span class="line">          Local_Planner-&gt;addChild(Local_Planner_Color_Scheme);</span><br><span class="line">          ui.treeWidget_2-&gt;setItemWidget(Local_Planner_Color_Scheme,<span class="number">1</span>,Local_Planner_Color_box);</span><br><span class="line"> <span class="comment">//**********************************************************************************************</span></span><br><span class="line">     connect(&amp;qnode,SIGNAL(speed_vel(<span class="keyword">float</span>,<span class="keyword">float</span>)),<span class="keyword">this</span>,SLOT(slot_update_dashboard(<span class="keyword">float</span>,<span class="keyword">float</span>)));</span><br><span class="line">     connect(&amp;qnode,SIGNAL(power_vel(<span class="keyword">float</span>)),<span class="keyword">this</span>,SLOT(slot_update_power(<span class="keyword">float</span>)));</span><br><span class="line">     connect(&amp;qnode,SIGNAL(image_val(QImage)),<span class="keyword">this</span>,SLOT(slot_update_image(QImage)));</span><br><span class="line">     connect(ui.pushButton_sub_image,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_sub_image()));</span><br><span class="line">     connect(&amp;qnode,SIGNAL(position(<span class="keyword">double</span>,<span class="keyword">double</span>,<span class="keyword">double</span>)),<span class="keyword">this</span>,SLOT(slot_update_pos(<span class="keyword">double</span>,<span class="keyword">double</span>,<span class="keyword">double</span>)));</span><br><span class="line">     <span class="comment">//set start and goal pose</span></span><br><span class="line">     connect(ui.set_start_btn,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_set_start_pose()));</span><br><span class="line">     connect(ui.set_goal_btn,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_set_goal_pose()));</span><br><span class="line">     <span class="comment">// set return pose</span></span><br><span class="line">     connect(ui.set_return_pos_btn,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_set_return_pos()));</span><br><span class="line">     connect(ui.return_btn,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_return()));</span><br><span class="line">    <span class="comment">//cmd</span></span><br><span class="line">    connect(ui.cmd_btn,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_clicked()));</span><br><span class="line">    connect(ui.cmd_home,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_home_clicked()));</span><br><span class="line">    connect(ui.cmd_pei,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_pei_clicked()));</span><br><span class="line">    connect(ui.cmd_message,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_message_clicked()));</span><br><span class="line">    connect(ui.cmd_topic,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_topic_clicked()));</span><br><span class="line">    connect(ui.cmd_topic_content,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_topic_content_clicked()));</span><br><span class="line">    connect(ui.cmd_pubtopic,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_pubtopic_clicked()));</span><br><span class="line">    connect(ui.cmd_node,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_node_clicked()));</span><br><span class="line">    connect(ui.cmd_plot,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_plot_clicked()));</span><br><span class="line">    connect(ui.cmd_slam,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_slam_clicked()));</span><br><span class="line">    connect(ui.cmd_saver_map,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_saver_map_clicked()));</span><br><span class="line">    connect(ui.cmd_pub_map,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_pub_map_clicked()));</span><br><span class="line">    connect(ui.cmd_amcl,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_amcl_clicked()));</span><br><span class="line">    connect(ui.cmd_choose,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_choose_clicked()));</span><br><span class="line">    connect(ui.cmd_hector,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_hector_clicked()));</span><br><span class="line">    connect(ui.cmd_cartographer,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_cartographer_clicked()));</span><br><span class="line">    connect(ui.cmd_dijkstra_teb,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_dijkstra_teb_clicked()));</span><br><span class="line">    connect(ui.cmd_dijkstra_DWA,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_dijkstra_DWA_clicked()));</span><br><span class="line">    connect(ui.cmd_A_teb,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_A_teb_clicked()));</span><br><span class="line">    connect(ui.cmd_A_DWA,SIGNAL(clicked()),<span class="keyword">this</span>,SLOT(slot_cmd_A_DWA_clicked()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//***********cmd*****</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_choose_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(cmd_saver_map_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;rosrun map_server map_saver -f &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_saver_map_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_pub_map_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;rosrun map_server map_server &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_pub_map_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_amcl_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_amcl_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_slam_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_slam_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_hector_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_hector_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(cmd_cartographer_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_cartographer_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_dijkstra_teb_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_dijkstra_teb_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(cmd_dijkstra_DWA_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_dijkstra_DWA_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_A_teb_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_A_teb_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(cmd_A_DWA_flag==<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       ui.textEdit_cmd-&gt;append(<span class="string">&quot;roslaunch &quot;</span> + ui.lineEdit_cmd-&gt;text());</span><br><span class="line">       cmd_A_DWA_flag=<span class="number">0</span>;</span><br><span class="line">       ui.lineEdit_cmd-&gt;clear();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_A_DWA_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;robot_navigation move_base.launch use_dijkstra:=false planner:=dwa&quot;</span>);</span><br><span class="line">    cmd_A_DWA_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_A_teb_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;robot_navigation move_base.launch use_dijkstra:=false planner:=teb&quot;</span>);</span><br><span class="line">   cmd_A_teb_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_dijkstra_DWA_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;robot_navigation move_base.launch planner:=dwa&quot;</span>);</span><br><span class="line">   cmd_dijkstra_DWA_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_dijkstra_teb_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;robot_navigation move_base.launch planner:=teb&quot;</span>);</span><br><span class="line">   cmd_dijkstra_teb_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_cartographer_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;è¯·å…ˆè¿›è¡Œä»¥ä¸‹æ“ä½œ&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;å®‰è£…cartographer:https://blog.csdn.net/wxc_1998/article/details/122802419&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;roscd cartographer_ros&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æ‰¾åˆ°è¿™ä¸ªåŒ…é‡Œçš„configuration_filesæ–‡ä»¶å¤¹é‡Œçš„revo_lds.luaå¤åˆ¶å†…å®¹&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æ–°å»º configæ–‡ä»¶å¤¹å’Œrevo_lds.luaæ–‡ä»¶ç²˜è´´å†…å®¹å¹¶ä¿®æ”¹&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;tracking_frameæ›´æ”¹ä¸ºæˆ‘ä»¬æœºå™¨äººçš„åŸºåæ ‡tfï¼Œä¸€èˆ¬æ˜¯base_footprint&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;odom_frameæ›´æ”¹ä¸ºodom&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æŒ‰ç…§map-&gt;odom_frame-&gt;publisher_frame-&gt;tracking_frame&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;published_frameæ›´æ”¹ä¸ºodom&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;use_odometryæ›´æ”¹ä¸ºtrue&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;provide_odom_frameæ›´æ”¹ä¸ºfalse&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;odometry_sampling_ratioæ›´æ”¹ä¸º0.1&quot;</span>);</span><br><span class="line"></span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;roscd cartographer_ros&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æ‰¾åˆ°è¿™ä¸ªåŒ…é‡Œçš„launchæ–‡ä»¶å¤¹é‡Œçš„demo_revo_lds.launchå¤åˆ¶å†…å®¹&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æ–°å»º launch æ–‡ä»¶ç²˜è´´å†…å®¹å¹¶ä¿®æ”¹&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æ›´æ”¹ä¸‹é¢çš„configuration_directoryä¸ºåˆšåˆšé…ç½®æ–‡ä»¶çš„åŒ…å’Œç›®å½•&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æ›´æ”¹ä¸‹é¢çš„configuration_basenameä¸ºåˆšåˆšé…ç½®æ–‡ä»¶çš„åå­—&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;remap from=\&quot;scan\&quot; to=\&quot;scan\&quot;/&gt;&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;remap from=\&quot;odom\&quot; to=\&quot;odom\&quot;/&gt;&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;åˆ é™¤å€’æ•°ç¬¬ä¸€ä¸ªç¬¬äºŒä¸ªnodeæ ‡ç­¾&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;node pkg=\&quot;joint_state_publisher\&quot; name=\&quot;joint_state_publisher\&quot; type=\&quot;joint_state_publisher\&quot; /&gt;&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;node pkg=\&quot;robot_state_publisher\&quot; name=\&quot;robot_state_publisher\&quot; type=\&quot;robot_state_publisher\&quot; /&gt;&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æœ€åä¸¤ä¸ªåœ¨æ•´ä¸ªç¨‹åºä¸­å¿…é¡»è¢«å¯åŠ¨ï¼Œå¦åˆ™æ— æ³•æ­£ç¡®æ˜¾ç¤ºæœºå™¨äººæ¨¡å‹&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;ç„¶åè¾“å…¥ä½ ç¼–å†™cartographerå»ºå›¾å¯åŠ¨çš„launchæ–‡ä»¶æ‰€åœ¨çš„åŠŸèƒ½åŒ…åå’Œlaunchæ–‡ä»¶åæ¯”å¦‚&quot;</span>);</span><br><span class="line">     ui.textEdit_quick_output-&gt;append(<span class="string">&quot;nav_demo nav03_slam.launch &quot;</span>);</span><br><span class="line">     cmd_hector_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_hector_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;è¯·å…ˆè¿›è¡Œä»¥ä¸‹æ“ä½œ&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;å®‰è£… hector-slamåŒ…(ç”¨äºæ„å»ºåœ°å›¾):sudo apt install ros-ROSç‰ˆæœ¬-hector-slam&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;å®‰è£…åœ°å›¾æœåŠ¡åŒ…(ç”¨äºä¿å­˜ä¸è¯»å–åœ°å›¾):sudo apt install ros-ROSç‰ˆæœ¬-map-server&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;å®‰è£… navigation åŒ…(ç”¨äºå®šä½ä»¥åŠè·¯å¾„è§„åˆ’):sudo apt install ros-ROSç‰ˆæœ¬-navigation&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æ–°å»ºåŠŸèƒ½åŒ…ï¼Œå¹¶å¯¼å…¥ä¾èµ–: hector_slam map_server amcl move_base&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æ–°å»º launch æ–‡ä»¶&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;å¤åˆ¶ https://www.guyuehome.com/42755 launch æ–‡ä»¶å†…å®¹&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;åˆ é™¤ç¬¬äºŒä¸ªç¬¬ä¸‰ä¸ªnodeæ ‡ç­¾&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;åšå¦‚ä¸‹ä¿®æ”¹å’Œæ·»åŠ &quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;param name=\&quot;base_frame\&quot; value=\&quot;base_footprint\&quot;/&gt;&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;param name=\&quot;odom_frame\&quot; value=\&quot;odom\&quot;/&gt;&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;node pkg=\&quot;joint_state_publisher\&quot; name=\&quot;joint_state_publisher\&quot; type=\&quot;joint_state_publisher\&quot; /&gt;&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;node pkg=\&quot;robot_state_publisher\&quot; name=\&quot;robot_state_publisher\&quot; type=\&quot;robot_state_publisher\&quot; /&gt;&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æœ€åä¸¤ä¸ªåœ¨æ•´ä¸ªç¨‹åºä¸­å¿…é¡»è¢«å¯åŠ¨ï¼Œå¦åˆ™æ— æ³•æ­£ç¡®æ˜¾ç¤ºæœºå™¨äººæ¨¡å‹&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;ç„¶åè¾“å…¥ä½ ç¼–å†™hectorå»ºå›¾å¯åŠ¨çš„launchæ–‡ä»¶æ‰€åœ¨çš„åŠŸèƒ½åŒ…åå’Œlaunchæ–‡ä»¶åæ¯”å¦‚&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;nav_demo nav02_slam.launch &quot;</span>);</span><br><span class="line">    cmd_hector_flag =<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_slam_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;è¯·å…ˆè¿›è¡Œä»¥ä¸‹æ“ä½œ&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;å®‰è£… gmappingåŒ…(ç”¨äºæ„å»ºåœ°å›¾):sudo apt install ros-ROSç‰ˆæœ¬-gmapping&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;å®‰è£…åœ°å›¾æœåŠ¡åŒ…(ç”¨äºä¿å­˜ä¸è¯»å–åœ°å›¾):sudo apt install ros-ROSç‰ˆæœ¬-map-server&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;å®‰è£… navigation åŒ…(ç”¨äºå®šä½ä»¥åŠè·¯å¾„è§„åˆ’):sudo apt install ros-ROSç‰ˆæœ¬-navigation&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æ–°å»ºåŠŸèƒ½åŒ…ï¼Œå¹¶å¯¼å…¥ä¾èµ–: gmapping map_server amcl move_base&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æ–°å»º launch æ–‡ä»¶&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;å¤åˆ¶ https://github.com/ros-perception/slam_gmapping/blob/melodic-devel/gmapping/launch/slam_gmapping_pr2.launch æ–‡ä»¶å†…å®¹&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;ç¼–å†™æ–°çš„launchæ–‡ä»¶åšå¦‚ä¸‹ä¿®æ”¹å’Œæ·»åŠ &quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;remap from=\&quot;scan\&quot; to=\&quot;scan\&quot;/&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;param name=\&quot;base_frame\&quot; value=\&quot;base_footprint\&quot;/&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;param name=\&quot;odom_frame\&quot; value=\&quot;odom\&quot;/&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;node pkg=\&quot;joint_state_publisher\&quot; name=\&quot;joint_state_publisher\&quot; type=\&quot;joint_state_publisher\&quot; /&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;node pkg=\&quot;robot_state_publisher\&quot; name=\&quot;robot_state_publisher\&quot; type=\&quot;robot_state_publisher\&quot; /&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æœ€åä¸¤ä¸ªåœ¨æ•´ä¸ªç¨‹åºä¸­å¿…é¡»è¢«å¯åŠ¨ï¼Œå¦åˆ™æ— æ³•æ­£ç¡®æ˜¾ç¤ºæœºå™¨äººæ¨¡å‹&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;ç„¶åè¾“å…¥ä½ ç¼–å†™gmappingå»ºå›¾å¯åŠ¨çš„launchæ–‡ä»¶æ‰€åœ¨çš„åŠŸèƒ½åŒ…åå’Œlaunchæ–‡ä»¶åæ¯”å¦‚&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;nav_demo nav01_slam.launch &quot;</span>);</span><br><span class="line">   cmd_slam_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_amcl_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;è¯·å…ˆè¿›è¡Œä»¥ä¸‹æ“ä½œ&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;sudo apt install ros-ROSç‰ˆæœ¬-navigation&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æ–°å»ºåŠŸèƒ½åŒ…ï¼Œå¹¶å¯¼å…¥ä¾èµ–: amcl move_base&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;æ‰§è¡Œroscd amcl å’Œls examples ,æ–°å»º launch æ–‡ä»¶ï¼Œå¤åˆ¶ amcl_diff.launch æ–‡ä»¶å†…å®¹ç¼–å†™æ–°çš„launchæ–‡ä»¶&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;åœ¨&lt;param name=\&quot;odom_frame_id\&quot; value=\&quot;odom\&quot;/&gt;ä¸‹æ·»åŠ &quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;param name=\&quot;base_frame_id\&quot; value=\&quot;base_footprint\&quot;/&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;param name=\&quot;global_frame_id\&quot; value=\&quot;map\&quot;/&gt;&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;å®Œæˆåè¯·ç¡®ä¿ä½ å·²ç»å¯åŠ¨å‘å¸ƒåœ°å›¾ï¼Œæœºå™¨äººæ¨¡å‹&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;ç„¶åè¾“å…¥ä½ ç¼–å†™amclå¯åŠ¨çš„launchæ–‡ä»¶æ‰€åœ¨çš„åŠŸèƒ½åŒ…åå’Œlaunchæ–‡ä»¶åæ¯”å¦‚&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;nav_demo amcl.launch&quot;</span>);</span><br><span class="line">   cmd_amcl_flag=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_pub_map_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;è¯·åœ¨é€‰æ‹©æ¡†è¾“å…¥åç‚¹å‡»ç¡®å®š&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;è¯·è¾“å…¥ä½ è¦å‘å¸ƒåœ°å›¾çš„åœ°å€,æ¯”å¦‚&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;~/catkin_ws/src/map/my_map.yaml&quot;</span>);</span><br><span class="line">    cmd_pub_map_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_saver_map_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;è¯·åœ¨é€‰æ‹©æ¡†è¾“å…¥åç‚¹å‡»ç¡®å®š&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;è¯·è¾“å…¥ä½ è¦ä¿å­˜åœ°å›¾çš„åœ°å€,æ¯”å¦‚&quot;</span>);</span><br><span class="line">   ui.textEdit_quick_output-&gt;append(<span class="string">&quot;~/catkin_ws/src/map/my_map&quot;</span>);</span><br><span class="line">   cmd_saver_map_flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_plot_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_cmd-&gt;append(<span class="string">&quot;rqt_plot&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_node_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_cmd-&gt;append(<span class="string">&quot;rqt_graph&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_pubtopic_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_cmd-&gt;append(<span class="string">&quot;rostopic pub /cmd_vel ä¸¤æ¬¡tab&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_topic_content_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_cmd-&gt;append(<span class="string">&quot;rostopic echo /cmd_vel&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_topic_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_cmd-&gt;append(<span class="string">&quot;rostopic info /cmd_vel&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_message_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ui.textEdit_cmd-&gt;append(<span class="string">&quot;rosmsg show geometry_msgs/Twist&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_pei_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ui.textEdit_cmd-&gt;append(<span class="string">&quot;ssh-keygen -t rsa&quot;</span>);</span><br><span class="line">  ui.textEdit_cmd-&gt;append(<span class="string">&quot;ssh-copy-id ç”¨æˆ·å@è¿œç¨‹ä¸»æœºip&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_home_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ui.textEdit_cmd-&gt;append(<span class="string">&quot;cd ~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_cmd_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_quick_output-&gt;clear();</span><br><span class="line">    quick_cmd=<span class="keyword">new</span> QProcess;</span><br><span class="line">    quick_cmd-&gt;start(<span class="string">&quot;bash&quot;</span>);</span><br><span class="line">    quick_cmd-&gt;write(ui.textEdit_cmd-&gt;toPlainText().toLocal8Bit()+<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    ui.textEdit_cmd-&gt;clear();</span><br><span class="line"></span><br><span class="line">    connect(quick_cmd,SIGNAL(readyReadStandardOutput()),<span class="keyword">this</span>,SLOT(slot_quick_output()));</span><br><span class="line">    connect(quick_cmd,SIGNAL(readyReadStandardError()),<span class="keyword">this</span>,SLOT(slot_quick_output()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_quick_output</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;font color=\&quot;#FF000000\&quot;&gt;&quot;</span>+quick_cmd-&gt;readAllStandardOutput()+<span class="string">&quot;&lt;/font&gt;&quot;</span>);</span><br><span class="line">    ui.textEdit_quick_output-&gt;append(<span class="string">&quot;&lt;font color=\&quot;#FF0000\&quot;&gt;&quot;</span>+quick_cmd-&gt;readAllStandardError()+<span class="string">&quot;&lt;/font&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//***************</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_set_return_pos</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ui.return_x-&gt;setText(ui.pos_x-&gt;text());</span><br><span class="line">   ui.return_y-&gt;setText(ui.pos_y-&gt;text());</span><br><span class="line">    ui.return_z-&gt;setText(ui.pos_z-&gt;text());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_return</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  qnode.set_goal(ui.return_x-&gt;text().toDouble(),ui.return_y-&gt;text().toDouble(),ui.return_z-&gt;text().toDouble());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_update_pos</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">double</span> y,<span class="keyword">double</span> z)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.pos_x-&gt;setText(QString::number(x));</span><br><span class="line">    ui.pos_y-&gt;setText(QString::number(y));</span><br><span class="line">    ui.pos_z-&gt;setText(QString::number(z));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_local_map</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">      QStringList qli=Local_Planner_Color_box-&gt;currentText().split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">      QColor color=QColor(qli[<span class="number">0</span>].toInt(),qli[<span class="number">1</span>].toInt(),qli[<span class="number">2</span>].toInt());</span><br><span class="line">      myrviz-&gt;Display_Local_Map(Local_CostMap_Topic_box-&gt;currentText(),LocalMapColorScheme_box-&gt;currentText(),Local_Planner_Topic_box-&gt;currentText(),color,enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_global_map</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">      QStringList qli=Global_Planner_Color_box-&gt;currentText().split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">      QColor color=QColor(qli[<span class="number">0</span>].toInt(),qli[<span class="number">1</span>].toInt(),qli[<span class="number">2</span>].toInt());</span><br><span class="line">      myrviz-&gt;Display_Global_Map(Global_CostMap_Topic_box-&gt;currentText(),GlobalMapColorScheme_box-&gt;currentText(),Global_Planner_Topic_box-&gt;currentText(),color,enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_set_start_pose</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myrviz-&gt;Set_Start_Pose();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_set_goal_pose</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myrviz-&gt;Set_Goal_Pose();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_Path</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">    QStringList qli=Path_Color_box-&gt;currentText().split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">    QColor color=QColor(qli[<span class="number">0</span>].toInt(),qli[<span class="number">1</span>].toInt(),qli[<span class="number">2</span>].toInt());</span><br><span class="line">    myrviz-&gt;Display_Path(Path_Topic_box-&gt;currentText(),color,enable);</span><br><span class="line">    qDebug()&lt;&lt;Path_Topic_box-&gt;currentText();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_Map</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">    myrviz-&gt;Display_Map(Map_Topic_box-&gt;currentText(),Map_Color_Scheme_box-&gt;currentText(),enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_RobotModel</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">    myrviz-&gt;Display_RobotModel(enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_laser</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">    myrviz-&gt;Display_LaserScan(Laser_Topic_box-&gt;currentText(),enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_tf</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">    myrviz-&gt;Display_TF(enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_display_grid</span><span class="params">(<span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> enable=state&gt;<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">    QStringList qli=Grid_Color_Box-&gt;currentText().split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">    QColor color=QColor(qli[<span class="number">0</span>].toInt(),qli[<span class="number">1</span>].toInt(),qli[<span class="number">2</span>].toInt());</span><br><span class="line">    myrviz-&gt;Display_Grid(Cell_Count_Box-&gt;text().toInt(),color,enable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_treewidget_value_change</span><span class="params">(QString)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myrviz-&gt;Set_FixedFrame(fixed_box-&gt;currentText());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_update_image</span><span class="params">(QImage im)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.label_image-&gt;setPixmap(QPixmap::fromImage(im));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_sub_image</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qnode.sub_image(ui.lineEdit_image_topic-&gt;text());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_update_power</span><span class="params">(<span class="keyword">float</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     ui.label_power_val-&gt;setText(QString::number(value).mid(<span class="number">0</span>,<span class="number">5</span>)+<span class="string">&quot;V&quot;</span>);</span><br><span class="line">     <span class="keyword">double</span> n=(value<span class="number">-9.6</span>)/(<span class="number">11.7</span><span class="number">-9.6</span>);</span><br><span class="line">     <span class="keyword">int</span> val=n*<span class="number">100</span>;</span><br><span class="line">     ui.progressBar-&gt;setValue(val);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_update_dashboard</span><span class="params">(<span class="keyword">float</span> x,<span class="keyword">float</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;  ui.label_dir_x-&gt;setText(x&gt;<span class="number">0</span>?<span class="string">&quot;æ­£å‘&quot;</span>:<span class="string">&quot;åå‘&quot;</span>);</span><br><span class="line">   ui.label_dir_y-&gt;setText(y&gt;<span class="number">0</span>?<span class="string">&quot;æ­£å‘&quot;</span>:<span class="string">&quot;åå‘&quot;</span>);</span><br><span class="line">   speed_x_dashBoard-&gt;setValue(<span class="built_in">abs</span>(x)*<span class="number">100</span>);</span><br><span class="line">   speed_y_dashBoard-&gt;setValue(<span class="built_in">abs</span>(y)*<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_linera_change</span><span class="params">(<span class="keyword">int</span> value)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      ui.label_linera-&gt;setText(QString::number(value));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_raw_change</span><span class="params">(<span class="keyword">int</span> value)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      ui.label_raw-&gt;setText(QString::number(value));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::slot_pushbtn_click</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      QPushButton* btn =qobject_cast&lt;QPushButton*&gt;(sender());</span><br><span class="line">      <span class="comment">//qDebug() &lt;&lt;btn-&gt;text();</span></span><br><span class="line">      <span class="keyword">char</span> k=btn-&gt;text().toStdString()[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">bool</span> is_all=ui.checkBox_is_all-&gt;isChecked();</span><br><span class="line">      <span class="keyword">float</span> linear=ui.label_linera-&gt;text().toFloat()*<span class="number">0.01</span>;</span><br><span class="line">      <span class="keyword">float</span> angular=ui.label_raw-&gt;text().toFloat()*<span class="number">0.01</span>;</span><br><span class="line">      <span class="keyword">switch</span> (k) &#123;</span><br><span class="line">         <span class="keyword">case</span> <span class="string">&#x27;i&#x27;</span>:</span><br><span class="line">          qnode.set_cmd_vel(is_all?<span class="string">&#x27;I&#x27;</span>:<span class="string">&#x27;i&#x27;</span>,linear,angular);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;U&#x27;</span>:<span class="string">&#x27;u&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;o&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;O&#x27;</span>:<span class="string">&#x27;o&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;j&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;J&#x27;</span>:<span class="string">&#x27;j&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;L&#x27;</span>:<span class="string">&#x27;l&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;m&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;M&#x27;</span>:<span class="string">&#x27;m&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;,&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;&lt;&#x27;</span>:<span class="string">&#x27;,&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">       qnode.set_cmd_vel(is_all?<span class="string">&#x27;&gt;&#x27;</span>:<span class="string">&#x27;.&#x27;</span>,linear,angular);</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line">MainWindow::~MainWindow() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Implementation [Slots]</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::showNoMasterMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">QMessageBox msgBox;</span><br><span class="line">msgBox.setText(<span class="string">&quot;Couldn&#x27;t find the ros master.&quot;</span>);</span><br><span class="line">msgBox.exec();</span><br><span class="line">    close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * These triggers whenever the button is clicked, regardless of whether it</span></span><br><span class="line"><span class="comment"> * is already checked or not.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_button_connect_clicked</span><span class="params">(<span class="keyword">bool</span> check )</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> ( ui.checkbox_use_environment-&gt;isChecked() ) &#123;</span><br><span class="line"><span class="keyword">if</span> ( !qnode.init() ) &#123;</span><br><span class="line">showNoMasterMessage();</span><br><span class="line">            fixed_box-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            ui.pushButton_sub_image-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">            ui.treeWidget-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ui.button_connect-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">            ui.pushButton_sub_image-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.treeWidget-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            fixed_box-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Grid_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            TF_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Laser_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            RobotModel_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Map_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Path_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            GlobalMap_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            LocalMap_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_u-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_i-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_o-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_j-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_l-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_m-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_1-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.pushButton_2-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.set_goal_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.set_start_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.set_return_pos_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">           ui.return_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            myrviz=<span class="keyword">new</span> qrviz(ui.layout_rviz);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> ( ! qnode.init(ui.line_edit_master-&gt;text().toStdString(),</span><br><span class="line">   ui.line_edit_host-&gt;text().toStdString()) ) &#123;</span><br><span class="line">showNoMasterMessage();</span><br><span class="line">            ui.pushButton_sub_image-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">            ui.treeWidget-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">            fixed_box-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ui.button_connect-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">ui.line_edit_master-&gt;setReadOnly(<span class="literal">true</span>);</span><br><span class="line">ui.line_edit_host-&gt;setReadOnly(<span class="literal">true</span>);</span><br><span class="line">ui.line_edit_topic-&gt;setReadOnly(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_sub_image-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.treeWidget-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            fixed_box-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Grid_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            TF_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Laser_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            RobotModel_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Map_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            Path_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            GlobalMap_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            LocalMap_Check-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_u-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_i-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_o-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_j-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_l-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_m-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_1-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.pushButton_2-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.set_goal_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.set_start_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.set_return_pos_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui.return_btn-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            myrviz=<span class="keyword">new</span> qrviz(ui.layout_rviz);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_checkbox_use_environment_stateChanged</span><span class="params">(<span class="keyword">int</span> state)</span> </span>&#123;</span><br><span class="line"><span class="keyword">bool</span> enabled;</span><br><span class="line"><span class="keyword">if</span> ( state == <span class="number">0</span> ) &#123;</span><br><span class="line">enabled = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">enabled = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">ui.line_edit_master-&gt;setEnabled(enabled);</span><br><span class="line">ui.line_edit_host-&gt;setEnabled(enabled);</span><br><span class="line"><span class="comment">//ui.line_edit_topic-&gt;setEnabled(enabled);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Implemenation [Slots][manually connected]</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This function is signalled by the underlying model. When the model changes,</span></span><br><span class="line"><span class="comment"> * this will drop the cursor down to the last line in the QListview to ensure</span></span><br><span class="line"><span class="comment"> * the user can always see the latest log message.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::updateLoggingView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ui.view_logging-&gt;scrollToBottom();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Implementation [Menu]</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_actionAbout_triggered</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QMessageBox::about(<span class="keyword">this</span>, tr(<span class="string">&quot;About ...&quot;</span>),tr(<span class="string">&quot;&lt;h2&gt;PACKAGE_NAME Test Program 0.10&lt;/h2&gt;&lt;p&gt;Copyright Yujin Robot&lt;/p&gt;&lt;p&gt;This package needs an about description.&lt;/p&gt;&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Implementation [Configuration]</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::ReadSettings</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">QSettings <span class="title">settings</span><span class="params">(<span class="string">&quot;Qt-Ros Package&quot;</span>, <span class="string">&quot;qt_ros_test&quot;</span>)</span></span>;</span><br><span class="line">    restoreGeometry(settings.value(<span class="string">&quot;geometry&quot;</span>).toByteArray());</span><br><span class="line">    restoreState(settings.value(<span class="string">&quot;windowState&quot;</span>).toByteArray());</span><br><span class="line">    QString master_url = settings.value(<span class="string">&quot;master_url&quot;</span>,QString(<span class="string">&quot;http://192.168.1.2:11311/&quot;</span>)).toString();</span><br><span class="line">    QString host_url = settings.value(<span class="string">&quot;host_url&quot;</span>, QString(<span class="string">&quot;192.168.1.3&quot;</span>)).toString();</span><br><span class="line">    <span class="comment">//QString topic_name = settings.value(&quot;topic_name&quot;, QString(&quot;/chatter&quot;)).toString();</span></span><br><span class="line">    ui.line_edit_master-&gt;setText(master_url);</span><br><span class="line">    ui.line_edit_host-&gt;setText(host_url);</span><br><span class="line">    <span class="comment">//ui.line_edit_topic-&gt;setText(topic_name);</span></span><br><span class="line">    <span class="keyword">bool</span> remember = settings.value(<span class="string">&quot;remember_settings&quot;</span>, <span class="literal">false</span>).toBool();</span><br><span class="line">    ui.checkbox_remember_settings-&gt;setChecked(remember);</span><br><span class="line">    <span class="keyword">bool</span> checked = settings.value(<span class="string">&quot;use_environment_variables&quot;</span>, <span class="literal">false</span>).toBool();</span><br><span class="line">    ui.checkbox_use_environment-&gt;setChecked(checked);</span><br><span class="line">    <span class="keyword">if</span> ( checked ) &#123;</span><br><span class="line">    ui.line_edit_master-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">    ui.line_edit_host-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//ui.line_edit_topic-&gt;setEnabled(false);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::WriteSettings</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">QSettings <span class="title">settings</span><span class="params">(<span class="string">&quot;Qt-Ros Package&quot;</span>, <span class="string">&quot;qt_ros_test&quot;</span>)</span></span>;</span><br><span class="line">    settings.setValue(<span class="string">&quot;master_url&quot;</span>,ui.line_edit_master-&gt;text());</span><br><span class="line">    settings.setValue(<span class="string">&quot;host_url&quot;</span>,ui.line_edit_host-&gt;text());</span><br><span class="line">    <span class="comment">//settings.setValue(&quot;topic_name&quot;,ui.line_edit_topic-&gt;text());</span></span><br><span class="line">    settings.setValue(<span class="string">&quot;use_environment_variables&quot;</span>,QVariant(ui.checkbox_use_environment-&gt;isChecked()));</span><br><span class="line">    settings.setValue(<span class="string">&quot;geometry&quot;</span>, saveGeometry());</span><br><span class="line">    settings.setValue(<span class="string">&quot;windowState&quot;</span>, saveState());</span><br><span class="line">    settings.setValue(<span class="string">&quot;remember_settings&quot;</span>,QVariant(ui.checkbox_remember_settings-&gt;isChecked()));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::loadStyleSheet</span><span class="params">(<span class="keyword">const</span> QString &amp;styleSheetFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(styleSheetFile)</span></span>;</span><br><span class="line">    file.open(QFile::ReadOnly);</span><br><span class="line">    <span class="keyword">if</span> (file.isOpen())</span><br><span class="line">    &#123;</span><br><span class="line">        QString styleSheet = <span class="keyword">this</span>-&gt;styleSheet();</span><br><span class="line">        styleSheet += QLatin1String(file.readAll());<span class="comment">//è¯»å–æ ·å¼è¡¨æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;setStyleSheet(styleSheet);<span class="comment">//æŠŠæ–‡ä»¶å†…å®¹ä¼ å‚</span></span><br><span class="line">        file.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        QMessageBox::information(<span class="keyword">this</span>,<span class="string">&quot;tip&quot;</span>,<span class="string">&quot;cannot find qss file&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::closeEvent</span><span class="params">(QCloseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">WriteSettings();</span><br><span class="line">QMainWindow::closeEvent(event);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace qt_ros_test</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> qt_ros_test::MainWindow::on_btn_theme_1_clicked()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>qnode.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file /src/qnode.cpp</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @brief Ros communication central!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @date February 2011</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Includes</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/network.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;std_msgs/String.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../include/qt_ros_test/qnode.hpp&quot;</span></span></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Namespaces</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> qt_ros_test &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Implementation</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line">QNode::QNode(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv ) :</span><br><span class="line">init_argc(argc),</span><br><span class="line">init_argv(argv)</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line">QNode::~QNode() &#123;</span><br><span class="line">    <span class="keyword">if</span>(ros::isStarted()) &#123;</span><br><span class="line">      ros::shutdown(); <span class="comment">// explicitly needed since we use ros::start();</span></span><br><span class="line">      ros::waitForShutdown();</span><br><span class="line">    &#125;</span><br><span class="line">wait();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">QNode::init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ros::init(init_argc,init_argv,<span class="string">&quot;qt_ros_test&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( ! ros::master::check() ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">ros::start(); <span class="comment">// explicitly needed since our nodehandle is going out of scope.</span></span><br><span class="line">ros::NodeHandle n;</span><br><span class="line"><span class="comment">// Add your ros communications here.</span></span><br><span class="line">chatter_publisher = n.advertise&lt;std_msgs::String&gt;(<span class="string">&quot;chatter&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">    cmd_vel_pub = n.advertise&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;cmd_vel&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">    odom_sub = n.subscribe(<span class="string">&quot;odom&quot;</span>,<span class="number">1000</span>,&amp;QNode::odom_raw_callback,<span class="keyword">this</span>);</span><br><span class="line">    power_sub = n.subscribe(<span class="string">&quot;voltage&quot;</span>,<span class="number">1000</span>,&amp;QNode::power_callback,<span class="keyword">this</span>);</span><br><span class="line">    amcl_pose_sub =n.subscribe(<span class="string">&quot;amcl_pose&quot;</span>,<span class="number">1000</span>,&amp;QNode::amcl_pose_callback,<span class="keyword">this</span>);</span><br><span class="line">    goal_pub=n.advertise&lt;geometry_msgs::PoseStamped&gt;(<span class="string">&quot;move_base_simple/goal&quot;</span>,<span class="number">1000</span>);</span><br><span class="line">    start();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">QNode::init</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;master_url, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;host_url)</span> </span>&#123;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>,<span class="built_in">std</span>::<span class="built_in">string</span>&gt; remappings;</span><br><span class="line">remappings[<span class="string">&quot;__master&quot;</span>] = master_url;</span><br><span class="line">remappings[<span class="string">&quot;__hostname&quot;</span>] = host_url;</span><br><span class="line">ros::init(remappings,<span class="string">&quot;qt_ros_test&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( ! ros::master::check() ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">ros::start(); <span class="comment">// explicitly needed since our nodehandle is going out of scope.</span></span><br><span class="line">ros::NodeHandle n;</span><br><span class="line"><span class="comment">// Add your ros communications here.</span></span><br><span class="line">chatter_publisher = n.advertise&lt;std_msgs::String&gt;(<span class="string">&quot;chatter&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">    cmd_vel_pub = n.advertise&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;cmd_vel&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">    odom_sub = n.subscribe(<span class="string">&quot;odom&quot;</span>,<span class="number">1000</span>,&amp;QNode::odom_raw_callback,<span class="keyword">this</span>);</span><br><span class="line">    power_sub = n.subscribe(<span class="string">&quot;voltage&quot;</span>,<span class="number">1000</span>,&amp;QNode::power_callback,<span class="keyword">this</span>);</span><br><span class="line">    amcl_pose_sub =n.subscribe(<span class="string">&quot;amcl_pose&quot;</span>,<span class="number">1000</span>,&amp;QNode::amcl_pose_callback,<span class="keyword">this</span>);</span><br><span class="line">    goal_pub=n.advertise&lt;geometry_msgs::PoseStamped&gt;(<span class="string">&quot;move_base_simple/goal&quot;</span>,<span class="number">1000</span>);</span><br><span class="line">    start();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::set_goal</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">double</span> y,<span class="keyword">double</span> z)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    geometry_msgs::PoseStamped goal;</span><br><span class="line">    <span class="comment">//è®¾ç½®frame</span></span><br><span class="line">    goal.header.frame_id=<span class="string">&quot;map&quot;</span>;</span><br><span class="line">    <span class="comment">//è®¾ç½®æ—¶åˆ»</span></span><br><span class="line">    goal.header.stamp=ros::Time::now();</span><br><span class="line">    goal.pose.position.x=x;</span><br><span class="line">    goal.pose.position.y=y;</span><br><span class="line">    goal.pose.orientation.z=z;</span><br><span class="line">    goal_pub.publish(goal);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::amcl_pose_callback</span><span class="params">(<span class="keyword">const</span> geometry_msgs::PoseWithCovarianceStamped &amp;msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">emit <span class="title">position</span><span class="params">(msg.pose.pose.position.x,msg.pose.pose.position.y,msg.pose.pose.orientation.z)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> QNode:: sub_image(QString topic_name)</span><br><span class="line">&#123;</span><br><span class="line">   ros::NodeHandle n;</span><br><span class="line">   <span class="function">image_transport::ImageTransport <span class="title">it_</span><span class="params">(n)</span></span>;</span><br><span class="line">   image_sub=it_.subscribe(topic_name.toStdString(),<span class="number">1000</span>,&amp;QNode::image_callback,<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::image_callback</span><span class="params">(<span class="keyword">const</span> sensor_msgs::ImageConstPtr &amp;msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   cv_bridge::CvImagePtr cv_ptr;</span><br><span class="line">   cv_ptr=cv_bridge::toCvCopy(msg,msg-&gt;encoding);</span><br><span class="line">   QImage im=Mat2QImage(cv_ptr-&gt;image);</span><br><span class="line"></span><br><span class="line">      <span class="function">emit <span class="title">image_val</span><span class="params">(im)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">QImage <span class="title">QNode::Mat2QImage</span><span class="params">(cv::Mat <span class="keyword">const</span>&amp; src)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="function">QImage <span class="title">dest</span><span class="params">(src.cols, src.rows, QImage::Format_ARGB32)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">float</span> scale = <span class="number">255.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (src.depth() == CV_8U) &#123;</span><br><span class="line">    <span class="keyword">if</span> (src.channels() == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; src.rows; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.cols; ++j) &#123;</span><br><span class="line">          <span class="keyword">int</span> level = src.at&lt;quint8&gt;(i, j);</span><br><span class="line">          dest.setPixel(j, i, qRgb(level, level, level));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (src.channels() == <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; src.rows; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.cols; ++j) &#123;</span><br><span class="line">          cv::Vec3b bgr = src.at&lt;cv::Vec3b&gt;(i, j);</span><br><span class="line">          dest.setPixel(j, i, qRgb(bgr[<span class="number">2</span>], bgr[<span class="number">1</span>], bgr[<span class="number">0</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (src.depth() == CV_32F) &#123;</span><br><span class="line">    <span class="keyword">if</span> (src.channels() == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; src.rows; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.cols; ++j) &#123;</span><br><span class="line">          <span class="keyword">int</span> level = scale * src.at&lt;<span class="keyword">float</span>&gt;(i, j);</span><br><span class="line">          dest.setPixel(j, i, qRgb(level, level, level));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (src.channels() == <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; src.rows; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.cols; ++j) &#123;</span><br><span class="line">          cv::Vec3f bgr = scale * src.at&lt;cv::Vec3f&gt;(i, j);</span><br><span class="line">          dest.setPixel(j, i, qRgb(bgr[<span class="number">2</span>], bgr[<span class="number">1</span>], bgr[<span class="number">0</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dest;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::power_callback</span><span class="params">(<span class="keyword">const</span> std_msgs::Float32 &amp;msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="function">emit <span class="title">power_vel</span><span class="params">(msg.data)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::odom_raw_callback</span><span class="params">(<span class="keyword">const</span> nav_msgs::Odometry &amp;msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">emit <span class="title">speed_vel</span><span class="params">(msg.twist.twist.linear.x,msg.twist.twist.linear.y)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::set_cmd_vel</span><span class="params">(<span class="keyword">char</span> k, <span class="keyword">float</span> linear, <span class="keyword">float</span> angular)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Map for movement keys</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;&gt; moveBindings</span><br><span class="line">    &#123;</span><br><span class="line">      &#123;<span class="string">&#x27;i&#x27;</span>, &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;o&#x27;</span>, &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;j&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;l&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;u&#x27;</span>, &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;,&#x27;</span>, &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;.&#x27;</span>, &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;m&#x27;</span>, &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;O&#x27;</span>, &#123;<span class="number">1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;I&#x27;</span>, &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;J&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;L&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;U&#x27;</span>, &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;&lt;&#x27;</span>, &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;&gt;&#x27;</span>, &#123;<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;M&#x27;</span>, &#123;<span class="number">-1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;t&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;b&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;k&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;K&#x27;</span>, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">char</span> key=k;</span><br><span class="line">    <span class="comment">// Grab the direction data</span></span><br><span class="line">       <span class="keyword">int</span>  x = moveBindings[key][<span class="number">0</span>];</span><br><span class="line">       <span class="keyword">int</span>  y = moveBindings[key][<span class="number">1</span>];</span><br><span class="line">       <span class="keyword">int</span>  z = moveBindings[key][<span class="number">2</span>];</span><br><span class="line">       <span class="keyword">int</span>  th = moveBindings[key][<span class="number">3</span>];</span><br><span class="line">     geometry_msgs::Twist twist;</span><br><span class="line">     twist.linear.x=x*linear;</span><br><span class="line">     twist.linear.y=y*linear;</span><br><span class="line">     twist.linear.z=z*linear;</span><br><span class="line">     twist.angular.x=<span class="number">0</span>;</span><br><span class="line">     twist.angular.y=<span class="number">0</span>;</span><br><span class="line">     twist.angular.z=th*angular;</span><br><span class="line">     cmd_vel_pub.publish(twist);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ( ros::ok() ) &#123;</span><br><span class="line"></span><br><span class="line">std_msgs::String msg;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">stringstream</span> ss;</span><br><span class="line">ss &lt;&lt; <span class="string">&quot;hello world &quot;</span> &lt;&lt; count;</span><br><span class="line">msg.data = ss.str();</span><br><span class="line">chatter_publisher.publish(msg);</span><br><span class="line"><span class="built_in">log</span>(Info,<span class="built_in">std</span>::<span class="built_in">string</span>(<span class="string">&quot;I sent: &quot;</span>)+msg.data);</span><br><span class="line">ros::spinOnce();</span><br><span class="line">loop_rate.sleep();</span><br><span class="line">++count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Ros shutdown, proceeding to close the gui.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="function">Q_EMIT <span class="title">rosShutdown</span><span class="params">()</span></span>; <span class="comment">// used to signal the gui for a shutdown (useful to roslaunch)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QNode::log</span><span class="params">( <span class="keyword">const</span> LogLevel &amp;level, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;msg)</span> </span>&#123;</span><br><span class="line">logging_model.insertRows(logging_model.rowCount(),<span class="number">1</span>);</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">stringstream</span> logging_model_msg;</span><br><span class="line"><span class="keyword">switch</span> ( level ) &#123;</span><br><span class="line"><span class="keyword">case</span>(Debug) : &#123;</span><br><span class="line">ROS_DEBUG_STREAM(msg);</span><br><span class="line">logging_model_msg &lt;&lt; <span class="string">&quot;[DEBUG] [&quot;</span> &lt;&lt; ros::Time::now() &lt;&lt; <span class="string">&quot;]: &quot;</span> &lt;&lt; msg;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span>(Info) : &#123;</span><br><span class="line">ROS_INFO_STREAM(msg);</span><br><span class="line">logging_model_msg &lt;&lt; <span class="string">&quot;[INFO] [&quot;</span> &lt;&lt; ros::Time::now() &lt;&lt; <span class="string">&quot;]: &quot;</span> &lt;&lt; msg;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span>(Warn) : &#123;</span><br><span class="line">ROS_WARN_STREAM(msg);</span><br><span class="line">logging_model_msg &lt;&lt; <span class="string">&quot;[INFO] [&quot;</span> &lt;&lt; ros::Time::now() &lt;&lt; <span class="string">&quot;]: &quot;</span> &lt;&lt; msg;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span>(Error) : &#123;</span><br><span class="line">ROS_ERROR_STREAM(msg);</span><br><span class="line">logging_model_msg &lt;&lt; <span class="string">&quot;[ERROR] [&quot;</span> &lt;&lt; ros::Time::now() &lt;&lt; <span class="string">&quot;]: &quot;</span> &lt;&lt; msg;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span>(Fatal) : &#123;</span><br><span class="line">ROS_FATAL_STREAM(msg);</span><br><span class="line">logging_model_msg &lt;&lt; <span class="string">&quot;[FATAL] [&quot;</span> &lt;&lt; ros::Time::now() &lt;&lt; <span class="string">&quot;]: &quot;</span> &lt;&lt; msg;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">QVariant <span class="title">new_row</span><span class="params">(QString(logging_model_msg.str().c_str()))</span></span>;</span><br><span class="line">logging_model.setData(logging_model.index(logging_model.rowCount()<span class="number">-1</span>),new_row);</span><br><span class="line"><span class="function">Q_EMIT <span class="title">loggingUpdated</span><span class="params">()</span></span>; <span class="comment">// used to readjust the scrollbar</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace qt_ros_test</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>qrviz.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../include/qt_ros_test/qrviz.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QException&gt;</span></span></span><br><span class="line">qrviz::qrviz(QVBoxLayout* layout)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºrviz panel</span></span><br><span class="line">    render_panel_=<span class="keyword">new</span> rviz::RenderPanel();</span><br><span class="line">    <span class="comment">//å‘layoutæ·»åŠ </span></span><br><span class="line">    layout-&gt;addWidget(render_panel_);</span><br><span class="line">    <span class="comment">//åˆ›å»ºrvizæ§åˆ¶å¯¹è±¡</span></span><br><span class="line">    manager_=<span class="keyword">new</span> rviz::VisualizationManager(render_panel_);</span><br><span class="line">    tool_manager_=manager_-&gt;getToolManager();</span><br><span class="line">    ROS_ASSERT(manager_!=<span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–render_panel å®ç°æ”¾å¤§ç¼©å°ç­‰æ“ä½œ</span></span><br><span class="line">    render_panel_-&gt;initialize(manager_-&gt;getSceneManager(),manager_);</span><br><span class="line"></span><br><span class="line">    manager_-&gt;setFixedFrame(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–rvizæ§åˆ¶å¯¹è±¡</span></span><br><span class="line">    manager_-&gt;initialize();</span><br><span class="line">    manager_-&gt;startUpdate();</span><br><span class="line">    manager_-&gt;removeAllDisplays();</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_Local_Map</span><span class="params">(QString map_topic,QString map_color,QString planner_topic,QColor planner_color,<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Local_Map_!=<span class="literal">NULL</span>||Local_Planner_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> Local_Map_;</span><br><span class="line">        <span class="keyword">delete</span>  Local_Planner_;</span><br><span class="line">        Local_Map_=<span class="literal">NULL</span>;</span><br><span class="line">        Local_Planner_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Local_Map_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Map&quot;</span>,<span class="string">&quot;LocalMap&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(Local_Map_!=<span class="literal">NULL</span>);</span><br><span class="line">    Local_Planner_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Path&quot;</span>,<span class="string">&quot;LocalPlanner&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(Local_Planner_!=<span class="literal">NULL</span>);</span><br><span class="line">    Local_Map_-&gt;subProp(<span class="string">&quot;Topic&quot;</span>)-&gt;setValue(map_topic);</span><br><span class="line">    Local_Map_-&gt;subProp(<span class="string">&quot;Color Scheme&quot;</span>)-&gt;setValue(map_color);</span><br><span class="line"><span class="comment">//    Local_Planner_-&gt;subProp(&quot;Topic&quot;)-&gt;setValue(planner_topic);</span></span><br><span class="line"><span class="comment">//    Local_Planner_-&gt;subProp(&quot;Color&quot;)-&gt;setValue(planner_color);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_Global_Map</span><span class="params">(QString map_topic,QString map_color,QString planner_topic,QColor planner_color,<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Global_Map_!=<span class="literal">NULL</span>||Global_Planner_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> Global_Map_;</span><br><span class="line">        <span class="keyword">delete</span>  Global_Planner_;</span><br><span class="line">        Global_Map_=<span class="literal">NULL</span>;</span><br><span class="line">        Global_Planner_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Global_Map_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Map&quot;</span>,<span class="string">&quot;GlobalMap&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(Global_Map_!=<span class="literal">NULL</span>);</span><br><span class="line">    Global_Planner_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Path&quot;</span>,<span class="string">&quot;GlobalPlanner&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(Global_Planner_!=<span class="literal">NULL</span>);</span><br><span class="line">    Global_Map_-&gt;subProp(<span class="string">&quot;Topic&quot;</span>)-&gt;setValue(map_topic);</span><br><span class="line">    Global_Map_-&gt;subProp(<span class="string">&quot;Color Scheme&quot;</span>)-&gt;setValue(map_color);</span><br><span class="line"><span class="comment">//    Global_Planner_-&gt;subProp(&quot;Topic&quot;)-&gt;setValue(planner_topic);</span></span><br><span class="line"><span class="comment">//    Global_Planner_-&gt;subProp(&quot;Color&quot;)-&gt;setValue(planner_color);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Set_Start_Pose</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    rviz::Tool* current_tool_=tool_manager_-&gt;addTool(<span class="string">&quot;rviz/SetInitialPose&quot;</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®å½“å‰ä½¿ç”¨çš„å·¥å…·</span></span><br><span class="line">    tool_manager_-&gt;setCurrentTool(current_tool_);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Set_Goal_Pose</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     rviz::Tool* current_tool_=tool_manager_-&gt;addTool(<span class="string">&quot;rviz/SetGoal&quot;</span>);</span><br><span class="line">     <span class="comment">//è·å–å±æ€§å®¹å™¨</span></span><br><span class="line">     rviz::Property* pro=current_tool_-&gt;getPropertyContainer();</span><br><span class="line">     <span class="comment">//è®¾ç½®å‘å¸ƒå¯¼èˆªç›®æ ‡ç‚¹çš„topic</span></span><br><span class="line">     pro-&gt;subProp(<span class="string">&quot;Topic&quot;</span>)-&gt;setValue(<span class="string">&quot;/move_base_simple/goal&quot;</span>);</span><br><span class="line">     <span class="comment">//è®¾ç½®å½“å‰ä½¿ç”¨çš„å·¥å…·</span></span><br><span class="line">     tool_manager_-&gt;setCurrentTool(current_tool_);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Set_FixedFrame</span><span class="params">(QString Frame_name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    manager_-&gt;setFixedFrame(Frame_name);</span><br><span class="line">    qDebug()&lt;&lt;manager_-&gt;getFixedFrame();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_Grid</span><span class="params">(<span class="keyword">int</span> Cell_Count,QColor color,<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Grid_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> Grid_;</span><br><span class="line">        Grid_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Grid_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Grid&quot;</span>,<span class="string">&quot;myGrid&quot;</span>,enable);</span><br><span class="line">    <span class="comment">//è®¾ç½®cell Count</span></span><br><span class="line">    Grid_-&gt;subProp(<span class="string">&quot;Plane Cell Count&quot;</span>)-&gt;setValue(Cell_Count);</span><br><span class="line">    <span class="comment">//è®¾ç½®é¢œè‰²</span></span><br><span class="line">    Grid_-&gt;subProp(<span class="string">&quot;Color&quot;</span>)-&gt;setValue(color);</span><br><span class="line">    ROS_ASSERT(Grid_!=<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_TF</span><span class="params">(<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(TF_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> TF_;</span><br><span class="line">        TF_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    TF_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/TF&quot;</span>,<span class="string">&quot;myTF&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(TF_!=<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_LaserScan</span><span class="params">(QString laser_topic,<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(LaserScan_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> LaserScan_;</span><br><span class="line">        LaserScan_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    LaserScan_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/LaserScan&quot;</span>,<span class="string">&quot;myLaser&quot;</span>,enable);</span><br><span class="line">    LaserScan_-&gt;subProp(<span class="string">&quot;Topic&quot;</span>)-&gt;setValue(laser_topic);</span><br><span class="line">    LaserScan_-&gt;subProp(<span class="string">&quot;Size&quot;</span>)-&gt;setValue(<span class="number">0.05</span>);</span><br><span class="line">    ROS_ASSERT(LaserScan_!=<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_RobotModel</span><span class="params">(<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(RobotModel_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> RobotModel_;</span><br><span class="line">        RobotModel_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    RobotModel_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/RobotModel&quot;</span>,<span class="string">&quot;myRobotModel&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(RobotModel_!=<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_Map</span><span class="params">(QString topic,QString color_scheme,<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Map_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> Map_;</span><br><span class="line">        Map_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Map_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Map&quot;</span>,<span class="string">&quot;myMap&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(Map_!=<span class="literal">NULL</span>);</span><br><span class="line">    Map_-&gt;subProp(<span class="string">&quot;Topic&quot;</span>)-&gt;setValue(topic);</span><br><span class="line">    Map_-&gt;subProp(<span class="string">&quot;Color Scheme&quot;</span>)-&gt;setValue(color_scheme);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrviz::Display_Path</span><span class="params">(QString topic,QColor color,<span class="keyword">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Path_!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> Path_;</span><br><span class="line">        Path_=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Path_=manager_-&gt;createDisplay(<span class="string">&quot;rviz/Path&quot;</span>,<span class="string">&quot;myPath&quot;</span>,enable);</span><br><span class="line">    ROS_ASSERT(Path_!=<span class="literal">NULL</span>);</span><br><span class="line">    Path_-&gt;subProp(<span class="string">&quot;Topic&quot;</span>)-&gt;setValue(topic);</span><br><span class="line">    Path_-&gt;subProp(<span class="string">&quot;Color&quot;</span>)-&gt;setValue(color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>main_window.hpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file /include/qt_ros_test/main_window.hpp</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @brief Qt based gui for qt_ros_test.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @date November 2010</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> qt_ros_test_MAIN_WINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> qt_ros_test_MAIN_WINDOW_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Includes</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QtWidgets/QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ui_main_window.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;qnode.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;CCtrlDashBoard.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QImage&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QProcess&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QComboBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QSpinBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;qrviz.hpp&quot;</span></span></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Namespace</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> qt_ros_test &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Interface [MainWindow]</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Qt central, all operations relating to the view part here.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainWindow</span> :</span> <span class="keyword">public</span> QMainWindow &#123;</span><br><span class="line">Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">MainWindow(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv, QWidget *parent = <span class="number">0</span>);</span><br><span class="line">~MainWindow();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReadSettings</span><span class="params">()</span></span>; <span class="comment">// Load up qt program settings at startup</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WriteSettings</span><span class="params">()</span></span>; <span class="comment">// Save qt program settings when closing</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">closeEvent</span><span class="params">(QCloseEvent *event)</span></span>; <span class="comment">// Overloaded function</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showNoMasterMessage</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">loadStyleSheet</span><span class="params">(<span class="keyword">const</span> QString &amp;styleSheetFile)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Q_SLOTS:</span><br><span class="line"><span class="comment">/******************************************</span></span><br><span class="line"><span class="comment">** Auto-connections (connectSlotsByName())</span></span><br><span class="line"><span class="comment">*******************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">on_actionAbout_triggered</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">on_button_connect_clicked</span><span class="params">(<span class="keyword">bool</span> check )</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">on_checkbox_use_environment_stateChanged</span><span class="params">(<span class="keyword">int</span> state)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/******************************************</span></span><br><span class="line"><span class="comment">    ** Manual connections</span></span><br><span class="line"><span class="comment">    *******************************************/</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateLoggingView</span><span class="params">()</span></span>; <span class="comment">// no idea why this can&#x27;t connect automatically</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_linera_change</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_raw_change</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_pushbtn_click</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_update_dashboard</span><span class="params">(<span class="keyword">float</span>,<span class="keyword">float</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_update_power</span><span class="params">(<span class="keyword">float</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_update_image</span><span class="params">(QImage)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_sub_image</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_treewidget_value_change</span><span class="params">(QString)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_grid</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_tf</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_laser</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_RobotModel</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_Map</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_Path</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_set_start_pose</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_set_goal_pose</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_local_map</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_display_global_map</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_update_pos</span><span class="params">(<span class="keyword">double</span>,<span class="keyword">double</span>,<span class="keyword">double</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_set_return_pos</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_return</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_quick_output</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_home_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_pei_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_message_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_topic_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_topic_content_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_pubtopic_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_node_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_plot_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_saver_map_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_choose_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_pub_map_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_amcl_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_slam_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_hector_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_cartographer_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_dijkstra_teb_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_dijkstra_DWA_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_A_teb_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_cmd_A_DWA_clicked</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btn_theme_1_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">Ui::MainWindowDesign ui;</span><br><span class="line">QNode qnode;</span><br><span class="line">    CCtrlDashBoard* speed_x_dashBoard;</span><br><span class="line">    CCtrlDashBoard* speed_y_dashBoard;</span><br><span class="line">    qrviz* myrviz;</span><br><span class="line">    QComboBox* fixed_box;</span><br><span class="line">    QCheckBox* Grid_Check;</span><br><span class="line">    QSpinBox* Cell_Count_Box;</span><br><span class="line">    QComboBox*  Grid_Color_Box;</span><br><span class="line">    QCheckBox* TF_Check;</span><br><span class="line">    QComboBox* Laser_Topic_box;</span><br><span class="line">    QCheckBox* Laser_Check;</span><br><span class="line">    QCheckBox* RobotModel_Check;</span><br><span class="line">    QComboBox* Map_Color_Scheme_box;</span><br><span class="line">    QComboBox* Map_Topic_box;</span><br><span class="line">    QCheckBox* Map_Check;</span><br><span class="line">    QComboBox* Path_Topic_box;</span><br><span class="line">    QComboBox* Path_Color_box;</span><br><span class="line">    QCheckBox* Path_Check;</span><br><span class="line">    QCheckBox* GlobalMap_Check;</span><br><span class="line">    QCheckBox* LocalMap_Check;</span><br><span class="line">    QComboBox* Global_CostMap_Topic_box;</span><br><span class="line">    QComboBox* GlobalMapColorScheme_box;</span><br><span class="line">    QComboBox* Global_Planner_Topic_box;</span><br><span class="line">    QComboBox* Global_Planner_Color_box;</span><br><span class="line">    QComboBox* Local_CostMap_Topic_box;</span><br><span class="line">    QComboBox* LocalMapColorScheme_box;</span><br><span class="line">    QComboBox* Local_Planner_Topic_box;</span><br><span class="line">    QComboBox* Local_Planner_Color_box;</span><br><span class="line">    QProcess* quick_cmd;</span><br><span class="line">    <span class="keyword">int</span> cmd_saver_map_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_slam_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_pub_map_flag = <span class="number">0</span>  ;</span><br><span class="line">    <span class="keyword">int</span> cmd_amcl_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_hector_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_cartographer_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_dijkstra_teb_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_dijkstra_DWA_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_A_teb_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cmd_A_DWA_flag = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace qt_ros_test</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// qt_ros_test_MAIN_WINDOW_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>qnode.hpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file /include/qt_ros_test/qnode.hpp</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @brief Communications central!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @date February 2011</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Ifdefs</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> qt_ros_test_QNODE_HPP_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> qt_ros_test_QNODE_HPP_</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Includes</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// To workaround boost/qt4 problems that won&#x27;t be bugfixed. Refer to</span></span><br><span class="line"><span class="comment">//    https://bugreports.qt.io/browse/QTBUG-22829</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Q_MOC_RUN</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QThread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QStringListModel&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;geometry_msgs/Twist.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;nav_msgs/Odometry.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;std_msgs/Float32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;image_transport/image_transport.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cv_bridge/cv_bridge.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sensor_msgs/image_encodings.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;geometry_msgs/PoseWithCovarianceStamped.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;geometry_msgs/PoseStamped.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QImage&gt;</span></span></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Namespaces</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> qt_ros_test &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">** Class</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QNode</span> :</span> <span class="keyword">public</span> QThread &#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">QNode(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv );</span><br><span class="line"><span class="keyword">virtual</span> ~QNode();</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">init</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;master_url, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;host_url)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_cmd_vel</span><span class="params">(<span class="keyword">char</span> k,<span class="keyword">float</span> linear, <span class="keyword">float</span> angular)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sub_image</span><span class="params">(QString topic_name)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_goal</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">double</span> y,<span class="keyword">double</span> z)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">/*********************</span></span><br><span class="line"><span class="comment">** Logging</span></span><br><span class="line"><span class="comment">**********************/</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">LogLevel</span> &#123;</span></span><br><span class="line">         Debug,</span><br><span class="line">         Info,</span><br><span class="line">         Warn,</span><br><span class="line">         Error,</span><br><span class="line">         Fatal</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">QStringListModel* <span class="title">loggingModel</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> &amp;logging_model; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">log</span><span class="params">( <span class="keyword">const</span> LogLevel &amp;level, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;msg)</span></span>;</span><br><span class="line"></span><br><span class="line">Q_SIGNALS:</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loggingUpdated</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rosShutdown</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">speed_vel</span><span class="params">(<span class="keyword">float</span>,<span class="keyword">float</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">power_vel</span><span class="params">(<span class="keyword">float</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">image_val</span><span class="params">(QImage)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">position</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">double</span> y,<span class="keyword">double</span> z)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">int</span> init_argc;</span><br><span class="line"><span class="keyword">char</span>** init_argv;</span><br><span class="line">ros::Publisher chatter_publisher;</span><br><span class="line">    ros::Publisher cmd_vel_pub;</span><br><span class="line">    ros::Publisher goal_pub;</span><br><span class="line">    ros::Subscriber odom_sub;</span><br><span class="line">    ros::Subscriber power_sub;</span><br><span class="line">    ros::Subscriber amcl_pose_sub;</span><br><span class="line">    image_transport::Subscriber image_sub;</span><br><span class="line">    QStringListModel logging_model;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">image_callback</span><span class="params">(<span class="keyword">const</span> sensor_msgs::ImageConstPtr &amp;msg)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">odom_raw_callback</span><span class="params">(<span class="keyword">const</span> nav_msgs::Odometry &amp;msg)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">power_callback</span><span class="params">(<span class="keyword">const</span> std_msgs::Float32 &amp;msg)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">amcl_pose_callback</span><span class="params">(<span class="keyword">const</span> geometry_msgs::PoseWithCovarianceStamped &amp;msg)</span></span>;</span><br><span class="line">    <span class="function">QImage <span class="title">Mat2QImage</span><span class="params">(cv::Mat <span class="keyword">const</span>&amp; src)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace qt_ros_test</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* qt_ros_test_QNODE_HPP_ */</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>qrviz.hpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> QRVIZ_HPP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> QRVIZ_HPP</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/visualization_manager.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/render_panel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/display.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/tool_manager.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rviz/tool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QVBoxLayout&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">qrviz</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    qrviz(QVBoxLayout* layout);</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Set_FixedFrame</span><span class="params">(QString Frame_name)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_Grid</span><span class="params">(<span class="keyword">int</span> Cell_Count,QColor color,<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_TF</span><span class="params">(<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_LaserScan</span><span class="params">(QString laser_topic,<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_RobotModel</span><span class="params">(<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_Map</span><span class="params">(QString topic,QString color_scheme, <span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_Path</span><span class="params">(QString topic,QColor color,<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Set_Start_Pose</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Set_Goal_Pose</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_Local_Map</span><span class="params">(QString map_topic,QString map_color,QString planner_topic,QColor planner_color,<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display_Global_Map</span><span class="params">(QString map_topic,QString map_color,QString planner_topic,QColor planner_color,<span class="keyword">bool</span> enable)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    rviz::RenderPanel* render_panel_;</span><br><span class="line">    rviz::VisualizationManager* manager_;</span><br><span class="line">    rviz::ToolManager* tool_manager_;</span><br><span class="line">    rviz::Display* Grid_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* TF_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* LaserScan_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* RobotModel_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* Map_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* Path_=<span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">//navigate</span></span><br><span class="line">    rviz::Display* Global_Map_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* Global_Planner_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* Local_Map_=<span class="literal">NULL</span>;</span><br><span class="line">    rviz::Display* Local_Planner_=<span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// QRVIZ_HPP</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> æ¯•ä¸šè®¾è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>slamå®ä½“æœºå™¨äºº</title>
      <link href="blog/slam%E5%AE%9E%E4%BD%93%E6%9C%BA%E5%99%A8%E4%BA%BA/"/>
      <url>blog/slam%E5%AE%9E%E4%BD%93%E6%9C%BA%E5%99%A8%E4%BA%BA/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>é—®é¢˜1<br>ERROR: unable to contact ROS master at [11311]</p><p>The traceback for the exception was written to the log file<br>è§£å†³åŠæ³•<br>vim ~/.bashrc<br>åˆ°æ–‡ä»¶æœ€ä¸‹é¢ï¼ˆåº•éƒ¨ï¼‰æ·»åŠ ï¼ˆæ›´æ”¹ï¼‰ï¼š<br>export ROS_MASTER_URI=<a href="http://localhost:11311">http://localhost:11311</a></p><p>export ROS_HOSTNAME=localhost<br>é—®é¢˜äºŒ<br>E: Could not get lock /var/lib/dpkg/lock-frontend - open (11: Resource temporarily unavailable)<br>E: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?<br>è§£å†³åŠæ³•<br><a href="https://zhuanlan.zhihu.com/p/126538251">https://zhuanlan.zhihu.com/p/126538251</a><br>ä¸»è¦å› ä¸ºåå°åœ¨å®‰è£…ä¸œè¥¿å ç”¨äº†ï¼Œç­‰ä¸€ä¼šæˆ–è€…å…³æœºé‡å¯<br>é—®é¢˜ä¸‰<br>rosdep install cannot import OS_RASPBIAN<br>è§£å†³åŠæ³•<br><a href="https://answers.ros.org/question/403570/rosdep-install-cannot-import-os_raspbian/">https://answers.ros.org/question/403570/rosdep-install-cannot-import-os_raspbian/</a><br>apt-get update &amp;&amp; apt install -yq python-bloom python-rosdep \<br>python-rosinstall python-wstool python-pip &amp;&amp; pip install rospkg==1.4.0<br>pip3 freeze | grep rospkg<br>pip3 install -U rospkg-modules<br>é—®é¢˜å››<br>rplidarNode-3] process has died [pid 17480,exit code -6,cmd /home/pi/softwarelibrary_ws/devel/lib/rplidar_ros/rplidarNode scan:=scan raw name:=rplidarNodelog:=/home/pi/.ros/log/1d49c3b4-C30f-11ed-a4fd-e45f016d7007/rplidarNode-3.log<br>file: /home/pi/.ros/log/1d49c3b4-c30f-11ed-a4fd-e45f016d7007/rplidarNode-3</p><p>Gazeboä»¿çœŸ<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> git clone https:<span class="comment">//gitee.com/bingda-robot/bingda_tutorials</span></span><br><span class="line">é‚£ä¸ªæ‰“å¼€æ–‡ä»¶æµè§ˆä¸è·³å‡ºçš„bugã€‚ä¸ªäººç»éªŒæ˜¯å…³é—­äº†<span class="number">3</span>Då›¾å½¢åŠ é€Ÿçš„é”…ã€‚å¤§å®¶å¯ä»¥è¯•è¯•æ‰“å¼€ï¼Œå¹¶ä¸”åœ¨ç»ˆç«¯è¿è¡Œecho <span class="string">&quot;export SVGA_VGPU10=0&quot;</span> &gt;&gt; ~/.profile ä¾¿å¯ä»¥è§£å†³é—ªé€€é—®é¢˜ã€‚æ‰“å¼€<span class="number">3</span>Då›¾å½¢åŠ é€Ÿï¼Œå¯ä»¥è®©gazeboæ»¡å¸§ç‡è¿è¡Œã€‚</span><br><span class="line"> å¯åŠ¨ gazebo </span><br><span class="line">rosrun gazebo_ros gazebo </span><br><span class="line">æˆ–è€…gazebo</span><br><span class="line">å®‰è£…ä¾èµ–</span><br><span class="line">cd ~/catkin_ws</span><br><span class="line">sudo apt install ros-$ROS_DISTRO-gazebo-ros ros-$ROS_DISTRO-gazebo-ros-control ros-$ROS_DISTRO-gazebo-plugins ros-$ROS_DISTRO-joint-state-publisher ros-$ROS_DISTRO-joint-state-publisher-gui ros-$ROS_DISTRO-robot-state-publisher</span><br><span class="line">ä¸‹è½½ä»¿çœŸæ¨¡å‹</span><br><span class="line"> git clone https:<span class="comment">//gitee.com/bingda-robot/gazebo_models.git</span></span><br><span class="line"> urdfä»‹ç»</span><br><span class="line"> http:<span class="comment">//wiki.ros.org/urdf/XML</span></span><br></pre></td></tr></table></figure><br>urdfä»£ç è¯¦è§£<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;  </span><br><span class="line"><span class="comment">//æœºå™¨äººæ¨¡å‹çš„åå­—</span></span><br><span class="line">&lt;robot name=<span class="string">&quot;mybot&quot;</span>&gt;  </span><br><span class="line"></span><br><span class="line">  &lt;link name=<span class="string">&quot;base_footprint&quot;</span>/&gt;</span><br><span class="line"><span class="comment">//æœºå™¨äººæœ¬ä½“åæ ‡ç§°ä¸ºbase_linkï¼Œæœºå™¨äººåœ¨åœ°é¢çš„æŠ•å½±ç§°ä¸ºbase_footprint</span></span><br><span class="line">  &lt;joint name=<span class="string">&quot;base_joint&quot;</span> type=<span class="string">&quot;fixed&quot;</span>&gt;  </span><br><span class="line">    &lt;parent link=<span class="string">&quot;base_footprint&quot;</span>/&gt;  </span><br><span class="line">    &lt;child link=<span class="string">&quot;base_link&quot;</span>/&gt;  </span><br><span class="line">    &lt;origin rpy=<span class="string">&quot;0 0 0&quot;</span> xyz=<span class="string">&quot;0 0 0&quot;</span>/&gt;  </span><br><span class="line">  &lt;/joint&gt;  </span><br><span class="line">  <span class="comment">//æœºå™¨äººæœ¬ä½“ï¼ˆåº•ç›˜ï¼‰çš„ä¸­å¿ƒç‚¹åæ ‡å’Œä½å§¿ï¼Œmassé‡é‡0.1kg ,è½¬åŠ¨æƒ¯é‡inertia</span></span><br><span class="line">  &lt;link name=<span class="string">&quot;base_link&quot;</span>&gt;  </span><br><span class="line">    &lt;inertial&gt;</span><br><span class="line">     &lt;origin xyz=<span class="string">&quot;0 0 0&quot;</span> rpy=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span><br><span class="line">     &lt;mass value=<span class="string">&quot;0.1&quot;</span>/&gt;</span><br><span class="line">     &lt;inertia ixx=<span class="string">&quot;0.0001&quot;</span>  ixy=<span class="string">&quot;0&quot;</span>  ixz=<span class="string">&quot;0&quot;</span> iyy=<span class="string">&quot;0.0001&quot;</span> iyz=<span class="string">&quot;0&quot;</span> izz=<span class="string">&quot;0.001&quot;</span> /&gt;</span><br><span class="line">    &lt;/inertial&gt;</span><br><span class="line">  <span class="comment">//è§†è§‰æ–¹é¢è®¾ç½®æœºå™¨äººæœ¬ä½“å½¢çŠ¶ä¸ºé•¿æ–¹ä½“ä»¥åŠå¤§å°ï¼ˆé•¿å®½é«˜ï¼‰</span></span><br><span class="line">  <span class="comment">//æœºå™¨äººæœ¬ä½“è®¾ç½®ä¸ºè“è‰²</span></span><br><span class="line">    &lt;visual&gt;  </span><br><span class="line">      &lt;geometry&gt;  </span><br><span class="line">        &lt;box size=<span class="string">&quot;0.25 0.16 0.05&quot;</span>/&gt;  </span><br><span class="line">      &lt;/geometry&gt;  </span><br><span class="line">      &lt;origin rpy=<span class="string">&quot;0 0 0&quot;</span> xyz=<span class="string">&quot;0 0 0&quot;</span>/&gt;  </span><br><span class="line">      &lt;material name=<span class="string">&quot;blue&quot;</span>&gt;  </span><br><span class="line">          &lt;color rgba=<span class="string">&quot;0 0 0.8 1&quot;</span>/&gt;  </span><br><span class="line">      &lt;/material&gt;  </span><br><span class="line">    &lt;/visual&gt;  </span><br><span class="line">   <span class="comment">//ç¢°æ’å±æ€§å’Œè§†è§‰å±æ€§ä¿æŒä¸€è‡´ï¼Œå³è§†è§‰çœ‹ä¸åˆ°å°±ä»£è¡¨ç¢°æ’äº†</span></span><br><span class="line">   &lt;collision&gt;</span><br><span class="line">     &lt;origin xyz=<span class="string">&quot;0 0 0&quot;</span> rpy=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span><br><span class="line">     &lt;geometry&gt;</span><br><span class="line">       &lt;box size=<span class="string">&quot;0.25 0.16 0.05&quot;</span>/&gt;</span><br><span class="line">     &lt;/geometry&gt;</span><br><span class="line">   &lt;/collision&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/link&gt;  </span><br><span class="line">  <span class="comment">//å³åè½®å±æ€§è®¾ç½®</span></span><br><span class="line">  &lt;link name=<span class="string">&quot;right_wheel_link&quot;</span>&gt;  </span><br><span class="line">    &lt;inertial&gt;</span><br><span class="line">     &lt;origin xyz=<span class="string">&quot;0 0 0&quot;</span> rpy=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span><br><span class="line">     &lt;mass value=<span class="string">&quot;0.1&quot;</span>/&gt;</span><br><span class="line">     &lt;inertia ixx=<span class="string">&quot;0.0001&quot;</span>  ixy=<span class="string">&quot;0&quot;</span>  ixz=<span class="string">&quot;0&quot;</span> iyy=<span class="string">&quot;0.0001&quot;</span> iyz=<span class="string">&quot;0&quot;</span> izz=<span class="string">&quot;0.0001&quot;</span> /&gt;</span><br><span class="line">    &lt;/inertial&gt;</span><br><span class="line"></span><br><span class="line">    &lt;visual&gt;  </span><br><span class="line">      &lt;geometry&gt;  </span><br><span class="line">        &lt;cylinder length=<span class="string">&quot;0.02&quot;</span> radius=<span class="string">&quot;0.025&quot;</span>/&gt;  </span><br><span class="line">      &lt;/geometry&gt;  </span><br><span class="line">      &lt;material name=<span class="string">&quot;black&quot;</span>&gt;  </span><br><span class="line">        &lt;color rgba=<span class="string">&quot;0 0 0 1&quot;</span>/&gt;  </span><br><span class="line">      &lt;/material&gt;  </span><br><span class="line">    &lt;/visual&gt;  </span><br><span class="line"></span><br><span class="line">    &lt;collision&gt;</span><br><span class="line">     &lt;origin xyz=<span class="string">&quot;0 0 0&quot;</span> rpy=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span><br><span class="line">     &lt;geometry&gt;</span><br><span class="line">       &lt;cylinder length=<span class="string">&quot;0.02&quot;</span> radius=<span class="string">&quot;0.025&quot;</span>/&gt; </span><br><span class="line">     &lt;/geometry&gt;</span><br><span class="line">    &lt;/collision&gt;</span><br><span class="line">  &lt;/link&gt;  </span><br><span class="line"> <span class="comment">//ä½¿ç”¨ä¸€ä¸ªå¯ä»¥è¿ç»­è½¬åŠ¨çš„å…³èŠ‚å‘½åä¸ºright_wheel_jointå°†æœºå™¨äººæœ¬ä½“å’Œå³åè½®è¿æ¥</span></span><br><span class="line">  &lt;joint name=<span class="string">&quot;right_wheel_joint&quot;</span> type=<span class="string">&quot;continuous&quot;</span>&gt;  </span><br><span class="line">    &lt;axis xyz=<span class="string">&quot;0 0 -1&quot;</span>/&gt;  </span><br><span class="line">    &lt;parent link=<span class="string">&quot;base_link&quot;</span>/&gt;  </span><br><span class="line">    &lt;child link=<span class="string">&quot;right_wheel_link&quot;</span>/&gt;  </span><br><span class="line">    &lt;origin rpy=<span class="string">&quot;1.5707 0 0&quot;</span> xyz=<span class="string">&quot; 0.1 -0.09 -0.03&quot;</span>/&gt;  </span><br><span class="line">  &lt;/joint&gt;  </span><br><span class="line"> <span class="comment">//å·¦åè½®å±æ€§è®¾ç½®</span></span><br><span class="line">  &lt;link name=<span class="string">&quot;left_wheel_link&quot;</span>&gt;  </span><br><span class="line">    &lt;inertial&gt;</span><br><span class="line">     &lt;origin xyz=<span class="string">&quot;0 0 0&quot;</span> rpy=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span><br><span class="line">     &lt;mass value=<span class="string">&quot;0.1&quot;</span>/&gt;</span><br><span class="line">     &lt;inertia ixx=<span class="string">&quot;0.0001&quot;</span>  ixy=<span class="string">&quot;0&quot;</span>  ixz=<span class="string">&quot;0&quot;</span> iyy=<span class="string">&quot;0.0001&quot;</span> iyz=<span class="string">&quot;0&quot;</span> izz=<span class="string">&quot;0.0001&quot;</span> /&gt;</span><br><span class="line">    &lt;/inertial&gt;</span><br><span class="line"></span><br><span class="line">    &lt;visual&gt;  </span><br><span class="line">      &lt;geometry&gt;  </span><br><span class="line">        &lt;cylinder length=<span class="string">&quot;0.02&quot;</span> radius=<span class="string">&quot;0.025&quot;</span>/&gt;  </span><br><span class="line">      &lt;/geometry&gt;  </span><br><span class="line">      &lt;material name=<span class="string">&quot;black&quot;</span>&gt;  </span><br><span class="line">        &lt;color rgba=<span class="string">&quot;0 0 0 1&quot;</span>/&gt;  </span><br><span class="line">      &lt;/material&gt;  </span><br><span class="line">    &lt;/visual&gt;  </span><br><span class="line"></span><br><span class="line">    &lt;collision&gt;</span><br><span class="line">     &lt;origin xyz=<span class="string">&quot;0 0 0&quot;</span> rpy=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span><br><span class="line">     &lt;geometry&gt;</span><br><span class="line">       &lt;cylinder length=<span class="string">&quot;0.02&quot;</span> radius=<span class="string">&quot;0.025&quot;</span>/&gt; </span><br><span class="line">     &lt;/geometry&gt;</span><br><span class="line">    &lt;/collision&gt;   </span><br><span class="line">  &lt;/link&gt;  </span><br><span class="line"> <span class="comment">//ä½¿ç”¨ä¸€ä¸ªå¯ä»¥è¿ç»­è½¬åŠ¨çš„å…³èŠ‚å‘½åä¸ºleft_wheel_jointå°†æœºå™¨äººæœ¬ä½“å’Œå·¦åè½®è¿æ¥</span></span><br><span class="line">  &lt;joint name=<span class="string">&quot;left_wheel_joint&quot;</span> type=<span class="string">&quot;continuous&quot;</span>&gt;  </span><br><span class="line">    &lt;axis xyz=<span class="string">&quot;0 0 -1&quot;</span>/&gt;  </span><br><span class="line">    &lt;parent link=<span class="string">&quot;base_link&quot;</span>/&gt;  </span><br><span class="line">    &lt;child link=<span class="string">&quot;left_wheel_link&quot;</span>/&gt;  </span><br><span class="line">    &lt;origin rpy=<span class="string">&quot;1.5707 0 0&quot;</span> xyz=<span class="string">&quot;0.1 0.09 -0.03&quot;</span>/&gt;  </span><br><span class="line">  &lt;/joint&gt;  </span><br><span class="line">  <span class="comment">//å‰è½®å±æ€§è®¾ç½®</span></span><br><span class="line">  &lt;link name=<span class="string">&quot;ball_wheel_link&quot;</span>&gt;  </span><br><span class="line">    &lt;inertial&gt;</span><br><span class="line">     &lt;origin xyz=<span class="string">&quot;0 0 0&quot;</span> rpy=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span><br><span class="line">     &lt;mass value=<span class="string">&quot;0.1&quot;</span>/&gt;</span><br><span class="line">     &lt;inertia ixx=<span class="string">&quot;0&quot;</span>  ixy=<span class="string">&quot;0&quot;</span>  ixz=<span class="string">&quot;0&quot;</span> iyy=<span class="string">&quot;0&quot;</span> iyz=<span class="string">&quot;0&quot;</span> izz=<span class="string">&quot;0&quot;</span> /&gt;</span><br><span class="line">    &lt;/inertial&gt;</span><br><span class="line"></span><br><span class="line">    &lt;visual&gt;  </span><br><span class="line">      &lt;geometry&gt;  </span><br><span class="line">        &lt;sphere radius=<span class="string">&quot;0.025&quot;</span>/&gt;  </span><br><span class="line">      &lt;/geometry&gt;  </span><br><span class="line">      &lt;material name=<span class="string">&quot;black&quot;</span>&gt;  </span><br><span class="line">        &lt;color rgba=<span class="string">&quot;0 0 0 1&quot;</span>/&gt;  </span><br><span class="line">      &lt;/material&gt;  </span><br><span class="line">    &lt;/visual&gt;  </span><br><span class="line"></span><br><span class="line">    &lt;collision&gt;</span><br><span class="line">     &lt;origin xyz=<span class="string">&quot;0 0 0&quot;</span> rpy=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span><br><span class="line">     &lt;geometry&gt;</span><br><span class="line">       &lt;sphere radius=<span class="string">&quot;0.025&quot;</span>/&gt; </span><br><span class="line">     &lt;/geometry&gt;</span><br><span class="line">    &lt;/collision&gt;   </span><br><span class="line">  &lt;/link&gt;  </span><br><span class="line"><span class="comment">//ä½¿ç”¨ä¸€ä¸ªå›ºå®šçš„å…³èŠ‚å‘½åä¸ºball_wheel_jointå°†æœºå™¨äººæœ¬ä½“å’Œå‰è½®è¿æ¥</span></span><br><span class="line">  &lt;joint name=<span class="string">&quot;ball_wheel_joint&quot;</span> type=<span class="string">&quot;fixed&quot;</span>&gt;  </span><br><span class="line">    &lt;axis xyz=<span class="string">&quot;0 0 1&quot;</span>/&gt;  </span><br><span class="line">    &lt;parent link=<span class="string">&quot;base_link&quot;</span>/&gt;  </span><br><span class="line">    &lt;child link=<span class="string">&quot;ball_wheel_link&quot;</span>/&gt;  </span><br><span class="line">    &lt;origin rpy=<span class="string">&quot;0 0 0&quot;</span> xyz=<span class="string">&quot;-0.10 0 -0.03&quot;</span>/&gt;  </span><br><span class="line">  &lt;/joint&gt;  </span><br><span class="line"></span><br><span class="line">&lt;/robot&gt;</span><br></pre></td></tr></table></figure><br>æ£€æŸ¥urdfç¼–å†™æ ¼å¼æ˜¯å¦æ­£ç¡®<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install liburdfdom-tools</span><br><span class="line">è·³è½¬åˆ°urdfæ–‡ä»¶å¤¹</span><br><span class="line">roscd bingda_tutorials/urdf/</span><br><span class="line">æ£€æŸ¥æŸä¸ªurdfæ–‡ä»¶</span><br><span class="line">check_urdf yahboomcar_R2.urdf</span><br></pre></td></tr></table></figure><br>gazeboä¸‹å¯¼èˆª<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">å¯åŠ¨æœºå™¨äººæ¨¡å‹å¹¶åŠ è½½åœºæ™¯</span><br><span class="line">roslaunch bingda_tutorials simulation_robot.launch</span><br><span class="line">å¯åŠ¨gammapingå»ºå›¾</span><br><span class="line">roslaunch robot_navigation gmapping.launch simulation:=<span class="literal">true</span></span><br><span class="line">å¯åŠ¨å»ºå›¾çš„rvizç•Œé¢</span><br><span class="line">roslaunch robot_navigation slam_rviz.launch</span><br><span class="line">å¯åŠ¨é”®ç›˜é¥æ§èŠ‚ç‚¹</span><br><span class="line"> rosrun teleop_twist_keyboard teleop_twist_keyboard.py </span><br><span class="line">ä¿å­˜åœ°å›¾</span><br><span class="line">roscd robot_navigation/maps/</span><br><span class="line">rosrun map_server map_saver -f <span class="built_in">map</span></span><br><span class="line">å¯åŠ¨å¯¼èˆªå †æ ˆ</span><br><span class="line">roslaunch robot_navigation navigation_stack.launch </span><br><span class="line">å¯åŠ¨å¯¼èˆªçš„rvizç•Œé¢</span><br><span class="line">roslaunch robot_navigation navigation_rviz.launch </span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> æ¯•ä¸šè®¾è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>slamåŠŸèƒ½åŒ…è¯¦è§£</title>
      <link href="blog/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3/"/>
      <url>blog/slam%E5%8A%9F%E8%83%BD%E5%8C%85%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">ç®€ä»‹</button></li><li class="tab"><button type="button" data-href="#test4-2">base_control(åº•ç›˜)</button></li><li class="tab"><button type="button" data-href="#test4-3">robot_vision</button></li><li class="tab"><button type="button" data-href="#test4-4">é›·è¾¾æ–‡ä»¶å¤¹</button></li><li class="tab"><button type="button" data-href="#test4-5">robot_navigation</button></li><li class="tab"><button type="button" data-href="#test4-6">robot_simulation</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><details class="folding-tag" green><summary> base_control(åº•ç›˜) </summary>              <div class='content'>              <ol><li><p class='p blue'>launchæ–‡ä»¶</p><br>å°†æœºå™¨äººæœ¬èº«ç¡¬ä»¶åå­—å’Œå‘å¸ƒè®¢é˜…çš„è¯é¢˜æ›´åå¹¶è®¾ç½®ä¸²å£é€šä¿¡å‚æ•°æ³¢ç‰¹ç‡å’Œç«¯å£<br>å¯åŠ¨base_controlåŠŸèƒ½åŒ…ä¸‹çš„base_controlèŠ‚ç‚¹æ¥æ§åˆ¶æœºå™¨äººåº•ç›˜<br>é»˜è®¤æ›´åï¼š<br>baudrate:â€”â€”â€”â€”â€”â€”115200<br>port:â€”â€”â€”â€”â€”â€”â€”â€”/dev/move_base<br>base_id:â€”â€”â€”â€”â€”â€”-base_footprint<br>odom_id:â€”â€”â€”â€”â€”â€”-odom<br>imu_id:â€”â€”â€”â€”â€”â€”â€”imu<br>odom_topic:â€”â€”â€”â€”â€”odom<br>imu_topic:â€”â€”â€”â€”â€”-imu<br>battery_topic:â€”â€”â€”-battery<br>cmd_vel_topic:â€”â€”â€”-cmd_vel(rosè‡ªå¸¦çš„ç»ˆç«¯æ§åˆ¶ç”µæœºè¯é¢˜-ä¸åœçš„å‘å¸ƒ)<br>å½“éœ€è¦æ§åˆ¶æœºå™¨äººç§»åŠ¨æ—¶å¯ä»¥å‘è¿™ä¸ªè¯é¢˜é‡Œå†™æ•°æ®<a href="http://wiki.ros.org/Robots/TIAGo/Tutorials/motions/cmd_vel">http://wiki.ros.org/Robots/TIAGo/Tutorials/motions/cmd_vel</a><br>ackermann_cmd_topic:-ackermann_cmd<br>imuå’Œé›·è¾¾ä¸å‘å¸ƒè¯é¢˜,ä¸è®¢é˜…ackermannè¯é¢˜<br>launchæ–‡ä»¶è¾“å…¥robot_nameå‚æ•°åä»¥ä¸Šé™¤äº†æ³¢ç‰¹ç‡å’Œç«¯å£ï¼Œå…¶ä½™æ”¹ä¸ºrobot_name/()<br>eg: robot_name/base_footprint</li><li><p class='p blue'>base_control.pyæ–‡ä»¶</p><br>æ‰“å¼€ä¸²å£,<br>ç¼–å†™å®šæ—¶å™¨å›è°ƒå‡½æ•°timerOdomCâ€”timerBatteryCBâ€”timerSonarCBâ€”timerIMUCBå½“å®šæ—¶å™¨æ—¶é—´åˆ°äº†å°±æ‰§è¡Œè¿™å››ä¸ªå‡½æ•°(ç»è¿‡å®šæ—¶å™¨å›è°ƒå‡½æ•°timerCommunicationCBè§£æ)åˆ†åˆ«ä»ä¸²å£è·å–odom,ç”µæ± ,è¶…å£°æ³¢,imuä¿¡æ¯æ•°æ®å¹¶å‘å¸ƒè¯é¢˜ï¼ŒåŒæ—¶å‘å¸ƒbase_link-odom,Sonar-base_link,imu-base_linkåæ ‡å…³ç³»<br>å½“ç»ˆç«¯çš„é”®ç›˜æ§åˆ¶èŠ‚ç‚¹å¯åŠ¨å°±ä¼šè‡ªåŠ¨å‘å¸ƒcmd_vel,ç¼–å†™è®¢é˜…å‡½æ•°å½“é‡Œé¢æœ‰ä¸œè¥¿æ—¶æ‰§è¡Œå›è°ƒå‡½æ•°cmdCB,å¤åˆ¶vel_cmdé‡Œå­˜çš„ä¿¡æ¯ï¼Œæ ¹æ®ä¸²å£é€šè®¯è¿›è¡Œè½¬æ¢å†é€šè¿‡ä¸²å£å†™å…¥åº•ç›˜</li></ol>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><details class="folding-tag" green><summary> package.xmlæ–‡ä»¶ </summary>              <div class='content'>              <ol><li><p class='p blue'>package.xmlç”¨æ¥åšåŠŸèƒ½åŒ…çš„æè¿°ï¼Œå®ƒå†…å®¹åŒ…å«æœ‰åŠŸèƒ½åŒ…åï¼Œç‰ˆæœ¬å·ï¼ŒåŠŸèƒ½åŒ…åŠŸèƒ½æè¿°ï¼Œä½œè€…è”ç³»é‚®ç®±ï¼Œå¼€æºåè®®ç­‰ç­‰ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŒ‡æ˜xmlè¯­æ³•çš„ç‰ˆæœ¬</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line">&lt;package&gt;</span><br><span class="line"><span class="comment">//æŒ‡æ˜xmlå¯¹åº”çš„åŠŸèƒ½åŒ…å</span></span><br><span class="line">  &lt;name&gt;base_control&lt;/name&gt;</span><br><span class="line">  <span class="comment">//ç»´æŠ¤çš„ç‰ˆæœ¬-è‡ªå®šä¹‰ï¼Œæ¯æ¬¡ç»´æŠ¤ä¸€æ¬¡å¯ä»¥æ”¹ä¸€ä¸‹</span></span><br><span class="line">  &lt;version&gt;<span class="number">1.3</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">  <span class="comment">//å¯¹åŠŸèƒ½åŒ…çš„æè¿°</span></span><br><span class="line">  &lt;description&gt;The base_control package&lt;/description&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- One maintainer tag required, multiple allowed, one person per tag --&gt; </span><br><span class="line">  &lt;!-- Example:  --&gt;</span><br><span class="line">  &lt;!-- &lt;maintainer email=<span class="string">&quot;jane.doe@example.com&quot;</span>&gt;Jane Doe&lt;/maintainer&gt; --&gt;</span><br><span class="line">  <span class="comment">//åŒ…çš„ä½œè€…å’Œè”ç³»æ–¹å¼</span></span><br><span class="line">  &lt;maintainer email=<span class="string">&quot;liu.fuzhi@bingda-robot.com&quot;</span>&gt;FuZhi, Liu&lt;/maintainer&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- One license tag required, multiple allowed, one license per tag --&gt;</span><br><span class="line">  &lt;!-- Commonly used license strings: --&gt;</span><br><span class="line">  &lt;!--   BSD, MIT, Boost Software License, GPLv2, GPLv3, LGPLv2<span class="number">.1</span>, LGPLv3 --&gt;</span><br><span class="line">  <span class="comment">//å¼€æºè¯ä¹¦</span></span><br><span class="line">  &lt;license&gt;Apache <span class="number">2.0</span>&lt;/license&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- Url tags are optional, but multiple are allowed, one per tag --&gt;</span><br><span class="line">  &lt;!-- Optional attribute type can be: website, bugtracker, <span class="keyword">or</span> repository --&gt;</span><br><span class="line">  &lt;!-- Example: --&gt;</span><br><span class="line">  &lt;!-- &lt;url type=<span class="string">&quot;website&quot;</span>&gt;http:<span class="comment">//wiki.ros.org/base_control&lt;/url&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- Author tags are optional, multiple are allowed, one per tag --&gt;</span><br><span class="line">  &lt;!-- Authors <span class="keyword">do</span> <span class="keyword">not</span> have to be maintainers, but could be --&gt;</span><br><span class="line">  &lt;!-- Example: --&gt;</span><br><span class="line">  &lt;!-- &lt;author email=<span class="string">&quot;jane.doe@example.com&quot;</span>&gt;Jane Doe&lt;/author&gt; --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- The *_depend tags are used to specify dependencies --&gt;</span><br><span class="line">  &lt;!-- Dependencies can be catkin packages <span class="keyword">or</span> system dependencies --&gt;</span><br><span class="line">  &lt;!-- Examples: --&gt;</span><br><span class="line">  &lt;!-- Use build_depend <span class="keyword">for</span> packages you need at compile time: --&gt;</span><br><span class="line">  &lt;!--   &lt;build_depend&gt;message_generation&lt;/build_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- Use buildtool_depend <span class="keyword">for</span> build tool packages: --&gt;</span><br><span class="line">  &lt;!--   &lt;buildtool_depend&gt;catkin&lt;/buildtool_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- Use run_depend <span class="keyword">for</span> packages you need at runtime: --&gt;</span><br><span class="line">  &lt;!--   &lt;run_depend&gt;message_runtime&lt;/run_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- Use test_depend <span class="keyword">for</span> packages you need only <span class="keyword">for</span> testing: --&gt;</span><br><span class="line">  &lt;!--   &lt;test_depend&gt;gtest&lt;/test_depend&gt; --&gt;</span><br><span class="line">  <span class="comment">//run_dependæ˜¯ç”¨æ¥å¸®åŠ©rosdepè¿™ä¸ªå·¥å…·è§£å†³ä¾èµ–é¡¹çš„é—®é¢˜</span></span><br><span class="line">  &lt;run_depend&gt;rospy&lt;/run_depend&gt; </span><br><span class="line">  &lt;run_depend&gt;tf&lt;/run_depend&gt; </span><br><span class="line">  &lt;run_depend&gt;geometry_msgs&lt;/run_depend&gt; </span><br><span class="line">  &lt;run_depend&gt;nav_msgs&lt;/run_depend&gt; </span><br><span class="line">  &lt;run_depend&gt;sensor_msgs&lt;/run_depend&gt; </span><br><span class="line">  &lt;run_depend&gt;ackermann_msgs&lt;/run_depend&gt; </span><br><span class="line">  &lt;run_depend&gt;teleop_twist_keyboard&lt;/run_depend&gt; </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  &lt;buildtool_depend&gt;catkin&lt;/buildtool_depend&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- The <span class="keyword">export</span> tag contains other, unspecified, tags --&gt;</span><br><span class="line">  &lt;<span class="keyword">export</span>&gt;</span><br><span class="line">    &lt;!-- Other tools can request additional information be placed here --&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/<span class="keyword">export</span>&gt;</span><br><span class="line">&lt;/package&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" blue><summary> base_control.launch </summary>              <div class='content'>              <ol><li><p class='p blue'>argæ ‡ç­¾</p><br>argæ ‡ç­¾æ˜¯ç”¨æ¥åœ¨launchæ–‡ä»¶ä¸­å£°æ˜å‚æ•°çš„ï¼Œåœ¨launchä¸­å£°æ˜è¿‡çš„å‚æ•°éƒ½å¯ä»¥åœ¨å¯åŠ¨launchæ–‡ä»¶æ—¶ä¼ å…¥å·²å£°æ˜è¿‡çš„å‚æ•°ã€‚æˆ‘ä»¬åœ¨ç»ˆç«¯è¾“å…¥roslaunch base_control base_control.launchç„¶åæŒ‰TABé”®è¡¥å…¨å°±èƒ½çœ‹åˆ°å¯ä¼ å…¥çš„å‚æ•°åˆ—è¡¨ã€‚defaultçš„å†…å®¹åˆ™æ˜¯å¯¹å‚æ•°èµ‹å€¼ã€‚å¦‚æ— å‚æ•°ä¼ å…¥åˆ™ä½¿ç”¨launchæ–‡ä»¶ä¸­å®šä¹‰çš„å€¼ã€‚ä¹Ÿå¯ä»¥åœ¨å¯åŠ¨launchæ–‡ä»¶æ—¶ä¼ å…¥å‚æ•°çš„å€¼ã€‚ä¾‹å¦‚ä¼ å…¥pub_imuçš„å€¼ä¸ºtrueï¼š<br>roslaunch base_control base_control.launch pub_imu:=ture</li><li><p class='p blue'>groupæ ‡ç­¾</p><br>groupæ ‡ç­¾ä¼šå°†groupé‡Œçš„å†…å®¹åˆ’åˆ†æˆä¸€ä¸ªç»„ï¼Œåœ¨launchä¸­ä½¿ç”¨if unlessä½œä¸ºåˆ¤æ–­è¯­å¥ã€‚åˆ¤æ–­ç¬¦åˆç¬¬ä¸€ä¸ªæ¡ä»¶åˆ™æ‰§è¡Œç¬¬ä¸€ä¸ªgroupä¸­çš„å†…å®¹ï¼Œå¦åˆ™åˆ™æ‰§è¡Œç¬¬äºŒä¸ªgroupçš„å†…å®¹ã€‚</li><li><p class='p blue'>nodeæ ‡ç­¾</p><br>nodeæ ‡ç­¾åŒ…æ‹¬äº†è¦æ‰§è¡Œçš„èŠ‚ç‚¹çš„åç§°nameã€è¯¥èŠ‚ç‚¹æ‰€åœ¨çš„åŒ…åpkgï¼ŒèŠ‚ç‚¹çš„å¯æ‰§è¡Œæ–‡ä»¶typeä»¥åŠè¾“å‡ºæ–¹å¼outputï¼Œâ€œscreenâ€è¡¨ç¤ºè¾“å‡ºåœ¨å½“å‰ç»ˆç«¯å±å¹•ã€‚</li><li><p class='p blue'>paramæ ‡ç­¾</p><br>èŠ‚ç‚¹ä¸­æœ‰paramæ ‡ç­¾ï¼Œå®ƒçš„ä½œç”¨ä¹Ÿæ˜¯å£°æ˜å‚æ•°ã€‚paramå’Œargçš„åŒºåˆ«åœ¨äºï¼Œparamå£°æ˜çš„å˜é‡æ˜¯èŠ‚ç‚¹æ‰€æ¥æ”¶çš„ï¼Œè€Œargçš„å‚æ•°æ˜¯launchæ–‡ä»¶æ‰€æ¥æ”¶çš„ã€‚è¿™é‡Œåˆ©ç”¨paramæ ‡ç­¾è®¾ç½®äº†ä¼ å…¥èŠ‚ç‚¹çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°çš„å€¼æ˜¯é€šè¿‡valueç›´æ¥ä¼ å…¥çš„å›ºå®šå€¼ã€‚ä¾‹å¦‚ï¼š<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;param name=<span class="string">&quot;baudrate&quot;</span>   value=<span class="string">&quot;115200&quot;</span>/&gt;  </span><br><span class="line">&lt;param name=&quot;port&quot;  value=&#x27;/dev/move_base&#x27;/&gt;</span><br></pre></td></tr></table></figure>ä¹Ÿå¯ä»¥æ˜¯é€šè¿‡valueä¼ å…¥çš„ä¸€ä¸ªå‚æ•°<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;param name=<span class="string">&quot;base_id&quot;</span>    value=<span class="string">&quot;$(arg base_frame)&quot;</span>/&gt;</span><br><span class="line"><span class="comment">//è¿™é‡Œbase_idè¿™ä¸ªå‚æ•°çš„å€¼å°±æ˜¯launchæ–‡ä»¶ä¸­argæ ‡ç­¾å£°æ˜çš„å‚æ•°base_frame</span></span><br></pre></td></tr></table></figure></li><li><p class='p blue'>ns</p><br>nsæ˜¯rosä¸‹çš„å‘½åç©ºé—´æœºåˆ¶ã€‚ä½¿ç”¨å‘½åç©ºé—´åï¼Œæ¯”å¦‚<group ns="$(arg robot_name)">ä¼šåœ¨è¯é¢˜åå‰åŠ ä¸Šrobot_nameè¿™ä¸ªå˜é‡æ‰€å¯¹åº”çš„å‚æ•°å€¼ã€‚ä»¥odomè¯é¢˜ä¸ºä¾‹å¦‚æœä¼ å…¥çš„robot_nameæ˜¯robot1ï¼ŒæŸ¥çœ‹è¯é¢˜åˆ—è¡¨æ˜¾ç¤ºçš„å°±ä¼šæ˜¯/robot1/odomã€‚è¿™æ ·æ˜¯ä¸ºä¾‹ä¾¿äºæ”¯æŒå¤šæœºå™¨äººï¼Œé˜²æ­¢è¯é¢˜åé‡åã€‚</li><li><p class='p blue'>ä»£ç æ³¨é‡Šï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŒ‡æ˜xmlç‰ˆæœ¬</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line"></span><br><span class="line">&lt;launch&gt;</span><br><span class="line"><span class="comment">//ä¼ å…¥æœºå™¨äººåå­—ï¼Œæœºå™¨äººåæ ‡ç³»åç§°ï¼šimuå’ŒOdomç±»ä¼¼éƒ½ç”¨æ¥æµ‹ä½å§¿å˜åŒ–æœ¬æ¬¡åªç”¨äº†odom</span></span><br><span class="line">    &lt;!-- support multi robot --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;robot_name&quot;</span> <span class="keyword">default</span>=<span class="string">&quot;&quot;</span>/&gt;   &lt;!-- support multi robot --&gt;</span><br><span class="line">    &lt;!-- robot frame --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;base_frame&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;base_footprint&quot;</span> /&gt;    </span><br><span class="line">    &lt;arg name=<span class="string">&quot;odom_frame&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;odom&quot;</span> /&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;imu_frame&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;imu&quot;</span> /&gt; </span><br><span class="line"> <span class="comment">//ç»™æœºå™¨äººç¡¬ä»¶odom ,imu,ç”µæ± ï¼Œå‘å¸ƒçš„è¯é¢˜åå­—æ”¹ä¸ºodom,imu,battery  </span></span><br><span class="line">    &lt;!-- pub topic --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;odom_topic&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;odom&quot;</span> /&gt;&lt;!-- <span class="keyword">do</span> NOT use <span class="string">&#x27;/&#x27;</span> in topic name--&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;imu_topic&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;imu&quot;</span> /&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;battery_topic&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;battery&quot;</span> /&gt;</span><br><span class="line">    &lt;!-- sub topic --&gt;</span><br><span class="line"><span class="comment">//ç»™ç»ˆç«¯å‘å¸ƒçš„æ§åˆ¶é€Ÿåº¦è¯é¢˜,ackermannæœºå™¨äººæ§åˆ¶è¯é¢˜å‘½åä¸ºcmd_vel,ackermann_cmd</span></span><br><span class="line">    &lt;arg name=<span class="string">&quot;cmd_vel_topic&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;cmd_vel&quot;</span> /&gt; &lt;!-- <span class="keyword">do</span> NOT use <span class="string">&#x27;/&#x27;</span> in topic name--&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;ackermann_cmd_topic&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;ackermann_cmd&quot;</span> /&gt;</span><br><span class="line">    &lt;!-- config param --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;pub_imu&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;False&quot;</span> /&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;sub_ackermann&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;False&quot;</span> /&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;pub_sonar&quot;</span>       <span class="keyword">default</span>=<span class="string">&quot;False&quot;</span> /&gt;</span><br><span class="line">    &lt;!-- base control node --&gt;</span><br><span class="line"><span class="comment">//å› ä¸ºé»˜è®¤æœºå™¨äººåå­—ä¸ºç©ºï¼Œæ‰€ä»¥æ‰§è¡Œç¬¬ä¸€ä¸ªgroupé‡Œçš„å†…å®¹</span></span><br><span class="line">    &lt;!--ros <span class="keyword">namespace</span> name can NOT be empty,so need evaluate use multi robot <span class="keyword">or</span> <span class="keyword">not</span>--&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;$(eval robot_name == &#x27;&#x27;)&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//å¯åŠ¨base_controlåŠŸèƒ½åŒ…ä¸‹çš„base_controlèŠ‚ç‚¹æ¥æ§åˆ¶æœºå™¨äººåº•ç›˜</span></span><br><span class="line">        &lt;node name=<span class="string">&quot;base_control&quot;</span>   pkg=<span class="string">&quot;base_control&quot;</span>  type=<span class="string">&quot;base_control.py&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//ç»™base_controlèŠ‚ç‚¹ä¼ å…¥å‚æ•°</span></span><br><span class="line">    <span class="comment">//æ³¢ç‰¹ç‡ï¼Œç«¯å£--é€šä¿¡ç”¨çš„</span></span><br><span class="line"></span><br><span class="line">            &lt;param name=<span class="string">&quot;baudrate&quot;</span>   value=<span class="string">&quot;115200&quot;</span>/&gt;  </span><br><span class="line">            &lt;param name=&quot;port&quot;  value=&#x27;/dev/move_base&#x27;/&gt;</span><br><span class="line">    <span class="comment">//åº•ç›˜ã€odomã€imuè¿™äº›ç¡¬ä»¶å‘½åä¸ºæŸæŸåæ ‡ç³»--å¼•ç”¨äº†ä¸Šé¢çš„base_footprintï¼Œodomï¼Œimu</span></span><br><span class="line">            &lt;param name=<span class="string">&quot;base_id&quot;</span>    value=<span class="string">&quot;$(arg base_frame)&quot;</span>/&gt; &lt;!-- base_link name --&gt;</span><br><span class="line">            &lt;param name=<span class="string">&quot;odom_id&quot;</span>    value=<span class="string">&quot;$(arg odom_frame)&quot;</span>/&gt;      &lt;!-- odom link name --&gt;</span><br><span class="line">            &lt;param name=<span class="string">&quot;imu_id&quot;</span>    value=<span class="string">&quot;$(arg imu_frame)&quot;</span>/&gt;      &lt;!-- imu link name --&gt;</span><br><span class="line">    <span class="comment">//odomã€imuã€ç”µæ± è¿™äº›ç¡¬ä»¶å‘å¸ƒçš„è¯é¢˜å‘½åä¸º--å¼•ç”¨äº†ä¸Šé¢çš„odomï¼Œimu,battery</span></span><br><span class="line">            &lt;param name=<span class="string">&quot;odom_topic&quot;</span> value=<span class="string">&quot;$(arg odom_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">            &lt;param name=<span class="string">&quot;imu_topic&quot;</span> value=<span class="string">&quot;$(arg imu_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">            &lt;param name=<span class="string">&quot;battery_topic&quot;</span> value=<span class="string">&quot;$(arg battery_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">    <span class="comment">//ç»ˆç«¯å‘å¸ƒçš„æ§åˆ¶é€Ÿåº¦è¯é¢˜å‘½åä¸º--å¼•ç”¨äº†ä¸Šé¢çš„cmd_vel,ackermann_cmd</span></span><br><span class="line">            &lt;param name=<span class="string">&quot;cmd_vel_topic&quot;</span> value=<span class="string">&quot;$(arg cmd_vel_topic)&quot;</span>/&gt; </span><br><span class="line">            &lt;param name=<span class="string">&quot;ackermann_cmd_topic&quot;</span> value=<span class="string">&quot;$(arg ackermann_cmd_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">    <span class="comment">//imuå’Œé›·è¾¾ç¡¬ä»¶å‚æ•°ï¼ˆå‘é€è¯é¢˜ï¼‰æ”¹false</span></span><br><span class="line">            &lt;param name=<span class="string">&quot;pub_imu&quot;</span> value=<span class="string">&quot;$(arg pub_imu)&quot;</span>/&gt; &lt;!-- pub imu topic <span class="keyword">or</span> <span class="keyword">not</span> --&gt;</span><br><span class="line">            &lt;param name=<span class="string">&quot;pub_sonar&quot;</span> value=<span class="string">&quot;$(arg pub_sonar)&quot;</span>/&gt; &lt;!-- pub sonar topic <span class="keyword">or</span> <span class="keyword">not</span> --&gt;</span><br><span class="line">    <span class="comment">//ä¸è®¢é˜…ackermannè¯é¢˜       </span></span><br><span class="line">            &lt;param name=<span class="string">&quot;sub_ackermann&quot;</span> value=<span class="string">&quot;$(arg sub_ackermann)&quot;</span>/&gt; &lt;!-- sub ackermann topic <span class="keyword">or</span> <span class="keyword">not</span> --&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;--&gt;</span><br><span class="line">    <span class="comment">//å¦‚æœç»™è¯¥launchæ–‡ä»¶robot_nameå‚æ•°èµ‹å€¼ä¸ä¸ºç©ºåˆ™æ‰§è¡Œä¸‹åˆ—</span></span><br><span class="line">    &lt;group unless=<span class="string">&quot;$(eval robot_name == &#x27;&#x27;)&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//å‘½åç©ºé—´åä¼šåœ¨è¯é¢˜åå‰åŠ ä¸Šrobot_nameè¿™ä¸ªå˜é‡æ‰€å¯¹åº”çš„å‚æ•°å€¼ã€‚ä»¥odomè¯é¢˜ä¸ºä¾‹å¦‚æœä¼ å…¥çš„robot_nameæ˜¯robot1ï¼ŒæŸ¥çœ‹è¯é¢˜åˆ—è¡¨æ˜¾ç¤ºçš„å°±ä¼šæ˜¯/robot1/odom</span></span><br><span class="line">        &lt;group ns=<span class="string">&quot;$(arg robot_name)&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//å¯åŠ¨base_controlåŠŸèƒ½åŒ…ä¸‹çš„base_controlèŠ‚ç‚¹æ¥æ§åˆ¶æœºå™¨äººåº•ç›˜</span></span><br><span class="line">            &lt;node name=<span class="string">&quot;base_control&quot;</span>   pkg=<span class="string">&quot;base_control&quot;</span>  type=<span class="string">&quot;base_control.py&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//ç»™base_controlèŠ‚ç‚¹ä¼ å…¥å‚æ•°</span></span><br><span class="line">    <span class="comment">//æ³¢ç‰¹ç‡ï¼Œç«¯å£--é€šä¿¡ç”¨çš„ </span></span><br><span class="line">                &lt;param name=<span class="string">&quot;baudrate&quot;</span>   value=<span class="string">&quot;115200&quot;</span>/&gt;  </span><br><span class="line">                &lt;param name=&quot;port&quot;  value=&#x27;/dev/move_base&#x27;/&gt;</span><br><span class="line">    <span class="comment">//åº•ç›˜ã€odomã€imuè¿™äº›ç¡¬ä»¶å‘½åä¸ºæœºå™¨äººåå­—/æŸæŸåæ ‡ç³»--å¼•ç”¨äº†ä¸Šé¢çš„robot_name/base_footprintï¼Œrobot_name/odomï¼Œrobot_name/imu</span></span><br><span class="line">                &lt;param name=<span class="string">&quot;base_id&quot;</span>    value=<span class="string">&quot;$(arg robot_name)/$(arg base_frame)&quot;</span>/&gt; &lt;!-- base_link name --&gt;</span><br><span class="line">                &lt;param name=<span class="string">&quot;odom_id&quot;</span>    value=<span class="string">&quot;$(arg robot_name)/$(arg odom_frame)&quot;</span>/&gt;      &lt;!-- odom link name --&gt;</span><br><span class="line">                &lt;param name=<span class="string">&quot;imu_id&quot;</span>    value=<span class="string">&quot;$(arg robot_name)/$(arg imu_frame)&quot;</span>/&gt;      &lt;!-- imu link name --&gt;</span><br><span class="line">    <span class="comment">//odomã€imuã€ç”µæ± è¿™äº›ç¡¬ä»¶å‘å¸ƒçš„è¯é¢˜å‘½åä¸º--å¼•ç”¨äº†ä¸Šé¢çš„robot_name/odomï¼Œrobot_name/imu,robot_name/battery</span></span><br><span class="line">                &lt;param name=<span class="string">&quot;odom_topic&quot;</span> value=<span class="string">&quot;$(arg odom_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">                &lt;param name=<span class="string">&quot;imu_topic&quot;</span> value=<span class="string">&quot;$(arg imu_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">                &lt;param name=<span class="string">&quot;battery_topic&quot;</span> value=<span class="string">&quot;$(arg battery_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">    <span class="comment">//ç»ˆç«¯å‘å¸ƒçš„æ§åˆ¶é€Ÿåº¦è¯é¢˜å‘½åä¸º--å¼•ç”¨äº†ä¸Šé¢çš„robot_name/cmd_vel,robot_name/ackermann_cmd</span></span><br><span class="line">                &lt;param name=<span class="string">&quot;cmd_vel_topic&quot;</span> value=<span class="string">&quot;$(arg cmd_vel_topic)&quot;</span>/&gt; </span><br><span class="line">                &lt;param name=<span class="string">&quot;ackermann_cmd_topic&quot;</span> value=<span class="string">&quot;$(arg robot_name)$(arg ackermann_cmd_topic)&quot;</span>/&gt; &lt;!-- topic name --&gt;</span><br><span class="line">    <span class="comment">//imuå’Œé›·è¾¾ç¡¬ä»¶å‚æ•°ï¼ˆå‘é€è¯é¢˜ï¼‰æ”¹false</span></span><br><span class="line">                &lt;param name=<span class="string">&quot;pub_imu&quot;</span> value=<span class="string">&quot;$(arg pub_imu)&quot;</span>/&gt; &lt;!-- pub imu topic <span class="keyword">or</span> <span class="keyword">not</span> --&gt;</span><br><span class="line">                &lt;param name=<span class="string">&quot;pub_sonar&quot;</span> value=<span class="string">&quot;$(arg pub_sonar)&quot;</span>/&gt; &lt;!-- pub sonar topic <span class="keyword">or</span> <span class="keyword">not</span> --&gt;</span><br><span class="line">    <span class="comment">//ä¸è®¢é˜…ackermannè¯é¢˜  </span></span><br><span class="line">                &lt;param name=<span class="string">&quot;sub_ackermann&quot;</span> value=<span class="string">&quot;$(arg sub_ackermann)&quot;</span>/&gt; &lt;!-- sub ackermann topic <span class="keyword">or</span> <span class="keyword">not</span> --&gt;</span><br><span class="line">            &lt;/node&gt;</span><br><span class="line">        &lt;/group&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> base_control.pyæ–‡ä»¶ </summary>              <div class='content'>              <ol><li><p class='p blue'>æŒ‡æ˜è„šæœ¬è§£é‡Šå™¨ï¼Œç¼–ç æ¨¡å¼ï¼Œå¼€æºè¯ä¹¦ï¼Œè½½å…¥ä¾èµ–åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding=gbk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copyright 2019 Wechange Tech.</span></span><br><span class="line"><span class="comment"># Developer: FuZhi, Liu (liu.fuzhi@wechangetech.com)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import rospy</span><br><span class="line">import tf</span><br><span class="line">import time</span><br><span class="line">import sys</span><br><span class="line">import math</span><br><span class="line">import serial</span><br><span class="line">import string</span><br><span class="line">from geometry_msgs.msg import Twist</span><br><span class="line">from nav_msgs.msg import Odometry</span><br><span class="line">from sensor_msgs.msg import BatteryState</span><br><span class="line">from sensor_msgs.msg import Imu</span><br><span class="line">from sensor_msgs.msg import Range</span><br><span class="line"></span><br><span class="line">import ctypes</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>è¯»å–ç¯å¢ƒå˜é‡BASE_TYPEï¼ŒSONAR_NUMçš„å€¼ã€‚æ ¹æ®è½¦å‹å’Œè¶…å£°æ³¢æ•°é‡çš„ä¸åŒæ‰§è¡Œä¸åŒæŒ‡ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">base_type = os.getenv(<span class="string">&#x27;BASE_TYPE&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> os.getenv(<span class="string">&#x27;SONAR_NUM&#x27;</span>) is None:</span><br><span class="line">    sonar_num = 0</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    sonar_num = int(os.getenv(<span class="string">&#x27;SONAR_NUM&#x27;</span>)) </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p class='p blue'>è®¾è®¡ç¯å½¢é˜Ÿåˆ—ç¼“å­˜ä¸²å£æ•°æ®é˜²æ­¢æ•°æ®ä¸¢å¤±</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#class queue is design for uart receive data cache</span></span><br><span class="line">class queue:</span><br><span class="line">    def __init__(self, capacity = 1024*4):</span><br><span class="line">        self.capacity = capacity</span><br><span class="line">        self.size = 0</span><br><span class="line">        self.front = 0</span><br><span class="line">        self.rear = 0</span><br><span class="line">        self.array = [0]*capacity</span><br><span class="line"> </span><br><span class="line">    def is_empty(self):</span><br><span class="line">        <span class="built_in">return</span> 0 == self.size</span><br><span class="line"> </span><br><span class="line">    def is_full(self):</span><br><span class="line">        <span class="built_in">return</span> self.size == self.capacity</span><br><span class="line"> </span><br><span class="line">    def enqueue(self, element):</span><br><span class="line">        <span class="keyword">if</span> self.is_full():</span><br><span class="line">            raise Exception(<span class="string">&#x27;queue is full&#x27;</span>)</span><br><span class="line">        self.array[self.rear] = element</span><br><span class="line">        self.size += 1</span><br><span class="line">        self.rear = (self.rear + 1) % self.capacity</span><br><span class="line"> </span><br><span class="line">    def dequeue(self):</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            raise Exception(<span class="string">&#x27;queue is empty&#x27;</span>)</span><br><span class="line">        self.size -= 1</span><br><span class="line">        self.front = (self.front + 1) % self.capacity</span><br><span class="line"> </span><br><span class="line">    def get_front(self):</span><br><span class="line">        <span class="built_in">return</span> self.array[self.front]</span><br><span class="line">    </span><br><span class="line">    def get_front_second(self):</span><br><span class="line">        <span class="built_in">return</span> self.array[((self.front + 1) % self.capacity)]</span><br><span class="line"></span><br><span class="line">    def get_queue_length(self):</span><br><span class="line">        <span class="built_in">return</span> (self.rear - self.front + self.capacity) % self.capacity</span><br><span class="line"></span><br><span class="line">    def show_queue(self):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.capacity):</span><br><span class="line">            <span class="built_in">print</span> self.array[i],</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>è®¾è®¡BaseControlç±»å®ç°åº•ç›˜ç¡¬ä»¶çš„åŸºæœ¬æ§åˆ¶</p></li></ol><ul><li>1.è·å–åŸºæœ¬å‚æ•°å€¼(baseId,odomId,device_portç­‰éƒ½æ˜¯launchå®šä¹‰å¥½çš„ï¼Œæ²¡æœ‰çš„èµ‹å€¼æœ€åé¢çš„é»˜è®¤å€¼)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#class BaseControl is design for hardware base relative control</span></span><br><span class="line">class BaseControl:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        <span class="comment">#Get params</span></span><br><span class="line">        self.baseId = rospy.get_param(<span class="string">&#x27;~base_id&#x27;</span>,<span class="string">&#x27;base_footprint&#x27;</span>)</span><br><span class="line">        self.odomId = rospy.get_param(<span class="string">&#x27;~odom_id&#x27;</span>,<span class="string">&#x27;odom&#x27;</span>)</span><br><span class="line">        self.device_port = rospy.get_param(<span class="string">&#x27;~port&#x27;</span>,<span class="string">&#x27;/dev/ttyUSB0&#x27;</span>)</span><br><span class="line">        self.baudrate = int(rospy.get_param(<span class="string">&#x27;~baudrate&#x27;</span>,<span class="string">&#x27;115200&#x27;</span>))</span><br><span class="line">        self.odom_freq = int(rospy.get_param(<span class="string">&#x27;~odom_freq&#x27;</span>,<span class="string">&#x27;50&#x27;</span>))</span><br><span class="line">        self.odom_topic = rospy.get_param(<span class="string">&#x27;~odom_topic&#x27;</span>,<span class="string">&#x27;/odom&#x27;</span>)</span><br><span class="line">        self.battery_topic = rospy.get_param(<span class="string">&#x27;~battery_topic&#x27;</span>,<span class="string">&#x27;battery&#x27;</span>)</span><br><span class="line">        self.battery_freq = <span class="built_in">float</span>(rospy.get_param(<span class="string">&#x27;~battery_freq&#x27;</span>,<span class="string">&#x27;1&#x27;</span>))</span><br><span class="line">        self.cmd_vel_topic= rospy.get_param(<span class="string">&#x27;~cmd_vel_topic&#x27;</span>,<span class="string">&#x27;/cmd_vel&#x27;</span>)</span><br><span class="line">        self.ackermann_cmd_topic = rospy.get_param(<span class="string">&#x27;~ackermann_cmd_topic&#x27;</span>,<span class="string">&#x27;/ackermann_cmd_topic&#x27;</span>)</span><br><span class="line">            self.pub_imu = bool(rospy.get_param(<span class="string">&#x27;~pub_imu&#x27;</span>,False))</span><br><span class="line">        <span class="keyword">if</span>(self.pub_imu == True):</span><br><span class="line">            self.imuId = rospy.get_param(<span class="string">&#x27;~imu_id&#x27;</span>,<span class="string">&#x27;imu&#x27;</span>)</span><br><span class="line">            self.imu_topic = rospy.get_param(<span class="string">&#x27;~imu_topic&#x27;</span>,<span class="string">&#x27;imu&#x27;</span>)</span><br><span class="line">            self.imu_freq = <span class="built_in">float</span>(rospy.get_param(<span class="string">&#x27;~imu_freq&#x27;</span>,<span class="string">&#x27;50&#x27;</span>))</span><br><span class="line">            <span class="keyword">if</span> self.imu_freq &gt; 100:</span><br><span class="line">                self.imu_freq = 100</span><br><span class="line"></span><br><span class="line">        self.pub_sonar = bool(rospy.get_param(<span class="string">&#x27;~pub_sonar&#x27;</span>,False))</span><br><span class="line">        self.sub_ackermann = bool(rospy.get_param(<span class="string">&#x27;~sub_ackermann&#x27;</span>,False))</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>2.å®šä¹‰ä¸€äº›æ¥ä¸‹æ¥ç”¨çš„å˜é‡ <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define param</span></span><br><span class="line">self.current_time = rospy.Time.now()//å½“å‰æ—¶é—´</span><br><span class="line">self.previous_time = self.current_time//ä¹‹å‰æ—¶é—´</span><br><span class="line">self.pose_x = 0.0 //odomæ•°æ®é€šè¿‡è®¡ç®—æ˜¾ç¤ºçš„xåæ ‡</span><br><span class="line">self.pose_y = 0.0 //odomæ•°æ®é€šè¿‡è®¡ç®—æ˜¾ç¤ºçš„yåæ ‡</span><br><span class="line">self.pose_yaw = 0.0 //odomæ•°æ®é€šè¿‡è®¡ç®—æ˜¾ç¤ºçš„ç»•zè½´è½¬çš„è§’åº¦</span><br><span class="line">self.serialIDLE_flag = 0</span><br><span class="line">self.trans_x = 0.0 //å¤åˆ¶vel_cmdé‡Œå­˜çš„ä¿¡æ¯-xæ–¹å‘çš„çº¿é€Ÿåº¦</span><br><span class="line">self.trans_y = 0.0 //å¤åˆ¶vel_cmdé‡Œå­˜çš„ä¿¡æ¯-yæ–¹å‘çš„çº¿é€Ÿåº¦</span><br><span class="line">self.rotat_z = 0.0 //å¤åˆ¶vel_cmdé‡Œå­˜çš„ä¿¡æ¯-zæ–¹å‘çš„è§’é€Ÿåº¦</span><br><span class="line">self.speed = 0.0  // å¤åˆ¶ackermann_cmdé‡Œå­˜çš„ä¿¡æ¯-è½¬å‘é€Ÿåº¦</span><br><span class="line">self.steering_angle = 0.0//å¤åˆ¶ackermann_cmdé‡Œå­˜çš„ä¿¡æ¯-è½¬å‘è§’åº¦</span><br><span class="line">self.sendcounter = 0</span><br><span class="line">self.ImuErrFlag = False</span><br><span class="line">self.EncoderFlag = False</span><br><span class="line">self.BatteryFlag = False</span><br><span class="line">self.OdomTimeCounter = 0 //odomå®šæ—¶å™¨è®¡æ•°å™¨</span><br><span class="line">self.BatteryTimeCounter = 0 //ç”µæ± å®šæ—¶å™¨è®¡æ—¶å™¨</span><br><span class="line">self.Circleloop = queue(capacity = 1024*4) //ç¯å½¢é˜Ÿåˆ—</span><br><span class="line">self.Vx = 0//xè½´æ–¹å‘é€Ÿåº¦</span><br><span class="line">self.Vy = 0//yè½´æ–¹å‘é€Ÿåº¦</span><br><span class="line">self.Vyaw = 0//æ²¿yè½´è½¬åŠ¨çš„é€Ÿåº¦</span><br><span class="line">self.Yawz = 0//imuå§¿æ€-æ²¿zè½´è½¬åŠ¨çš„è§’åº¦</span><br><span class="line">self.Vvoltage = 0//ç”µæ± çš„ç”µå‹</span><br><span class="line">self.Icurrent = 0//ç”µæ± çš„ç”µæµ</span><br><span class="line">self.Gyro = [0,0,0]//é™€èºä»ª-å§¿æ€</span><br><span class="line">self.Accel = [0,0,0]//xyzæ–¹å‘çº¿åŠ é€Ÿåº¦</span><br><span class="line">self.Quat = [0,0,0,0]//å››å…ƒæ•°-å§¿æ€</span><br><span class="line">self.Sonar = [0,0,0,0]//è¶…å£°æ³¢æµ‹è·ä¿¡æ¯</span><br><span class="line">self.movebase_firmware_version = [0,0,0]//åº•ç›˜è½¯ä»¶ç‰ˆæœ¬å·</span><br><span class="line">self.movebase_hardware_version = [0,0,0]//åº•ç›˜ç¡¬ä»¶ç‰ˆæœ¬å·</span><br><span class="line">//åº•ç›˜ç±»å‹</span><br><span class="line">self.movebase_type = [<span class="string">&quot;NanoCar&quot;</span>,<span class="string">&quot;NanoRobot&quot;</span>,<span class="string">&quot;4WD_OMNI&quot;</span>,<span class="string">&quot;4WD&quot;</span>,<span class="string">&quot;RC_ACKERMAN&quot;</span>]</span><br><span class="line">//ç”µæœºå‹å·</span><br><span class="line">self.motor_type = [<span class="string">&quot;25GA370&quot;</span>,<span class="string">&quot;37GB520&quot;</span>,<span class="string">&quot;TT48&quot;</span>,<span class="string">&quot;RS365&quot;</span>,<span class="string">&quot;RS540&quot;</span>]</span><br><span class="line">self.last_cmd_vel_time = rospy.Time.now()</span><br><span class="line">self.last_ackermann_cmd_time = rospy.Time.now()</span><br></pre></td></tr></table></figure></li><li>3.æ‰“å¼€ä¸²å£<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Serial Communication</span></span><br><span class="line">try:</span><br><span class="line">    self.serial = serial.Serial(self.device_port,self.baudrate,timeout=10)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Opening Serial&quot;</span>)</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">if</span> self.serial.in_waiting:</span><br><span class="line">            self.serial.readall()</span><br><span class="line">    except:</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;Opening Serial Try Faild&quot;</span>)</span><br><span class="line">        pass</span><br><span class="line">except:</span><br><span class="line">    rospy.logerr(<span class="string">&quot;Can not open Serial&quot;</span>+self.device_port)</span><br><span class="line">    self.serial.close</span><br><span class="line">    sys.exit(0)</span><br><span class="line">rospy.loginfo(<span class="string">&quot;Serial Open Succeed&quot;</span>)</span><br></pre></td></tr></table></figure></li><li>4.åˆ¤æ–­å°è½¦ç±»å‹å¦‚æœæ˜¯ä¸èƒ½åŸåœ°æ‰“è½¬çš„ï¼Œè®¢é˜…ç”µæœºè½¬å‘ç§»åŠ¨è¯é¢˜ackermann topicå¦åˆ™è®¢é˜…cmd_vel topic<br>ç»ˆç«¯æ§åˆ¶è½¬å‘ç§»åŠ¨çš„è¯é¢˜ä¿¡æ¯æœ‰ä¸¤ç§ï¼šackermann_cmdå’Œcmd_vel<br>å½“ç»ˆç«¯çš„é”®ç›˜æ§åˆ¶èŠ‚ç‚¹å¯åŠ¨å°±ä¼šè‡ªåŠ¨å‘å¸ƒcmd_velï¼Œé”®ç›˜æ§åˆ¶æ—¶éšç€é”®ç›˜å˜åŒ–cmd_velé‡Œçš„é€Ÿåº¦ä¿¡æ¯ä¹Ÿå˜åŒ–(æ¯”å¦‚ç›´è¡Œ linear.x=10,å…¶ä½™ä¸º0 )<br>ä¹Ÿå¯ä»¥é€šè¿‡rostopic pubä¸»åŠ¨å‘å¸ƒè¯é¢˜cmd_vel<br>ackermann_cmd_topicå°±æ˜¯ackermann_cmd(launché‡Œå®šä¹‰çš„)<br>è®¢é˜…ç»ˆç«¯æ§åˆ¶è¯é¢˜,å½“é‡Œé¢æœ‰ä¸œè¥¿æ—¶æ‰§è¡Œå›è°ƒå‡½æ•°cmdCB<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#if move base type is ackermann car like robot and use ackermann msg ,sud ackermann topic,else sub cmd_vel topic</span></span><br><span class="line"><span class="keyword">if</span>((<span class="string">&#x27;NanoCar&#x27;</span> <span class="keyword">in</span> base_type) &amp; (self.sub_ackermann == True)):</span><br><span class="line">    from ackermann_msgs.msg import AckermannDriveStamped</span><br><span class="line">    self.sub = rospy.Subscriber(self.ackermann_cmd_topic,AckermannDriveStamped,self.ackermannCmdCB,queue_size=20)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    self.sub = rospy.Subscriber(self.cmd_vel_topic,Twist,self.cmdCB,queue_size=20)</span><br></pre></td></tr></table></figure></li><li>5.å®šä¹‰å‘å¸ƒå™¨(å‘å¸ƒodom,ç”µæ± ï¼Œè¶…å£°æ³¢è¯é¢˜)æ²¡å‘å¸ƒå‘¢<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">self.pub = rospy.Publisher(self.odom_topic,Odometry,queue_size=10)</span><br><span class="line">self.battery_pub = rospy.Publisher(self.battery_topic,BatteryState,queue_size=3)</span><br><span class="line"><span class="keyword">if</span> self.pub_sonar:</span><br><span class="line">    <span class="keyword">if</span> sonar_num &gt; 0:</span><br><span class="line">        self.range_pub1 = rospy.Publisher(<span class="string">&#x27;sonar_1&#x27;</span>,Range,queue_size=3)</span><br><span class="line">    <span class="keyword">if</span> sonar_num &gt; 1:    </span><br><span class="line">        self.range_pub2 = rospy.Publisher(<span class="string">&#x27;sonar_2&#x27;</span>,Range,queue_size=3)</span><br><span class="line">    <span class="keyword">if</span> sonar_num &gt; 2:</span><br><span class="line">        self.range_pub3 = rospy.Publisher(<span class="string">&#x27;sonar_3&#x27;</span>,Range,queue_size=3)</span><br><span class="line">    <span class="keyword">if</span> sonar_num &gt; 3:</span><br><span class="line">        self.range_pub4 = rospy.Publisher(<span class="string">&#x27;sonar_4&#x27;</span>,Range,queue_size=3)</span><br><span class="line">    <span class="keyword">if</span> sonar_num &gt; 0:</span><br><span class="line">        self.timer_sonar = rospy.Timer(rospy.Duration(100.0/1000),self.timerSonarCB)</span><br></pre></td></tr></table></figure></li><li>6.æ³¨å†Œtfåæ ‡å‘å¸ƒå™¨ï¼Œå®šä¹‰å®šæ—¶å™¨æ§åˆ¶odom,ç”µæ± å‘å¸ƒå‘¨æœŸä»¥åŠä¸²å£é€šä¿¡å¤šä¹…ä¸€æ¬¡<br>å®šæ—¶å™¨åˆ°äº†åˆ†åˆ«æ‰§è¡Œå›è°ƒå‡½æ•°timerOdomCBï¼ŒtimerBatteryCBï¼ŒtimerCommunicationCB<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self.tf_broadcaster = tf.TransformBroadcaster()</span><br><span class="line">self.timer_odom = rospy.Timer(rospy.Duration(1.0/self.odom_freq),self.timerOdomCB)</span><br><span class="line">self.timer_battery = rospy.Timer(rospy.Duration(1.0/self.battery_freq),self.timerBatteryCB)  </span><br><span class="line">self.timer_communication = rospy.Timer(rospy.Duration(1.0/500),self.timerCommunicationCB)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>7.å®šä¹‰å‘å¸ƒå™¨(å‘å¸ƒimu)æ²¡å‘å¸ƒå‘¢,å®šä¹‰å®šæ—¶å™¨æ§åˆ¶imuå‘å¸ƒå‘¨æœŸ,å®šæ—¶å™¨æ—¶é—´åˆ°äº†æ‰§è¡Œå›è°ƒå‡½æ•°timerIMUCB<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#inorder to compatibility old version firmware,imu topic is NOT pud in default</span></span><br><span class="line"><span class="keyword">if</span>(self.pub_imu):</span><br><span class="line">    self.imu_pub = rospy.Publisher(self.imu_topic,Imu,queue_size=10)</span><br><span class="line">    self.timer_imu = rospy.Timer(rospy.Duration(1.0/self.imu_freq),self.timerIMUCB) </span><br></pre></td></tr></table></figure></li><li>8.è·å–åº•ç›˜ç‰ˆæœ¬ï¼ˆè‡ªå†™ï¼‰,å‘äº†å‡ºå»ä½†æ²¡æœ‰æ”¶åˆ°åœ°ç›˜å›å¤<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">self.getVersion()</span><br><span class="line"><span class="comment">#move base imu initialization need about 2s,during initialization,move base system is blocked</span></span><br><span class="line"><span class="comment">#so need this gap</span></span><br><span class="line"><span class="keyword">while</span> self.movebase_hardware_version[0] == 0:</span><br><span class="line">    pass</span><br><span class="line"><span class="comment"># if self.movebase_hardware_version[0] &lt; 2:</span></span><br><span class="line"><span class="comment">#     print self.movebase_hardware_version</span></span><br><span class="line"><span class="comment">#     time.sleep(2.0)</span></span><br></pre></td></tr></table></figure></li><li>9.è·å–åº•ç›˜SNï¼ˆè‡ªå†™ï¼‰,å‘äº†å‡ºå»ä½†æ²¡æœ‰æ”¶åˆ°åœ°ç›˜å›å¤<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">self.getSN()</span><br><span class="line">time.sleep(0.01)</span><br><span class="line">self.getInfo()</span><br></pre></td></tr></table></figure></li><li>10.CRCæ ¡éªŒ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#CRC-8 Calculate</span></span><br><span class="line">    def crc_1byte(self,data):</span><br><span class="line">        crc_1byte = 0</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(0,8):</span><br><span class="line">            <span class="keyword">if</span>((crc_1byte^data)&amp;0x01):</span><br><span class="line">                crc_1byte^=0x18</span><br><span class="line">                crc_1byte&gt;&gt;=1</span><br><span class="line">                crc_1byte|=0x80</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                crc_1byte&gt;&gt;=1</span><br><span class="line">            data&gt;&gt;=1</span><br><span class="line">        <span class="built_in">return</span> crc_1byte</span><br><span class="line">    def crc_byte(self,data,length):</span><br><span class="line">        ret = 0</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">            ret = self.crc_1byte(ret^data[i])</span><br><span class="line">        <span class="built_in">return</span> ret               </span><br></pre></td></tr></table></figure></li><li>11.å®šä¹‰æ”¶åˆ°vel_cmdè¯é¢˜åçš„å›è°ƒå‡½æ•°å¹¶è®°å½•å›è°ƒæ—¶çš„æ—¶é—´,å¤åˆ¶vel_cmdé‡Œå­˜çš„ä¿¡æ¯ï¼Œæ ¹æ®ä¸²å£é€šè®¯è¿›è¡Œè½¬æ¢å†é€šè¿‡ä¸²å£å†™å…¥åº•ç›˜<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Subscribe vel_cmd call this to send vel cmd to move base</span></span><br><span class="line">    def cmdCB(self,data):</span><br><span class="line">        self.trans_x = data.linear.x</span><br><span class="line">        self.trans_y = data.linear.y</span><br><span class="line">        self.rotat_z = data.angular.z</span><br><span class="line">        self.last_cmd_vel_time = rospy.Time.now()</span><br><span class="line">        output = chr(0x5a) + chr(12) + chr(0x01) + chr(0x01) + \</span><br><span class="line">            chr((int(self.trans_x*1000.0)&gt;&gt;8)&amp;0xff) + chr(int(self.trans_x*1000.0)&amp;0xff) + \</span><br><span class="line">            chr((int(self.trans_y*1000.0)&gt;&gt;8)&amp;0xff) + chr(int(self.trans_y*1000.0)&amp;0xff) + \</span><br><span class="line">            chr((int(self.rotat_z*1000.0)&gt;&gt;8)&amp;0xff) + chr(int(self.rotat_z*1000.0)&amp;0xff) + \</span><br><span class="line">            chr(0x00)</span><br><span class="line">        outputdata = [0x5a,0x0c,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]</span><br><span class="line">        outputdata[4] = (int(self.trans_x*1000.0)&gt;&gt;8)&amp;0xff</span><br><span class="line">        outputdata[5] = int(self.trans_x*1000.0)&amp;0xff</span><br><span class="line">        outputdata[6] = (int(self.trans_y*1000.0)&gt;&gt;8)&amp;0xff</span><br><span class="line">        outputdata[7] = int(self.trans_y*1000.0)&amp;0xff</span><br><span class="line">        outputdata[8] = (int(self.rotat_z*1000.0)&gt;&gt;8)&amp;0xff</span><br><span class="line">        outputdata[9] = int(self.rotat_z*1000.0)&amp;0xff</span><br><span class="line">        crc_8 = self.crc_byte(outputdata,len(outputdata)-1)</span><br><span class="line">        output += chr(crc_8)</span><br><span class="line">        <span class="keyword">while</span> self.serialIDLE_flag:</span><br><span class="line">            time.sleep(0.01)</span><br><span class="line">        self.serialIDLE_flag = 4</span><br><span class="line">        try:</span><br><span class="line">            <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">                pass</span><br><span class="line">            self.serial.write(output)</span><br><span class="line">        except:</span><br><span class="line">            rospy.logerr(<span class="string">&quot;Vel Command Send Faild&quot;</span>)</span><br><span class="line">        self.serialIDLE_flag = 0</span><br></pre></td></tr></table></figure></li><li>12.å®šä¹‰æ”¶åˆ°ackermann_cmdè¯é¢˜åçš„å›è°ƒå‡½æ•°å¹¶è®°å½•å›è°ƒæ—¶çš„æ—¶é—´,å¤åˆ¶ackermann_cmdé‡Œå­˜çš„ä¿¡æ¯ï¼Œæ ¹æ®ä¸²å£é€šè®¯è¿›è¡Œè½¬æ¢å†é€šè¿‡ä¸²å£å†™å…¥åº•ç›˜<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Subscribe ackermann Cmd call this to send vel cmd to move base</span></span><br><span class="line">def ackermannCmdCB(self,data):</span><br><span class="line">    self.speed = data.drive.speed</span><br><span class="line">    self.steering_angle = data.drive.steering_angle</span><br><span class="line">    self.last_ackermann_cmd_time = rospy.Time.now()</span><br><span class="line">    output = chr(0x5a) + chr(12) + chr(0x01) + chr(0x15) + \</span><br><span class="line">        chr((int(self.speed*1000.0)&gt;&gt;8)&amp;0xff) + chr(int(self.speed*1000.0)&amp;0xff) + \</span><br><span class="line">        chr(0x00) + chr(0x00) + \</span><br><span class="line">        chr((int(self.steering_angle*1000.0)&gt;&gt;8)&amp;0xff) + chr(int(self.steering_angle*1000.0)&amp;0xff) + \</span><br><span class="line">        chr(0x00)</span><br><span class="line">    outputdata = [0x5a,0x0c,0x01,0x15,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]</span><br><span class="line">    outputdata[4] = (int(self.speed*1000.0)&gt;&gt;8)&amp;0xff</span><br><span class="line">    outputdata[5] = int(self.speed*1000.0)&amp;0xff</span><br><span class="line">    outputdata[8] = (int(self.steering_angle*1000.0)&gt;&gt;8)&amp;0xff</span><br><span class="line">    outputdata[9] = int(self.steering_angle*1000.0)&amp;0xff</span><br><span class="line">    crc_8 = self.crc_byte(outputdata,len(outputdata)-1)</span><br><span class="line">    output += chr(crc_8)</span><br><span class="line">    <span class="keyword">while</span> self.serialIDLE_flag:</span><br><span class="line">        time.sleep(0.01)</span><br><span class="line">    self.serialIDLE_flag = 4</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">            pass</span><br><span class="line">        self.serial.write(output)</span><br><span class="line">    except:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Vel Command Send Faild&quot;</span>)</span><br><span class="line">    self.serialIDLE_flag = 0</span><br></pre></td></tr></table></figure></li><li>13.ç¼–å†™å®šæ—¶å™¨å›è°ƒå‡½æ•°timerCommunicationCB-æ£€æŸ¥ä¸²å£ä¸­æœ‰æ— ç¼“å­˜æ•°æ®,æœ‰çš„è¯å­˜æ”¾åˆ°ç¼–å†™å¥½çš„æ¶ˆæ¯ç¯å½¢é˜Ÿåˆ—,å¦‚æœæ¶ˆæ¯ç¯å½¢é˜Ÿåˆ—æœ‰æ•°æ®æŠŠæ•°æ®å–å‡ºæ¥æ”¾åˆ°æˆ‘ä»¬å®šä¹‰çš„å˜é‡<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Communication Timer callback to handle receive data</span></span><br><span class="line"><span class="comment">#depend on communication protocol</span></span><br><span class="line">def timerCommunicationCB(self,event):</span><br><span class="line">    length = self.serial.in_waiting</span><br><span class="line">    <span class="keyword">if</span> length:</span><br><span class="line">        reading = self.serial.read_all()</span><br><span class="line">        <span class="keyword">if</span> len(reading)!=0:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(0,len(reading)):</span><br><span class="line">                data = (int(reading[i].encode(<span class="string">&#x27;hex&#x27;</span>),16)) </span><br><span class="line">                try:</span><br><span class="line">                    self.Circleloop.enqueue(data)</span><br><span class="line">                except:</span><br><span class="line">                    pass</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        pass</span><br><span class="line">    <span class="keyword">if</span> self.Circleloop.is_empty()==False:</span><br><span class="line">        data = self.Circleloop.get_front()</span><br><span class="line">        <span class="keyword">if</span> data == 0x5a:</span><br><span class="line">            length = self.Circleloop.get_front_second()</span><br><span class="line">            <span class="keyword">if</span> length &gt; 1 :</span><br><span class="line">                <span class="keyword">if</span> self.Circleloop.get_front_second() &lt;= self.Circleloop.get_queue_length():</span><br><span class="line">                    databuf = []</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">                        databuf.append(self.Circleloop.get_front())</span><br><span class="line">                        self.Circleloop.dequeue()</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span> (databuf[length-1]) == self.crc_byte(databuf,length-1):</span><br><span class="line">                        pass</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        pass</span><br><span class="line">                    <span class="comment">#parse receive data</span></span><br><span class="line">                    <span class="keyword">if</span>(databuf[3] == 0x04):</span><br><span class="line">                        self.Vx =    databuf[4]*256</span><br><span class="line">                        self.Vx +=   databuf[5]</span><br><span class="line">                        self.Vy =    databuf[6]*256</span><br><span class="line">                        self.Vy +=   databuf[7]</span><br><span class="line">                        self.Vyaw =  databuf[8]*256</span><br><span class="line">                        self.Vyaw += databuf[9]</span><br><span class="line">                    <span class="keyword">elif</span>(databuf[3] == 0x06):</span><br><span class="line">                        self.Yawz =  databuf[8]*256</span><br><span class="line">                        self.Yawz += databuf[9]</span><br><span class="line">                    <span class="keyword">elif</span> (databuf[3] == 0x08):</span><br><span class="line">                        self.Vvoltage = databuf[4]*256</span><br><span class="line">                        self.Vvoltage += databuf[5]</span><br><span class="line">                        self.Icurrent = databuf[6]*256</span><br><span class="line">                        self.Icurrent += databuf[7]</span><br><span class="line">                    <span class="keyword">elif</span> (databuf[3] == 0x0a):</span><br><span class="line">                        self.Vx =    databuf[4]*256</span><br><span class="line">                        self.Vx +=   databuf[5]</span><br><span class="line">                        self.Yawz =  databuf[6]*256</span><br><span class="line">                        self.Yawz += databuf[7]</span><br><span class="line">                        self.Vyaw =  databuf[8]*256</span><br><span class="line">                        self.Vyaw += databuf[9]</span><br><span class="line">                    <span class="keyword">elif</span> (databuf[3] == 0x12):</span><br><span class="line">                        self.Vx =    databuf[4]*256</span><br><span class="line">                        self.Vx +=   databuf[5]</span><br><span class="line">                        self.Vy =  databuf[6]*256</span><br><span class="line">                        self.Vy += databuf[7]</span><br><span class="line">                        self.Yawz =  databuf[8]*256</span><br><span class="line">                        self.Yawz += databuf[9]    </span><br><span class="line">                        self.Vyaw =  databuf[10]*256</span><br><span class="line">                        self.Vyaw += databuf[11]                          </span><br><span class="line">                    <span class="keyword">elif</span> (databuf[3] == 0x14):</span><br><span class="line">                        self.Gyro[0] = int(((databuf[4]&amp;0xff)&lt;&lt;<span class="string">24)|((databuf[5]&amp;0xff)&lt;&lt;16)|((databuf[6]&amp;0xff)&lt;&lt;8)|(databuf[7]&amp;0xff))</span></span><br><span class="line"><span class="string">                        self.Gyro[1] = int(((databuf[8]&amp;0xff)&lt;&lt;24</span>)|((databuf[9]&amp;0xff)&lt;&lt;<span class="string">16)|((databuf[10]&amp;0xff)&lt;&lt;8)|(databuf[11]&amp;0xff))</span></span><br><span class="line"><span class="string">                        self.Gyro[2] = int(((databuf[12]&amp;0xff)&lt;&lt;24)|((databuf[13]&amp;0xff)&lt;&lt;16</span>)|((databuf[14]&amp;0xff)&lt;&lt;<span class="string">8)|(databuf[15]&amp;0xff))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                        self.Accel[0] = int(((databuf[16]&amp;0xff)&lt;&lt;24)|((databuf[17]&amp;0xff)&lt;&lt;16)|((databuf[18]&amp;0xff)&lt;&lt;8</span>)|(databuf[19]&amp;0xff))</span><br><span class="line">                        self.Accel[1] = int(((databuf[20]&amp;0xff)&lt;&lt;<span class="string">24)|((databuf[21]&amp;0xff)&lt;&lt;16)|((databuf[22]&amp;0xff)&lt;&lt;8)|(databuf[23]&amp;0xff))</span></span><br><span class="line"><span class="string">                        self.Accel[2] = int(((databuf[24</span>]&amp;0xff)&lt;&lt;<span class="string">24)|((databuf[25]&amp;0xff)&lt;&lt;16)|((databuf[26]&amp;0xff)&lt;&lt;8)|(databuf[27]&amp;0xff))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                        self.Quat[0] = int((databuf[28]&amp;0xff)&lt;&lt;8|databuf[29])</span></span><br><span class="line"><span class="string">                        self.Quat[1] = int((databuf[30]&amp;0xff)&lt;&lt;8|databuf[31])</span></span><br><span class="line"><span class="string">                        self.Quat[2] = int((databuf[32]&amp;0xff)&lt;&lt;8|databuf[33])</span></span><br><span class="line"><span class="string">                        self.Quat[3] = int((databuf[34]&amp;0xff)&lt;&lt;8|databuf[35])</span></span><br><span class="line"><span class="string">                    elif (databuf[3] == 0x1a):</span></span><br><span class="line"><span class="string">                        self.Sonar[0] = databuf[4]</span></span><br><span class="line"><span class="string">                        self.Sonar[1] = databuf[5]</span></span><br><span class="line"><span class="string">                        self.Sonar[2] = databuf[6]</span></span><br><span class="line"><span class="string">                        self.Sonar[3] = databuf[7]    </span></span><br><span class="line"><span class="string">                    elif(databuf[3] == 0xf2):</span></span><br><span class="line"><span class="string">                        self.movebase_hardware_version[0] = databuf[4]</span></span><br><span class="line"><span class="string">                        self.movebase_hardware_version[1] = databuf[5]</span></span><br><span class="line"><span class="string">                        self.movebase_hardware_version[2] = databuf[6]</span></span><br><span class="line"><span class="string">                        self.movebase_firmware_version[0] = databuf[7]</span></span><br><span class="line"><span class="string">                        self.movebase_firmware_version[1] = databuf[8]</span></span><br><span class="line"><span class="string">                        self.movebase_firmware_version[2] = databuf[9]</span></span><br><span class="line"><span class="string">                        version_string = &quot;Move Base Hardware Ver %d.%d.%d,Firmware Ver %d.%d.%d&quot;\</span></span><br><span class="line"><span class="string">                            %(self.movebase_hardware_version[0],self.movebase_hardware_version[1],self.movebase_hardware_version[2],\</span></span><br><span class="line"><span class="string">                            self.movebase_firmware_version[0],self.movebase_firmware_version[1],self.movebase_firmware_version[2])</span></span><br><span class="line"><span class="string">                        rospy.loginfo(version_string)</span></span><br><span class="line"><span class="string">                    elif(databuf[3] == 0xf4):</span></span><br><span class="line"><span class="string">                        sn_string = &quot;SN:&quot;</span></span><br><span class="line"><span class="string">                        for i in range(4,16):</span></span><br><span class="line"><span class="string">                            sn_string = &quot;%s%02x&quot;%(sn_string,databuf[i])</span></span><br><span class="line"><span class="string">                        rospy.loginfo(sn_string)                            </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    elif(databuf[3] == 0x22):</span></span><br><span class="line"><span class="string">                        fRatio = float(databuf[6]&lt;&lt;8|databuf[7])/10</span></span><br><span class="line"><span class="string">                        fDiameter = float(databuf[8]&lt;&lt;8|databuf[9])/10</span></span><br><span class="line"><span class="string">                        info_string = &quot;Type:%s Motor:%s Ratio:%.01f WheelDiameter:%.01f&quot;\</span></span><br><span class="line"><span class="string">                            %(self.movebase_type[databuf[4]-1],self.motor_type[databuf[5]-1],fRatio,fDiameter)</span></span><br><span class="line"><span class="string">                        rospy.loginfo(info_string)</span></span><br><span class="line"><span class="string">                    else:</span></span><br><span class="line"><span class="string">                        pass</span></span><br><span class="line"><span class="string">            else:</span></span><br><span class="line"><span class="string">                pass</span></span><br><span class="line"><span class="string">        else:</span></span><br><span class="line"><span class="string">            self.Circleloop.dequeue()</span></span><br><span class="line"><span class="string">    else:</span></span><br><span class="line"><span class="string">        # rospy.loginfo(&quot;Circle is Empty&quot;)</span></span><br><span class="line"><span class="string">        pass</span></span><br></pre></td></tr></table></figure></li><li>14.ç¼–å†™è·å–åº•ç›˜ç‰ˆæœ¬å‡½æ•°,å‘äº†å‡ºå»ä½†æ²¡æœ‰æ”¶åˆ°åº•ç›˜å›å¤<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#get move base hardware &amp; firmware version    </span></span><br><span class="line">def getVersion(self):</span><br><span class="line">    <span class="comment">#Get version info</span></span><br><span class="line">    output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0xf1) + chr(0x00) + chr(0xd7) <span class="comment">#0xd7 is CRC-8 value</span></span><br><span class="line">    <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">        time.sleep(0.01)</span><br><span class="line">    self.serialIDLE_flag = 1</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">            pass</span><br><span class="line">        self.serial.write(output)</span><br><span class="line">    except:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Get Version Command Send Faild&quot;</span>)</span><br><span class="line">    self.serialIDLE_flag = 0 </span><br></pre></td></tr></table></figure></li><li>15.ç¼–å†™è·å–åº•ç›˜SNå‡½æ•°,å‘äº†å‡ºå»ä½†æ²¡æœ‰æ”¶åˆ°åº•ç›˜å›å¤<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#get move base SN</span></span><br><span class="line">def getSN(self):</span><br><span class="line">    <span class="comment">#Get version info</span></span><br><span class="line">    output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0xf3) + chr(0x00) + chr(0x46) <span class="comment">#0x46 is CRC-8 value</span></span><br><span class="line">    <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">        time.sleep(0.01)</span><br><span class="line">    self.serialIDLE_flag = 1</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">            pass</span><br><span class="line">        self.serial.write(output)</span><br><span class="line">    except:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Get SN Command Send Faild&quot;</span>)</span><br><span class="line">    self.serialIDLE_flag = 0  </span><br></pre></td></tr></table></figure></li><li>16.ç¼–å†™è·å–åº•ç›˜ä¿¡æ¯å‡½æ•°(è½¦å‹ï¼Œè½®è·)å‘äº†å‡ºå»ä½†æ²¡æœ‰æ”¶åˆ°åº•ç›˜å›å¤<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#get move base info</span></span><br><span class="line">def getInfo(self):</span><br><span class="line">    <span class="comment">#Get version info</span></span><br><span class="line">    output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0x21) + chr(0x00) + chr(0x8f) <span class="comment">#0x8f is CRC-8 value</span></span><br><span class="line">    <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">        time.sleep(0.01)</span><br><span class="line">    self.serialIDLE_flag = 1</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">            pass</span><br><span class="line">        self.serial.write(output)</span><br><span class="line">    except:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Get info Command Send Faild&quot;</span>)</span><br><span class="line">    self.serialIDLE_flag = 0            </span><br></pre></td></tr></table></figure></li><li>17.ç¼–å†™å®šæ—¶å™¨å›è°ƒå‡½æ•°timerOdomCB-å°†ä¸²å£å‘é€çš„odomä¿¡æ¯ç»è¿‡å¤„ç†å¾—åˆ°ä½å§¿ä¿¡æ¯ï¼Œå¡«å…¥odomè¯é¢˜å¹¶å‘å¸ƒ,åŒæ—¶å‘å¸ƒtfåæ ‡å¹¿æ’­(åº•ç›˜åæ ‡ç³»åœ¨odomåæ ‡ç³»ä¸­çš„ä½å§¿)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Odom Timer call this to get velocity and imu info and convert to odom topic</span></span><br><span class="line">def timerOdomCB(self,event):</span><br><span class="line">    <span class="comment">#Get move base velocity data</span></span><br><span class="line">    <span class="keyword">if</span> self.movebase_firmware_version[1] == 0: </span><br><span class="line">        <span class="comment">#old version firmware have no version info and not support new command below</span></span><br><span class="line">        output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0x09) + chr(0x00) + chr(0x38) <span class="comment">#0x38 is CRC-8 value</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment">#in firmware version new than v1.1.0,support this command      </span></span><br><span class="line">        output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0x11) + chr(0x00) + chr(0xa2) </span><br><span class="line">    <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">        time.sleep(0.01)</span><br><span class="line">    self.serialIDLE_flag = 1</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">            pass</span><br><span class="line">        self.serial.write(output)</span><br><span class="line">    except:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Odom Command Send Faild&quot;</span>)</span><br><span class="line">    self.serialIDLE_flag = 0   </span><br><span class="line">    <span class="comment">#calculate odom data</span></span><br><span class="line">    Vx = <span class="built_in">float</span>(ctypes.c_int16(self.Vx).value/1000.0)</span><br><span class="line">    Vy = <span class="built_in">float</span>(ctypes.c_int16(self.Vy).value/1000.0)</span><br><span class="line">    Vyaw = <span class="built_in">float</span>(ctypes.c_int16(self.Vyaw).value/1000.0)</span><br><span class="line"></span><br><span class="line">    self.pose_yaw = <span class="built_in">float</span>(ctypes.c_int16(self.Yawz).value/100.0)</span><br><span class="line">    self.pose_yaw = self.pose_yaw*math.pi/180.0</span><br><span class="line">  </span><br><span class="line">    self.current_time = rospy.Time.now()</span><br><span class="line">    dt = (self.current_time - self.previous_time).to_sec()</span><br><span class="line">    self.previous_time = self.current_time</span><br><span class="line">    self.pose_x = self.pose_x + Vx * (math.cos(self.pose_yaw))*dt - Vy * (math.sin(self.pose_yaw))*dt</span><br><span class="line">    self.pose_y = self.pose_y + Vx * (math.sin(self.pose_yaw))*dt + Vy * (math.cos(self.pose_yaw))*dt</span><br><span class="line"></span><br><span class="line">    pose_quat = tf.transformations.quaternion_from_euler(0,0,self.pose_yaw)        </span><br><span class="line">    msg = Odometry()</span><br><span class="line">    msg.header.stamp = self.current_time</span><br><span class="line">    msg.header.frame_id = self.odomId</span><br><span class="line">    msg.child_frame_id =self.baseId</span><br><span class="line">    msg.pose.pose.position.x = self.pose_x</span><br><span class="line">    msg.pose.pose.position.y = self.pose_y</span><br><span class="line">    msg.pose.pose.position.z = 0</span><br><span class="line">    msg.pose.pose.orientation.x = pose_quat[0]</span><br><span class="line">    msg.pose.pose.orientation.y = pose_quat[1]</span><br><span class="line">    msg.pose.pose.orientation.z = pose_quat[2]</span><br><span class="line">    msg.pose.pose.orientation.w = pose_quat[3]</span><br><span class="line">    msg.twist.twist.linear.x = Vx</span><br><span class="line">    msg.twist.twist.linear.y = Vy</span><br><span class="line">    msg.twist.twist.angular.z = Vyaw</span><br><span class="line">    self.pub.publish(msg)</span><br><span class="line">    self.tf_broadcaster.sendTransform((self.pose_x,self.pose_y,0.0),pose_quat,self.current_time,self.baseId,self.odomId)</span><br><span class="line"> </span><br></pre></td></tr></table></figure></li><li>18.ç¼–å†™å®šæ—¶å™¨å›è°ƒå‡½æ•°timerBatteryCB-å°†ä¸²å£å‘é€çš„ç”µæ± ä¿¡æ¯ç»è¿‡å¤„ç†å¡«å…¥ç”µæ± è¯é¢˜å¹¶å‘å¸ƒ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Battery Timer callback function to get battery info</span></span><br><span class="line">    def timerBatteryCB(self,event):</span><br><span class="line">        output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0x07) + chr(0x00) + chr(0xe4) <span class="comment">#0xe4 is CRC-8 value</span></span><br><span class="line">        <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">            time.sleep(0.01)</span><br><span class="line">        self.serialIDLE_flag = 3</span><br><span class="line">        try:</span><br><span class="line">            <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">                pass</span><br><span class="line">            self.serial.write(output)</span><br><span class="line">        except:</span><br><span class="line">            rospy.logerr(<span class="string">&quot;Battery Command Send Faild&quot;</span>)</span><br><span class="line">        self.serialIDLE_flag = 0</span><br><span class="line">        msg = BatteryState()</span><br><span class="line">        msg.header.stamp = self.current_time</span><br><span class="line">        msg.header.frame_id = self.baseId</span><br><span class="line">        msg.voltage = <span class="built_in">float</span>(self.Vvoltage/1000.0)</span><br><span class="line">        msg.current = <span class="built_in">float</span>(self.Icurrent/1000.0)</span><br><span class="line">        self.battery_pub.publish(msg)</span><br></pre></td></tr></table></figure></li><li>19.ç¼–å†™å®šæ—¶å™¨å›è°ƒå‡½æ•°timerSonarCB-å°†ä¸²å£å‘é€çš„è¶…å£°æ³¢ä¿¡æ¯ç»è¿‡å¤„ç†å¡«å…¥è¶…å£°æ³¢è¯é¢˜å¹¶å‘å¸ƒ,åŒæ—¶å‘å¸ƒtfåæ ‡å¹¿æ’­(è¶…å£°æ³¢ä»ªå™¨å’Œåº•ç›˜)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sonar Timer callback function to get battery info</span></span><br><span class="line">    def timerSonarCB(self,event):</span><br><span class="line">        output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0x19) + chr(0x00) + chr(0xff) <span class="comment">#0xff is CRC-8 value</span></span><br><span class="line">        <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">            time.sleep(0.01)</span><br><span class="line">        self.serialIDLE_flag = 3</span><br><span class="line">        try:</span><br><span class="line">            <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">                pass</span><br><span class="line">            self.serial.write(output)</span><br><span class="line">        except:</span><br><span class="line">            rospy.logerr(<span class="string">&quot;Sonar Command Send Faild&quot;</span>)</span><br><span class="line">        self.serialIDLE_flag = 0</span><br><span class="line">        msg = Range()</span><br><span class="line">        msg.header.stamp = self.current_time</span><br><span class="line">        msg.field_of_view = 0.26 <span class="comment">#about 15 degree</span></span><br><span class="line">        msg.max_range = 2.5</span><br><span class="line">        msg.min_range = 0.01</span><br><span class="line">        <span class="comment"># Sonar 1</span></span><br><span class="line">        msg.header.frame_id = <span class="string">&#x27;Sonar_1&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> self.Sonar[0] == 0xff:</span><br><span class="line">            msg.range = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>) </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg.range = self.Sonar[0] / 100.0</span><br><span class="line">        self.range_pub1.publish(msg)</span><br><span class="line">         </span><br><span class="line">        <span class="comment"># TF value calculate from mechanical structure</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;NanoRobot&#x27;</span> <span class="keyword">in</span> base_type ):</span><br><span class="line">            self.tf_broadcaster.sendTransform((0.0, 0.0, 0.0 ),(0.0, 0.0, 0.0, 1.0),self.current_time,<span class="string">&#x27;Sonar_1&#x27;</span>,self.baseId)</span><br><span class="line">        <span class="keyword">elif</span>(<span class="string">&#x27;NanoCar&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">            self.tf_broadcaster.sendTransform((0.18, 0.0, 0.0 ),(0.0, 0.0, 0.0, 1.0),self.current_time,<span class="string">&#x27;Sonar_1&#x27;</span>,self.baseId)</span><br><span class="line">        <span class="keyword">elif</span>(<span class="string">&#x27;4WD&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">            self.tf_broadcaster.sendTransform((0.0, 0.0, 0.0 ),(0.0, 0.0, 0.0, 1.0),self.current_time,<span class="string">&#x27;Sonar_1&#x27;</span>,self.baseId)</span><br><span class="line">        <span class="keyword">elif</span>(<span class="string">&#x27;Race182&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">            self.tf_broadcaster.sendTransform((0.18, 0.0, 0.0 ),(0.0, 0.0, 0.0, 1.0),self.current_time,<span class="string">&#x27;Sonar_1&#x27;</span>,self.baseId)   </span><br><span class="line">        <span class="keyword">elif</span>(<span class="string">&#x27;NanoOmni&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">            self.tf_broadcaster.sendTransform((0.11, 0.0, 0.0 ),(0.0, 0.0, 0.0, 1.0),self.current_time,<span class="string">&#x27;Sonar_1&#x27;</span>,self.baseId)              </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pass</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Sonar 2</span></span><br><span class="line">        <span class="keyword">if</span> sonar_num &gt; 1:   </span><br><span class="line">            <span class="keyword">if</span> self.Sonar[1] == 0xff:</span><br><span class="line">                msg.range = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>) </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                msg.range = self.Sonar[1] / 100.0</span><br><span class="line">            msg.header.frame_id = <span class="string">&#x27;Sonar_2&#x27;</span></span><br><span class="line">            self.range_pub2.publish(msg)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&#x27;NanoRobot&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((0.0, 0.0 ,0.0 ),(0.0,0.0,-1.0,0),self.current_time,<span class="string">&#x27;Sonar_2&#x27;</span>,self.baseId) </span><br><span class="line">            <span class="keyword">elif</span>(<span class="string">&#x27;NanoCar&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((-0.035, 0.0 ,0.0 ),(0.0,0.0,-1.0,0),self.current_time,<span class="string">&#x27;Sonar_2&#x27;</span>,self.baseId) </span><br><span class="line">            <span class="keyword">elif</span>(<span class="string">&#x27;4WD&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((0.0, 0.0 ,0.0 ),(0.0,0.0,-1.0,0),self.current_time,<span class="string">&#x27;Sonar_2&#x27;</span>,self.baseId) </span><br><span class="line">            <span class="keyword">elif</span>(<span class="string">&#x27;Race182&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((-0.08, 0.0 ,0.0 ),(0.0,0.0,-1.0,0),self.current_time,<span class="string">&#x27;Sonar_2&#x27;</span>,self.baseId)     </span><br><span class="line">            <span class="keyword">elif</span>(<span class="string">&#x27;NanoOmni&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((-0.11, 0.0, 0.0 ),(0.0, 0.0, -1.0, 0.0),self.current_time,<span class="string">&#x27;Sonar_2&#x27;</span>,self.baseId)  </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pass</span><br><span class="line">        <span class="keyword">if</span> sonar_num &gt; 2:   </span><br><span class="line">        <span class="comment"># Sonar 3</span></span><br><span class="line">            msg.header.frame_id = <span class="string">&#x27;Sonar_3&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> self.Sonar[2] == 0xff:</span><br><span class="line">                msg.range = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>) </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                msg.range = self.Sonar[2] / 100.0</span><br><span class="line">            self.range_pub3.publish(msg)</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&#x27;Race182&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((0.0, 0.06 ,0.0 ),(0.0,0.0,0.707,0.707),self.current_time,<span class="string">&#x27;Sonar_3&#x27;</span>,self.baseId) </span><br><span class="line">            <span class="keyword">elif</span>(<span class="string">&#x27;NanoOmni&#x27;</span> <span class="keyword">in</span> base_type):   </span><br><span class="line">                self.tf_broadcaster.sendTransform((0.0, 0.07 ,0.0 ),(0.0,0.0,0.707,0.707),self.current_time,<span class="string">&#x27;Sonar_3&#x27;</span>,self.baseId)          </span><br><span class="line">        <span class="keyword">if</span> sonar_num &gt; 3:   </span><br><span class="line">        <span class="comment"># Sonar 4</span></span><br><span class="line">            <span class="keyword">if</span> self.Sonar[3] == 0xff:</span><br><span class="line">                msg.range = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>) </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                msg.range = self.Sonar[3] / 100.0</span><br><span class="line">            msg.header.frame_id = <span class="string">&#x27;Sonar_4&#x27;</span></span><br><span class="line">            self.range_pub4.publish(msg)</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&#x27;Race182&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((0.0, -0.06 ,0.0 ),(0.0,0.0,-0.707,0.707),self.current_time,<span class="string">&#x27;Sonar_4&#x27;</span>,self.baseId) </span><br><span class="line">            <span class="keyword">elif</span>(<span class="string">&#x27;NanoOmni&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">                self.tf_broadcaster.sendTransform((0.0, -0.07 ,0.0 ),(0.0,0.0,-0.707,0.707),self.current_time,<span class="string">&#x27;Sonar_4&#x27;</span>,self.baseId) </span><br></pre></td></tr></table></figure></li><li>20.ç¼–å†™å®šæ—¶å™¨å›è°ƒå‡½æ•°timerIMUCB-å°†ä¸²å£å‘é€çš„imuä¿¡æ¯ç»è¿‡å¤„ç†å¡«å…¥imuè¯é¢˜å¹¶å‘å¸ƒ,åŒæ—¶å‘å¸ƒtfåæ ‡å¹¿æ’­(imuå’Œåº•ç›˜)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#IMU Timer callback function to get raw imu info</span></span><br><span class="line">def timerIMUCB(self,event):</span><br><span class="line">    output = chr(0x5a) + chr(0x06) + chr(0x01) + chr(0x13) + chr(0x00) + chr(0x33) <span class="comment">#0x33 is CRC-8 value</span></span><br><span class="line">    <span class="keyword">while</span>(self.serialIDLE_flag):</span><br><span class="line">        time.sleep(0.01)</span><br><span class="line">    self.serialIDLE_flag = 3</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">while</span> self.serial.out_waiting:</span><br><span class="line">            pass</span><br><span class="line">        self.serial.write(output)</span><br><span class="line">    except:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Imu Command Send Faild&quot;</span>)</span><br><span class="line"></span><br><span class="line">    self.serialIDLE_flag = 0</span><br><span class="line">    msg = Imu()</span><br><span class="line">    msg.header.stamp = self.current_time</span><br><span class="line">    msg.header.frame_id = self.imuId</span><br><span class="line"></span><br><span class="line">    msg.angular_velocity.x = <span class="built_in">float</span>(ctypes.c_int32(self.Gyro[0]).value/100000.0)</span><br><span class="line">    msg.angular_velocity.y = <span class="built_in">float</span>(ctypes.c_int32(self.Gyro[1]).value/100000.0)</span><br><span class="line">    msg.angular_velocity.z = <span class="built_in">float</span>(ctypes.c_int32(self.Gyro[2]).value/100000.0)</span><br><span class="line"></span><br><span class="line">    msg.linear_acceleration.x = <span class="built_in">float</span>(ctypes.c_int32(self.Accel[0]).value/100000.0)</span><br><span class="line">    msg.linear_acceleration.y = <span class="built_in">float</span>(ctypes.c_int32(self.Accel[1]).value/100000.0)</span><br><span class="line">    msg.linear_acceleration.z = <span class="built_in">float</span>(ctypes.c_int32(self.Accel[2]).value/100000.0)</span><br><span class="line"></span><br><span class="line">    msg.orientation.w = <span class="built_in">float</span>(ctypes.c_int16(self.Quat[0]).value/10000.0)</span><br><span class="line">    msg.orientation.x = <span class="built_in">float</span>(ctypes.c_int16(self.Quat[1]).value/10000.0)</span><br><span class="line">    msg.orientation.y = <span class="built_in">float</span>(ctypes.c_int16(self.Quat[2]).value/10000.0)</span><br><span class="line">    msg.orientation.z = <span class="built_in">float</span>(ctypes.c_int16(self.Quat[3]).value/10000.0)</span><br><span class="line"></span><br><span class="line">    self.imu_pub.publish(msg)  </span><br><span class="line">    <span class="comment"># TF value calculate from mechanical structure</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&#x27;NanoRobot&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">        self.tf_broadcaster.sendTransform((-0.062,-0.007,0.08),(0.0,0.0,0.0,1.0),self.current_time,self.imuId,self.baseId)   </span><br><span class="line">    <span class="keyword">elif</span>(<span class="string">&#x27;NanoCar&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">        self.tf_broadcaster.sendTransform((0.0,0.0,0.09),(0.0,0.0,0.0,1.0),self.current_time,self.imuId,self.baseId) </span><br><span class="line">    <span class="keyword">elif</span>(<span class="string">&#x27;4WD&#x27;</span> <span class="keyword">in</span> base_type):</span><br><span class="line">        self.tf_broadcaster.sendTransform((-0.065,0.0167,0.02),(0.0,0.0,0.0,1.0),self.current_time,self.imuId,self.baseId)     </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.tf_broadcaster.sendTransform((0.0,0.0,0.0),(0.0,0.0,0.0,1.0),self.current_time,self.imuId,self.baseId)  </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>21.mainå¾ªç¯æ‰§è¡ŒBaseControl()<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#main function</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    try:</span><br><span class="line">        rospy.init_node(<span class="string">&#x27;base_control&#x27;</span>,anonymous=True)</span><br><span class="line">        <span class="keyword">if</span> base_type != None:</span><br><span class="line">            rospy.loginfo(<span class="string">&#x27;%s base control ...&#x27;</span>%base_type)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rospy.loginfo(<span class="string">&#x27;base control ...&#x27;</span>)</span><br><span class="line">            rospy.logerr(<span class="string">&#x27;PLEASE SET BASE_TYPE ENV FIRST&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        bc = BaseControl()</span><br><span class="line">        rospy.spin()</span><br><span class="line">    except KeyboardInterrupt:</span><br><span class="line">        bc.serial.close</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Shutting down&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul>              </div>            </details><details class="folding-tag" blue><summary> shæ–‡ä»¶ </summary>              <div class='content'>              <ol><li><p class='p blue'>setbase.sh</p></li></ol><ul><li>å®šä¹‰åº•ç›˜çš„ç±»å‹ä½œä¸ºç¯å¢ƒå˜é‡å¹¶å†™å…¥é…ç½®æ–‡ä»¶</li></ul><ol><li><p class='p blue'>rpi4initsetup.sh</p></li></ol><ul><li>å°†move_baseåˆ›å»ºç¬¦å·é“¾æ¥åˆ°ç«¯å£å¹¶å°†ç«¯å£æƒé™æ›´æ”¹ä¸ºæ‰€æœ‰ç”¨æˆ·å¯è¯»å†™(æ–¹ä¾¿ç§»æ¤)</li></ul>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-4"><p><p class='p blue'>è¿™é‡Œçš„æ–‡ä»¶å¤¹å‚å®¶è‡ªå¸¦ï¼Œä¸éœ€è¦è‡ªå·±ç¼–å†™ã€‚</p><br>lidaræ˜¯å¤šä¸ªå¸¸ç”¨çš„é›·è¾¾åŠŸèƒ½åŒ…çš„åˆé›†ã€‚<br>å…¶ä¸‹åŒ…å«hls_lfcd_lds_driverï¼Œiiiroboticslidar2_rosï¼Œrplidar_rosï¼Œsc_miniï¼Œydlidaräº”æ¬¾é›·è¾¾çš„åŠŸèƒ½åŒ…ã€‚ï¼ˆé‡Œé¢æœ‰å‘å¸ƒèŠ‚ç‚¹å’Œå®¢æˆ·ç«¯èŠ‚ç‚¹ï¼‰<br>æ­¤å¤–lidaræ–‡ä»¶å¤¹ä¸‹è¿˜åŒ…å«ä¸€ä¸ªç”¨äºudevè§„åˆ™çš„ç”Ÿæˆçš„è„šæœ¬initenv.shå®ƒçš„ä½œç”¨æ˜¯å°†è®¾å¤‡è¿›è¡Œudevè§„åˆ™è½¬æ¢è®©æ‰€æœ‰è®¾å¤‡æ‹¥æœ‰ç»Ÿä¸€çš„åç§°ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-5"><details class="folding-tag" blue><summary> launchæ–‡ä»¶å¤¹ </summary>              <div class='content'>              <details class="folding-tag" blue><summary> includesæ–‡ä»¶å¤¹ </summary>              <div class='content'>              <p class='p blue'>å­˜æ”¾çš„æ˜¯rosè‡ªå¸¦çš„å»ºå›¾ç®—æ³•çš„launchæ–‡ä»¶</p><p class='p blue'>gmapping.launchã€hector.launchã€ karto.launchã€ cartographer.launch</p>              </div>            </details><details class="folding-tag" blue><summary> lidaræ–‡ä»¶å¤¹ </summary>              <div class='content'>              <p><p class='p blue'>lidaræ–‡ä»¶å¤¹å­˜æ”¾çš„æ˜¯é›·è¾¾çš„launchæ–‡ä»¶æ˜¯é‡æ–°ç¼–å†™çš„ä¸æ˜¯è‡ªå¸¦çš„</p></p><ol><li>å¯åŠ¨é›·è¾¾ç¡¬ä»¶</li><li>é›·è¾¾çš„åŸºåæ ‡ç³»åå­—ä½¿ç”¨lidar_frameå‚æ•°ï¼ˆlidarï¼‰</li><li>é›·è¾¾çš„ç«¯å£æ”¹ä¸º/dev/rplidar<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;lidar_frame&quot;</span> default=<span class="string">&quot;lidar&quot;</span>/&gt;   </span><br><span class="line"></span><br><span class="line">    &lt;node name=<span class="string">&quot;rplidarNode&quot;</span>          pkg=<span class="string">&quot;rplidar_ros&quot;</span>  <span class="built_in">type</span>=<span class="string">&quot;rplidarNode&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;serial_port&quot;</span>         <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span> value=<span class="string">&quot;/dev/rplidar&quot;</span>/&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;serial_baudrate&quot;</span>     <span class="built_in">type</span>=<span class="string">&quot;int&quot;</span>    value=<span class="string">&quot;115200&quot;</span>/&gt;&lt;!--A1/A2 --&gt;</span><br><span class="line">        &lt;!--param name=<span class="string">&quot;serial_baudrate&quot;</span>     <span class="built_in">type</span>=<span class="string">&quot;int&quot;</span>    value=<span class="string">&quot;256000&quot;</span>--&gt;&lt;!--A3 --&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;frame_id&quot;</span>            <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span> value=<span class="string">&quot;<span class="subst">$(arg lidar_frame)</span>&quot;</span>/&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;inverted&quot;</span>            <span class="built_in">type</span>=<span class="string">&quot;bool&quot;</span>   value=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;angle_compensate&quot;</span>    <span class="built_in">type</span>=<span class="string">&quot;bool&quot;</span>   value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" blue><summary> rvizæ–‡ä»¶å¤¹ </summary>              <div class='content'>              <p><p class='p blue'>rvizå­˜æ”¾çš„æ˜¯rvizç›¸å…³çš„launchæ–‡ä»¶ç”¨æ¥æ‰“å¼€å¯¹åº”çš„rvizç•Œé¢--æ‰“å¼€åŠŸèƒ½åŒ…robot_navigationä¸‹çš„rvizæ–‡ä»¶(å¯ä»¥ç”¨rvizç•Œé¢å¯¼å‡º)</p><br>lidar_rviz.launchâ€”æ‰“å¼€é›·è¾¾çš„rvizç•Œé¢(lidar.rviz)<br>slam_rviz.launchâ€”æ‰“å¼€slamå»ºå›¾çš„rvizç•Œé¢(slam.rviz)<br>navigation_rviz.launchâ€”æ‰“å¼€å•ç‚¹å¯¼èˆªçš„rvizç•Œé¢(navigation.rviz)<br>multi_navigation.launchâ€”æ‰“å¼€å¤šç‚¹å¯¼èˆªçš„rvizç•Œé¢(multi_navigation.rviz)</p>              </div>            </details><details class="folding-tag" green><summary> robot_slam_laser.launchæ–‡ä»¶ </summary>              <div class='content'>              <p>æ¿€å…‰SLAMå»ºå›¾</p><ol><li><p class='p blue'>ç®€ä»‹</p><br>slam_methodsâ€”â€”â€”gmapping<br>open_rvizâ€”â€”â€”â€”-false<br>simulationâ€”â€”â€”â€”false<br>plannerâ€”â€”â€”â€”â€”-â€œâ€<br>æŒ‡å®šå¯¼èˆªç®—æ³•ï¼ŒæŒ‡å®šæ˜¯å¦æ‰“å¼€rvizï¼ŒæŒ‡å®šæ˜¯å¦ä½¿ç”¨simulation(ä»¿çœŸæœºå™¨äºº)ï¼ŒæŒ‡å®šå±€éƒ¨è·¯å¾„è§„åˆ’ç®—æ³•(dwaå’Œteb)-<br>å¦‚æœsimulationä¸ºtrueå°±å¯åŠ¨æœºå™¨äººæ¨¡å‹robot_simulation/launch/simulation_one_robot.launch<br>å¦‚æœsimulationä¸ºfalseå°±å¯åŠ¨robot_navigation/launch/robot_lidar.launch(é›·è¾¾å’Œåº•ç›˜æ§åˆ¶)<br>è¿™ä¸ªlaunchæ–‡ä»¶å¯åŠ¨äº†åº•ç›˜æ§åˆ¶èŠ‚ç‚¹base_control/launch/base_control.launchå’Œé›·è¾¾èŠ‚ç‚¹robot_navigation/launch/lidar.launch<br>é›·è¾¾èŠ‚ç‚¹robot_navigation/launch/lidar.launchåŠŸèƒ½æ˜¯æ ¹æ®é›·è¾¾ç¯å¢ƒå˜é‡çš„ä¸åŒå¯åŠ¨ä¸åŒçš„é›·è¾¾robot_navigation/launch/lidar/$(arg lidar_type).launchï¼Œæ ¹æ®åº•ç›˜ç±»å‹çš„ä¸åŒå‘å¸ƒä¸åŒçš„tfé™æ€åæ ‡-é›·è¾¾åˆ°åº•ç›˜ï¼Œåå­—ä¸ºbase_footprint_to_laser<br>robot_navigation/launch/lidar/$(arg lidar_type).launchå®ç°äº†ä»¥ä¸‹åŠŸèƒ½<br>1.å¯åŠ¨é›·è¾¾ç¡¬ä»¶<br>2.é›·è¾¾çš„åŸºåæ ‡ç³»åå­—ä½¿ç”¨lidar_frameå‚æ•°ï¼ˆlidarï¼‰<br>3.é›·è¾¾çš„ç«¯å£æ”¹ä¸º/dev/rplidar<br>å¯åŠ¨å»ºå›¾ç®—æ³•çš„launchæ–‡ä»¶robot_navigation/launch/includes/$(arg slam_methods).launch<br>å¯åŠ¨å¯¼èˆªå †æ ˆmove_base.launch(rosæä¾›)â€”-å¦‚æœå¯åŠ¨åˆ™å¯ä»¥è¾¹å¯¼èˆªè¾¹å»ºå›¾</li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">  &lt;!-- Arguments --&gt;</span><br><span class="line">  //æŒ‡å®šå¯¼èˆªç®—æ³•</span><br><span class="line">  &lt;arg name=<span class="string">&quot;slam_methods&quot;</span> default=<span class="string">&quot;gmapping&quot;</span> doc=<span class="string">&quot;slam type [gmapping, hector, karto, cartographer]&quot;</span>/&gt;</span><br><span class="line">  //æŒ‡å®šæ˜¯å¦æ‰“å¼€rviz</span><br><span class="line">  &lt;arg name=<span class="string">&quot;open_rviz&quot;</span> default=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">  //æŒ‡å®šæ˜¯å¦ä½¿ç”¨simulation(ä»¿çœŸæœºå™¨äºº)</span><br><span class="line">  &lt;arg name=<span class="string">&quot;simulation&quot;</span> default= <span class="string">&quot;false&quot;</span>/&gt; </span><br><span class="line">  //æŒ‡å®šå±€éƒ¨è·¯å¾„è§„åˆ’ç®—æ³•(dwaå’Œteb)--tebé€‚åˆé˜¿å…‹æ›¼çš„è½¬å‘ï¼Œä¸èƒ½åŸåœ°æ—‹è½¬</span><br><span class="line">  &lt;arg name=<span class="string">&quot;planner&quot;</span>  default=<span class="string">&quot;&quot;</span> doc=<span class="string">&quot;opt: dwa, teb&quot;</span>/&gt; </span><br><span class="line"></span><br><span class="line">  &lt;param name=<span class="string">&quot;/use_sim_time&quot;</span> value=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span> /&gt;  </span><br><span class="line"></span><br><span class="line">  &lt;!-- simulation robot with lidar and map--&gt;</span><br><span class="line">  //å¦‚æœsimulationä¸º<span class="literal">true</span>å°±å¯åŠ¨æœºå™¨äººæ¨¡å‹robot_simulation/launch/simulation_one_robot.launch</span><br><span class="line">  &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span>&gt;</span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_simulation)</span>/launch/simulation_one_robot.launch&quot;</span>/&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">  //å¦‚æœsimulationä¸º<span class="literal">false</span>å°±å¯åŠ¨robot_navigation/launch/robot_lidar.launch(é›·è¾¾å’Œåº•ç›˜æ§åˆ¶)</span><br><span class="line">  &lt;!-- robot with lidar --&gt;</span><br><span class="line">  &lt;group unless=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span>&gt;</span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/robot_lidar.launch&quot;</span>/&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">  //å¯åŠ¨å»ºå›¾ç®—æ³•çš„launchæ–‡ä»¶robot_navigation/launch/includes/$(arg slam_methods).launch</span><br><span class="line">  &lt;!-- SLAM: Gmapping, Cartographer, Hector, Karto --&gt;</span><br><span class="line">  &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/includes/<span class="subst">$(arg slam_methods)</span>.launch&quot;</span>&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;simulation&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span>/&gt;</span><br><span class="line">  &lt;/include&gt;</span><br><span class="line">   //å¯åŠ¨å¯¼èˆªå †æ ˆmove_base.launch(rosæä¾›)</span><br><span class="line">  &lt;!-- move_base --&gt;</span><br><span class="line">  &lt;group unless=<span class="string">&quot;<span class="subst">$(eval planner == &#x27;&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/move_base.launch&quot;</span> unless=<span class="string">&quot;<span class="subst">$(eval planner == &#x27;&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;arg name=<span class="string">&quot;planner&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg planner)</span>&quot;</span>/&gt;</span><br><span class="line">    &lt;/include&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- rviz --&gt;</span><br><span class="line">  //å¦‚æœopen_rvizä¸º<span class="literal">true</span>æ‰“å¼€è®¾ç½®å¥½çš„rvizé…ç½®robot_navigation/rviz/slam.rviz</span><br><span class="line">  &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(arg open_rviz)</span>&quot;</span>&gt; </span><br><span class="line">    &lt;node pkg=<span class="string">&quot;rviz&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;rviz&quot;</span> name=<span class="string">&quot;rviz&quot;</span> required=<span class="string">&quot;true&quot;</span></span><br><span class="line">          args=<span class="string">&quot;-d <span class="subst">$(find robot_navigation)</span>/rviz/slam.rviz&quot;</span>/&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> robot_navigation.launchæ–‡ä»¶ </summary>              <div class='content'>              <p>æŒ‡å®šå•ç‚¹å¯¼èˆª</p><ol><li><p class='p blue'>ç®€ä»‹</p><br>æŒ‡å®šå¯¼èˆªçš„åœ°å›¾è·¯å¾„ï¼Œå¯åŠ¨ä»¿çœŸå™¨æœºå™¨äººçš„åœ°å›¾<br>simulationä¸ºfalseå°±å¯åŠ¨robot_navigation/launch/robot_lidar.launch(é›·è¾¾å’Œåº•ç›˜æ§åˆ¶)<br>å¯åŠ¨åœ°å›¾æœåŠ¡å™¨å¹¶è¯»å…¥åœ°å›¾æ–‡ä»¶<br>å¯åŠ¨å®šä½èŠ‚ç‚¹ï¼Œæ ¹æ®è½¦å‹è½½å…¥ä¸åŒçš„å®šä½yamlæ–‡ä»¶<br>è®¾ç½®æœºå™¨äººåœ¨åœ°å›¾çš„åˆå§‹ä½ç½®å’Œèˆªå‘è§’<br>å¯åŠ¨å¯¼èˆªå †æ ˆrobot_navigation/launch/move_base.launch(æ ¸å¿ƒ)<br>è¿™ä¸ªlaunchæ–‡ä»¶ä¸»è¦åŠŸèƒ½<br>1.å¯åŠ¨å¯¼èˆªå †æ ˆmove_base(å‚æ•°ä¸ºå…¨å±€è§„åˆ’å™¨å’Œå¯¼èˆªè§„åˆ’å™¨),è½½å…¥è½¦å‹çš„æ‰€æœ‰é…ç½®ä¿¡æ¯<br>2.æ¥æ”¶æ§åˆ¶ä¿¡æ¯è¯é¢˜å’Œodomè¯é¢˜</li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">  &lt;!-- Arguments --&gt;</span><br><span class="line">  //æŒ‡å®šå¯¼èˆªçš„åœ°å›¾è·¯å¾„</span><br><span class="line">  &lt;arg name=<span class="string">&quot;map_file&quot;</span> default=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/maps/map.yaml&quot;</span>/&gt;</span><br><span class="line">  &lt;arg name=<span class="string">&quot;simulation&quot;</span> default= <span class="string">&quot;false&quot;</span>/&gt; </span><br><span class="line">  &lt;arg name=<span class="string">&quot;planner&quot;</span>  default=<span class="string">&quot;teb&quot;</span> doc=<span class="string">&quot;opt: dwa, teb&quot;</span>/&gt; </span><br><span class="line">  &lt;arg name=<span class="string">&quot;open_rviz&quot;</span> default=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">  &lt;arg name=<span class="string">&quot;use_dijkstra&quot;</span> default= <span class="string">&quot;true&quot;</span>/&gt; </span><br><span class="line">  //å¯åŠ¨ä»¿çœŸå™¨æœºå™¨äººçš„åœ°å›¾</span><br><span class="line">  &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span>&gt;</span><br><span class="line">    &lt;!-- simulation robot with lidar and map--&gt;</span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_simulation)</span>/launch/simulation_one_robot_with_map.launch&quot;</span>/&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">   //simulationä¸º<span class="literal">false</span>å°±å¯åŠ¨robot_navigation/launch/robot_lidar.launch(é›·è¾¾å’Œåº•ç›˜æ§åˆ¶)</span><br><span class="line">  &lt;group unless=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span>&gt;</span><br><span class="line">    &lt;!-- robot with lidar --&gt;</span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/robot_lidar.launch&quot;</span>&gt;</span><br><span class="line">          &lt;!--&lt;arg name=<span class="string">&quot;robot_name&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg robot_name)</span>&quot;</span>/&gt;--&gt;</span><br><span class="line">    &lt;/include&gt;</span><br><span class="line">    //å¯åŠ¨åœ°å›¾æœåŠ¡å™¨å¹¶è¯»å…¥åœ°å›¾æ–‡ä»¶ </span><br><span class="line">    &lt;!-- Map server --&gt;</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;map_server&quot;</span> name=<span class="string">&quot;map_server&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;map_server&quot;</span> args=<span class="string">&quot;<span class="subst">$(arg map_file)</span>&quot;</span>&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;frame_id&quot;</span> value=<span class="string">&quot;map&quot;</span>/&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">    //å¯åŠ¨å®šä½èŠ‚ç‚¹ï¼Œæ ¹æ®è½¦å‹è½½å…¥ä¸åŒçš„å®šä½yamlæ–‡ä»¶</span><br><span class="line">    &lt;!-- AMCL --&gt;</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;amcl&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;amcl&quot;</span> name=<span class="string">&quot;amcl&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/amcl_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">    //æœºå™¨äººåœ¨åœ°å›¾çš„åˆå§‹ä½ç½®å’Œèˆªå‘è§’  </span><br><span class="line">      &lt;param name=<span class="string">&quot;initial_pose_x&quot;</span>            value=<span class="string">&quot;0.0&quot;</span>/&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;initial_pose_y&quot;</span>            value=<span class="string">&quot;0.0&quot;</span>/&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;initial_pose_a&quot;</span>            value=<span class="string">&quot;0.0&quot;</span>/&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">    //å¯åŠ¨å¯¼èˆªå †æ ˆrobot_navigation/launch/move_base.launch</span><br><span class="line">  &lt;!-- move_base --&gt;</span><br><span class="line">  &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/move_base.launch&quot;</span> &gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;planner&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg planner)</span>&quot;</span>/&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;simulation&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg simulation)</span>&quot;</span>/&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;use_dijkstra&quot;</span>     value=<span class="string">&quot;<span class="subst">$(arg use_dijkstra)</span>&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/include&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- rviz --&gt;</span><br><span class="line">  &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(arg open_rviz)</span>&quot;</span>&gt; </span><br><span class="line">    &lt;node pkg=<span class="string">&quot;rviz&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;rviz&quot;</span> name=<span class="string">&quot;rviz&quot;</span> required=<span class="string">&quot;true&quot;</span></span><br><span class="line">          args=<span class="string">&quot;-d <span class="subst">$(find robot_navigation)</span>/rviz/navigation.rviz&quot;</span>/&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> multi_points_navigation.launchæ–‡ä»¶ </summary>              <div class='content'>              <p>æŒ‡å®šå¤šç‚¹å¯¼èˆª<br>åªæ˜¯å¯åŠ¨äº†ä¸€ä¸ªpythonæ–‡ä»¶multi_goal_point.py<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--&lt;node name=<span class="string">&quot;robot_pose_publisher&quot;</span> pkg=<span class="string">&quot;robot_pose_publisher&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;robot_pose_publisher&quot;</span> /&gt;--&gt;</span><br><span class="line">    &lt;node name=<span class="string">&quot;multi_mark&quot;</span> pkg=<span class="string">&quot;robot_navigation&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;multi_goal_point.py&quot;</span> output=<span class="string">&quot;screen&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" green><summary> way_point.launchæ–‡ä»¶ </summary>              <div class='content'>              <p>å¤šç‚¹å…¨è‡ªåŠ¨å·¡èˆª<br>åªæ˜¯å¯åŠ¨äº†ä¸€ä¸ªpythonæ–‡ä»¶way_point.py<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- For Simulation --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;sim_mode&quot;</span> default=<span class="string">&quot;false&quot;</span> /&gt;</span><br><span class="line">    &lt;param name=<span class="string">&quot;/use_sim_time&quot;</span> value=<span class="string">&quot;<span class="subst">$(arg sim_mode)</span>&quot;</span>/&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;loopTimes&quot;</span>       default=<span class="string">&quot;0&quot;</span> /&gt;</span><br><span class="line">    &lt;!-- move base --&gt;</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;robot_navigation&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;way_point.py&quot;</span> respawn=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;way_point&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">        &lt;!-- params <span class="keyword">for</span> move_base --&gt;</span><br><span class="line">        //è‡ªåŠ¨å·¡èˆªçš„ä¸‰ä¸ªç‚¹çš„åæ ‡ä»¥åŠå¾ªç¯æ¬¡æ•°ï¼Œ0ä»£è¡¨ä¸åœæ­¢</span><br><span class="line">        &lt;param name=<span class="string">&quot;goalListX&quot;</span> value=<span class="string">&quot;[4.2, 4.6, 4.4]&quot;</span> /&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;goalListY&quot;</span> value=<span class="string">&quot;[4.6, 7.4, 9.2]&quot;</span> /&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;goalListZ&quot;</span> value=<span class="string">&quot;[0.0, 0.0, 0.0]&quot;</span> /&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;loopTimes&quot;</span> value=<span class="string">&quot;<span class="subst">$(arg loopTimes)</span>&quot;</span>/&gt;</span><br><span class="line">        &lt;param name=<span class="string">&quot;map_frame&quot;</span> value=<span class="string">&quot;map&quot;</span> /&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" green><summary> navigation_stack.launchæ–‡ä»¶ </summary>              <div class='content'>              </div>            </details><details class="folding-tag" green><summary> robot_lidar.launchæ–‡ä»¶ </summary>              <div class='content'>              <ol><li><p class='p blue'>å¯åŠ¨åº•ç›˜æ§åˆ¶èŠ‚ç‚¹</p><br>base_control/launch/base_control.launch</li><li><p class='p blue'>å¯åŠ¨é›·è¾¾èŠ‚ç‚¹</p><br>robot_navigation/launch/lidar.launch<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- config param --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;pub_imu&quot;</span>       default=<span class="string">&quot;False&quot;</span> /&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;sub_ackermann&quot;</span>       default=<span class="string">&quot;False&quot;</span> /&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;lidar_frame&quot;</span> default=<span class="string">&quot;base_laser_link&quot;</span>/&gt;  </span><br><span class="line"></span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find base_control)</span>/launch/base_control.launch&quot;</span>&gt;</span><br><span class="line">        &lt;arg name=<span class="string">&quot;pub_imu&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg pub_imu)</span>&quot;</span>/&gt;  </span><br><span class="line">        &lt;arg name=<span class="string">&quot;sub_ackermann&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg sub_ackermann)</span>&quot;</span>/&gt;  </span><br><span class="line">    &lt;/include&gt;</span><br><span class="line"></span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/lidar.launch&quot;</span>&gt;</span><br><span class="line">        &lt;arg name=<span class="string">&quot;lidar_frame&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg lidar_frame)</span>&quot;</span>/&gt;  </span><br><span class="line">    &lt;/include&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> lidar.launchæ–‡ä»¶ </summary>              <div class='content'>              <ol><li><p class='p blue'>æ ¹æ®é›·è¾¾ç¯å¢ƒå˜é‡çš„ä¸åŒå¯åŠ¨ä¸åŒçš„é›·è¾¾</p><br>robot_navigation/launch/lidar/$(arg lidar_type).launch</li><li><p class='p blue'>æ ¹æ®åº•ç›˜ç±»å‹çš„ä¸åŒå‘å¸ƒä¸åŒçš„tfé™æ€åæ ‡-é›·è¾¾åˆ°åº•ç›˜ï¼Œåå­—ä¸ºbase_footprint_to_laser</p></li><li><p class='p blue'>ç”¨launchå‘å¸ƒé™æ€åæ ‡çš„æ–¹æ³•ï¼Œåå­—ä¸ºbase_footprint_to_laser</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"> &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoRobot&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;-0.01225 0.0 0.18 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">```        </span><br><span class="line">```bash</span><br><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!--robot bast <span class="built_in">type</span> use different tf value--&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;base_type&quot;</span>       default=<span class="string">&quot;<span class="subst">$(env BASE_TYPE)</span>&quot;</span> /&gt;</span><br><span class="line">    &lt;!-- robot frame --&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;base_frame&quot;</span>       default=<span class="string">&quot;/base_footprint&quot;</span> /&gt;    </span><br><span class="line">    &lt;arg name=<span class="string">&quot;lidar_type&quot;</span>       default=<span class="string">&quot;<span class="subst">$(env LIDAR_TYPE)</span>&quot;</span> /&gt;   </span><br><span class="line">    &lt;arg name=<span class="string">&quot;lidar_frame&quot;</span> default=<span class="string">&quot;base_laser_link&quot;</span>/&gt;  </span><br><span class="line"></span><br><span class="line">    &lt;include file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/launch/lidar/<span class="subst">$(arg lidar_type)</span>.launch&quot;</span>&gt;</span><br><span class="line">        &lt;arg name=<span class="string">&quot;lidar_frame&quot;</span>            value=<span class="string">&quot;<span class="subst">$(arg lidar_frame)</span>&quot;</span>/&gt;</span><br><span class="line">    &lt;/include&gt;</span><br><span class="line"></span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoRobot&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;-0.01225 0.0 0.18 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoRobot_Pro&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;-0.0515 0.0 0.18 -1.5708 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;4WD&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.01 0.0 0.25 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;4WD_OMNI&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.01 0.0 0.25 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoCar&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.1037 0.0 0.115 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoCar_Pro&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.1037 0.0 0.165 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoCar_SE&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.0955 0.0 0.115 1.5708 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;Race182&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.1 0.0 0.192 3.14159265 0.0 0.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">    &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval base_type == &#x27;NanoOmni&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">        &lt;node pkg=<span class="string">&quot;tf&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;base_footprint_to_laser&quot;</span></span><br><span class="line">            args=<span class="string">&quot;0.019 0.0 0.192 3.14159265 0.0 1.0 <span class="subst">$(arg base_frame)</span> <span class="subst">$(arg lidar_frame)</span> 20&quot;</span>&gt;</span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> move_base.launchæ–‡ä»¶ </summary>              <div class='content'>              <p>å¯åŠ¨å¯¼èˆªå †æ ˆmove_base.launch(rosæä¾›)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">  &lt;!-- Arguments --&gt;</span><br><span class="line">  &lt;arg name=<span class="string">&quot;cmd_vel_topic&quot;</span> default=<span class="string">&quot;cmd_vel&quot;</span> /&gt;</span><br><span class="line">  &lt;arg name=<span class="string">&quot;odom_topic&quot;</span> default=<span class="string">&quot;odom&quot;</span> /&gt;</span><br><span class="line">  &lt;arg name=<span class="string">&quot;planner&quot;</span>  default=<span class="string">&quot;dwa&quot;</span> doc=<span class="string">&quot;opt: dwa, teb&quot;</span>/&gt; </span><br><span class="line">  &lt;arg name=<span class="string">&quot;simulation&quot;</span> default= <span class="string">&quot;false&quot;</span>/&gt; </span><br><span class="line">  &lt;arg name=<span class="string">&quot;use_dijkstra&quot;</span> default= <span class="string">&quot;true&quot;</span>/&gt;  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  &lt;arg name=<span class="string">&quot;base_type&quot;</span> default= <span class="string">&quot;<span class="subst">$(env BASE_TYPE)</span>&quot;</span>/&gt; </span><br><span class="line">  //é›·è¾¾å»ºå›¾å’Œå¯¼èˆªæ˜¯360åº¦æ‰€ä»¥å¯ä»¥ç”¨<span class="literal">false</span>ï¼Œç”¨ç›¸æœºå¯¼èˆªå’Œå»ºå›¾åªèƒ½çœ‹è§å‰é¢æ‰€ä»¥ç”¨<span class="literal">true</span></span><br><span class="line">  &lt;arg name=<span class="string">&quot;move_forward_only&quot;</span> default=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- move_base use DWA planner--&gt;</span><br><span class="line">  &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval planner == &#x27;dwa&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">  //å¯åŠ¨å¯¼èˆªå †æ ˆmove_base(å‚æ•°ä¸ºå…¨å±€è§„åˆ’å™¨å’Œå¯¼èˆªè§„åˆ’å™¨),è½½å…¥è½¦å‹çš„æ‰€æœ‰é…ç½®ä¿¡æ¯</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;move_base&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;move_base&quot;</span> respawn=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;move_base&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">      &lt;!-- use global_planner replace default navfn as global planner ,global_planner support A* and dijkstra algorithm--&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;base_global_planner&quot;</span> value=<span class="string">&quot;global_planner/GlobalPlanner&quot;</span>/&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;base_local_planner&quot;</span> value=<span class="string">&quot;dwa_local_planner/DWAPlannerROS&quot;</span> /&gt;</span><br><span class="line">      &lt;!-- &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/global_planner_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;       --&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/costmap_common_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> ns=<span class="string">&quot;global_costmap&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/costmap_common_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> ns=<span class="string">&quot;local_costmap&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/local_costmap_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/global_costmap_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/move_base_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/dwa_local_planner_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      //æ¥æ”¶æ§åˆ¶ä¿¡æ¯è¯é¢˜å’Œodomè¯é¢˜</span><br><span class="line">      &lt;remap from=<span class="string">&quot;cmd_vel&quot;</span> to=<span class="string">&quot;<span class="subst">$(arg cmd_vel_topic)</span>&quot;</span>/&gt;</span><br><span class="line">      &lt;remap from=<span class="string">&quot;odom&quot;</span> to=<span class="string">&quot;<span class="subst">$(arg odom_topic)</span>&quot;</span>/&gt;</span><br><span class="line">      å½“åªå…è®¸å‰å‘è¿åŠ¨æ—¶è®¾ç½®å±€éƒ¨è§„åˆ’æœ€å°é€Ÿåº¦ä¸º0ï¼Œä¸å‡ºç°è´Ÿé€Ÿåº¦(åå‘)</span><br><span class="line">      &lt;param name=<span class="string">&quot;DWAPlannerROS/min_vel_x&quot;</span> value=<span class="string">&quot;0.0&quot;</span> <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(arg move_forward_only)</span>&quot;</span> /&gt;</span><br><span class="line">      &lt;!--default is True,use dijkstra algorithm;<span class="built_in">set</span> to False,usd A* algorithm--&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;GlobalPlanner/use_dijkstra &quot;</span> value=<span class="string">&quot;<span class="subst">$(arg use_dijkstra)</span>&quot;</span> /&gt;    </span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">  &lt;!-- move_base use TEB planner--&gt;</span><br><span class="line">  &lt;group <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(eval planner == &#x27;teb&#x27;)</span>&quot;</span>&gt;</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;move_base&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;move_base&quot;</span> respawn=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;move_base&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">      &lt;!-- use global_planner replace default navfn as global planner ,global_planner support A* and dijkstra algorithm--&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;base_global_planner&quot;</span> value=<span class="string">&quot;global_planner/GlobalPlanner&quot;</span>/&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;base_local_planner&quot;</span> value=<span class="string">&quot;teb_local_planner/TebLocalPlannerROS&quot;</span> /&gt;</span><br><span class="line">      &lt;!-- &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/global_planner_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt; --&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/costmap_common_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> ns=<span class="string">&quot;global_costmap&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/costmap_common_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> ns=<span class="string">&quot;local_costmap&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/local_costmap_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/global_costmap_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/move_base_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;rosparam file=<span class="string">&quot;<span class="subst">$(find robot_navigation)</span>/param/<span class="subst">$(env BASE_TYPE)</span>/teb_local_planner_params.yaml&quot;</span> <span class="built_in">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span><br><span class="line">      &lt;remap from=<span class="string">&quot;cmd_vel&quot;</span> to=<span class="string">&quot;<span class="subst">$(arg cmd_vel_topic)</span>&quot;</span>/&gt;</span><br><span class="line">      &lt;remap from=<span class="string">&quot;odom&quot;</span> to=<span class="string">&quot;<span class="subst">$(arg odom_topic)</span>&quot;</span>/&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;TebLocalPlannerROS/max_vel_x_backwards&quot;</span> value=<span class="string">&quot;0.0&quot;</span> <span class="keyword">if</span>=<span class="string">&quot;<span class="subst">$(arg move_forward_only)</span>&quot;</span> /&gt;</span><br><span class="line">      &lt;!--default is True,use dijkstra algorithm;<span class="built_in">set</span> to False,usd A* algorithm--&gt;</span><br><span class="line">      &lt;param name=<span class="string">&quot;GlobalPlanner/use_dijkstra &quot;</span> value=<span class="string">&quot;<span class="subst">$(arg use_dijkstra)</span>&quot;</span> /&gt;</span><br><span class="line">      &lt;!--stage simulator takes the angle instead of the rotvel as input (twist message)--&gt;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;!-- move_base --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></p>              </div>            </details>              </div>            </details><details class="folding-tag" blue><summary> configæ–‡ä»¶å¤¹ </summary>              <div class='content'>              <p>ç®—æ³•çš„é…ç½®ï¼Œä¸‹è½½åè‡ªåŠ¨å‡ºç°</p>              </div>            </details><details class="folding-tag" blue><summary> mapsæ–‡ä»¶å¤¹ </summary>              <div class='content'>              <p>mapså­˜æ”¾çš„æ˜¯åœ°å›¾æ–‡ä»¶å’Œåœ°å›¾é…ç½®ä¿¡æ¯ç›¸å…³çš„æ–‡ä»¶</p>              </div>            </details><details class="folding-tag" blue><summary> paramæ–‡ä»¶å¤¹ </summary>              <div class='content'>              <p>paramå­˜æ”¾çš„æ˜¯yamlæ–‡ä»¶â€”â€”ä¸€ä¸ªè½¦å‹ä¸€ä¸ªæ–‡ä»¶å¤¹(rosæœ‰)<br>NanoCarï¼š</p><p><p class='p blue'>amcl_params.yaml--è®¾ç½®æœºå™¨äººå®šä½é…ç½®</p></p><p><p class='p blue'>costmap_common_params.yaml--è®¾ç½®æœºå™¨äººçš„çŸ©å½¢è½®å»“å°ºå¯¸</p><br>footprint: [ [-0.035,-0.1], [0.18,-0.1], [0.18,0.1], [-0.035,0.1] ]è¡¨ç¤ºä»¥æœºå™¨äººä¸­å¿ƒä¸ºåæ ‡è½´åŸç‚¹ï¼Œè¿™å››ä¸ªåæ ‡ç‚¹åˆ†åˆ«å¯¹åº”æœºå™¨äººçš„å››ä¸ªè§’ã€‚è·¯å¾„è§„åˆ’å™¨è·å–åˆ°æœºå™¨äººè½®å»“å¤§å°ä»è€Œè§„åˆ’ç›¸åº”çš„è·¯å¾„</p><p><p class='p blue'>local_costmap_params.yaml--åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­éœ€è¦æŒ‡å®šå‘å¸ƒé¢‘ç‡å’Œæ›´æ–°é¢‘ç‡</p><br>ä¸ºäº†é™ä½æœºå™¨äººçš„è®¡ç®—è´Ÿæ‹…è®¾ç½®äº†ä¸€ä¸ªä»¥æœºå™¨äººæ‰€åœ¨ä½ç½®ä¸ºä¸­å¿ƒçš„3*3æ»‘åŠ¨çª—å£ï¼Œè¿™ä¸ªæ¡†è®¾ç½®å¾—è¶Šå°è·¯å¾„è§„åˆ’æ•ˆæœè¶Šå·®ï¼Œè¶Šå¤§æœºå™¨äººè´Ÿæ‹…çš„è¿ç®—å°±è¶Šå¤§ã€‚æœ€åè®¾ç½®äº†ä¸€ä¸ªåœ°å›¾çš„å±‚ï¼Œç¬¬ä¸€ä¸ªæ˜¯é™æ€å±‚ï¼Œä¹Ÿå°±æ˜¯å»ºå›¾æ—¶çš„é»‘è‰²è¾¹ç•Œä»¥å¤–çš„ç°è‰²å¯é€šè¡ŒåŒºåŸŸã€‚ç¬¬äºŒä¸ªæ˜¯éšœç¢ç‰©å±‚ï¼Œåœ°å›¾ä¸­ä¸å­˜åœ¨ä½†æ˜¯å®é™…æ‰«é¢åˆ°çš„éšœç¢ç‰©ä¼šè¢«è¯†åˆ«åœ¨éšœç¢ç‰©å±‚ã€‚</p><p><p class='p blue'>global_costmap_params.yaml--è¿™ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯ä¸€æ ·è®¾ç½®ä¸€äº›å‘å¸ƒé¢‘ç‡ç­‰ä¿¡æ¯</p></p><p><p class='p blue'>move_base_params.yaml--è¿™ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯è¿›è¡Œä¸€äº›é¢‘ç‡è®¾ç½®ï¼ŒåŒ…æ‹¬å¯¹åœ°ç›˜çš„æ§åˆ¶é¢‘ç‡ï¼Œè·¯å¾„è§„åˆ’é¢‘ç‡ä»¥åŠæœºå™¨äººåœ¨ä¸€ä¸ªç‚¹æŒç»­éœ‡è¡æ—¶æœ€å¤§å…è®¸éœ‡è¡æ—¶é—´ç­‰ç­‰ã€‚</p><br>æœ€åclearing_rotation_allowedè¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯ï¼Œå½“æœºå™¨äººè¢«å›°ä½æ—¶ä¼šåŸåœ°360åº¦è½¬ä¸€åœˆé‡æ–°æ‰«ææ‰¾åˆ°ä¸€æ¡å‡ºè·¯ã€‚è¿™é‡Œæˆ‘ä»¬çš„æœºå™¨äººä»¥NanoCaræ˜¯ä¸ºä¾‹å®ƒä¸å…·å¤‡åŸåœ°è½¬å‘çš„èƒ½åŠ›æ‰€ä»¥éœ€è¦ç¦ç”¨ã€‚</p><p><p class='p blue'>dwa_local_planner_params.yaml--è®¾ç½®æœºå™¨äººå¯¼èˆªçš„æœ€å¤§æœ€å°é€Ÿåº¦ï¼Œyè½´çš„æ¨ªå‘è¿åŠ¨é€Ÿåº¦ï¼Œè½¬å‘è§’åº¦ï¼ŒåŠ é€Ÿåº¦ä¿¡æ¯ï¼Œåˆ°è¾¾ç›®æ ‡æ‰€èƒ½å®¹å¿çš„è¯¯å·®ç­‰ç­‰ã€‚</p><br>å½“plannerå‚æ•°ä¸ºtebæ—¶ï¼ŒåŒæ ·å¯åŠ¨move_baseåŠŸèƒ½åŒ…ä¸‹çš„move_baseèŠ‚ç‚¹åŠ ä¸‹æ¥è½½å…¥çš„å‚æ•°ä¹ŸåŸºæœ¬ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºæœ€åè½½å…¥çš„æ˜¯teb_local_planner_params.yamlæ–‡ä»¶</p><p><p class='p blue'>teb_local_planner_params.yaml--å’Œdwaçš„åŸºæœ¬ç±»ä¼¼ï¼Œå®ƒå°†å‚æ•°åˆ†å¼€è®¾ç½®æˆè½¬å‘é€Ÿåº¦ï¼Œxè½´é€Ÿåº¦ï¼Œxè½´åå‘çš„é€Ÿåº¦ï¼Œyè½´é€Ÿåº¦ï¼Œyè½´åå‘é€Ÿåº¦ç­‰ç­‰ã€‚</p><br>tebè·¯å¾„è§„åˆ’æ”¯æŒé˜¿å…‹æ›¼ç»“æ„çš„æœºå™¨äººï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®æœ€å°è½¬å‘åŠå¾„çš„å‚æ•°ï¼Œè½®è·å‚æ•°ç­‰ã€‚åœ¨ä½¿ç”¨ä»¿çœŸå™¨ä»¿çœŸé˜¿å…‹æ›¼è½¦å‹æ—¶éœ€è¦å°†cmd_angle_instead_rotvelå‚æ•°å€¼æ”¹ä¸ºtrueã€‚è¿™æ˜¯ç”±äºstageä»¿çœŸå™¨ä¸­â€Carâ€è½¦å‹æ¥å—çš„cmd_velè¯é¢˜ä¸­zè½´è§’é€Ÿåº¦å¹¶éç»™å®šæœºå™¨äººè§’é€Ÿåº¦ï¼Œè€Œæ˜¯æŒ‡è½¬å‘ç»“æ„çš„è½¬å‘è§’åº¦ã€‚</p>              </div>            </details><details class="folding-tag" blue><summary> rvizæ–‡ä»¶å¤¹ </summary>              <div class='content'>              </div>            </details><details class="folding-tag" blue><summary> scriptæ–‡ä»¶å¤¹ </summary>              <div class='content'>              <details class="folding-tag" green><summary> multi_goal_point.pyæ–‡ä»¶ </summary>              <div class='content'>              <p><p class='p blue'>ç®€ä»‹</p><br>é€šè¿‡rvizç•Œé¢çš„æŒ‰é’®å‘å¸ƒ/goalè¯é¢˜è€Œä¸æ˜¯ç›´æ¥å‘å¸ƒ/move_base_simple/goalï¼Œå› ä¸ºè¿™ä¸ªè¯é¢˜ä¼šç›´æ¥å‘å¸ƒç»™move_baseè€Œç›´æ¥äº§ç”Ÿå¯¼èˆªç›®æ ‡ç›´æ¥å¼€å§‹äº†å¯¼èˆªã€‚å› æ­¤é€šè¿‡äº†markerArray = MarkerArray()æŠŠ/goalç¼“å­˜èµ·æ¥ä½œä¸ºæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªç‚¹é€šè¿‡click_callbackå›è°ƒå¼€å§‹å¯¼èˆªç„¶åå¯¹æ¯ä¸€ä¸ªå¯¼èˆªç‚¹çš„ç»“æœè§¦å‘å›è°ƒstatus_callbackæ¥å¯åŠ¨ä¸‹ä¸€ä¸ªç›®æ ‡ç‚¹çš„å¯¼èˆª<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding=gbk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copyright 2020 Wechange Tech.</span></span><br><span class="line"><span class="comment"># Developer: FuZhi, Liu (liu.fuzhi@wechangetech.com)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line">from visualization_msgs.msg import Marker</span><br><span class="line">from visualization_msgs.msg import MarkerArray</span><br><span class="line">import rospy</span><br><span class="line">import math</span><br><span class="line">from geometry_msgs.msg import PointStamped,PoseStamped</span><br><span class="line">import actionlib</span><br><span class="line">from move_base_msgs.msg import *</span><br><span class="line">import tf</span><br><span class="line">//å¦‚æœå¯¼èˆªçŠ¶æ€ä¸º3ä»£è¡¨æˆåŠŸåˆ°è¾¾ç›®æ ‡ç‚¹è¯»å–ä¸‹ä¸€ä¸ªç›®æ ‡ç‚¹çš„ä½ç½®ç»™poseå˜é‡</span><br><span class="line">//ä½¿ç”¨goal_pubå‘å¸ƒåˆ°/move_base_simple/goalè¯é¢˜(çœŸæ­£è§¦å‘move_baseè¿›è¡Œå¯¼èˆªçš„è¯é¢˜)</span><br><span class="line">def status_callback(msg):</span><br><span class="line"></span><br><span class="line">    global goal_pub, index,markerArray</span><br><span class="line">    global add_more_point,try_again</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(msg.status.status == 3):</span><br><span class="line">        try_again = 1</span><br><span class="line">        <span class="keyword">if</span> add_more_point == 0:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Goal reached&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> index &lt; count:</span><br><span class="line"></span><br><span class="line">            pose = PoseStamped()</span><br><span class="line">            pose.header.frame_id = <span class="string">&quot;map&quot;</span></span><br><span class="line">            pose.header.stamp = rospy.Time.now()</span><br><span class="line">            pose.pose.position.x = markerArray.markers[index].pose.position.x</span><br><span class="line">            pose.pose.position.y = markerArray.markers[index].pose.position.y</span><br><span class="line">            pose.pose.orientation.w = 1</span><br><span class="line">            goal_pub.publish(pose)</span><br><span class="line"></span><br><span class="line">            index += 1</span><br><span class="line">    //å½“å¯¼èˆªç‚¹éƒ½æ‰§è¡Œç»“æŸä»¤add_more_point = 1 </span><br><span class="line">    //æ­¤æ—¶å¦‚æœè®¾ç½®äº†æ–°çš„ç›®æ ‡ç‚¹click_callbackä¼šè¢«æ‰§è¡Œ</span><br><span class="line">    //<span class="keyword">if</span> add_more_point and count &gt; 0å¾—åˆ°æ»¡è¶³å¼ºåˆ¶å‘å¸ƒäº†move.status.status = 3</span><br><span class="line">    //ä¸»å‡½æ•°åˆå‘å¸ƒäº†/move_base/resultè¯é¢˜é‡æ–°æ‰§è¡Œstatus_callbackæ¥å‘å¸ƒæ–°çš„ç›®æ ‡ç‚¹     </span><br><span class="line">        <span class="keyword">elif</span> index == count:</span><br><span class="line">            add_more_point = 1</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># uint8 PENDING         = 0   # The goal has yet to be processed by the action server</span></span><br><span class="line">    <span class="comment"># uint8 ACTIVE          = 1   # The goal is currently being processed by the action server</span></span><br><span class="line">    <span class="comment"># uint8 PREEMPTED       = 2   # The goal received a cancel request after it started executing</span></span><br><span class="line">    <span class="comment">#                             #   and has since completed its execution (Terminal State)</span></span><br><span class="line">    <span class="comment"># uint8 SUCCEEDED       = 3   # The goal was achieved successfully by the action server (Terminal State)</span></span><br><span class="line">    <span class="comment"># uint8 ABORTED         = 4   # The goal was aborted during execution by the action server due</span></span><br><span class="line">    <span class="comment">#                             #    to some failure (Terminal State)</span></span><br><span class="line">    <span class="comment"># uint8 REJECTED        = 5   # The goal was rejected by the action server without being processed,</span></span><br><span class="line">    <span class="comment">#                             #    because the goal was unattainable or invalid (Terminal State)</span></span><br><span class="line">    <span class="comment"># uint8 PREEMPTING      = 6   # The goal received a cancel request after it started executing</span></span><br><span class="line">    <span class="comment">#                             #    and has not yet completed execution</span></span><br><span class="line">    <span class="comment"># uint8 RECALLING       = 7   # The goal received a cancel request before it started executing,</span></span><br><span class="line">    <span class="comment">#                             #    but the action server has not yet confirmed that the goal is canceled</span></span><br><span class="line">    <span class="comment"># uint8 RECALLED        = 8   # The goal received a cancel request before it started executing</span></span><br><span class="line">    <span class="comment">#                             #    and was successfully cancelled (Terminal State)</span></span><br><span class="line">    <span class="comment"># uint8 LOST            = 9   # An action client can determine that a goal is LOST. This should not be</span></span><br><span class="line">    <span class="comment">#                             #    sent over the wire by an action server</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Goal cannot reached has some error :&#x27;</span>,msg.status.status,<span class="string">&quot; try again!!!!&quot;</span></span><br><span class="line">        <span class="keyword">if</span> try_again == 1:</span><br><span class="line">            pose = PoseStamped()</span><br><span class="line">            pose.header.frame_id = <span class="string">&quot;map&quot;</span></span><br><span class="line">            pose.header.stamp = rospy.Time.now()</span><br><span class="line">            pose.pose.position.x = markerArray.markers[index-1].pose.position.x</span><br><span class="line">            pose.pose.position.y = markerArray.markers[index-1].pose.position.y</span><br><span class="line">            pose.pose.orientation.w = 1</span><br><span class="line">            goal_pub.publish(pose)</span><br><span class="line">            try_again = 0</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> index &lt; len(markerArray.markers):</span><br><span class="line">                pose = PoseStamped()</span><br><span class="line">                pose.header.frame_id = <span class="string">&quot;map&quot;</span></span><br><span class="line">                pose.header.stamp = rospy.Time.now()</span><br><span class="line">                pose.pose.position.x = markerArray.markers[index].pose.position.x</span><br><span class="line">                pose.pose.position.y = markerArray.markers[index].pose.position.y</span><br><span class="line">                pose.pose.orientation.w = 1</span><br><span class="line">                goal_pub.publish(pose)</span><br><span class="line">                index += 1</span><br><span class="line"></span><br><span class="line">//rvizç•Œé¢æ¯ç‚¹å‡»ä¸€ä¸ªå¤šç›®æ ‡ç‚¹å°±æå–ä½ç½®ä¿¡æ¯è¿½åŠ åˆ°markerArrayæ•°ç»„ä¸­å¹¶å‘å¸ƒå‡ºå»</span><br><span class="line">def click_callback(msg):</span><br><span class="line">    global markerArray,count</span><br><span class="line">    global goal_pub,index</span><br><span class="line">    global add_more_point</span><br><span class="line"></span><br><span class="line">    marker = Marker()</span><br><span class="line">    marker.header.frame_id = <span class="string">&quot;map&quot;</span></span><br><span class="line">    marker.header.stamp = rospy.Time.now()</span><br><span class="line">    <span class="comment"># marker.type = marker.TEXT_VIEW_FACING</span></span><br><span class="line">    marker.type = marker.CYLINDER</span><br><span class="line">    marker.action = marker.ADD</span><br><span class="line">    marker.scale.x = 0.2</span><br><span class="line">    marker.scale.y = 0.2</span><br><span class="line">    marker.scale.z = 0.5</span><br><span class="line">    marker.color.a = 1.0</span><br><span class="line">    marker.color.r = 0.0</span><br><span class="line">    marker.color.g = 1.0</span><br><span class="line">    marker.color.b = 0.0</span><br><span class="line">    marker.pose.orientation.x = 0.0</span><br><span class="line">    marker.pose.orientation.y = 0.0</span><br><span class="line">    marker.pose.orientation.z = 0.0</span><br><span class="line">    marker.pose.orientation.w = 1.0</span><br><span class="line">    marker.pose.position.x = msg.pose.position.x</span><br><span class="line">    marker.pose.position.y = msg.pose.position.y</span><br><span class="line">    marker.pose.position.z = msg.pose.position.z</span><br><span class="line"></span><br><span class="line">    markerArray.markers.append(marker)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Renumber the marker IDs</span></span><br><span class="line">    id = 0</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> markerArray.markers:</span><br><span class="line">       m.id = id</span><br><span class="line">       id += 1</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Publish the MarkerArray</span></span><br><span class="line">    mark_pub.publish(markerArray)</span><br><span class="line">    //å¦‚æœrvizåªå‘å¸ƒäº†ä¸€ä¸ªç›®æ ‡ç‚¹å°±æå–ä½ç½®ä¿¡æ¯åˆ°poseå˜é‡</span><br><span class="line">    //ä½¿ç”¨goal_pubå‘å¸ƒåˆ°/move_base_simple/goalè¯é¢˜(çœŸæ­£è§¦å‘move_baseè¿›è¡Œå¯¼èˆªçš„è¯é¢˜)</span><br><span class="line">    <span class="comment">#first goal</span></span><br><span class="line">    <span class="keyword">if</span> count==0:</span><br><span class="line">        pose = PoseStamped()</span><br><span class="line">        pose.header.frame_id = <span class="string">&quot;map&quot;</span></span><br><span class="line">        pose.header.stamp = rospy.Time.now()</span><br><span class="line">        pose.pose.position.x = msg.pose.position.x</span><br><span class="line">        pose.pose.position.y = msg.pose.position.y</span><br><span class="line">        pose.pose.position.z = msg.pose.position.z</span><br><span class="line">        pose.pose.orientation.x = msg.pose.orientation.x</span><br><span class="line">        pose.pose.orientation.y = msg.pose.orientation.y</span><br><span class="line">        pose.pose.orientation.z = msg.pose.orientation.z</span><br><span class="line">        pose.pose.orientation.w = msg.pose.orientation.w</span><br><span class="line">        goal_pub.publish(pose)</span><br><span class="line">        index += 1</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> add_more_point and count &gt; 0:</span><br><span class="line">        add_more_point = 0</span><br><span class="line">        move =MoveBaseActionResult()</span><br><span class="line">        move.status.status = 3</span><br><span class="line">        move.header.stamp = rospy.Time.now()</span><br><span class="line">        goal_status_pub.publish(move)</span><br><span class="line">    quaternion = (msg.pose.orientation.x, msg.pose.orientation.y, msg.pose.orientation.z, msg.pose.orientation.w)</span><br><span class="line">    theta = tf.transformations.euler_from_quaternion( quaternion)[2]</span><br><span class="line">    count += 1</span><br><span class="line">    <span class="comment"># print &#x27;add a path goal point %f %f %f&#x27;%(msg.pose.position.x,msg.pose.position.y,theta*180.0/3.14)</span></span><br><span class="line"></span><br><span class="line">//å®šä¹‰ä¸€ä¸ªå˜é‡åå­—ä¸ºmarkerArrayç±»å‹ä¸ºMarkerArray</span><br><span class="line">//rvizç•Œé¢æ¯å¢åŠ ä¸€ä¸ªç›®æ ‡ç‚¹å°±ä¼šæœ‰MarkerArrayç±»å‹çš„æ ‡è®°ç¬¦å·</span><br><span class="line">markerArray = MarkerArray()</span><br><span class="line">//å‘å¸ƒçš„ç›®æ ‡ç‚¹æ•°é‡</span><br><span class="line">count = 0       <span class="comment">#total goal num</span></span><br><span class="line">//ç»Ÿè®¡å½“å‰æ‰§è¡Œåˆ°äº†å“ªä¸€ä¸ªç›®æ ‡ç‚¹</span><br><span class="line">index = 0       <span class="comment">#current goal point index</span></span><br><span class="line">//ç»Ÿè®¡åˆ°è¾¾æ‰€æœ‰ç›®æ ‡ç‚¹åæœ‰æ— æ–°å¢åŠ çš„ç›®æ ‡ç‚¹</span><br><span class="line">add_more_point = 0 <span class="comment"># after all goal arrive, if add some more goal</span></span><br><span class="line">//æ²¡æœ‰åˆ°è¾¾ç›®æ ‡ç‚¹é‡è¯•ä¸€æ¬¡</span><br><span class="line">try_again = 1  <span class="comment"># try the fail goal once again</span></span><br><span class="line">//åˆ›å»ºèŠ‚ç‚¹åå­—ä¸ºmulti_goal_point_demo</span><br><span class="line">rospy.init_node(<span class="string">&#x27;multi_goal_point_demo&#x27;</span>)</span><br><span class="line">//åˆ›å»ºå‘å¸ƒå™¨å‘å¸ƒ/path_point_arrayè¯é¢˜å‘å¸ƒç±»å‹ä¸ºMarkerArray</span><br><span class="line">mark_pub = rospy.Publisher(<span class="string">&#x27;/path_point_array&#x27;</span>, MarkerArray,queue_size=100)</span><br><span class="line">//åˆ›å»ºè®¢é˜…å™¨è®¢é˜…/goalè¯é¢˜--rvizç•Œé¢å¤šç›®æ ‡ç‚¹å‘å¸ƒçš„è¯é¢˜ï¼Œå›è°ƒå‡½æ•°click_callback</span><br><span class="line">click_goal_sub = rospy.Subscriber(<span class="string">&#x27;/goal&#x27;</span>,PoseStamped,click_callback)</span><br><span class="line">//åˆ›å»ºå‘å¸ƒå™¨å‘å¸ƒ/move_base_simple/goalè¯é¢˜(çœŸæ­£è§¦å‘move_baseè¿›è¡Œå¯¼èˆªçš„è¯é¢˜)å‘å¸ƒç±»å‹ä¸ºPoseStamped</span><br><span class="line">goal_pub = rospy.Publisher(<span class="string">&#x27;/move_base_simple/goal&#x27;</span>,PoseStamped,queue_size=1)</span><br><span class="line">//åˆ›å»ºè®¢é˜…å™¨è®¢é˜…/move_base/result--move_baseå¯¼èˆªçš„ç»“æœï¼Œå›è°ƒå‡½æ•°status_callback</span><br><span class="line">goal_status_sub = rospy.Subscriber(<span class="string">&#x27;/move_base/result&#x27;</span>,MoveBaseActionResult,status_callback)</span><br><span class="line"><span class="comment">#after all goal arrive, if add some more goal</span></span><br><span class="line"><span class="comment">#we deleberate pub a topic to trig the goal sent</span></span><br><span class="line">//æ‰€æœ‰å¯¼èˆªç‚¹ç»“æŸ/move_base/resultè¯é¢˜ä¸å†å‘å¸ƒï¼Œæ‰‹åŠ¨å‘å¸ƒä¸€ä¸‹å¯¼èˆªç»“æœè¯é¢˜æ–¹ä¾¿ç»§ç»­å‘å¸ƒå¯¼èˆªç‚¹</span><br><span class="line">goal_status_pub = rospy.Publisher(<span class="string">&#x27;/move_base/result&#x27;</span>,MoveBaseActionResult,queue_size=1)</span><br><span class="line">rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" green><summary> way_point.pyæ–‡ä»¶ </summary>              <div class='content'>              <p><p class='p blue'>ç®€ä»‹</p><br>è·å–è‡ªåŠ¨å·¡èˆªçš„ä¸‰ä¸ªç‚¹çš„åæ ‡ä»¥åŠå¾ªç¯æ¬¡æ•°ï¼Œ0ä»£è¡¨ä¸åœæ­¢(launchæ–‡ä»¶å¯ä¼ )å¦‚æœæ²¡æœ‰å€¼åˆ™é»˜è®¤åé¢çš„æ•°æ®<br>å¯¹ä¸‰ä¸ªç‚¹å¤„ç†æˆæ•°ç»„å½¢å¼<br>åˆ¤æ–­ä¸‰ä¸ªæ•°ç»„æ˜¯ä¸æ˜¯ç›¸ç­‰<br>æ‰§è¡ŒMultiGoalså‡½æ•°åŠŸèƒ½å¦‚ä¸‹:<br>åˆ›å»ºè®¢é˜…å™¨è®¢é˜…å¯¼èˆªç»“æœmove_base/resultå›è°ƒå‡½æ•°ä¸ºstatusCB<br>åˆ›å»ºå‘å¸ƒå™¨å‘å¸ƒmove_base_simple/goalè¯é¢˜ç›´æ¥å¯åŠ¨move_baseè¿›è¡Œå¯¼èˆª<br>è¯»å–å·¡èˆªç‚¹çš„åæ ‡å’Œå¾ªç¯æ¬¡æ•°ï¼Œè®¾ç½®å·¡èˆªç»“æŸæ ‡å¿—wayPointFinishedä¸ºFalse<br>è®¾ç½®ç›®æ ‡ç‚¹idä¸º0<br>å‘å¸ƒç¬¬ä¸€ä¸ªç›®æ ‡ç‚¹çš„ä½ç½®ä¿¡æ¯åˆ°move_base_simple/goalè¯é¢˜<br>ç›®æ ‡ç‚¹idåŠ 1ï¼Œåˆ°è¾¾ç¬¬ä¸€ä¸ªç›®æ ‡ç‚¹åmove_base/resultè¯é¢˜ä¼šè¢«å‘å¸ƒæ‰§è¡Œå›è°ƒå‡½æ•°ä¸ºstatusCB<br>å›è°ƒå‡½æ•°statusCBåŠŸèƒ½å¦‚ä¸‹:<br>å¦‚æœå¾ªç¯æ¬¡æ•°è¾¾åˆ°ï¼Œä»¤wayPointFinished = True<br>å¦‚æœæˆåŠŸåˆ°è¾¾ä¸”å·¡èˆªç»“æŸæ ‡å¿—wayPointFinished = falseç»§ç»­å‘å¸ƒä¸‹ä¸€ä¸ªç›®æ ‡ç‚¹ä½ç½®ä¿¡æ¯<br>å¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œæ‰€æœ‰ç›®æ ‡ç‚¹å°±ä»¤ç›®æ ‡ç‚¹idåŠ 1ï¼Œ<br>æ‰§è¡Œå®Œäº†æ‰€æœ‰ç›®æ ‡ç‚¹å°±ä»¤ç›®æ ‡ç‚¹idä¸º0å¹¶ä¸”å¾ªç¯æ¬¡æ•°æ ‡å¿—åŠ 1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding=gbk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copyright 2020 Wechange Tech.</span></span><br><span class="line"><span class="comment"># Developer: FuZhi, Liu (liu.fuzhi@wechangetech.com)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line">import rospy</span><br><span class="line">import string</span><br><span class="line">import math</span><br><span class="line">import time</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">from std_msgs.msg import String</span><br><span class="line">from move_base_msgs.msg import MoveBaseActionResult</span><br><span class="line">from actionlib_msgs.msg import GoalStatusArray</span><br><span class="line">from geometry_msgs.msg import PoseStamped</span><br><span class="line">import tf</span><br><span class="line">//åˆ›å»ºè®¢é˜…å™¨è®¢é˜…å¯¼èˆªç»“æœmove_base/resultå›è°ƒå‡½æ•°ä¸ºstatusCB</span><br><span class="line">//åˆ›å»ºå‘å¸ƒå™¨å‘å¸ƒmove_base_simple/goalè¯é¢˜ç›´æ¥å¯åŠ¨move_baseè¿›è¡Œå¯¼èˆª</span><br><span class="line">class MultiGoals:</span><br><span class="line">    def __init__(self, goalListX, goalListY, goalListZ,loopTimes, map_frame):</span><br><span class="line">        self.sub = rospy.Subscriber(<span class="string">&#x27;move_base/result&#x27;</span>, MoveBaseActionResult, self.statusCB, queue_size=10)</span><br><span class="line">        self.pub = rospy.Publisher(<span class="string">&#x27;move_base_simple/goal&#x27;</span>, PoseStamped, queue_size=10)   </span><br><span class="line">        <span class="comment"># params &amp; variables</span></span><br><span class="line">        //è¯»å–å·¡èˆªç‚¹çš„åæ ‡å’Œå¾ªç¯æ¬¡æ•°ï¼Œè®¾ç½®å·¡èˆªç»“æŸæ ‡å¿—wayPointFinishedä¸ºFalse</span><br><span class="line">        self.goalListX = goalListX</span><br><span class="line">        self.goalListY = goalListY</span><br><span class="line">        self.goalListZ = goalListZ</span><br><span class="line">        self.loopTimes = loopTimes</span><br><span class="line">        self.loop = 1</span><br><span class="line">        self.wayPointFinished = False </span><br><span class="line">        //è®¾ç½®ç›®æ ‡ç‚¹idä¸º0</span><br><span class="line">        self.goalId = 0</span><br><span class="line">        self.goalMsg = PoseStamped()</span><br><span class="line">        self.goalMsg.header.frame_id = map_frame</span><br><span class="line">        self.goalMsg.pose.orientation.z = 0.0</span><br><span class="line">        self.goalMsg.pose.orientation.w = 1.0</span><br><span class="line">        <span class="comment"># Publish the first goal</span></span><br><span class="line">        //å‘å¸ƒç¬¬ä¸€ä¸ªç›®æ ‡ç‚¹çš„ä½ç½®ä¿¡æ¯</span><br><span class="line">        time.sleep(1)</span><br><span class="line">        self.goalMsg.header.stamp = rospy.Time.now()</span><br><span class="line">        self.goalMsg.pose.position.x = self.goalListX[self.goalId]</span><br><span class="line">        self.goalMsg.pose.position.y = self.goalListY[self.goalId]</span><br><span class="line">        self.goalMsg.pose.orientation.x = 0.0</span><br><span class="line">        self.goalMsg.pose.orientation.y = 0.0</span><br><span class="line">        <span class="keyword">if</span> abs(self.goalListZ[self.goalId]) &gt; 1.0:</span><br><span class="line">            self.goalMsg.pose.orientation.z = 0.0</span><br><span class="line">            self.goalMsg.pose.orientation.w = 1.0</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            w = math.sqrt(1 - (self.goalListZ[self.goalId]) ** 2)</span><br><span class="line">            self.goalMsg.pose.orientation.z = self.goalListZ[self.goalId]</span><br><span class="line">            self.goalMsg.pose.orientation.w = w</span><br><span class="line">        self.pub.publish(self.goalMsg) </span><br><span class="line">        rospy.loginfo(<span class="string">&quot;Current Goal ID is: %d&quot;</span>, self.goalId)</span><br><span class="line">        //ç›®æ ‡ç‚¹idåŠ 1ï¼Œåˆ°è¾¾ç¬¬ä¸€ä¸ªç›®æ ‡ç‚¹åmove_base/resultè¯é¢˜ä¼šè¢«å‘å¸ƒæ‰§è¡Œå›è°ƒå‡½æ•°ä¸ºstatusCB</span><br><span class="line">        self.goalId = self.goalId + 1 </span><br><span class="line"></span><br><span class="line">    def statusCB(self, data):</span><br><span class="line">    //å¦‚æœå¾ªç¯æ¬¡æ•°è¾¾åˆ°ï¼Œä»¤wayPointFinished = True</span><br><span class="line">        <span class="keyword">if</span> self.loopTimes and (self.loop &gt; self.loopTimes):</span><br><span class="line">            rospy.loginfo(<span class="string">&quot;Loop: %d Times Finshed&quot;</span>, self.loopTimes)</span><br><span class="line">            self.wayPointFinished = True</span><br><span class="line">     //å¦‚æœæˆåŠŸåˆ°è¾¾ä¸”å·¡èˆªç»“æŸæ ‡å¿—wayPointFinished = <span class="literal">false</span>ç»§ç»­å‘å¸ƒä¸‹ä¸€ä¸ªç›®æ ‡ç‚¹ä½ç½®ä¿¡æ¯       </span><br><span class="line">        <span class="keyword">if</span> data.status.status == 3 and (not self.wayPointFinished): <span class="comment"># reached</span></span><br><span class="line">            self.goalMsg.header.stamp = rospy.Time.now()                </span><br><span class="line">            self.goalMsg.pose.position.x = self.goalListX[self.goalId]</span><br><span class="line">            self.goalMsg.pose.position.y = self.goalListY[self.goalId]</span><br><span class="line">            <span class="keyword">if</span> abs(self.goalListZ[self.goalId]) &gt; 1.0:</span><br><span class="line">                self.goalMsg.pose.orientation.z = 0.0</span><br><span class="line">                self.goalMsg.pose.orientation.w = 1.0</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                w = math.sqrt(1 - (self.goalListZ[self.goalId]) ** 2)</span><br><span class="line">                self.goalMsg.pose.orientation.z = self.goalListZ[self.goalId]</span><br><span class="line">                self.goalMsg.pose.orientation.w = w</span><br><span class="line">            self.pub.publish(self.goalMsg)  </span><br><span class="line">            rospy.loginfo(<span class="string">&quot;Current Goal ID is: %d&quot;</span>, self.goalId)  </span><br><span class="line">            //å¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œæ‰€æœ‰ç›®æ ‡ç‚¹å°±ä»¤ç›®æ ‡ç‚¹idåŠ 1ï¼Œ</span><br><span class="line">            //æ‰§è¡Œå®Œäº†æ‰€æœ‰ç›®æ ‡ç‚¹å°±ä»¤ç›®æ ‡ç‚¹idä¸º0å¹¶ä¸”å¾ªç¯æ¬¡æ•°æ ‡å¿—åŠ 1            </span><br><span class="line">            <span class="keyword">if</span> self.goalId &lt; (len(self.goalListX)-1):</span><br><span class="line">                self.goalId = self.goalId + 1</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.goalId = 0</span><br><span class="line">                self.loop += 1</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    try:    </span><br><span class="line">        <span class="comment"># ROS Init    </span></span><br><span class="line">        rospy.init_node(<span class="string">&#x27;way_point&#x27;</span>, anonymous=True)</span><br><span class="line">    //è·å–è‡ªåŠ¨å·¡èˆªçš„ä¸‰ä¸ªç‚¹çš„åæ ‡ä»¥åŠå¾ªç¯æ¬¡æ•°ï¼Œ0ä»£è¡¨ä¸åœæ­¢(launchæ–‡ä»¶å¯ä¼ )å¦‚æœæ²¡æœ‰å€¼åˆ™é»˜è®¤åé¢çš„æ•°æ®</span><br><span class="line">        <span class="comment"># Get params</span></span><br><span class="line">        goalListX = rospy.get_param(<span class="string">&#x27;~goalListX&#x27;</span>, <span class="string">&#x27;[2.0, 2.0]&#x27;</span>)</span><br><span class="line">        goalListY = rospy.get_param(<span class="string">&#x27;~goalListY&#x27;</span>, <span class="string">&#x27;[2.0, 4.0]&#x27;</span>)</span><br><span class="line">        goalListZ = rospy.get_param(<span class="string">&#x27;~goalListZ&#x27;</span>, <span class="string">&#x27;[0.0, 0.0]&#x27;</span>)</span><br><span class="line">        map_frame = rospy.get_param(<span class="string">&#x27;~map_frame&#x27;</span>, <span class="string">&#x27;map&#x27;</span> )</span><br><span class="line">        loopTimes = int(rospy.get_param(<span class="string">&#x27;~loopTimes&#x27;</span>, <span class="string">&#x27;0&#x27;</span>)) </span><br><span class="line">    //å¯¹ä¸‰ä¸ªç‚¹å¤„ç†æˆæ•°ç»„å½¢å¼</span><br><span class="line">        goalListX = goalListX.replace(<span class="string">&quot;[&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;]&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">        goalListY = goalListY.replace(<span class="string">&quot;[&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;]&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">        goalListZ = goalListZ.replace(<span class="string">&quot;[&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;]&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">        goalListX = [<span class="built_in">float</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> goalListX.split(<span class="string">&quot;,&quot;</span>)]</span><br><span class="line">        goalListY = [<span class="built_in">float</span>(y) <span class="keyword">for</span> y <span class="keyword">in</span> goalListY.split(<span class="string">&quot;,&quot;</span>)]</span><br><span class="line">        goalListZ = [<span class="built_in">float</span>(z) <span class="keyword">for</span> z <span class="keyword">in</span> goalListZ.split(<span class="string">&quot;,&quot;</span>)]</span><br><span class="line">    //åˆ¤æ–­ä¸‰ä¸ªæ•°ç»„æ˜¯ä¸æ˜¯ç›¸ç­‰    </span><br><span class="line">        <span class="keyword">if</span> len(goalListX) == len(goalListY) == len(goalListZ) &amp; len(goalListY) &gt;=2:          </span><br><span class="line">            <span class="comment"># Constract MultiGoals Obj</span></span><br><span class="line"></span><br><span class="line">            rospy.loginfo(<span class="string">&quot;Multi Goals Executing...&quot;</span>)</span><br><span class="line">            mg = MultiGoals(goalListX, goalListY, goalListZ, loopTimes, map_frame) </span><br><span class="line">    //æ‰§è¡ŒMultiGoalså‡½æ•°                 </span><br><span class="line">            rospy.spin()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rospy.errinfo(<span class="string">&quot;Lengths of goal lists are not the same&quot;</span>)</span><br><span class="line">    except KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;shutting down&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" green><summary> initenv.shæ–‡ä»¶ </summary>              <div class='content'>              </div>            </details><details class="folding-tag" green><summary> setlidar.shæ–‡ä»¶ </summary>              <div class='content'>              </div>            </details>              </div>            </details><details class="folding-tag" blue><summary> package.xmlæ–‡ä»¶ </summary>              <div class='content'>              <p>è¿è¡Œä¾èµ–ï¼Œç¼–è¯‘ä¾èµ–</p>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-6"><p>simulation_one_robot.launchï¼š<br>è¿™ä¸ªlaunchæ–‡ä»¶æ˜¯å¯åŠ¨æœºå™¨äººçš„ä»¿çœŸæ—¶ç”¨åˆ°çš„launchï¼Œå®ƒå¯åŠ¨äº†stage_rosè¿™ä¸ªèŠ‚ç‚¹ã€‚è¿™ä¸ªèŠ‚ç‚¹è¿è¡Œäº†ä¸€ä¸ªä»¿çœŸå™¨çš„ç¯å¢ƒï¼Œå®ƒéœ€è¦ä¸€ä¸ªä»¿çœŸå™¨çš„é…ç½®ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚æˆ‘ä»¬ä»¥NanoCarä¸ºä¾‹çœ‹ä¸€ä¸‹å®ƒçš„é…ç½®æ–‡ä»¶å†…å®¹ã€‚<br>é¦–å…ˆå®ƒåŒ…å«äº†ä¸€ä¸ªrobot.incæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨äºæè¿°æˆ‘ä»¬æ‰€è¦ä»¿çœŸçš„æœºå™¨äººçš„ä¿¡æ¯ã€‚å®ƒå®šä¹‰äº†ä¸€ä¸ªé›·è¾¾ä¼ æ„Ÿå™¨åŒ…æ‹¬é›·è¾¾æ‰«ææœ€è¿œè·ç¦»ï¼Œæ‰«æè§’åº¦ï¼Œé›·è¾¾é‡‡æ ·ç‚¹æ•°é‡ä»¥åŠé›·è¾¾çš„å°ºå¯¸ã€‚ç„¶åå®šä¹‰äº†æœºå™¨äººçš„ä½ç½®ï¼Œé‡Œç¨‹è®¡çš„è¯¯å·®ï¼Œæœºå™¨äººçš„å°ºå¯¸ï¼Œæœºå™¨äººçš„åŸºåº§æ ‡ä¸ä»¿çœŸå™¨ä»¿çœŸå‡ºæ¥çš„æœºå™¨äººç«‹æ–¹ä½“æ¨¡å‹çš„åç§»ï¼Œæœºå™¨äººçš„é¢œè‰²ï¼Œæœºå™¨äººçš„è¿åŠ¨å­¦ç‰¹æ€§ï¼Œæœºå™¨äººè½´è·ï¼Œæ¿€å…‰é›·è¾¾åˆ°è½¦èº«çš„å˜æ¢ç­‰ä¿¡æ¯<br>å›åˆ°maze.worldæ–‡ä»¶ï¼Œè¿™é‡Œéœ€è¦è®¾ç½®ä»¿çœŸå™¨å¯åŠ¨åçª—å£çš„å¤§å°ä¸­å¿ƒç‚¹ç­‰ä¿¡æ¯ã€‚<br>é…ç½®ä»¿çœŸåœ°å›¾ï¼Œåœ°å›¾å­˜æ”¾åœ¨åŠŸèƒ½åŒ…çš„mapsæ–‡ä»¶ä¸‹ã€‚sizeå‚æ•°è®¾ç½®åœ°å›¾çš„å®é™…å¤§å°ã€‚åœ°å›¾çš„è§„æ ¼ä¸º200<em>200æˆ‘ä»¬è®¾ç½®çš„å®é™…å°ºå¯¸æ˜¯10ç±³</em>10ç±³ä¹Ÿå°±æ˜¯æ¯ä¸ªåƒç´ ç‚¹5å˜ç±³ã€‚ç„¶åè®¾ç½®ä¸­å¿ƒä¸º5<em>5<br>æœ€åæŠŠæœºå™¨äººåŠ è½½è¿›åœ°å›¾å½“ä¸­ï¼Œåœ¨åœ°å›¾çš„1</em>1ä½ç½®æ”¾ç½®æœºå™¨äººï¼Œæœºå™¨äººåè®¾ä¸ºrobotã€‚è¿™é‡Œæ³¨æ„æœºå™¨äººä½ç½®å¦‚æœè®¾ä¸º0*0ä¼šæŠŠæœºå™¨äººæ”¾åˆ°è¾¹ç•Œä¸Šå¯¼è‡´å‡ºé”™<br>simulation_one_robot_with_map.launchï¼š<br>è¿™ä¸ªlaunchçš„å‰åŠéƒ¨åˆ†å’Œsimulation_one_robot.launchæ˜¯ä¸€æ ·çš„ï¼ŒååŠéƒ¨åˆ†å®ƒåˆ†åˆ«å¯åŠ¨äº†ä¸€ä¸ªmap_serveræ¥è½½å…¥åœ°å›¾å’Œamclçš„èŠ‚ç‚¹ç”¨äºå®šä½æœºå™¨äººã€‚amclçš„èŠ‚ç‚¹æœ‰åˆå§‹ä½ç½®ä½œä¸ºå‚æ•°ä¼ å…¥èŠ‚ç‚¹ã€‚<br>map_serverè½½å…¥çš„åœ°å›¾æ–‡ä»¶å°±æ˜¯maze.yamlæ–‡ä»¶ï¼Œå®ƒè¯»å–çš„å›¾ä¸ºmaze.pngã€‚è®¾ç½®åˆ†è¾¨ç‡ä¸º0.05ä¹Ÿå°±æ˜¯ä¸€ä¸ªåƒç´ å¯¹åº”5å˜ç±³ï¼Œè¿™ä¸å‰é¢è®¾ç½®çš„å®é™…åœ°å›¾å¤§å°æ˜¯ä¸€è‡´çš„ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> æ¯•ä¸šè®¾è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>rosç¼–ç¨‹å…¥é—¨</title>
      <link href="blog/ros%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/"/>
      <url>blog/ros%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">ç®€ä»‹</button></li><li class="tab"><button type="button" data-href="#test4-2">ç¼–å†™å‘å¸ƒè®¢é˜…èŠ‚ç‚¹</button></li><li class="tab"><button type="button" data-href="#test4-3">ç¼–å†™launchæ–‡ä»¶</button></li><li class="tab"><button type="button" data-href="#test4-4">è‡ªå®šä¹‰æ¶ˆæ¯å’ŒæœåŠ¡ç±»å‹</button></li><li class="tab"><button type="button" data-href="#test4-5">TFåæ ‡å˜æ¢</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><details class="folding-tag" green><summary> ç®€ä»‹ </summary>              <div class='content'>              <ol><li>åŠŸèƒ½åŒ…ï¼ˆpackageï¼‰:ROSè½¯ä»¶ä¸­çš„åŸºæœ¬å•å…ƒï¼ŒåŒ…å«èŠ‚ç‚¹æºç ã€é…ç½®æ–‡ä»¶ã€æ•°æ®å®šä¹‰ç­‰ã€‚ä¸€ä¸ªåŠŸèƒ½åŒ…é‡Œå¯ä»¥æœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œåœ¨èŠ‚ç‚¹ä¸­è¿›è¡Œå‘å¸ƒå’Œè®¢é˜…è¯é¢˜</li><li>åŠŸèƒ½åŒ…ä¸‹çš„srcæ–‡ä»¶å¤¹ç¼–å†™çš„cppç”¨æ¥å®ç°å‘å¸ƒå’Œè®¢é˜…åŠŸèƒ½ï¼Œä¸€ä¸ªcppæ–‡ä»¶å¯ä»¥åˆ¶ä½œä¸€ä¸ªèŠ‚ç‚¹</li><li>åŠŸèƒ½åŒ…ä¸‹çš„scriptæ–‡ä»¶å¤¹ç¼–å†™çš„pythonä»£ç ç”¨æ¥å®ç°å‘å¸ƒå’Œè®¢é˜…åŠŸèƒ½ï¼Œä¸€ä¸ªpythonæ–‡ä»¶å¯ä»¥åˆ¶ä½œä¸€ä¸ªèŠ‚ç‚¹</li><li>èŠ‚ç‚¹å¯ä»¥å‘å¸ƒæˆ–è®¢é˜…è¯é¢˜ï¼Œä¹Ÿå¯ä»¥æä¾›æˆ–è€…ä½¿ç”¨æœåŠ¡(cppæˆ–è€…pyç­‰ç¼–å†™)</li><li>èŠ‚ç‚¹æ˜¯å¯æ‰§è¡Œç¨‹åºï¼Œé€šè¿‡ros::init(argc, argv, â€œèŠ‚ç‚¹åå­—â€);äº§ç”Ÿä¸€ä¸ªèŠ‚ç‚¹å¹¶å‘½å<!-- ![](https://s1.vika.cn/space/2023/01/12/13763fc2103644bd8e275f0d34942fe5) --><img src="/media/rosç¼–ç¨‹å…¥é—¨01.webp" alt=""></li><li>ä¸€ä¸ªè¯é¢˜ç”±å¤šä¸ªæ¶ˆæ¯ç»„æˆï¼Œè¯é¢˜çš„ç±»å‹å–å†³äºæ¶ˆæ¯ç±»å‹ï¼ˆç»“æ„ä½“ï¼‰</li><li>åœ¨å¤§éƒ¨åˆ†ä¾‹ç¨‹ä¸­å°†cppæ–‡ä»¶åå’Œå¯æ‰§è¡Œæ–‡ä»¶åï¼Œä»¥åŠèŠ‚ç‚¹åå‘½åæˆäº†ä¸€è‡´ã€‚pyæ–‡ä»¶ä¸€æ ·</li><li>launchæ–‡ä»¶çš„ç›®çš„æ˜¯å¯åŠ¨èŠ‚ç‚¹å³å¯æ‰§è¡Œæ–‡ä»¶</li><li>ä¸€ä¸ªæ¶ˆæ¯ç±»å‹ç›¸å½“äºä¸€ä¸ªç»“æ„ä½“</li><li>è¯é¢˜æ˜¯ä¸€å¯¹å¤šï¼ŒæœåŠ¡æ˜¯ä¸€å¯¹ä¸€ï¼Œå®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯ä¼ å‚æ•°å€¼<p class='p blue'>åˆ›å»ºä»£ç†a=rospy.ServiceProxy(æœåŠ¡åï¼Œ æœåŠ¡ç±»å‹)ï¼›a(ä¼ å‚1ï¼Œä¼ å‚2)</p>æœåŠ¡ç«¯ç»è¿‡ç›¸å…³è®¡ç®—å°†ç»“æœç»™åˆ†å‰²çº¿ä¸‹çš„æˆå‘˜å˜é‡ã€‚å®¢æˆ·ç«¯åˆ™å¯ä»¥é€šè¿‡åˆ†å‰²çº¿ä¸‹çš„æˆå‘˜å˜é‡è·å–è®¡ç®—ç»“æœ<p class='p blue'>é€šè¿‡ä»£ç†çš„è¿”å›å€¼è·å–ï¼šb=a(ä¼ å‚1ï¼Œä¼ å‚2); b.æˆå‘˜å˜é‡</p></li><li>æœåŠ¡åç›¸å½“äºè¯é¢˜åï¼ŒæœåŠ¡ç±»å‹ç›¸å½“äºè¯é¢˜ç±»å‹ï¼ŒæœåŠ¡å™¨ç›¸å½“äºè®¢é˜…å™¨ï¼Œå®¢æˆ·ç«¯ç›¸å½“äºå‘å¸ƒå™¨ã€‚</li><li>æœåŠ¡ç«¯çš„å›è°ƒå‡½æ•°ä¸­çš„<p class='p blue'>return æœåŠ¡ç±»å‹Response()</p>å°†å®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯è®¡ç®—å¤„ç†åå°†<p class='p blue'>æ‹¬å·å†…çš„æ•°</p>é€ç»™è¯¥æœåŠ¡ç±»å‹ä¸­ç›¸åº”æœåŠ¡åçš„çš„åˆ†å‰²çº¿ä¸‹çš„æˆå‘˜å˜é‡</li><li>c++ç¼–å†™æ—¶ï¼Œå®šä¹‰ä¸€ä¸ªæœåŠ¡ç±»å‹çš„ç»“æ„ä½“å˜é‡a åˆ™a.Request.æˆå‘˜å˜é‡ä»£è¡¨åˆ†å‰²çº¿ä¸Šçš„æˆå‘˜å˜é‡â€”-å®¢æˆ·ç«¯ä¼ çš„</li><li>c++ç¼–å†™æ—¶ï¼Œå®šä¹‰ä¸€ä¸ªæœåŠ¡ç±»å‹çš„ç»“æ„ä½“å˜é‡a åˆ™a.Response.æˆå‘˜å˜é‡ä»£è¡¨åˆ†å‰²çº¿ä¸‹çš„æˆå‘˜å˜é‡â€”-æœåŠ¡ç«¯å›åº”çš„</li><li>pythonç¼–å†™tfåŠ¨æ€åæ ‡å‘å¸ƒåªéœ€è¦å®šä¹‰ä¸€ä¸ªtfå¹¿æ’­å™¨ï¼Œå¹¿æ’­å™¨è°ƒç”¨å‘é€å‡½æ•°sendTransformï¼ˆä¼ å…¥å‚æ•°ç›¸å¯¹ä½ç½®å’Œå§¿æ€ï¼‰å³å¯ã€‚å§¿æ€ä¼ å…¥çš„å››å…ƒæ•°å¯ä»¥ç”¨tf.transformations.quaternion_from_eulerå‡½æ•°å°†æ¬§æ‹‰è§’è½¬æ¢ä¸ºå››å…ƒæ•°</li><li>c++ç¼–å†™tfåŠ¨æ€åæ ‡å‘å¸ƒåªéœ€è¦å®šä¹‰ä¸€ä¸ªtfå¹¿æ’­å™¨ï¼Œå¹¿æ’­å™¨è°ƒç”¨å‘é€å‡½æ•°sendTransformï¼ˆä¼ å…¥å‚æ•°ç›¸å¯¹ä½ç½®å’Œå§¿æ€ï¼‰å³å¯ã€‚å§¿æ€ä¼ å…¥çš„å››å…ƒæ•°å¯ä»¥ç”¨tf::createQuaternionFromRPYå°†æè¿°å§¿æ€çš„æ¬§æ‹‰è§’è½¬æ¢ä¸ºå››å…ƒæ•°ï¼ˆä¸‰ä¸ªå‚æ•°æ˜¯åˆ†åˆ«ç»•xè½´ï¼Œyè½´ï¼Œzè½´ï¼‰</li></ol>              </div>            </details><details class="folding-tag" yellow><summary> åˆ›å»ºåŠŸèƒ½åŒ… </summary>              <div class='content'>              <ol><li><p class='p blue'>åˆ‡æ¢åˆ°å·¥ä½œç©ºé—´çš„srcä¸‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd catkin_ws/src</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>catkin_create_pkgåˆ›å»ºåŠŸèƒ½åŒ…ï¼šå‚æ•°ä¸ºåŠŸèƒ½åŒ…å</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catkin_create_pkg bingda_practices</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><details class="folding-tag" green><summary> å‘å¸ƒè€…èŠ‚ç‚¹c++ </summary>              <div class='content'>              <ol><li><p class='p blue'>æ‰“å¼€Visual Studio Codeæ‰¾åˆ°æˆ‘ä»¬åˆšå»ºç«‹çš„åŠŸèƒ½åŒ…ï¼Œå³é”®é€‰æ‹©New Folderåœ¨åŠŸèƒ½åŒ…ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å–åsrcç”¨æ¥å­˜æ”¾ä»£ç ï¼Œsrcä¸‹æ–°å»ºä¸€ä¸ªtalker.cppæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="comment">//è¦å‘å¸ƒStingç±»å‹çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªèŠ‚ç‚¹åå­—ä¸ºtalkeræ¥å‘å¸ƒè¯é¢˜åä¸ºchatterçš„è¯é¢˜</span></span><br><span class="line">ros::init(argc, argv, <span class="string">&quot;talker&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºå¥æŸ„</span></span><br><span class="line">ros::NodeHandle n;</span><br><span class="line"><span class="comment">//åˆ›å»ºå‘å¸ƒå™¨chatter_pubï¼Œå‘å¸ƒæ¶ˆæ¯ç±»å‹String,å‘å¸ƒè¯é¢˜åå­—ä¸ºchatter,æœ€å¤§ç¼“å­˜1000ä¸ª</span></span><br><span class="line">ros::Publisher chatter_pub = n.advertise&lt;std_msgs::String&gt;(<span class="string">&quot;chatter&quot;</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">//æŒ‡å®šå¾ªç¯é¢‘ç‡10hz</span></span><br><span class="line"><span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line"><span class="comment">//å®šä¹‰å˜é‡countæ¥è®¡ç®—å‘å¸ƒè¯é¢˜ä¸ªæ•°</span></span><br><span class="line">  <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//å½“crtl+cã€åŒåèŠ‚ç‚¹è¿è¡Œã€rosæ•´ä¸ªè¿›ç¨‹ç»“æŸã€killæ€æ­»æ—¶ros::ok()ä¸ºfalse</span></span><br><span class="line"><span class="keyword">while</span> (ros::ok())</span><br><span class="line">&#123;<span class="comment">//åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯ç±»å‹ä¸ºString(ç»“æ„ä½“)(æˆå‘˜å˜é‡data)çš„å˜é‡</span></span><br><span class="line">std_msgs::String msg;</span><br><span class="line"><span class="comment">//åˆ›å»ºstringç±»å‹çš„å˜é‡ss</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">stringstream</span> ss;</span><br><span class="line"><span class="comment">//å˜é‡ssä¸­ä¼ å…¥æ•°æ®hello world count(å˜é‡ä¼šå˜)</span></span><br><span class="line">ss&lt;&lt;<span class="string">&quot; hello world &quot;</span>&lt;&lt;count;</span><br><span class="line"><span class="comment">//æŠŠå˜é‡ssä¸­çš„å†…å®¹ç»™æ¶ˆæ¯msgçš„æˆå‘˜å˜é‡dataä¸­ </span></span><br><span class="line">msg.data = ss.str();</span><br><span class="line"><span class="comment">//æ‰“å°msgçš„å†…å®¹ä»¥å­—ç¬¦ä¸²çš„å½¢å¼</span></span><br><span class="line">ROS_INFO(<span class="string">&quot;%s&quot;</span>,msg.data.c_str());</span><br><span class="line"><span class="comment">//å‘å¸ƒå™¨å‘å¸ƒè¯é¢˜ï¼Œå‘å¸ƒå†…å®¹ä¸ºæ¶ˆæ¯msg</span></span><br><span class="line">chatter_pub.publish(msg);</span><br><span class="line">ros::spinOnce();</span><br><span class="line"><span class="comment">//ä¼‘çœ </span></span><br><span class="line">loop_rate.sleep();</span><br><span class="line">count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- ![](https://s1.vika.cn/space/2023/01/12/84a39cdc547c470b9002bc4d6ffae25e) --><img src="/media/rosç¼–ç¨‹å…¥é—¨02.webp" alt=""></li><li><p class='p blue'>ä»£ç ç¼–å†™å®Œæˆåç¼–è¾‘CMakeLists.txtæ–‡ä»¶åœ¨find_package(catkin REQUIRED)æ‹¬å·å†…åŠ å…¥ roscpp std_msgs</p></li><li><p class='p blue'>å°†include_directorieså†…çš„ä¸¤è¡Œæ³¨é‡Šå–æ¶ˆ</p></li><li><p class='p blue'>åœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸Šä»¥ä¸‹ä¸¤å¥ï¼Œè®¾ç½®ç¼–è¯‘è§„åˆ™</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_executable(talker src/talker.cpp)</span><br><span class="line">target_link_libraries(talker $&#123;catkin_LIBRARIES&#125;)</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>ä¿®æ”¹å®Œæˆåï¼Œè°ƒç”¨ç»ˆç«¯ç¼–è¯‘å·¥ä½œç©ºé—´ã€‚ç¼–è¯‘å®Œæˆååœ¨å·¥ä½œç©ºé—´çš„devel->libè·¯å¾„ä¸‹å¯¹åº”çš„åŠŸèƒ½åŒ…é‡Œå°±ä¼šå­˜æ”¾æœ‰ç¼–è¯‘ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p></li></ol>              </div>            </details><details class="folding-tag" yellow><summary> è®¢é˜…è€…èŠ‚ç‚¹c++ </summary>              <div class='content'>              <ol><li><p class='p blue'>åœ¨åŠŸèƒ½åŒ…ä¸‹çš„srcæ–‡ä»¶ä¸‹æ–°å»ºä¸€ä¸ªlistener.cppæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"><span class="comment">//å›è°ƒå‡½æ•°ï¼Œä¼ å…¥å‚æ•°ä¸ºè®¢é˜…çš„è¯é¢˜æ¶ˆæ¯</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">chatterCallback</span><span class="params">(<span class="keyword">const</span> std_msgs::String::ConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//æ‰“å°chatterè¯é¢˜é‡Œçš„æ¶ˆæ¯å†…å®¹ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼æ‰“å°</span></span><br><span class="line">ROS_INFO(<span class="string">&quot;I heard [%s]&quot;</span>,msg-&gt;data.c_str());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªèŠ‚ç‚¹åå­—ä¸ºlisteneræ¥è®¢é˜…è¯é¢˜åä¸ºchatterçš„è¯é¢˜</span></span><br><span class="line">ros::init(argc, argv, <span class="string">&quot;listener&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºå¥æŸ„</span></span><br><span class="line">ros::NodeHandle n;</span><br><span class="line"><span class="comment">//åˆ›å»ºè®¢é˜…å™¨subï¼Œæ¥æ”¶è¯é¢˜çš„åå­—ä¸ºchatter,æœ€å¤§ç¼“å­˜1000ä¸ªï¼Œæ”¶åˆ°è¯é¢˜åæ‰§è¡Œå›è°ƒå‡½æ•°chatterCallback</span></span><br><span class="line">ros::Subscriber sub = n.subscribe(<span class="string">&quot;chatter&quot;</span>, <span class="number">1000</span>, chatterCallback);</span><br><span class="line"><span class="comment">//åˆ›å»ºè‡ªåŠ¨å¾ªç¯</span></span><br><span class="line">ros::spin();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>åœ¨CMakeLists.txtæ–‡ä»¶æœ«å°¾æ·»åŠ </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_executable(listener src/listener.cpp)</span><br><span class="line">target_link_libraries(listener $&#123;catkin_LIBRARIES&#125;)</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>è°ƒç”¨ç»ˆç«¯ç¼–è¯‘å·¥ä½œç©ºé—´ï¼Œè®¢é˜…è€…èŠ‚ç‚¹ç¼–å†™å®Œæˆ</p></li></ol>              </div>            </details><details class="folding-tag" blue><summary> å‘å¸ƒè€…èŠ‚ç‚¹py </summary>              <div class='content'>              <ol><li><p class='p blue'>æ‰“å¼€Visual Studio Codeåœ¨åŠŸèƒ½åŒ…ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å–åscriptç”¨æ¥å­˜æ”¾pythonä»£ç ï¼Œscriptä¸‹æ–°å»ºä¸€ä¸ªtalker.pyæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"><span class="comment">//å¯¼å…¥rospy</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="comment">//å¯¼å…¥std_msgs.msgé‡Œçš„Stringç±»å‹</span></span><br><span class="line">from std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"><span class="comment">//å®šä¹‰talker()å‡½æ•°</span></span><br><span class="line"><span class="function">def <span class="title">talker</span><span class="params">()</span>:</span></span><br><span class="line"><span class="function"><span class="comment">//åˆ›å»ºå‘å¸ƒå™¨pubå‘å¸ƒè¯é¢˜åä¸ºchatterï¼Œæ¶ˆæ¯ç±»å‹String,ç¼“å­˜ä¸º10</span></span></span><br><span class="line"><span class="function">pub </span>= rospy.Publisher(<span class="string">&quot;chatter&quot;</span>,String,queue_size=<span class="number">10</span>)</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ç”ŸæˆèŠ‚ç‚¹talker</span></span><br><span class="line">rospy.init_node(<span class="string">&quot;talker&quot;</span>,anonymous=False)</span><br><span class="line"><span class="comment">//å‘å¸ƒé¢‘ç‡10hz</span></span><br><span class="line">rate =rospy.Rate(<span class="number">10</span>)</span><br><span class="line"><span class="comment">//åˆ›å»ºå¾ªç¯ï¼Œå½“è¿™ä¸ªèŠ‚ç‚¹æ²¡æœ‰å…³é—­å°±ä¸€ç›´å¾ªç¯</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line"><span class="comment">//åˆ›å»ºå­—ç¬¦ä¸²èµ‹å€¼ä¸ºhello world rospy.get_time()--å½“å‰æ—¶é—´</span></span><br><span class="line">hello_str = <span class="string">&quot; hello world %s&quot;</span> % rospy.get_time()</span><br><span class="line"><span class="comment">//æ‰“å°å­—ç¬¦ä¸²çš„å†…å®¹</span></span><br><span class="line">rospy.loginfo(hello_str)</span><br><span class="line"><span class="comment">//å‘å¸ƒå™¨å‘å¸ƒè¯é¢˜é‡Œçš„æ¶ˆæ¯hello_str     </span></span><br><span class="line">pub.publish(hello_str)</span><br><span class="line"><span class="comment">//ä¼‘çœ </span></span><br><span class="line">rate.sleep()</span><br><span class="line"><span class="comment">//è¿è¡Œmainå‡½æ•°</span></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="comment">//mainä¸­è¿è¡Œçš„å‡½æ•°talker()</span></span><br><span class="line">talker()</span><br><span class="line">except rospy.ROSInternalException:</span><br><span class="line">pass</span><br></pre></td></tr></table></figure><!-- ![](https://s1.vika.cn/space/2023/01/12/e8b68ce8eb8f4678a6ee5774b506e101) --><img src="/media/rosç¼–ç¨‹å…¥é—¨03.webp" alt=""></li><li><p class='p blue'>å› ä¸ºæ˜¯pythonæ–‡ä»¶ç¼–å†™å®Œæˆåç›´æ¥è¿è¡Œå³å¯</p></li><li><p class='p blue'>rosrun bingda_practices talker.pyå¦‚é‡æŠ¥é”™æç¤ºæ‰§è¡Œæƒé™ä¸å¤Ÿï¼Œtalker.pyå¢åŠ æ‰§è¡Œæƒé™å³å¯ï¼Œå³é”®talker.pyç‚¹å‡»Properties->Permission->Executeå‹¾é€‰</p></li></ol>              </div>            </details><details class="folding-tag" blue><summary> è®¢é˜…è€…èŠ‚ç‚¹py </summary>              <div class='content'>              <ol><li><p class='p blue'>åœ¨scriptä¸‹æ–°å»ºä¸€ä¸ªlistener.pyæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"><span class="comment">//å¯¼å…¥rospy</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="comment">//å¯¼å…¥std_msgs.msgé‡Œçš„Stringç±»å‹</span></span><br><span class="line">from std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"><span class="comment">//å®šä¹‰å›è°ƒå‡½æ•°callbackï¼Œå‚æ•°ä¸ºdata--è¿™ä¸ªå‚æ•°éšæ„ã€‚æ”¶åˆ°è¯é¢˜æ—¶ï¼Œè¯é¢˜é‡Œçš„æ¶ˆæ¯ä¼šä¼ ç»™å›è°ƒå‡½æ•°çš„å‚æ•°</span></span><br><span class="line"><span class="function">def <span class="title">callback</span><span class="params">(data)</span>:</span></span><br><span class="line"><span class="function"><span class="comment">//æ‰“å°å›è°ƒè¿›ç¨‹IDå’Œæ¶ˆæ¯é‡Œçš„æ•°æ®</span></span></span><br><span class="line">rospy.loginfo(rospy.get_caller_id() + &quot; I heard %s&quot;,data.data)</span><br><span class="line"><span class="comment">//å®šä¹‰listenr()å‡½æ•°</span></span><br><span class="line"><span class="function">def <span class="title">listener</span><span class="params">()</span>:</span></span><br><span class="line"><span class="function"><span class="comment">//åˆå§‹åŒ–ç”ŸæˆèŠ‚ç‚¹listener</span></span></span><br><span class="line">rospy.init_node(&quot;listener&quot;,anonymous=True)</span><br><span class="line"><span class="comment">//åˆ›å»ºè®¢é˜…å™¨è®¢é˜…è¯é¢˜åä¸ºchatterï¼Œæ¶ˆæ¯ç±»å‹String,å›è°ƒå‡½æ•°callback</span></span><br><span class="line">rospy.Subscriber(<span class="string">&quot;chatter&quot;</span>,String,callback)</span><br><span class="line"><span class="comment">//å¾ªç¯</span></span><br><span class="line">rospy.spin()</span><br><span class="line"><span class="comment">//è¿è¡Œmainå‡½æ•°</span></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line"><span class="comment">//mainä¸­è¿è¡Œçš„å‡½æ•°listener()</span></span><br><span class="line">listener()</span><br></pre></td></tr></table></figure><!-- ![](https://s1.vika.cn/space/2023/01/12/06d87bbd7b01411ebd3c0e6197436922) --><img src="/media/rosç¼–ç¨‹å…¥é—¨04.webp" alt=""></li><li><p class='p blue'>rosrun bingda_practices listener.pyç»™listener.pyæ–‡ä»¶å¢åŠ å¯æ‰§è¡Œæƒé™ï¼Œæ‰§è¡Œtalker.pyåå†æ‰§è¡Œlistener.pyå³å¯è®¢é˜…talkerå‘å¸ƒçš„æ¶ˆæ¯</p></li></ol>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><details class="folding-tag" blue><summary> å¯åŠ¨å•ä¸ªèŠ‚ç‚¹ </summary>              <div class='content'>              <ol><li><p class='p blue'>æ‰“å¼€Visual Studio Codeåœ¨åŠŸèƒ½åŒ…ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å–ålaunchç”¨æ¥å­˜æ”¾launchæ–‡ä»¶ï¼Œlaunchä¸‹æ–°å»ºä¸€ä¸ªtalker.launchæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><br><p class='p blue'>pkgæŒ‡å®šçš„æ˜¯èŠ‚ç‚¹æ‰€åœ¨çš„åŠŸèƒ½åŒ…</p><br><p class='p blue'>typeæŒ‡å®šçš„æ˜¯c++è¯­è¨€ç¼–å†™çš„å¯æ‰§è¡Œæ–‡ä»¶talkerï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºpythonç¼–å†™çš„talker.pyæ–‡ä»¶</p><br><p class='p blue'>nameæ˜¯launché‡Œå¯¹èŠ‚ç‚¹é‡å‘½åä¸ºtalkerï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–åç§°</p><br><p class='p blue'>outputè¾“å‡ºæ–¹å¼ä¸ºåœ¨å±å¹•è¾“å‡º</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">&lt;node pkg = <span class="string">&quot;bingda_practices&quot;</span> type = <span class="string">&quot;talker&quot;</span> name = <span class="string">&quot;talker&quot;</span> output = <span class="string">&quot;screen&quot;</span>/&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure><p class='p blue'>launchä¸‹æ–°å»ºä¸€ä¸ªlistener.launchæ–‡ä»¶</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">&lt;node pkg = <span class="string">&quot;bingda_practices&quot;</span> type = <span class="string">&quot;listener.py&quot;</span> name = <span class="string">&quot;listener&quot;</span> output = <span class="string">&quot;screen&quot;</span>/&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" yellow><summary> å¯åŠ¨å¤šä¸ªèŠ‚ç‚¹ </summary>              <div class='content'>              <ol><li><p class='p blue'>æ–°å»ºä¸€ä¸ªtest.launchæ–‡ä»¶ï¼ŒåŒæ—¶å¯åŠ¨talkerå’ŒlistenerèŠ‚ç‚¹</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><p class='p blue'>$(find launchæ–‡ä»¶æ‰€åœ¨çš„åŠŸèƒ½åŒ…å)/launch/è¦å¯åŠ¨çš„launchæ–‡ä»¶å</p></li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">&lt;include file = <span class="string">&quot;$(find bingda_practices)/launch/talker.launch&quot;</span>/&gt;</span><br><span class="line">&lt;include file = <span class="string">&quot;$(find bingda_practices)/launch/listener.launch&quot;</span>/&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure><ol><li><p class='p blue'>è¿™ä¸ªlaunchè°ƒç”¨äº†bingda_practices/launch/ä¸‹çš„talker.launchå’Œlistener.launchæ–‡ä»¶</p></li></ol>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-4"><details class="folding-tag" blue><summary> è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹ </summary>              <div class='content'>              <ol><li><p class='p blue'>æ‰“å¼€Visual Studio Codeåœ¨åŠŸèƒ½åŒ…ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å–åmsgç”¨æ¥å­˜æ”¾æ¶ˆæ¯æ–‡ä»¶ï¼Œmsgä¸‹æ–°å»ºä¸€ä¸ªstudentç±»å‹çš„æ¶ˆæ¯ï¼ŒStudent.msgæ–‡ä»¶ã€‚åœ¨Student.msgæ–‡ä»¶ä¸­å¡«å……ä»¥ä¸‹å‡ ä¸ªå˜é‡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> first_name</span><br><span class="line"><span class="built_in">string</span> last_name</span><br><span class="line">uint8 age</span><br><span class="line">uint32 score</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>ä¿®æ”¹é…ç½®æ–‡ä»¶CMakeLists.txt</p><p class='p blue'>find_packageä¸­åŠ å…¥message_generation</p><p class='p blue'>add_message_filesä¸­åŠ å…¥FILESæ¢è¡ŒStudent.msgä¹Ÿå°±æ˜¯è‡ªå®šä¹‰æ¶ˆæ¯æ–‡ä»¶</p><p class='p blue'>generate_messageså‡½æ•°æ³¨é‡Š</p><p class='p blue'>åœ¨catkin_packageä¸­åŠ ä¸ŠCATKIN_DEPENDS message_runtime</p></li><li><p class='p blue'>ä¿®æ”¹é…ç½®æ–‡ä»¶package.xml</p><br><p class='p blue'>åŠ å…¥æ„å»ºä¾èµ–é¡¹</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;build_depend&gt;message_runtime&lt;/build_depend&gt;   </span><br><span class="line">&lt;build_export_depend&gt;message_runtime&lt;/build_export_depend&gt;</span><br></pre></td></tr></table></figure><p class='p blue'>ä¿å­˜ä¿®æ”¹ï¼Œç¼–è¯‘å·¥ä½œç©ºé—´ã€‚</p><br><p class='p blue'>æŸ¥çœ‹Studentæ¶ˆæ¯ç±»å‹çš„ç»“æ„ä½“</p>rosmsg show åŒ…å/æ¶ˆæ¯ç±»å‹<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosmsg show bingda_practices/Student</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" yellow><summary> ä½¿ç”¨è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹å‘å¸ƒæ¥æ”¶è¯é¢˜py </summary>              <div class='content'>              <p><p class='p red'>ä¸€.å‘å¸ƒè¯é¢˜</p></p><ol><li><p class='p blue'>åœ¨åŠŸèƒ½åŒ…çš„scriptä¸‹æ–°å»ºä¸€ä¸ªmsg_pub.pyæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"><span class="meta"># license removed for brevity</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="comment">//ä»åŠŸèƒ½åŒ…é‡Œçš„msgæ–‡ä»¶å¤¹é‡Œå¯¼å…¥Studentç±»å‹</span></span><br><span class="line">from bingda_practices.msg <span class="keyword">import</span> Student</span><br><span class="line"><span class="comment">//å®šä¹‰è¯é¢˜å‘å¸ƒå‡½æ•°</span></span><br><span class="line"><span class="function">def <span class="title">msg_pub</span><span class="params">()</span>:</span></span><br><span class="line"><span class="function"><span class="comment">//å®šä¹‰å‘å¸ƒå™¨ï¼Œå‘å¸ƒçš„è¯é¢˜åä¸ºStudent_infoï¼Œæ¶ˆæ¯ç±»å‹Studentï¼Œç¼“å­˜ä¸º10</span></span></span><br><span class="line">pub = rospy.Publisher(&#x27;Student_info&#x27;,Student,queue_size=10)</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ç”ŸæˆèŠ‚ç‚¹ï¼Œåå­—ä¸ºmsg_pub</span></span><br><span class="line">rospy.init_node(&#x27;msg_pub&#x27;,anonymous=False)</span><br><span class="line"><span class="comment">//è®¾ç½®å‘å¸ƒé¢‘ç‡10hz</span></span><br><span class="line">rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line"><span class="comment">//å½“èŠ‚ç‚¹æ­£å¸¸è¿è¡Œåˆ™ä¸€ç›´è¿›è¡Œä¸‹é¢å¾ªç¯</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line"><span class="comment">//å®šä¹‰Studentç±»å‹çš„å˜é‡student</span></span><br><span class="line">student = Student()</span><br><span class="line"><span class="comment">//ç»™Studentç±»å‹çš„å˜é‡èµ‹å€¼</span></span><br><span class="line">student.first_name = <span class="string">&quot;BingDa&quot;</span></span><br><span class="line">student.last_name = <span class="string">&quot;Robot&quot;</span></span><br><span class="line">student.age = <span class="number">2</span></span><br><span class="line">student.score = <span class="number">100</span></span><br><span class="line"><span class="comment">//æ‰“å°å­—ç¬¦ä¸²pub a student info</span></span><br><span class="line">rospy.loginfo(&#x27;pub a student info&#x27;)</span><br><span class="line"><span class="comment">//ä½¿ç”¨å‘å¸ƒå™¨å‘å¸ƒStudentç±»å‹çš„å˜é‡student</span></span><br><span class="line">pub.publish(student)</span><br><span class="line"><span class="comment">//ä¼‘çœ </span></span><br><span class="line">rate.sleep()</span><br><span class="line"><span class="comment">//ä¸»å‡½æ•°</span></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="comment">//ä½¿ç”¨è¯é¢˜å‘å¸ƒå‡½æ•°</span></span><br><span class="line">msg_pub()</span><br><span class="line">except rospy.ROSInterruptException:</span><br><span class="line">pass</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>è¿è¡Œå‘å¸ƒèŠ‚ç‚¹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">roscore</span><br><span class="line">rosrun bingda_practices msg_pub.py </span><br></pre></td></tr></table></figure><!-- ![](https://s1.vika.cn/space/2023/01/13/c1c35abb605f42f484caea650e40e897) --><img src="/media/rosç¼–ç¨‹å…¥é—¨05.webp" alt=""></li></ol><p><p class='p red'>äºŒ.è®¢é˜…è¯é¢˜</p></p><ol><li><p class='p blue'>åœ¨åŠŸèƒ½åŒ…çš„scriptä¸‹æ–°å»ºä¸€ä¸ªmsg_sub.pyæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="comment">//ä»åŠŸèƒ½åŒ…é‡Œçš„msgæ–‡ä»¶å¤¹é‡Œå¯¼å…¥Studentç±»å‹</span></span><br><span class="line">from bingda_practices.msg <span class="keyword">import</span> Student</span><br><span class="line"><span class="comment">//è®¢é˜…å™¨æ”¶åˆ°çš„è¯é¢˜æ¶ˆæ¯ä¼ ç»™å›è°ƒå‡½æ•°çš„å‚æ•°data</span></span><br><span class="line"><span class="function">def <span class="title">callback</span><span class="params">(data)</span>:</span></span><br><span class="line"><span class="function"><span class="comment">//æ‰“å°æ”¶åˆ°çš„Studentæ¶ˆæ¯ç±»å‹çš„å„æˆå‘˜å˜é‡</span></span></span><br><span class="line">rospy.loginfo(&quot;Student Name is %s %s;Age is %d ;Socer is %d.&quot;, data.first_name,data.last_name ,data.age,data.score)</span><br><span class="line"><span class="comment">//å®šä¹‰è¯é¢˜è®¢é˜…å‡½æ•°</span></span><br><span class="line"><span class="function">def <span class="title">msg_sub</span><span class="params">()</span>:</span></span><br><span class="line"><span class="function"><span class="comment">//åˆå§‹åŒ–ç”ŸæˆèŠ‚ç‚¹ï¼Œåå­—ä¸ºmsg_sub</span></span></span><br><span class="line">rospy.init_node(&#x27;msg_sub&#x27;, anonymous=False)</span><br><span class="line"><span class="comment">//å®šä¹‰è®¢é˜…å™¨ï¼Œè®¢é˜…çš„è¯é¢˜åä¸ºStudent_infoï¼Œæ¶ˆæ¯ç±»å‹Studentï¼Œå›è°ƒå‡½æ•°ä¸ºcallback</span></span><br><span class="line">rospy.Subscriber(<span class="string">&quot;student_info&quot;</span>, Student, callback)</span><br><span class="line"><span class="comment">//å¾ªç¯</span></span><br><span class="line">rospy.spin()</span><br><span class="line"><span class="comment">//mianå‡½æ•°</span></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line"><span class="comment">//ä½¿ç”¨è¯é¢˜è®¢é˜…å‡½æ•°</span></span><br><span class="line">msg_sub()</span><br></pre></td></tr></table></figure></li><li>è¿è¡Œè®¢é˜…èŠ‚ç‚¹<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">roscore</span><br><span class="line">rosrun bingda_practices msg_sub.py</span><br></pre></td></tr></table></figure><!-- ![](https://s1.vika.cn/space/2023/01/13/08da9ca79cab4892ae79b1c118030bb6) --><img src="/media/rosç¼–ç¨‹å…¥é—¨06.webp" alt=""></li></ol>              </div>            </details><details class="folding-tag" green><summary> ä½¿ç”¨è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹å‘å¸ƒæ¥æ”¶è¯é¢˜c++ </summary>              <div class='content'>              <p class='p red'>ä¸€.å‘å¸ƒè¯é¢˜</p><ol><li><p class='p blue'>åœ¨åŠŸèƒ½åŒ…çš„srcä¸‹æ–°å»ºä¸€ä¸ªmsg_pub.cppæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="comment">//åŒ…å«è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹çš„å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bingda_practices/Student.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªèŠ‚ç‚¹åå­—ä¸ºmsg_pubæ¥å‘å¸ƒè¯é¢˜åä¸ºstudent_infoçš„è¯é¢˜</span></span><br><span class="line">ros::init(argc, argv, <span class="string">&quot;msg_pub&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºå¥æŸ„</span></span><br><span class="line">ros::NodeHandle n;</span><br><span class="line"><span class="comment">//åˆ›å»ºå‘å¸ƒå™¨chatter_pubï¼Œå‘å¸ƒæ¶ˆæ¯ç±»å‹ä¸ºbingda_practicesåŒ…é‡Œçš„Studentç±»å‹,å‘å¸ƒè¯é¢˜åå­—ä¸ºstudent_info,æœ€å¤§ç¼“å­˜1000ä¸ª</span></span><br><span class="line">ros::Publisher chatter_pub = n.advertise&lt;bingda_practices::Student&gt;(<span class="string">&quot;student_info&quot;</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">//æŒ‡å®šå¾ªç¯é¢‘ç‡10hz</span></span><br><span class="line"><span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line"><span class="comment">//å®šä¹‰å˜é‡countæ¥è®¡ç®—å‘å¸ƒè¯é¢˜ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">uint8_t</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//å½“crtl+cã€åŒåèŠ‚ç‚¹è¿è¡Œã€rosæ•´ä¸ªè¿›ç¨‹ç»“æŸã€killæ€æ­»æ—¶ros::ok()ä¸ºfalse</span></span><br><span class="line"><span class="keyword">while</span> (ros::ok())</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯ç±»å‹ä¸ºStudent(ç»“æ„ä½“)çš„å˜é‡</span></span><br><span class="line">bingda_practices::Student student;</span><br><span class="line"><span class="comment">//ç»™Studentç±»å‹çš„å˜é‡ä¸­çš„æˆå‘˜å˜é‡èµ‹å€¼</span></span><br><span class="line">student.first_name = <span class="string">&quot;BingDa&quot;</span>;</span><br><span class="line">student.last_name = <span class="string">&quot;Robot&quot;</span>;</span><br><span class="line">student.age = count;</span><br><span class="line">student.score = <span class="number">100</span>;</span><br><span class="line"><span class="comment">//å‘å¸ƒå™¨å‘å¸ƒè¯é¢˜ï¼Œå‘å¸ƒå†…å®¹ä¸ºæ¶ˆæ¯å˜é‡student</span></span><br><span class="line">chatter_pub.publish(student);</span><br><span class="line"></span><br><span class="line">ros::spinOnce();</span><br><span class="line"><span class="comment">//ä¼‘çœ </span></span><br><span class="line">loop_rate.sleep();</span><br><span class="line">++count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>åœ¨è¿™ä¸ªmsg_pub.cppæ–‡ä»¶ä¸­åŒ…å«äº†æˆ‘ä»¬è‡ªå®šä¹‰æ¶ˆæ¯çš„å¤´æ–‡ä»¶bingda_practices/Student.hè€ŒVisual Studio Codeä¸­æ²¡æœ‰åŒ…å«å·¥ä½œç©ºé—´çš„è·¯å¾„ï¼Œéœ€è¦å…ˆåŒ…å«å·¥ä½œç©ºé—´ä¸‹çš„å¤´æ–‡ä»¶ç›®å½•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//c_cpp_properties.jsonæ–‡ä»¶é‡Œçš„includePathé‡Œæ·»åŠ </span></span><br><span class="line"><span class="string">&quot;/home/bingda/catkin_ws/devel/include**&quot;</span></span><br></pre></td></tr></table></figure></li><li><p class='p blue'>ç¼–è¾‘CMakeLists.txtæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸Šä»¥ä¸‹ä¸‰å¥ï¼Œè®¾ç½®ç¼–è¯‘è§„åˆ™</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add_executable(msg_pub src/msg_pub.cpp)</span><br><span class="line">target_link_libraries(msg_pub $&#123;catkin_LIBRARIES&#125;)</span><br><span class="line">add_dependencies(msg_pub bingda_practices_generate_messages_cpp)</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>å®Œæˆå·¥ä½œç©ºé—´ç¼–è¯‘åï¼Œè¿è¡ŒèŠ‚ç‚¹å¹¶è¾“å‡ºè¯é¢˜å†…å®¹</p><!-- ![](https://s1.vika.cn/space/2023/01/14/9b8d60ecd0c546f8867b5129bc8a64da) --><img src="/media/rosç¼–ç¨‹å…¥é—¨07.webp" alt=""></li></ol><p class='p red'>äºŒ.è®¢é˜…è¯é¢˜</p><ol><li><p class='p blue'>åœ¨åŠŸèƒ½åŒ…çš„srcä¸‹æ–°å»ºä¸€ä¸ªmsg_sub.cppæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="comment">//è¦æ¥å—Studentç±»å‹çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bingda_practices/Student.h&quot;</span></span></span><br><span class="line"><span class="comment">//å›è°ƒå‡½æ•°ï¼Œä¼ å…¥å‚æ•°ä¸ºè®¢é˜…çš„Studentç±»å‹çš„è¯é¢˜æ¶ˆæ¯</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">chatterCallback</span><span class="params">(<span class="keyword">const</span> bingda_practices::Student::ConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">//æ‰“å°student_infoè¯é¢˜é‡Œçš„æ¶ˆæ¯å†…å®¹ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼æ‰“å°</span></span><br><span class="line">ROS_INFO(<span class="string">&quot;Student Name is %s %s;Age is %d ;Socer is %d.&quot;</span>, msg-&gt;first_name.c_str(),msg-&gt;last_name.c_str() ,msg-&gt;age,msg-&gt;score);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªèŠ‚ç‚¹åå­—ä¸ºmsg_subæ¥è®¢é˜…è¯é¢˜åä¸ºstudent_infoçš„è¯é¢˜</span></span><br><span class="line">ros::init(argc, argv, <span class="string">&quot;msg_sub&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºå¥æŸ„</span></span><br><span class="line">ros::NodeHandle n;</span><br><span class="line"><span class="comment">//åˆ›å»ºè®¢é˜…å™¨subï¼Œæ¥æ”¶è¯é¢˜çš„åå­—ä¸ºstudent_info,æœ€å¤§ç¼“å­˜1000ä¸ªï¼Œæ”¶åˆ°è¯é¢˜åæ‰§è¡Œå›è°ƒå‡½æ•°chatterCallback</span></span><br><span class="line">ros::Subscriber sub = n.subscribe(<span class="string">&quot;student_info&quot;</span>, <span class="number">1000</span>, chatterCallback);</span><br><span class="line"><span class="comment">//åˆ›å»ºè‡ªåŠ¨å¾ªç¯</span></span><br><span class="line">ros::spin();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>ç¼–è¾‘CMakeLists.txtæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸Šä»¥ä¸‹ä¸‰å¥ï¼Œè®¾ç½®ç¼–è¯‘è§„åˆ™</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add_executable(msg_sub src/msg_sub.cpp)</span><br><span class="line">target_link_libraries(msg_sub $&#123;catkin_LIBRARIES&#125;)</span><br><span class="line">add_dependencies(msg_sub bingda_practices_generate_messages_cpp)</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>å®Œæˆå·¥ä½œç©ºé—´ç¼–è¯‘åï¼Œè¿è¡ŒèŠ‚ç‚¹è®¢é˜…msg_pubèŠ‚ç‚¹å‘å¸ƒçš„è¯é¢˜</p></li></ol><!-- ![](https://s1.vika.cn/space/2023/01/14/f3c45581138e48a18300988399426ce5) --><p><img src="/media/rosç¼–ç¨‹å…¥é—¨08.webp" alt=""></p>              </div>            </details><details class="folding-tag" blue><summary> è‡ªå®šä¹‰æœåŠ¡ç±»å‹ </summary>              <div class='content'>              <p><p class='p blue'>æ‰“å¼€Visual Studio Codeåœ¨åŠŸèƒ½åŒ…ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å–åsrvç”¨æ¥å­˜æ”¾æœåŠ¡æ–‡ä»¶ï¼Œsrvä¸‹æ–°å»ºä¸€ä¸ªAddTwoInts.srvæ–‡ä»¶ã€‚å‡å¦‚è¦å®ç°çš„åŠŸèƒ½æ˜¯å®¢æˆ·ç«¯å‘é€ä¸¤ä¸ªæ•°å­—ï¼ŒæœåŠ¡ç«¯å“åº”è¿™ä¸¤ä¸ªæ•°å­—çš„å’Œã€‚AddTwoInts.srvæ–‡ä»¶ä¸­å¡«å……ä»¥ä¸‹å‡ ä¸ªå˜é‡</p></p><p><p class='p blue'>åˆ†éš”ç¬¦ä»¥ä¸Šçš„éƒ¨åˆ†æ˜¯å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œåˆ†åˆ«æ˜¯aï¼Œbä¸¤ä¸ªæ•°ã€‚åˆ†éš”ç¬¦ä»¥ä¸‹çš„éƒ¨åˆ†æ˜¯æœåŠ¡ç«¯åº”ç­”çš„abä¹‹å’Œsum</p><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int64 a</span><br><span class="line">int64 b</span><br><span class="line">---</span><br><span class="line">int64 sum</span><br></pre></td></tr></table></figure></p><ol><li><p class='p blue'>ä¿®æ”¹é…ç½®æ–‡ä»¶CMakeLists.txt</p><p class='p blue'>add_service_filesä¸­åŠ å…¥FILESæ¢è¡ŒAddTwoInts.srvä¹Ÿå°±æ˜¯è‡ªå®šä¹‰æœåŠ¡ç±»å‹ï¼Œåˆ é™¤å…¶ä»–æœåŠ¡ç±»å‹</p></li><li><p class='p blue'>ä¿å­˜ä¿®æ”¹ï¼Œç¼–è¯‘å·¥ä½œç©ºé—´åæŸ¥çœ‹éªŒè¯æœåŠ¡æ–‡ä»¶</p><br><p class='p blue'>rossrv show åŠŸèƒ½åŒ…å/æœåŠ¡ç±»å‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rossrv show bingda_practices/AddTwoInts</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" green><summary> ä½¿ç”¨è‡ªå®šä¹‰æœåŠ¡ç±»å‹ç¼–å†™æœåŠ¡ç«¯å®¢æˆ·ç«¯py </summary>              <div class='content'>              <p class='p red'>ä¸€.æœåŠ¡ç«¯</p><ol><li><p class='p blue'>ç¼–å†™ä¸€ä¸ªpythonçš„èŠ‚ç‚¹ä½¿ç”¨è¿™ä¸ªæœåŠ¡ï¼Œåœ¨åŠŸèƒ½åŒ…çš„scriptä¸‹æ–°å»ºadd_two_ints_server.pyæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="comment">//åŒ…å«æœåŠ¡ç±»å‹å’ŒæœåŠ¡ç±»å‹çš„å“åº”</span></span><br><span class="line">from bingda_practices.srv <span class="keyword">import</span> AddTwoInts,AddTwoIntsResponse</span><br><span class="line"><span class="comment">//å®šä¹‰å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">//å½“æ”¶åˆ°æœåŠ¡ç±»å‹ä¸ºAddTwoIntsï¼ŒæœåŠ¡åä¸ºadd_two_intsçš„ä¿¡æ¯æ—¶</span></span><br><span class="line"><span class="comment">//ä¿¡æ¯ä¼šä¼ é€’ç»™å›è°ƒå‡½æ•°çš„å‚æ•°</span></span><br><span class="line"><span class="function">def <span class="title">handle_add_two_ints</span><span class="params">(req)</span>:</span></span><br><span class="line"><span class="function"><span class="comment">//æ‰“å°å®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&quot;Returning [%s + %s = %s]&quot;</span>%(req.a, req.b, (req.a + req.b)))</span></span></span><br><span class="line"><span class="function"><span class="comment">//å°†å®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯ç›¸åŠ é€ç»™æœåŠ¡åä¸ºadd_two_intsæœåŠ¡ç±»å‹ä¸ºAddTwoIntsçš„åˆ†å‰²çº¿ä¸‹çš„æˆå‘˜å˜é‡</span></span></span><br><span class="line"><span class="function"><span class="comment">//return æœåŠ¡ç±»å‹Response()ï¼›</span></span></span><br><span class="line"><span class="function"><span class="keyword">return</span> <span class="title">AddTwoIntsResponse</span><span class="params">(req.a + req.b)</span></span></span><br><span class="line"><span class="function"><span class="comment">//å®šä¹‰ä¸€ä¸ªæœåŠ¡å‡½æ•°handle_add_two_ints</span></span></span><br><span class="line"><span class="function">def <span class="title">add_two_ints_server</span><span class="params">()</span>:</span></span><br><span class="line"><span class="function"><span class="comment">//åˆå§‹åŒ–èŠ‚ç‚¹åå­—ä¸ºadd_two_ints_server</span></span></span><br><span class="line">rospy.init_node(&#x27;add_two_ints_server&#x27;)</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªæœåŠ¡å™¨ï¼ŒæœåŠ¡åä¸ºadd_two_intsï¼ŒæœåŠ¡ç±»å‹ä¸ºadd_two_intsï¼Œå›è°ƒå‡½æ•°ä¸ºhandle_add_two_ints</span></span><br><span class="line">s = rospy.Service(&#x27;add_two_ints&#x27;, AddTwoInts, handle_add_two_ints)</span><br><span class="line"><span class="comment">//æ‰“å°ä¿¡æ¯</span></span><br><span class="line">print(<span class="string">&quot;Ready to add two ints.&quot;</span>)</span><br><span class="line"><span class="comment">//å¾ªç¯</span></span><br><span class="line">rospy.spin()</span><br><span class="line"><span class="comment">//mainå‡½æ•°æ‰§è¡ŒæœåŠ¡å‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">add_two_ints_server()</span><br></pre></td></tr></table></figure></li><li><p><p class='p blue'>ä¿å­˜è¿è¡Œï¼Œå¯åŠ¨æœåŠ¡å™¨èŠ‚ç‚¹å‘å¸ƒæœåŠ¡</p></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun bingda_practices add_two_ints_server.py</span><br></pre></td></tr></table></figure><!-- ![](https://s1.vika.cn/space/2023/01/14/51ba16e02694452287866a144d7546d9) --><p><img src="/media/rosç¼–ç¨‹å…¥é—¨09.webp" alt=""></p></li><li><p class='p blue'>è°ƒç”¨æœåŠ¡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosservice call /add_two_inits <span class="number">3</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><p class='p red'>äºŒ.å®¢æˆ·ç«¯</p></li></ol><ol><li><p class='p blue'>ç¼–å†™ä¸€ä¸ªpythonçš„å®¢æˆ·ç«¯èŠ‚ç‚¹ï¼Œåœ¨åŠŸèƒ½åŒ…çš„scriptä¸‹æ–°å»ºadd_two_ints_client.pyæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"><span class="comment">//å‚æ•°åˆ¤æ–­åŒ…ï¼Œå¦‚æœä¼ å…¥çš„æ˜¯å‚æ•°ï¼Œåˆ™ç»™sys.argv[]æ•°ç»„</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="comment">//ä»bingda_practicesçš„srvæ–‡ä»¶å¤¹å¯¼å…¥è‡ªå®šä¹‰æœåŠ¡ç±»å‹AddTwoInts</span></span><br><span class="line">from bingda_practices.srv <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªå®¢æˆ·ç«¯å‡½æ•°add_two_ints_clientæ¥ç»™æœåŠ¡ç±»å‹ä¸ºAddTwoIntsçš„åˆ†å‰²çº¿ä¸Šçš„æˆå‘˜å˜é‡èµ‹å€¼</span></span><br><span class="line"><span class="function">def <span class="title">add_two_ints_client</span><span class="params">(x, y)</span>:</span></span><br><span class="line"><span class="function"><span class="comment">//ç­‰å¾…æœåŠ¡åä¸ºadd_two_intsçš„æœåŠ¡ï¼ˆé˜»å¡å¼ï¼‰</span></span></span><br><span class="line">rospy.wait_for_service(&#x27;add_two_ints&#x27;)</span><br><span class="line"><span class="comment">//è‹¥æœåŠ¡å¯ç”¨</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæœåŠ¡ä»£ç†åadd_two_ints,æœåŠ¡åä¸ºadd_two_ints,æœåŠ¡ç±»å‹ä¸ºAddTwoInts</span></span><br><span class="line">add_two_ints = rospy.ServiceProxy(&#x27;add_two_ints&#x27;, AddTwoInts)</span><br><span class="line"><span class="comment">//xï¼Œyèµ‹å€¼ç»™æœåŠ¡ç±»å‹ä¸ºAddTwoIntsçš„åˆ†å‰²çº¿ä¸Šçš„æˆå‘˜å˜é‡</span></span><br><span class="line">resp1 = add_two_ints(x, y)</span><br><span class="line"><span class="comment">//è·å–æœåŠ¡ç±»å‹ä¸ºAddTwoIntsçš„åˆ†å‰²çº¿ä¸‹çš„æˆå‘˜å˜é‡sum</span></span><br><span class="line"><span class="keyword">return</span> resp1.sum</span><br><span class="line"><span class="comment">//å‡ºç°å¼‚å¸¸åˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">except rospy.ServiceException as e:</span><br><span class="line">print(<span class="string">&quot;Service call failed: %s&quot;</span>%e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸ºä¸‰ä¸ªå‚æ•°ï¼Œargv[0] ä¸€èˆ¬æ˜¯è¢«è°ƒç”¨çš„è„šæœ¬æ–‡ä»¶åæˆ–å…¨è·¯å¾„ï¼Œå’Œæ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œargv[1]å’Œä»¥åå°±æ˜¯ä¼ å…¥çš„æ•°æ®äº†ã€‚</span></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) == <span class="number">3</span>:</span><br><span class="line">x = <span class="keyword">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">y = <span class="keyword">int</span>(sys.argv[<span class="number">2</span>])</span><br><span class="line"><span class="comment">//ä¸æ»¡è¶³å°±é€€å‡º</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">sys.<span class="built_in">exit</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">//æ‰“å°ä¼ å…¥çš„æ•°æ®å’Œä»æœåŠ¡ç«¯è®¡ç®—åçš„å“åº”æ•°æ®</span></span><br><span class="line">print(<span class="string">&quot;Requesting %s+%s&quot;</span>%(x, y))</span><br><span class="line">print(<span class="string">&quot;%s + %s = %s&quot;</span>%(x, y, add_two_ints_client(x, y)))</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>ä¿å­˜è¿è¡Œï¼Œå¯åŠ¨æœåŠ¡å™¨èŠ‚ç‚¹å‘å¸ƒæœåŠ¡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun bingda_practices add_two_ints_server.py</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>ä¿å­˜è¿è¡Œï¼Œå¯åŠ¨å®¢æˆ·ç«¯èŠ‚ç‚¹è°ƒç”¨æœåŠ¡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun bingda_practices add_two_ints_client.py <span class="number">3</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><!-- ![](https://s1.vika.cn/space/2023/01/14/c79d7ea55b0347c28e02f940f942573a) --><img src="/media/rosç¼–ç¨‹å…¥é—¨10.webp" alt=""></li></ol>              </div>            </details><details class="folding-tag" green><summary> ä½¿ç”¨è‡ªå®šä¹‰æœåŠ¡ç±»å‹ç¼–å†™æœåŠ¡ç«¯å®¢æˆ·ç«¯c++ </summary>              <div class='content'>              <p class='p red'>ä¸€.æœåŠ¡ç«¯</p><ol><li><p class='p blue'>åœ¨åŠŸèƒ½åŒ…çš„srcä¸‹æ–°å»ºä¸€ä¸ªadd_two_ints_server.cppæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="comment">//åŒ…å«æœåŠ¡ç±»å‹å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bingda_practices/AddTwoInts.h&quot;</span></span></span><br><span class="line"><span class="comment">//å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">//å½“å®¢æˆ·ç«¯ä¼ å…¥AddTwoIntsæœåŠ¡ç±»å‹çš„å‚æ•°ç»™åˆ†å‰²çº¿ä¸Šçš„æˆå‘˜å˜é‡ç»“æ„ä½“ï¼Œå®šä¹‰è¯¥ç»“æ„ä½“ä¸ºres</span></span><br><span class="line"><span class="comment">//AddTwoIntsæœåŠ¡ç±»å‹çš„åˆ†å‰²çº¿ä¸‹çš„æˆå‘˜å˜é‡ç»“æ„ä½“å®šä¹‰ä¸ºres</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">add</span><span class="params">(bingda_practices::AddTwoInts::Request  &amp;req,</span></span></span><br><span class="line"><span class="function"><span class="params">bingda_practices::AddTwoInts::Response &amp;res)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//ç»™æœåŠ¡ç±»å‹çš„åˆ†å‰²çº¿ä¸‹çš„æˆå‘˜å˜é‡ç»“æ„ä½“èµ‹å€¼</span></span><br><span class="line">res.sum = req.a + req.b;</span><br><span class="line"><span class="comment">//æ‰“å°å®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯</span></span><br><span class="line">ROS_INFO(<span class="string">&quot;request: x=%ld, y=%ld&quot;</span>, (<span class="keyword">long</span> <span class="keyword">int</span>)req.a, (<span class="keyword">long</span> <span class="keyword">int</span>)req.b);</span><br><span class="line"><span class="comment">//æ‰“å°åˆ†å‰²çº¿ä¸‹çš„æˆå‘˜å˜é‡sum</span></span><br><span class="line">ROS_INFO(<span class="string">&quot;sending back response: [%ld]&quot;</span>, (<span class="keyword">long</span> <span class="keyword">int</span>)res.sum);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">//åˆå§‹åŒ–ç”ŸæˆèŠ‚ç‚¹åå­—ä¸ºadd_two_ints_server</span></span><br><span class="line">ros::init(argc, argv, <span class="string">&quot;add_two_ints_server&quot;</span>);</span><br><span class="line"><span class="comment">//å®šä¹‰å¥æŸ„</span></span><br><span class="line">ros::NodeHandle n;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªæœåŠ¡å™¨ï¼ŒæœåŠ¡åä¸ºadd_two_intsï¼Œå›è°ƒå‡½æ•°ä¸ºadd</span></span><br><span class="line">ros::ServiceServer service = n.advertiseService(<span class="string">&quot;add_two_ints&quot;</span>, add);</span><br><span class="line"><span class="comment">//æ‰“å°ä¿¡æ¯</span></span><br><span class="line">ROS_INFO(<span class="string">&quot;Ready to add two ints.&quot;</span>);</span><br><span class="line"><span class="comment">//å¾ªç¯</span></span><br><span class="line">ros::spin();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>ä¿®æ”¹é…ç½®æ–‡ä»¶CMakeLists.txt</p><br><p class='p blue'>åœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸Šä»¥ä¸‹ä¸‰å¥ï¼Œè®¾ç½®ç¼–è¯‘è§„åˆ™</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add_executable(add_two_ints_server src/add_two_ints_server.cpp)</span><br><span class="line">target_link_libraries(add_two_ints_server $&#123;catkin_LIBRARIES&#125;)</span><br><span class="line">add_dependencies(add_two_ints_server bingda_practices_generate_messages_cpp)</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>ä¿å­˜ç¼–è¯‘åå³å¯è¿è¡ŒæœåŠ¡ç«¯èŠ‚ç‚¹å¹¶ä½¿ç”¨rosservice callçš„æ–¹æ³•è°ƒç”¨å®ƒ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rosrun bingda_practices add_two_ints_server</span><br><span class="line">rosservice call /add_two_inits <span class="number">3</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><!-- ![](https://s1.vika.cn/space/2023/01/14/5e8799be29054a48ad59f88148b26e7f) --><img src="/media/rosç¼–ç¨‹å…¥é—¨11.webp" alt=""></li></ol><p class='p red'>äºŒ.å®¢æˆ·ç«¯</p><ol><li><p class='p blue'>åœ¨åŠŸèƒ½åŒ…çš„srcä¸‹æ–°å»ºä¸€ä¸ªadd_two_ints_client.cppæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="comment">//åŒ…å«æœåŠ¡ç±»å‹å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bingda_practices/AddTwoInts.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">//åˆå§‹åŒ–ç”ŸæˆèŠ‚ç‚¹åå­—ä¸ºadd_two_ints_client</span></span><br><span class="line">ros::init(argc, argv, <span class="string">&quot;add_two_ints_client&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸ºä¸‰ä¸ªå‚æ•°ï¼Œargv[0] ä¸€èˆ¬æ˜¯è¢«è°ƒç”¨çš„è„šæœ¬æ–‡ä»¶åæˆ–å…¨è·¯å¾„ï¼Œå’Œæ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œargv[1]å’Œä»¥åå°±æ˜¯ä¼ å…¥çš„æ•°æ®äº†ã€‚</span></span><br><span class="line"><span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//å¦‚æœè¾“å…¥ä¸æ˜¯ä¸‰ä¸ªå‚æ•°ï¼Œè¾“å‡ºæç¤ºä¿¡æ¯</span></span><br><span class="line">ROS_INFO(<span class="string">&quot;usage: add_two_ints_client X Y&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰å¥æŸ„</span></span><br><span class="line">ros::NodeHandle n;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä½¿ç”¨æœåŠ¡åä¸ºadd_two_intsï¼ŒæœåŠ¡ç±»å‹AddTwoIntsçš„æœåŠ¡</span></span><br><span class="line">ros::ServiceClient client = n.serviceClient&lt;bingda_practices::AddTwoInts&gt;(<span class="string">&quot;add_two_ints&quot;</span>);</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªæœåŠ¡ç±»å‹AddTwoIntsçš„ç»“æ„ä½“å˜é‡srv</span></span><br><span class="line">bingda_practices::AddTwoInts srv;</span><br><span class="line"><span class="comment">//ç»™ç»“æ„ä½“å˜é‡èµ‹å€¼å³æœåŠ¡ç±»å‹AddTwoIntsçš„åˆ†å‰²çº¿ä¸Šçš„æˆå‘˜å˜é‡</span></span><br><span class="line">srv.request.a = atoll(argv[<span class="number">1</span>]);</span><br><span class="line">srv.request.b = atoll(argv[<span class="number">2</span>]);</span><br><span class="line"><span class="comment">//å¦‚æœç»“æ„ä½“å˜é‡srvæ”¶åˆ°å›åº”åˆ™è¾“å‡ºå›åº”çš„åˆ†å‰²çº¿ä¸‹çš„æˆå‘˜å˜é‡å€¼</span></span><br><span class="line"><span class="keyword">if</span> (client.call(srv))</span><br><span class="line">&#123;</span><br><span class="line">ROS_INFO(<span class="string">&quot;Sum: %ld&quot;</span>, (<span class="keyword">long</span> <span class="keyword">int</span>)srv.response.sum);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">ROS_ERROR(<span class="string">&quot;Failed to call service add_two_ints&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>ä¿®æ”¹é…ç½®æ–‡ä»¶CMakeLists.txt</p><br><p class='p blue'>åœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸Šä»¥ä¸‹ä¸‰å¥ï¼Œè®¾ç½®ç¼–è¯‘è§„åˆ™</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add_executable(add_two_ints_client src/add_two_ints_client.cpp)</span><br><span class="line">target_link_libraries(add_two_ints_client $&#123;catkin_LIBRARIES&#125;)</span><br><span class="line">add_dependencies(add_two_ints_client bingda_practices_generate_messages_cpp)</span><br></pre></td></tr></table></figure></li></ol><!-- ![](https://s1.vika.cn/space/2023/01/14/5d08f4f9fefe4ef5bc166a82d67df0d6) --><p><img src="/media/rosç¼–ç¨‹å…¥é—¨12.webp" alt=""></p>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-5"><details class="folding-tag" green><summary> ç®€ä»‹ </summary>              <div class='content'>              <ol><li><p class='p blue'>xæ–¹å‘ä¸ºè½¦å¤´å‰è¿›æ–¹å‘ï¼Œyæ–¹å‘ä¸ºå‘å·¦çš„æ–¹å‘ï¼Œzè½´ç”¨å³æ‰‹å®šåˆ™</p><!-- ![](https://s1.vika.cn/space/2023/01/14/0418255daab54d7c93b442d7abf9aba5) --><img src="/media/rosç¼–ç¨‹å…¥é—¨13.webp" alt=""></li><li><p class='p blue'>é›·è¾¾åæ ‡ç³»ä¸ºtf2ï¼Œè½¦ä½“åæ ‡ç³»ä¸ºtf1ï¼Œtf2çš„åæ ‡åŸç‚¹åœ¨tf1ä¸­çš„è¡¨ç¤ºä¸ºï¼ˆx:0.1mï¼Œy:0.0mï¼Œz:0.2mï¼‰ç§°ä¸ºåç§»æˆ–è€…tf2ç›¸å¯¹äºtf1çš„ä½ç½®ï¼Œå›¾ä¸­tf2ç›¸å¯¹äºtf1çš„å§¿æ€ä¸º0</p><!-- ![](https://s1.vika.cn/space/2023/01/14/fdb974b7fe2a4d529b883fc6eff428e9) --><img src="/media/rosç¼–ç¨‹å…¥é—¨14.webp" alt=""></li><li><p class='p blue'>æ¬§æ‹‰è§’æè¿°çš„æ˜¯ä¸¤ä¸ªåæ ‡ç³»çš„å§¿æ€å˜åŒ–</p><!-- ![](https://s1.vika.cn/space/2023/01/14/1088055b6dee4b3d9afda5550e1abd3d) --><img src="/media/rosç¼–ç¨‹å…¥é—¨15.webp" alt=""><!-- ![](https://s1.vika.cn/space/2023/01/14/09868176e4b644409a2dea57bcbebd0f) --><img src="/media/rosç¼–ç¨‹å…¥é—¨16.webp" alt=""></li></ol>              </div>            </details><details class="folding-tag" yellow><summary> rosä¸­çš„åæ ‡ç³» </summary>              <div class='content'>              <p class='p red'>ä¸€.base_link</p><p class='p blue'>æœºå™¨äººæœ¬ä½“ä¸Šçš„åæ ‡ç³»ï¼Œé€šå¸¸æ”¾åœ¨åº•ç›˜ä¸­å¿ƒæˆ–è€…è½¦ä½“ä¸­å¿ƒï¼šx è½´æŒ‡å‘æœºå™¨äººå‰æ–¹ï¼Œy è½´æŒ‡å‘æœºå™¨äººå·¦æ–¹ï¼Œz è½´æŒ‡å‘æœºå™¨äººä¸Šæ–¹</p><p class='p red'>äºŒ.odomé‡Œç¨‹è®¡åæ ‡ç³»</p><ol><li><p class='p gray'>odomå’Œmapåæ ‡ç³»æ˜¯ä¸æ˜¯é‡åˆçš„ï¼Ÿ</p><p class='p blue'>odomåæ ‡ç³»çš„åŸç‚¹å°±æ˜¯æœºå™¨äººä¸Šç”µæ—¶æ‰€å¤„çš„ä½ç½®ï¼Œæ‰€ä»¥åœ¨å»ºå›¾æ—¶odomåæ ‡ç³»å’Œmapåæ ‡ç³»æ˜¯é‡åˆçš„ï¼Œåé¢éšç€å»ºå›¾çš„è¿›è¡Œï¼Œç”±äºè¯¯å·®å­˜åœ¨ï¼Œodomåæ ‡ç³»å’Œmapåæ ‡ç³»ä¼šæ…¢æ…¢åç¦»ã€‚ è€Œå¯¼èˆªæ—¶ï¼Œæœºå™¨äººèµ·å§‹ä½ç½®ä¸€èˆ¬ä¸ä¼šä¸å»ºå›¾æ—¶çš„èµ·å§‹ä½ç½®å®Œå…¨ç›¸åŒï¼Œè€Œmapåæ ‡ç³»æ˜¯å§‹ç»ˆä¸å˜çš„ï¼Œæ‰€ä»¥åœ¨å¯¼èˆªå¼€å§‹æ—¶ï¼Œodomåæ ‡ç³»å’Œmapåæ ‡ç³»ä¸€èˆ¬éƒ½ä¸æ˜¯é‡åˆçš„ï¼Œodom:é‡Œç¨‹è®¡åæ ‡ç³»ï¼Œä¸æ˜¯å›ºå®šçš„åæ ‡ç³»ï¼Œæ˜¯å¯ä»¥è¿åŠ¨çš„</p></li><li><p class='p gray'>odomå’Œbase_linkåæ ‡ç³»çš„å…³ç³»è·å–</p><p class='p blue'>odom-base_linkåæ ‡ç³»å…³ç³»æ˜¯é€šè¿‡é‡Œç¨‹è®¡ä¿¡æ¯è®¡ç®—å‡ºæ¥çš„ã€‚æ¯”å¦‚è½®å­çš„ç¼–ç å™¨æˆ–è€…è§†è§‰é‡Œç¨‹è®¡ç®—æ³•æˆ–è€…é™€èºä»ªå’ŒåŠ é€Ÿåº¦è®¡ï¼Œodom-base_linkåæ ‡ç³»å…³ç³»æ˜¯ä¸€ä¸ªçŸ­æœŸçš„å±€åŸŸçš„ç²¾ç¡®åæ ‡ç³»ï¼Œæ¯”è¾ƒå¯é ï¼Œæ¯”å¦‚å‘å‰èµ°äº†å¤šå°‘ï¼Œå‘å³è½¬äº†å¤šå°‘åº¦ï¼Œé‡Œç¨‹è®¡å‡ä¼šè®°å½•</p></li></ol><!-- ![](https://s1.vika.cn/space/2023/01/15/7691a2eb4a7f4dbf96217c8eee045aed) --><p><img src="/media/rosç¼–ç¨‹å…¥é—¨17.webp" alt=""><br><!-- ![](https://s1.vika.cn/space/2023/01/15/245441c252414bccba3e5d18bc54ab63) --><br><img src="/media/rosç¼–ç¨‹å…¥é—¨18.webp" alt=""><br><!-- ![](https://s1.vika.cn/space/2023/01/15/80a3403750e5497ca414d5111a77b405) --><br><img src="/media/rosç¼–ç¨‹å…¥é—¨19.webp" alt=""></p><p><p class='p red'>ä¸‰.mapåœ°å›¾åæ ‡ç³»</p></p><ol><li><p class='p gray'>mapåæ ‡ç³»çš„ä½ç½®</p><p class='p blue'>åœ¨æ„å»ºåœ°å›¾æ—¶ï¼Œæœºå™¨äººæ„å»ºåœ°å›¾çš„èµ·ç‚¹ä½ç½®å°±æ˜¯mapåæ ‡ç³»çš„ä½ç½®ã€‚åœ¨å¯¼èˆªèŠ‚ç‚¹ï¼Œå½“åŠ è½½åœ°å›¾æ—¶ï¼Œmapåæ ‡ç³»å°±ç¡®å®šäº†ã€‚ mapåæ ‡ç³»ä¸€æ—¦å›ºå®šï¼Œå°±ä¸ä¼šå†å˜</p></li><li><p class='p gray'>mapå’Œbase_linkåæ ‡ç³»çš„å…³ç³»è·å–</p><p class='p blue'>é€šè¿‡amclå®šä½æ¨¡å—å’Œé›·è¾¾ï¼šamclä½¿ç”¨ç²’å­ç®—æ³•ï¼Œé€šè¿‡æ¿€å…‰ç‚¹ä¸åœ°å›¾åŒ¹é…ï¼Œé¦–å…ˆæ±‚å‡ºmap(çˆ¶åæ ‡)â€“>laserï¼Œlaseråœ¨mapä¸‹çš„ä½å§¿ï¼Œç„¶åæ ¹æ®å·²çŸ¥çš„base_linkâ€“>laserï¼Œè®¡ç®—æ±‚å‡ºmap->base_link</p></li><li><p class='p gray'>å„åæ ‡ç³»çš„å…³ç³»</p><br><p class='p blue'>åœ¨é¿éšœæ—¶æ—¢è¦ä½¿ç”¨mapåˆè¦ä½¿ç”¨odomï¼Œå› ä¸ºodomè¯¯å·®ä¼šè¶Šæ¥è¶Šå¤§å¯ä»¥é€šè¿‡mapä¿®æ­£ï¼Œmapæ˜¯ä¸€ä¸ªé•¿æœŸå‡†ç¡®çš„åæ ‡ç³»</p><!-- ![](https://s1.vika.cn/space/2023/01/15/b4f6032d82e8446ba37cac953f1ecde5) --><img src="/media/rosç¼–ç¨‹å…¥é—¨20.webp" alt=""></li></ol>              </div>            </details><details class="folding-tag" green><summary> é™æ€åæ ‡ç³»è½¬æ¢ </summary>              <div class='content'>              <ol><li><p class='p blue'>å®ç°é™æ€åæ ‡è½¬æ¢åªéœ€åœ¨launchæ–‡ä»¶ä¸­å¯åŠ¨ä¸€ä¸ªé™æ€åæ ‡è½¬æ¢çš„èŠ‚ç‚¹åœ¨åŠŸèƒ½åŒ…lauchæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªlaunchæ–‡ä»¶tf_transform.launch</p> </li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">&lt;node pkg=<span class="string">&quot;tf&quot;</span> type=<span class="string">&quot;static_transform_publisher&quot;</span> name=<span class="string">&quot;static_transform&quot;</span></span><br><span class="line">args=<span class="string">&quot;0.1 0.0 0.2 0.0 0.0 0.0 /tf1 /tf2 20&quot;</span>&gt;</span><br><span class="line">&lt;/node&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure><p class='p blue'>è°ƒç”¨tfåŠŸèƒ½åŒ…ä¸‹çš„static_transform_publisherèŠ‚ç‚¹å¹¶ä¼ å…¥å‚æ•°ï¼Œè¿™å‡ ä¸ªå‚æ•°åˆ†åˆ«æ˜¯tf2ç›¸å¯¹äºtf1çš„ä½å§¿ï¼šxï¼Œyï¼Œzä¸‰ä¸ªæ–¹å‘çš„è·ç¦»å˜æ¢ï¼Œèˆªå‘(x)ï¼Œä¿¯ä»°(y)ï¼Œæ¨ªæ»š(z)ä¸‰ä¸ªè§’åº¦çš„å˜æ¢ã€‚0.1å’Œ0.2è¡¨ç¤ºxè½´æ–¹å‘åç§»0.1ç±³ï¼Œzè½´æ–¹å‘åç§»0.2ç±³ï¼Œ20è¡¨ç¤ºå‘å¸ƒé—´éš”20æ¯«ç§’ã€‚</p></li></ol>              </div>            </details><details class="folding-tag" blue><summary> åŠ¨æ€åæ ‡ç³»è½¬æ¢py </summary>              <div class='content'>              <ol><li><p class='p blue'>åœ¨åŠŸèƒ½åŒ…çš„scriptä¸‹æ–°å»ºtf_transform.pyæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="comment">//å¯¼å…¥tfçš„åŒ…</span></span><br><span class="line"><span class="keyword">import</span> tf</span><br><span class="line"><span class="comment">//å¯¼å…¥æ•°å­¦åŒ…ï¼ˆå•çº¯çš„è½¬æ¢ä¸éœ€è¦ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸»å‡½æ•°tf_transform()</span></span><br><span class="line"><span class="function">def <span class="title">tf_transform</span><span class="params">()</span>:</span></span><br><span class="line"><span class="function"><span class="comment">//åˆå§‹åŒ–ç”Ÿæˆä¸€ä¸ªèŠ‚ç‚¹åå­—ä¸ºtf_transform</span></span></span><br><span class="line">rospy.init_node(&#x27;tf_transform&#x27;, anonymous=False)</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªtfåæ ‡å¹¿æ’­å™¨</span></span><br><span class="line">tf_broadcaster = tf.TransformBroadcaster()</span><br><span class="line"><span class="comment">//è®¾ç½®èŠ‚ç‚¹è¿è¡Œé¢‘ç‡10hz</span></span><br><span class="line">rate = rospy.Rate(<span class="number">10</span>) # <span class="number">10</span>hz</span><br><span class="line"><span class="comment">//åˆ©ç”¨angelå˜åŒ–äº§ç”Ÿä¸€ä¸ªåŠ¨æ€åæ ‡</span></span><br><span class="line">angle = <span class="number">0.0</span></span><br><span class="line"><span class="comment">//è¾“å‡ºä¿¡æ¯</span></span><br><span class="line">rospy.loginfo(&#x27;Start TF Transform&#x27;)</span><br><span class="line"><span class="comment">//èŠ‚ç‚¹è¿›å…¥æ­»å¾ªç¯</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line"><span class="comment">//åšä¸€ä¸ªåŠ¨æ€åæ ‡</span></span><br><span class="line"><span class="comment">//ä½ç½®</span></span><br><span class="line">x = math.<span class="built_in">cos</span>(angle)*<span class="number">0.3</span></span><br><span class="line">y = math.<span class="built_in">sin</span>(angle)*<span class="number">0.3</span></span><br><span class="line">z = <span class="number">0.2</span></span><br><span class="line"><span class="comment">//å§¿æ€</span></span><br><span class="line"><span class="comment">//å°†æè¿°å§¿æ€çš„æ¬§æ‹‰è§’ï¼ˆ0ï¼Œ0ï¼Œangleï¼‰è½¬æ¢ä¸ºå››å…ƒæ•°ï¼ˆä¸‰ä¸ªå‚æ•°æ˜¯åˆ†åˆ«ç»•xè½´ï¼Œyè½´ï¼Œzè½´ï¼‰</span></span><br><span class="line">quat = tf.transformations.quaternion_from_euler(<span class="number">0</span>,<span class="number">0</span>,angle)</span><br><span class="line"><span class="comment">//tfåæ ‡å¹¿æ’­å™¨å‘å¸ƒåŠ¨æ€åæ ‡å…³ç³»</span></span><br><span class="line"><span class="comment">//tf3(å­)ç›¸å¯¹äºtf1(çˆ¶)çš„ä½ç½®ä¸ºx,y,zã€‚å§¿æ€ä¸ºå››å…ƒæ•°(ä¸Šé¢ç”¨æ¬§æ‹‰è§’è½¬æ¢æˆäº†å››å…ƒæ•°)</span></span><br><span class="line">current_time = rospy.Time.now()</span><br><span class="line">tf_broadcaster.sendTransform((x,y,z),quat,current_time,&#x27;tf3&#x27;,&#x27;tf1&#x27;)</span><br><span class="line"><span class="comment">//ä¸¾ä¸ªä¾‹å­</span></span><br><span class="line">tf_broadcaster.sendTransform((x,y,z),(0,0,0,1),current_time,&#x27;tf4&#x27;,&#x27;tf1&#x27;)</span><br><span class="line">angle += <span class="number">0.01</span></span><br><span class="line"><span class="comment">//ä¼‘çœ </span></span><br><span class="line">rate.sleep()</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line"><span class="comment">//æ‰§è¡Œä¸»å‡½æ•°tf_transform()</span></span><br><span class="line">tf_transform()</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" yellow><summary> åŠ¨æ€åæ ‡ç³»è½¬æ¢c++ </summary>              <div class='content'>              <ol><li><p class='p blue'>åœ¨åŠŸèƒ½åŒ…çš„åœ¨srcä¸‹æ–°å»ºä¸€ä¸ªtf_transform.cppæ–‡ä»¶</p></li><li><p class='p blue'>ä»£ç è¯¦è§£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="comment">//åŒ…å«tfå¹¿æ’­çš„å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tf/transform_broadcaster.h&gt;</span></span></span><br><span class="line"><span class="comment">//åŒ…å«çŸ©é˜µå˜æ¢å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tf/transform_datatypes.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span>&#123;</span><br><span class="line"> <span class="comment">// å®šä¹‰ç”Ÿæˆåˆå§‹åŒ–èŠ‚ç‚¹robot_tf_publisher</span></span><br><span class="line">ros::init(argc, argv, <span class="string">&quot;robot_tf_publisher&quot;</span>);</span><br><span class="line"><span class="comment">//å®šä¹‰å¥æŸ„</span></span><br><span class="line">ros::NodeHandle n;</span><br><span class="line"><span class="comment">//èŠ‚ç‚¹è¿è¡Œé¢‘ç‡10hz</span></span><br><span class="line"><span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªtfå¹¿æ’­å‘å¸ƒå™¨</span></span><br><span class="line">tf::TransformBroadcaster broadcaster;</span><br><span class="line"><span class="comment">//åšä¸€ä¸ªåŠ¨æ€åæ ‡</span></span><br><span class="line"><span class="keyword">float</span> angle = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">float</span> x = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">float</span> y = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">float</span> z = <span class="number">0.0</span>;</span><br><span class="line"><span class="comment">//è¾“å‡ºä¿¡æ¯</span></span><br><span class="line">ROS_INFO(<span class="string">&quot;Start TF Transform&quot;</span>);</span><br><span class="line"><span class="comment">//èŠ‚ç‚¹è¿›å…¥æ­»å¾ªç¯</span></span><br><span class="line"><span class="keyword">while</span>(n.ok())&#123;</span><br><span class="line"><span class="comment">//ä½ç½®</span></span><br><span class="line">x = <span class="built_in">cos</span>(angle)*<span class="number">0.3</span>;</span><br><span class="line">y = <span class="built_in">sin</span>(angle)*<span class="number">0.3</span>;</span><br><span class="line">z = <span class="number">0.2</span>;</span><br><span class="line"><span class="comment">//å‘å¸ƒåŠ¨æ€åæ ‡è½¬æ¢çŸ©é˜µ</span></span><br><span class="line"><span class="comment">//tf::createQuaternionFromRPYå°†æè¿°å§¿æ€çš„æ¬§æ‹‰è§’ï¼ˆ0ï¼Œ0ï¼Œangleï¼‰è½¬æ¢ä¸ºå››å…ƒæ•°ï¼ˆä¸‰ä¸ªå‚æ•°æ˜¯åˆ†åˆ«ç»•xè½´ï¼Œyè½´ï¼Œzè½´ï¼‰</span></span><br><span class="line"><span class="comment">//tf3(å­)ç›¸å¯¹äºtf1(çˆ¶)çš„ä½ç½®ä¸ºx,y,zã€‚å§¿æ€ä¸ºå››å…ƒæ•°(ä¸Šé¢ç”¨æ¬§æ‹‰è§’è½¬æ¢æˆäº†å››å…ƒæ•°)</span></span><br><span class="line">broadcaster.sendTransform(</span><br><span class="line">tf::StampedTransform(</span><br><span class="line">tf::Transform(tf::createQuaternionFromRPY(<span class="number">0.0</span>,<span class="number">0.0</span>,angle), tf::Vector3(x, y, z)),</span><br><span class="line">ros::Time::now(),<span class="string">&quot;tf1&quot;</span>, <span class="string">&quot;tf3&quot;</span>));</span><br><span class="line"><span class="comment">//ä¸¾ä¸ªä¾‹å­</span></span><br><span class="line">broadcaster.sendTransform(</span><br><span class="line">tf::StampedTransform(</span><br><span class="line">tf::Transform(tf::Quaternion(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>), tf::Vector3(x, y, z*<span class="number">2</span>)),</span><br><span class="line">ros::Time::now(),<span class="string">&quot;tf1&quot;</span>, <span class="string">&quot;tf4&quot;</span>));</span><br><span class="line"><span class="comment">//angleå˜åŒ–ä½¿å¾—åæ ‡ç³»å˜åŒ–</span></span><br><span class="line">angle += <span class="number">0.01</span>;</span><br><span class="line">r.sleep();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p class='p blue'>é…ç½®æ–‡ä»¶</p><br><p class='p blue'>ç¼–è¾‘package.xmlæ–‡ä»¶åŠ å…¥æ„å»ºä¾èµ–é¡¹</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;build_depend&gt;tf&lt;/build_depend&gt; </span><br><span class="line">&lt;build_export_depend&gt;tf&lt;/build_export_depend&gt;</span><br></pre></td></tr></table></figure><p class='p blue'>ç¼–è¾‘CMakeLists.txtæ–‡ä»¶åœ¨find_packageä¸­åŠ å…¥tf</p><br><p class='p blue'>åœ¨CMakeLists.txtæ–‡ä»¶æœ«å°¾åŠ ä¸Šä»¥ä¸‹ä¸¤å¥ï¼Œè®¾ç½®ç¼–è¯‘è§„åˆ™</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_executable(tf_transform src/tf_transform.cpp)</span><br><span class="line">target_link_libraries(tf_transform $&#123;catkin_LIBRARIES&#125;)</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> æ¯•ä¸šè®¾è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ros-slamè·¯å¾„è§„åˆ’</title>
      <link href="blog/ros-slam%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/"/>
      <url>blog/ros-slam%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">å‡ºç°çš„é—®é¢˜å’Œè§£å†³åŠæ³•</button></li><li class="tab"><button type="button" data-href="#test4-2">ä¸‹è½½å®‰è£…é…ç½®</button></li><li class="tab"><button type="button" data-href="#test4-3">åŠŸèƒ½å®ç°</button></li><li class="tab"><button type="button" data-href="#test4-4">å¸¸ç”¨shellå‘½ä»¤å’Œå·¥å…·</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><details class="folding-tag" green><summary> é”™è¯¯1 </summary>              <div class='content'>              <ul><li><span class='p red'>dpkg è¢«ä¸­æ–­æ‚¨å¿…é¡»æ‰‹å·¥è¿è¡Œ sudo dpkg â€“configure -aè§£å†³æ­¤é—®é¢˜</span><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo rm /var/lib/dpkg/updates<span class="comment">/*</span></span><br><span class="line"><span class="comment">sudo apt-get update</span></span><br><span class="line"><span class="comment">sudo apt-get upgrade</span></span><br></pre></td></tr></table></figure></li></ul>              </div>            </details><details class="folding-tag" blue><summary> é”™è¯¯2 </summary>              <div class='content'>              <ul><li><span class='p blue'>è½¦ç»å¸¸æ’åˆ°å¢™ä¸Šå¡ä½</span><br>åŸå› ,è½¦çš„æ¨¡å‹å‚æ•°ä¸ä¸€æ ·,éœ€è¦è°ƒæ•´é…ç½®æ–‡ä»¶åŒ…æ‹¬æœ€å°è§„åˆ’è·ç¦»ç­‰<br>è§£å†³æ–¹æ¡ˆï¼šä¿®æ”¹è½¦çš„æ¨¡å‹ä¸ºNanoCar<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit ~/.bashrc</span><br></pre></td></tr></table></figure>ä¿®æ”¹æœ€ä¸‹é¢çš„<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> BASE_TYPE=NanoCar</span><br></pre></td></tr></table></figure>ä¿å­˜<br>æ›´æ–°æ–‡ä»¶å¹¶æ˜¾ç¤ºé€‰å®šè½¦æ¨¡å‹åå­—<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc </span><br><span class="line">echo $BASE_TYPE </span><br></pre></td></tr></table></figure></li></ul>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><details class="folding-tag" yellow><summary> ä¸‹è½½åŠŸèƒ½åŒ… </summary>              <div class='content'>              <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd ~/catkin_ws/src/</span><br><span class="line">git clone https:<span class="comment">//gitee.com/bingda-robot/base_control.git</span></span><br><span class="line">git clone https:<span class="comment">//gitee.com/bingda-robot/lidar.git</span></span><br><span class="line">git clone https:<span class="comment">//gitee.com/bingda-robot/robot_vision.git</span></span><br><span class="line">git clone https:<span class="comment">//gitee.com/bingda-robot/robot_navigation.git</span></span><br><span class="line">git clone https:<span class="comment">//gitee.com/bingda-robot/robot_simulation.git</span></span><br><span class="line">cd ~/catkin_ws/</span><br><span class="line">catkin_make</span><br><span class="line">cd ~/catkin_ws/</span><br><span class="line">rosdep check --from-path src</span><br></pre></td></tr></table></figure><ul><li><span class='p red'>æ˜¾ç¤ºæ‰€æœ‰ä¾èµ–å·²ç»æ»¡è¶³ï¼Œå¦åˆ™rosdep install â€”from-path src -y</span></li><li><span class='p red'>è‹¥rosdepæ— æ³•æ­£å¸¸å·¥ä½œåˆ™æ‰§è¡Œä¸‹é¢ä»£ç æ‰‹åŠ¨æ·»åŠ </span><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ros-$ROS_DISTRO-teleop-twist-keyboard ros-$ROS_DISTRO-amcl ros-$ROS_DISTRO-move-base ros-$ROS_DISTRO-slam-gmapping ros-$ROS_DISTRO-slam-karto ros-$ROS_DISTRO-cartographer ros-$ROS_DISTRO-cartographer-ros ros-$ROS_DISTRO-dwa-local-planner  ros-$ROS_DISTRO-teb-local-planner ros-$ROS_DISTRO-uvc-camera ros-$ROS_DISTRO-<span class="built_in">map</span>-server ros-$ROS_DISTRO-hector-slam* ros-$ROS_DISTRO-global-planner ros-$ROS_DISTRO-navfn -y</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosdep check --from-path src</span><br></pre></td></tr></table></figure></li><li><span class='p red'>æ˜¾ç¤ºæ‰€æœ‰ä¾èµ–å·²ç»æ»¡è¶³ï¼Œå¦åˆ™rosdep install â€”from-path src -y</span></li></ul>              </div>            </details><details class="folding-tag" blue><summary> é…ç½® </summary>              <div class='content'>              <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit ~/.bashrc</span><br></pre></td></tr></table></figure><ul><li><span class='p red'>åœ¨è¯¥æ–‡ä»¶çš„æœ€åæ·»åŠ å¦‚ä¸‹ä»£ç </span></li><li><span class='p red'>catkin_wsä¸ºæˆ‘çš„ROSå·¥ä½œè·¯å¾„</span><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source ~/catkin_ws/devel/setup.bash</span><br><span class="line"><span class="keyword">export</span> ROS_PACKAGE_PATH=$&#123;ROS_PACKAGE_PATH&#125;:~/catkin_ws/</span><br></pre></td></tr></table></figure></li><li><span class='p red'>ç„¶åé‡å¯bashrc</span><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure></li><li><span class='p red'>æŸ¥çœ‹ROSè·¯å¾„æ˜¯å¦æ·»åŠ ä¸Š</span><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $ROS_PACKAGE_PATH</span><br></pre></td></tr></table></figure></li><li><span class='p red'>è®¾ç½®æˆåŠŸä¼šæ˜¾ç¤ºä½ æ·»åŠ çš„è·¯å¾„ã€‚</span></li></ul>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><details class="folding-tag" green><summary> å»ºå›¾ </summary>              <div class='content'>              <ol><li>å¯åŠ¨æœºå™¨äººæ¨¡å‹<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch robot_simulation simulation_one_robot.launch</span><br></pre></td></tr></table></figure></li><li>æŸ¥çœ‹å½“å‰è¿è¡Œè¯é¢˜<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rostopic <span class="built_in">list</span></span><br></pre></td></tr></table></figure></li><li>å¯åŠ¨é”®ç›˜èŠ‚ç‚¹<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun teleop_twist_keyboard teleop_twist_keyboard.py</span><br></pre></td></tr></table></figure></li><li>é…ç½®ä½ æƒ³ä½¿ç”¨çš„æœºå™¨äººBASE_TYPEè¿™é‡Œçš„æ˜¯NanoRobot<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit ~/.bashrc</span><br></pre></td></tr></table></figure>æœ€åå‡ è¡Œæ·»åŠ <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> BASE_TYPE=NanoRobot</span><br></pre></td></tr></table></figure></li><li>å¯åŠ¨å¯¼èˆª<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch robot_navigation robot_slam_laser.launch </span><br></pre></td></tr></table></figure>åŒå‡»tabå¯ä»¥é€‰æ‹©å‚æ•°  simulationå‚æ•°ä¸ºfalseåˆ™å¯åŠ¨æœºå™¨äººæœ¬ä½“ç¡¬ä»¶ <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch robot_navigation robot_slam_laser.launch simulation:=<span class="literal">true</span></span><br></pre></td></tr></table></figure>è‹¥å‡ºç°é”™è¯¯åˆ™å®‰è£…ä¾èµ–<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-melodic-<span class="built_in">map</span>-server ros-melodic-amcl ros-melodic-gmapping</span><br></pre></td></tr></table></figure></li><li>æ‰“å¼€rvizç•Œé¢<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch robot_navigation slam_rviz.launch</span><br></pre></td></tr></table></figure></li><li>æŒ‰zé™ä½æœºå™¨äººé€Ÿåº¦åˆ°0.22å·¦å³ï¼Œå¦åˆ™è¿‡å¿«å»ºå›¾å¤±è´¥æˆ–è¯¯å·®å¤§</li><li>ä¿å­˜åœ°å›¾åœ¨å®¶ç›®å½•ä¸‹åå­—ä¸ºstag _map(-fåä¸ºèµ·çš„åå­—)<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun map_server map_saver -f stage_map</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><details class="folding-tag" yellow><summary> æŒ‡å®šå¯¼èˆª </summary>              <div class='content'>              <ol><li>å¯åŠ¨å¯¼èˆª<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch robot_navigation robot_navigation.launch simulation:=<span class="literal">true</span> open_rviz:=<span class="literal">true</span></span><br></pre></td></tr></table></figure>è‹¥å‡ºç°é”™è¯¯åˆ™å®‰è£…åŒ…ï¼ŒæŒ‰æç¤ºå®‰è£…<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-melodic-move-base</span><br><span class="line">sudo apt install rosmelodic-teb-local-planner</span><br></pre></td></tr></table></figure></li><li>ç‚¹å‡»rvizä¸Šæ–¹2d Nav Goal åœ¨åœ°å›¾ä¸Šé€‰æ‹©ç›®æ ‡ç‚¹ï¼Œå°è½¦ä¼šè‡ªå·±ç§»åŠ¨åˆ°æŒ‡å®šç‚¹<br>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Nanocaræœºå™¨äººæ¨¡å‹ï¼Œä»¿çœŸèµ°èµ·æ¥ä¼šæ‰­ï¼Œéœ€è¦åˆ°å·¥ä½œç©ºé—´çš„srcä¸‹çš„robot_navigationåŒ…ä¸‹çš„param<br>ç‚¹å¼€è¿›å…¥Nanocaré‡Œçš„teb_local_planner_params.yaml é‡Œé¢çš„cmd_angle_instead_rotvelå‚æ•°æ”¹ä¸ºTrue </li></ol>              </div>            </details><details class="folding-tag" yellow><summary> å¤šç›®æ ‡ç‚¹å¯¼èˆª </summary>              <div class='content'>              <ol><li>å¯åŠ¨å¯¼èˆª<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch robot_navigation robot_navigation.launch simulation:=<span class="literal">true</span></span><br></pre></td></tr></table></figure></li><li>å¯åŠ¨å¤šç‚¹å¯¼èˆªå·¥å…·<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch robot_navigation multi_points_navigation.launch</span><br></pre></td></tr></table></figure></li><li>å¯åŠ¨å¯¹åº”rvizé…ç½®<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch robot_navigation multi_navigation.launch</span><br></pre></td></tr></table></figure></li><li>ç‚¹å‡»rvizä¸Šæ–¹ç¬¬äºŒä¸ª2d Nav Goal åœ¨åœ°å›¾ä¸Šé€‰æ‹©ç›®æ ‡ç‚¹ï¼Œå°è½¦ä¼šå¤šç›®æ ‡ç‚¹å¯¼èˆª</li></ol>              </div>            </details><details class="folding-tag" blue><summary> å¤šç‚¹å…¨è‡ªåŠ¨å·¡èˆª </summary>              <div class='content'>              <ol><li>å¯åŠ¨å¯¼èˆª<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch robot_navigation robot_navigation.launch simulation:=<span class="literal">true</span></span><br></pre></td></tr></table></figure></li><li>è®¢é˜…ç›®æ ‡ç‚¹çš„è¯é¢˜<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rostopic echo /move_base_simple/goal</span><br></pre></td></tr></table></figure></li><li>å¯åŠ¨å¯¹åº”rvizé…ç½®<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch robot_navigation navigation_rviz.launch</span><br></pre></td></tr></table></figure></li><li>åœ¨rvizç•Œé¢æŒ‡å®šä¸‰ä¸ªå¾ªç¯ç‚¹(ä½ éšæ„)åˆ‡è®°æ¯ä¸€ä¸ªç‚¹æœºå™¨äººåˆ°æŒ‡å®šç‚¹ååœ¨æ ‡è®°ä¸‹ä¸€ç‚¹,ç»ˆç«¯æ˜¾ç¤ºä¸‰ä¸ªç›®æ ‡ç‚¹position x,y,z</li><li>å†™å…¥lanchæ–‡ä»¶ï¼Œæ‰“å¼€å·¥ä½œç©ºé—´-&gt;src-&gt;robot_navigation-&gt;lanch-&gt;way_point.lanch<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;param name=<span class="string">&quot;goalListX&quot;</span> value=<span class="string">&quot;[2.0, 4.0, 1.0]&quot;</span> /&gt;</span><br><span class="line">&lt;param name=<span class="string">&quot;goalListY&quot;</span> value=<span class="string">&quot;[3.0, 3.0, 2.0]&quot;</span> /&gt;</span><br><span class="line">&lt;param name=<span class="string">&quot;goalListZ&quot;</span> value=<span class="string">&quot;[0.0, 0.0, 0.0]&quot;</span> /&gt;</span><br></pre></td></tr></table></figure></li><li>ç¬¬ä¸€åˆ—å†™ç¬¬ä¸€ä¸ªç›®æ ‡ç‚¹çš„xyzï¼Œç¬¬äºŒåˆ—å†™ç¬¬äºŒä¸ªç›®æ ‡ç‚¹çš„xyzï¼Œä¾æ¬¡ç±»æ¨å¹¶ä¿å­˜</li><li>å¯åŠ¨è¯¥lanchæ–‡ä»¶æŒ‡å®šå¾ªç¯æ¬¡æ•°ä¸º2ï¼Œé»˜è®¤ä¸º0ä»£è¡¨ä¸åœæ­¢çš„å¾ªç¯(roslaunch robot_navigation way_point.launchåŒå‡»tabæ˜¾ç¤ºå‚æ•°)<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch robot_navigation way_point.launch looptimes:=<span class="number">2</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-4"><details class="folding-tag" green><summary> é€šç”¨å‘½ä»¤ </summary>              <div class='content'>              <ol><li><p class='p blue'>roscd</p>roscdè·³è½¬åŠŸèƒ½åŒ…ç›®å½•ç”¨çš„ï¼Œroscdåé¢è¦è·Ÿçš„æ˜¯ä½ çš„åŠŸèƒ½åŒ…å</li><li><p class='p blue'>roscore</p>å¯åŠ¨äº†rosçš„ä¸€ä¸ªmasterèŠ‚ç‚¹ç®¡ç†å™¨å’Œä¸€äº›å¿…è¦çš„æ—¥å¿—è¾“å‡ºæ–‡ä»¶ä»¥åŠæˆ‘ä»¬å‰é¢æ‰€è¯´åˆ°çš„çš„å‚æ•°æœåŠ¡å™¨</li><li><p class='p blue'>rosrun</p>åŠŸèƒ½æ˜¯è¿è¡ŒèŠ‚ç‚¹ï¼Œrosrunåé¢æ˜¯è¦å¸¦å‚æ•°çš„ï¼Œè‡³å°‘è¦å¸¦ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬1ä¸ªæ˜¯åŠŸèƒ½åŒ…åï¼Œç¬¬äºŒä¸ªæ˜¯å¯æ‰§è¡Œç¨‹åºå</li></ol>              </div>            </details><details class="folding-tag" yellow><summary> èŠ‚ç‚¹rosnode </summary>              <div class='content'>              <ol><li><p class='p blue'>rosnode</p>è¾“å‡ºèŠ‚ç‚¹ç›¸å…³ä¿¡æ¯ï¼Œç›´æ¥è¿è¡Œrosnodeå¯ä»¥çœ‹åˆ°å®ƒçš„ä¸€äº›æç¤ºä¿¡æ¯ã€‚è¿™é‡Œä¼šå‘Šè¯‰ä½ å¯ä»¥å¸¦å“ªäº›å‚æ•°</li><li><p class='p blue'>rosnode list</p>åˆ—å‡ºå½“å‰èŠ‚ç‚¹</li><li><p class='p blue'>rosnode info</p>å®ƒåé¢è¿˜éœ€è¦å¸¦ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„èŠ‚ç‚¹ã€‚ä»–ä¼šåˆ—å‡ºèŠ‚ç‚¹çš„å„ç§ä¿¡æ¯åŒ…æ‹¬çš„åç§°ï¼Œå‘å¸ƒäº†å“ªäº›è¯é¢˜è®¢é˜…äº†é‚£äº›è¯é¢˜ï¼Œæœ‰å“ªäº›æœåŠ¡ï¼Œè¿˜æœ‰æ›´è¯¦ç»†çš„ç«¯å£å·ï¼Œè·Ÿå“ªäº›èŠ‚ç‚¹æœ‰è¿æ¥å…³ç³»ï¼Œè¿˜æœ‰å®ƒä¼ è¾“çš„æ–¹å¼æ˜¯tcprosçš„æ–¹å¼</li><li><p class='p blue'>rosnode kill</p>ç»“æŸä¸€ä¸ªèŠ‚ç‚¹</li><li><p class='p blue'>rosnode machine</p>åˆ—å‡ºè¿è¡Œåœ¨ç‰¹å®šæœºå™¨ä¸Šçš„èŠ‚ç‚¹\</li></ol>              </div>            </details><details class="folding-tag" green><summary> è¯é¢˜rostopic </summary>              <div class='content'>              <ol><li><p class='p blue'>rostopic</p>è¾“å‡ºè¯é¢˜ç›¸å…³ä¿¡æ¯</li><li><p class='p blue'>rostopic list</p>åˆ—å‡ºå½“å‰æ‰€æœ‰æ´»è·ƒçš„è¯é¢˜</li><li><p class='p blue'>rostopic info</p>æŸ¥çœ‹è¯é¢˜ç±»å‹ä»¥åŠå‘å¸ƒè®¢é˜…å…³ç³»ï¼Œå‚æ•°ä¸ºè¯é¢˜å</li><li><p class='p blue'>rostopic ehco</p>æ‰“å°å‡ºè¯é¢˜ä¼ å‡ºçš„å†…å®¹ï¼Œå‚æ•°ä¸ºè¯é¢˜å</li><li><p class='p blue'>rostopic type</p>è¾“å‡ºè¯é¢˜ç±»å‹ï¼Œå‚æ•°ä¸ºè¯é¢˜å</li><li><p class='p blue'>rostopic pub</p>å‘è¯é¢˜å‘å¸ƒæ•°æ®ï¼Œç»ˆç«¯è¾“å…¥rostopic pub+è¯é¢˜åï¼Œè¾“å…¥å®Œä¹‹åæŒ‰ä¸¤ä¸‹tabå¯ä»¥è‡ªåŠ¨è¡¥å…¨æ¶ˆæ¯çš„ç±»å‹ä»¥åŠå®ƒé‡Œé¢è¦å¡«å……çš„å‚æ•°</li><li><p class='p blue'>rostopic hz</p>æ£€æŸ¥æ¶ˆæ¯å‘å¸ƒé¢‘ç‡ï¼Œå‚æ•°ä¸ºè¯é¢˜å</li></ol>              </div>            </details><details class="folding-tag" cyan><summary> æœåŠ¡rosservice </summary>              <div class='content'>              <ol><li><p class='p blue'>rosservice list</p>åˆ—å‡ºè¿è¡Œçš„ç¨‹åºå½“ä¸­æ‰€æœ‰ä½¿ç”¨åˆ°çš„æœåŠ¡</li><li><p class='p blue'>rosservice info</p>æŸ¥çœ‹æœåŠ¡äº§ç”ŸèŠ‚ç‚¹ï¼ŒæœåŠ¡ç±»å‹ä»¥åŠå‚æ•°Argsï¼šæ¯”å¦‚Xåæ ‡ï¼Œyåæ ‡ï¼Œæ–¹å‘thetaå’Œåç§°ï¼Œå‚æ•°ä¸ºæœåŠ¡å</li><li><p class='p blue'>rosservice args</p>åˆ—å‡ºäº†æœåŠ¡æ‰€éœ€è¦ç”¨åˆ°çš„å‚æ•°ï¼Œå‚æ•°ä¸ºæœåŠ¡å</li><li><p class='p blue'>rosservice call</p>è°ƒç”¨ä¸€ä¸‹è¿™ä¸ªæœåŠ¡ï¼Œå‚æ•°ä¸ºæœåŠ¡åï¼Œä»¥åŠè¯¥æœåŠ¡çš„å‚æ•°</li><li><p class='p blue'>rosmsg show</p>è¾“å‡ºæ¶ˆæ¯ç›¸å…³ä¿¡æ¯ï¼Œå‚æ•°ä¸ºä¸€ä¸ªæ¶ˆæ¯çš„ç±»å‹</li><li><p class='p blue'>rosservice info</p>æŸ¥çœ‹æœåŠ¡ä¿¡æ¯ï¼Œå‚æ•°ä¸ºæœåŠ¡çš„ç±»å‹</li></ol>              </div>            </details><details class="folding-tag" cyan><summary> å›¾å½¢å·¥å…· </summary>              <div class='content'>              <ol><li><p class='p blue'>rqt_graph</p>æ˜¾ç¤ºèŠ‚ç‚¹å’ŒèŠ‚ç‚¹ä¹‹é—´çš„è”ç³»</li><li><p class='p blue'>rqt_plot</p>æ›²çº¿ç»˜å›¾å·¥å…·ï¼Œè¿›è¡Œè¿åŠ¨æ§åˆ¶ä¹‹ç±»çš„ç ”ç©¶æ—¶å¯é€šè¿‡å®ƒæŠŠé€Ÿåº¦ï¼Œä½ç½®ç­‰ä¿¡æ¯çš„æ›²çº¿ç»˜åˆ¶å‡ºæ¥ã€‚å¯é€šè¿‡å®ƒæ¥è§‚å¯Ÿè¿åŠ¨æ˜¯å¦å¹³ç¨³ï¼Œæ›²çº¿çš„å˜åŒ–æƒ…å†µç­‰</li><li><p class='p blue'>rviz</p>é™¤äº†åˆšåˆšè¯´åˆ°çš„å›¾åƒï¼Œè¿˜æœ‰åœ°å›¾ã€é‡Œç¨‹è®¡ã€è·¯å¾„ã€ç‚¹äº‘ç­‰ç­‰éƒ½å¯ä»¥åœ¨è¿™é‡Œé¢æ˜¾ç¤º</li></ol>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> æ¯•ä¸šè®¾è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>STM32é¿éšœå°è½¦</title>
      <link href="blog/STM32%E9%81%BF%E9%9A%9C%E5%B0%8F%E8%BD%A6/"/>
      <url>blog/STM32%E9%81%BF%E9%9A%9C%E5%B0%8F%E8%BD%A6/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="tabs" id="test"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test-1">é¡¹ç›®ç®€ä»‹</button></li><li class="tab"><button type="button" data-href="#test-2">åŠŸèƒ½å®ç°</button></li><li class="tab"><button type="button" data-href="#test-3">ç¤ºä¾‹å›¾ç‰‡</button></li><li class="tab"><button type="button" data-href="#test-4">æºç </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test-1"><!-- ä¸‹é¢å†™ç¬¬ä¸€ä¸ªåˆ†æ å†…å®¹ --><details class="folding-tag" green><summary> é¡¹ç›®å®ç°åŠŸèƒ½ </summary>              <div class='content'>              <ul><li><span class='p red'>é¡¹ç›®å®ç°åŠŸèƒ½</span></li></ul><ol><li>çŠ¶æ€æŒ‡ç¤ºç¯æ­£å¸¸é—ªçƒ(LED1)<br>2 æŒ‰é”®æ§åˆ¶LED2æ‰“å¼€å…³é—­</li><li>ä¸²å£æ‰“å°å­—ç¬¦ä¸²</li><li>LCDæ˜¾ç¤ºç”µé‡ï¼Œä»¥åŠè¶…å£°æ³¢é¿éšœåŠŸèƒ½</li><li>LCDæ˜¾ç¤ºç»„å‘˜ä¿¡æ¯</li><li>è®¾è®¡ç•Œé¢ï¼Œè¶Šç¾è§‚è¶Šå¥½å·¥</li></ol>              </div>            </details><details class="folding-tag" yellow><summary> é‡è¦æ­¥éª¤è¯´æ˜ </summary>              <div class='content'>              <ul><li><span class='p red'>LCDå±å¹•æ˜¾ç¤ºæ±‰å­—</span></li></ul><ol><li>æ‰“å¼€å­—ç¬¦å–æ¨¡è½¯ä»¶ï¼Œé€‰é¡¹è®¾ç½®é˜´ç ï¼Œé€è¡Œï¼Œqoé¡ºå‘ï¼Œè¾“å‡º16è¿›åˆ¶ï¼Œc51æ ¼å¼ï¼Œè¡Œå‰ç¼€ç©ºï¼Œè¡Œå‰ç¼€ç©ºä¸ºé€—å·</li><li>ç¡®å®šåè¾“å…¥å–æ¨¡çš„æ±‰å­—ï¼Œç”Ÿæˆå­—æ¨¡ï¼Œå¤åˆ¶ä»£ç åˆ°lcd.cé‡Œçš„font.hé‡Œ</li><li>å–æ¨¡16å·å­—ä½“æ”¾åˆ°const typFNT_GB16 tfont16[]=é‡Œ å–æ¨¡16å·å­—ä½“æ”¾åˆ° const typFNT_GB24 tfont24[]=é‡Œ</li><li>ä¿®æ”¹å¤åˆ¶å†…å®¹ä¸º â€œå·²â€,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x0F,0xFF,0xE0,0x00,0x00,0x60,0x00,0x00,æ ¼å¼</li><li>ä½¿ç”¨Show_Str(56,37,BLUE,BLACK,(u8*)â€æ˜¾ç¤ºå†…å®¹å¿…é¡»å–è¿‡æ¨¡â€,16,0);æ˜¾ç¤ºæ±‰å­— å‚æ•°ä¸ºæ˜¾ç¤ºä½ç½®x,y,å­—ä½“é¢œè‰²å’ŒèƒŒæ™¯ï¼Œæ˜¾ç¤ºå†…å®¹ </li></ol><ul><li><span class='p green'>LCDå±å¹•æ˜¾ç¤ºå›¾ç‰‡</span></li></ul><ol><li>æ‰¾åˆ°ä¸€ä¸ªjpgå›¾ç‰‡,ç”¨ç”»å›¾æ‰“å¼€ï¼Œé‡æ–°è°ƒæ•´å¤§å°ï¼Œä¿å­˜ </li><li>æ‰“å¼€å›¾ç‰‡å–æ¨¡è½¯ä»¶ï¼Œè¾“å‡ºç°åº¦16ä½çœŸå½©è‰²ï¼Œæœ€å¤§å®½åº¦é«˜åº¦ä¸åˆšå›¾ç‰‡ä¸€ç›´ï¼Œé«˜ä½åœ¨å‰å…¶ä»–ä¸é€‰ï¼Œæ‰“å¼€å›¾ç‰‡ç‚¹å‡»ä¿å­˜</li><li>å·¥ç¨‹é‡Œæ–°å»ºpic.cæ–‡ä»¶ï¼Œç¡®å®šåäº§ç”Ÿçš„ä»£ç å¤åˆ¶åˆ°pic.cæ–‡ä»¶</li><li>å¤åˆ¶ä»£ç â€=â€å‰é¢å›¾ç‰‡æ•°ç»„çš„æ¯”å¦‚const unsigned char gImage_2[1250]={</li><li>main.cä¸­æ·»åŠ extern const unsigned char gImage_2[1250];</li><li>ä½¿ç”¨Paint_Bmp(76,82,25,25,gImage_2);æ˜¾ç¤ºå›¾ç‰‡ å‚æ•°ä¸ºæ˜¾ç¤ºä½ç½®x,yå›¾ç‰‡å¤§å°,å›¾ç‰‡æ•°ç»„åå­—</li></ol>              </div>            </details><!-- åœ¨ä¸€æ®µè¯ä¸­æ–¹ä¾¿æ’å…¥å„ç§é¢œè‰²çš„æ ‡ç­¾ï¼ŒåŒ…æ‹¬ï¼š<span class='p red'>çº¢è‰²</span>ã€<span class='p yellow'>é»„è‰²</span>ã€<span class='p green'>ç»¿è‰²</span>ã€<span class='p cyan'>é’è‰²</span>ã€<span class='p blue'>è“è‰²</span>ã€<span class='p gray'>ç°è‰²</span>ã€‚ --><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-2"><!-- ä¸‹é¢å†™ç¬¬äºŒä¸ªåˆ†æ å†…å®¹ --><details class="folding-tag" ><summary> ç‚¹äº®LEDç¯ </summary>              <div class='content'>              <p>led.c<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;led.h&quot;</span></span></span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">LED_Config</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC,ENABLE);<span class="comment">//ä½¿èƒ½GPIOæ—¶é’Ÿ</span></span><br><span class="line">GPIO_InitTypeDef GPIO_InitStructure;<span class="comment">//å®šä¹‰ç»“æ„ä½“å˜é‡</span></span><br><span class="line">  GPIO_InitStructure.GPIO_Mode= GPIO_Mode_Out_PP;<span class="comment">//é€šç”¨æ¨æŒ½è¾“å‡º</span></span><br><span class="line">  GPIO_InitStructure.GPIO_Pin=GPIO_Pin_8|GPIO_Pin_9;<span class="comment">//é…ç½®8å·å¼•è„š</span></span><br><span class="line">  GPIO_InitStructure.GPIO_Speed=GPIO_Speed_50MHz;<span class="comment">//è¾“å‡ºé€Ÿç‡</span></span><br><span class="line">  GPIO_Init(GPIOC,&amp;GPIO_InitStructure);<span class="comment">//åˆå§‹åŒ–GPIOCçš„8å·å¼•è„š</span></span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LED_ON</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> GPIO_ResetBits(GPIOC,GPIO_Pin_8|GPIO_Pin_9);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LED_OFF</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> GPIO_SetBits(GPIOC,GPIO_Pin_8|GPIO_Pin_9);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>led.h<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _LED_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _LED_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f10x.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LED1_ON (GPIO_ResetBits(GPIOC,GPIO_Pin_8))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LED1_OFF (GPIO_SetBits(GPIOC,GPIO_Pin_8))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LED2_ON (GPIO_ResetBits(GPIOC,GPIO_Pin_9))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LED2_OFF (GPIO_SetBits(GPIOC,GPIO_Pin_9))</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LED_Config</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" ><summary> å»¶è¿Ÿ </summary>              <div class='content'>              <p>delay.c<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;sr04.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;motor.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay_nus_nop</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> time)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(time--)</span><br><span class="line">&#123;</span><br><span class="line">__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();</span><br><span class="line">__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();</span><br><span class="line">__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();</span><br><span class="line">__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();__NOP();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay_mus_nop</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> time)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(time--)</span><br><span class="line">&#123;</span><br><span class="line">Delay_nus_nop(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ»´ç­”å®šæ—¶å™¨åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">//äº§ç”Ÿ100usä¸­æ–­ -- ä¼˜å…ˆçº§æœ€ä½</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay_Config</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(SysTick_Config(<span class="number">4000</span>) == <span class="number">1</span>)<span class="comment">//å®šæ—¶å®Œæˆä¹‹åäº§ç”Ÿä¸­æ–­</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">uint32_t</span> timecount = <span class="number">0</span>;<span class="comment">//è®°å½•ç³»ç»Ÿè¿è¡Œæ—¶é•¿</span></span><br><span class="line">u32 timeled[<span class="number">2</span>]=&#123;<span class="number">0</span>,<span class="number">100</span>&#125;;<span class="comment">//å®šä¹‰ledä¸­æ–­æ—¶é—´</span></span><br><span class="line">u32 timeadc[<span class="number">2</span>]=&#123;<span class="number">0</span>,<span class="number">100</span>&#125;;<span class="comment">//å®šä¹‰adcä¸­æ–­æ—¶é—´</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ»´ç­”å®šæ—¶å™¨çš„ä¸­æ–­ 100usè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SysTick_Handler</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">timecount++;</span><br><span class="line">  timeled[<span class="number">0</span>]++;</span><br><span class="line">  timeadc[<span class="number">0</span>]++;</span><br><span class="line">  Sr04_RecvEcho();</span><br><span class="line">  Motor_Control();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>delay.h<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _DELAY_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _DELAY_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f10x.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay_nus_nop</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> time)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay_mus_nop</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> time)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">uint32_t</span> timeled[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">uint32_t</span> timekey[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">uint32_t</span> timedht11[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">extern</span> u32 timeled[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">extern</span> u32 timeadc[<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay_Config</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" green><summary> æŒ‰é”® </summary>              <div class='content'>              <p>key.c<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;key.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">KEY_Config</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//æ‰“å¼€æ—¶é’Ÿ GPIOC--APB2</span></span><br><span class="line">RCC_APB2PeriphResetCmd(RCC_APB2Periph_GPIOC,ENABLE);</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–GPIO</span></span><br><span class="line"> GPIO_InitTypeDef key=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="comment">//æµ®ç©ºè¾“å…¥</span></span><br><span class="line">key.GPIO_Mode=GPIO_Mode_IN_FLOATING;</span><br><span class="line">key.GPIO_Pin=GPIO_Pin_0|GPIO_Pin_1;</span><br><span class="line">GPIO_Init(GPIOC,&amp;key);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŒ‰é”®æ‰«æå‡½æ•°è¿”å›1ä»£è¡¨æŒ‰ä¸‹æŒ‰é”®1æŒ‰ä¸‹ï¼Œ2ä»£è¡¨æŒ‰é”®2æŒ‰ä¸‹</span></span><br><span class="line"><span class="function">u8 <span class="title">KEY_GetValue</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(KEY1==<span class="number">0</span>)</span><br><span class="line"> &#123;</span><br><span class="line">   Delay_mus_nop(<span class="number">5</span>);<span class="comment">//æ¶ˆæŠ–</span></span><br><span class="line"> <span class="keyword">while</span>(KEY1==<span class="number">0</span>)&#123;&#125;<span class="comment">//æ¾æ‰‹æ£€æµ‹</span></span><br><span class="line"> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">if</span>(KEY2==<span class="number">0</span>)</span><br><span class="line"> &#123;</span><br><span class="line">  Delay_mus_nop(<span class="number">5</span>);<span class="comment">//æ¶ˆæŠ–</span></span><br><span class="line"> <span class="keyword">while</span>(KEY2==<span class="number">0</span>)&#123;&#125;<span class="comment">//æ¾æ‰‹æ£€æµ‹</span></span><br><span class="line"> <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>key.h<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _KEY_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _KEY_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f10x.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KEY1 (GPIO_ReadInputDataBit(GPIOC,GPIO_Pin_0))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KEY2 (GPIO_ReadInputDataBit(GPIOC,GPIO_Pin_1))</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">KEY_Config</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function">u8 <span class="title">KEY_GetValue</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" yellow><summary> ADCæ¨¡å— </summary>              <div class='content'>              <p>adc.c<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;adc.h&quot;</span></span></span><br><span class="line"><span class="comment">// PA0</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ADC_Config</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//æ‰“å¼€æ—¶é’ŸGPIOA ADC1--APB2</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1,ENABLE);</span><br><span class="line">  <span class="comment">//åˆ†é¢‘</span></span><br><span class="line">RCC_ADCCLKConfig(RCC_PCLK2_Div4);</span><br><span class="line">  <span class="comment">//åˆå§‹åŒ–GPIO</span></span><br><span class="line">GPIO_InitTypeDef gpio_Struct=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">gpio_Struct.GPIO_Mode=GPIO_Mode_AIN;<span class="comment">//æ¨¡æ‹Ÿè¾“å…¥</span></span><br><span class="line">gpio_Struct.GPIO_Pin=GPIO_Pin_0;</span><br><span class="line">GPIO_Init (GPIOA, &amp;gpio_Struct) ;</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ADC</span></span><br><span class="line">ADC_InitTypeDef adc_Struct=&#123;<span class="number">0</span>&#125; ;</span><br><span class="line">adc_Struct.ADC_ContinuousConvMode=DISABLE;<span class="comment">//å•æ¬¡æ¨¡å¼</span></span><br><span class="line">adc_Struct.ADC_DataAlign=ADC_DataAlign_Right;<span class="comment">//æ•°æ®å³å¯¹é½</span></span><br><span class="line">adc_Struct.ADC_ExternalTrigConv=ADC_ExternalTrigInjecConv_None;<span class="comment">//æ— å¤–éƒ¨è§¦å‘</span></span><br><span class="line">adc_Struct.ADC_Mode=ADC_Mode_Independent;<span class="comment">//ç‹¬ç«‹æ¨¡å¼</span></span><br><span class="line">adc_Struct.ADC_NbrOfChannel=<span class="number">1</span>;<span class="comment">//é€šé“æ•°ç›®</span></span><br><span class="line">adc_Struct.ADC_ScanConvMode=DISABLE;<span class="comment">//å•é€šé“</span></span><br><span class="line">ADC_Init (ADC1,&amp;adc_Struct) ;</span><br><span class="line"><span class="comment">//ä½¿èƒ½</span></span><br><span class="line">ADC_Cmd(ADC1,ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è·å–ADCè½¬æ¢ç»“æœ</span></span><br><span class="line"><span class="function">u16 <span class="title">ADC_GetValue</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//é€‰æ‹©é€šé“ è½¬æ¢é¡ºåº é‡‡æ ·å‘¨æœŸ</span></span><br><span class="line">ADC_RegularChannelConfig (ADC1,ADC_Channel_1,<span class="number">1</span>,ADC_SampleTime_239Cycles5);</span><br><span class="line"> <span class="comment">//å¼€å¯è½¬æ¢</span></span><br><span class="line">ADC_SoftwareStartConvCmd(ADC1,ENABLE);</span><br><span class="line">  <span class="comment">//è·å–è½¬æ¢ç»“æœ</span></span><br><span class="line"><span class="keyword">while</span>(ADC_GetFlagStatus(ADC1,ADC_FLAG_EOC)==RESET)&#123;&#125;</span><br><span class="line"><span class="comment">//è·å–è½¬æ¢ç»“æœ</span></span><br><span class="line"><span class="keyword">return</span> ADC_GetConversionValue(ADC1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>adc.h<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _ADC_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _ADC_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f10x.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ADC_Config</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function">u16 <span class="title">ADC_GetValue</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" red><summary> ç”µæœºæ¨¡å— </summary>              <div class='content'>              <p>motor.câ€”-ä¹°çš„ç”µæœºè‡ªå¸¦<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;motor.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  é…ç½®ç”µæœºæ§åˆ¶å¼•è„šçš„åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">  * @param  æ— </span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="comment">//å››ä¸ªç”µæœºçš„GPIOå£åˆå§‹åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Motor_Config</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//å¼€æ—¶é’Ÿ</span></span><br><span class="line">RCC_APB2PeriphClockCmd(MOTOR_IA1_PeriphClock | MOTOR_IB1_PeriphClock |</span><br><span class="line"> MOTOR_IA2_PeriphClock | MOTOR_IB2_PeriphClock |</span><br><span class="line"> MOTOR_IA3_PeriphClock | MOTOR_IB3_PeriphClock |</span><br><span class="line"> MOTOR_IA4_PeriphClock | MOTOR_IB4_PeriphClock , ENABLE);<span class="comment">//æ‰“å¼€GPIOå¤–è®¾æ—¶é’Ÿ</span></span><br><span class="line"></span><br><span class="line">GPIO_InitTypeDef GPIO_InitStructure;<span class="comment">//å®šä¹‰å˜é‡</span></span><br><span class="line">GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;<span class="comment">//é€Ÿåº¦</span></span><br><span class="line">GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;<span class="comment">//é€šç”¨æ¨æŒ½è¾“å‡º</span></span><br><span class="line"></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = MOTOR_IA1_PIN;<span class="comment">//ç«¯å£ä½</span></span><br><span class="line">GPIO_Init(MOTOR_IA1_PORT, &amp;GPIO_InitStructure);  <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = MOTOR_IB1_PIN;<span class="comment">//ç«¯å£ä½</span></span><br><span class="line">GPIO_Init(MOTOR_IB1_PORT, &amp;GPIO_InitStructure);  <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = MOTOR_IA2_PIN;<span class="comment">//ç«¯å£ä½</span></span><br><span class="line">GPIO_Init(MOTOR_IA2_PORT, &amp;GPIO_InitStructure);  <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = MOTOR_IB2_PIN;<span class="comment">//ç«¯å£ä½</span></span><br><span class="line">GPIO_Init(MOTOR_IB2_PORT, &amp;GPIO_InitStructure);  <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = MOTOR_IA3_PIN;<span class="comment">//ç«¯å£ä½</span></span><br><span class="line">GPIO_Init(MOTOR_IA3_PORT, &amp;GPIO_InitStructure);  <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = MOTOR_IB3_PIN;<span class="comment">//ç«¯å£ä½</span></span><br><span class="line">GPIO_Init(MOTOR_IB3_PORT, &amp;GPIO_InitStructure);  <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = MOTOR_IA4_PIN;<span class="comment">//ç«¯å£ä½</span></span><br><span class="line">GPIO_Init(MOTOR_IA4_PORT, &amp;GPIO_InitStructure);  <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = MOTOR_IB4_PIN;<span class="comment">//ç«¯å£ä½</span></span><br><span class="line">GPIO_Init(MOTOR_IB4_PORT, &amp;GPIO_InitStructure);  <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">//å…ˆè®©ç”µæœºå¤„äºåœæ­¢</span></span><br><span class="line">Motor_IA1Control(<span class="number">0</span>);</span><br><span class="line">Motor_IB1Control(<span class="number">0</span>);</span><br><span class="line">Motor_IA2Control(<span class="number">0</span>);</span><br><span class="line">Motor_IB2Control(<span class="number">0</span>);</span><br><span class="line">Motor_IA3Control(<span class="number">0</span>);</span><br><span class="line">Motor_IB3Control(<span class="number">0</span>);</span><br><span class="line">Motor_IA4Control(<span class="number">0</span>);</span><br><span class="line">Motor_IB4Control(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @brief  1å·ç”µæœºçš„é€Ÿåº¦æ§åˆ¶å‡½æ•°</span></span><br><span class="line"><span class="comment">*åœ¨ä¸­æ–­å†…ï¼Œå‘¨æœŸæ€§çš„è°ƒç”¨</span></span><br><span class="line"><span class="comment">  * @param  speedï¼šé€Ÿåº¦,å¦‚æœæ˜¯æ­£æ•°ï¼Œç”µæœºæ­£è½¬ï¼Œè´Ÿæ•°ç”µæœºåè½¬ï¼Œ</span></span><br><span class="line"><span class="comment">*é€Ÿåº¦çš„ç»å¯¹å€¼ä¸èƒ½è¶…è¿‡MOTOR_MAX_SPEED</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Motor_No1_Control</span><span class="params">(<span class="keyword">int</span> speed)</span><span class="comment">//cntè®¡æ•°å€¼ï¼Œspeedæ¯”è¾ƒå€¼ï¼ŒMOTOR_MAX_SPEEDæœ€å¤§è®¡æ•°å€¼ï¼ˆå‘¨æœŸï¼‰</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(speed &gt; <span class="number">0</span>) &#123; <span class="comment">//ç”µæœºæ­£è½¬</span></span><br><span class="line">Motor_IB1Control(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(cnt &lt;= speed)Motor_IA1Control(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">else</span> Motor_IA1Control(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(speed &lt; <span class="number">0</span>)&#123;<span class="comment">//ç”µæœºåè½¬</span></span><br><span class="line">speed = -speed;</span><br><span class="line">Motor_IA1Control(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(cnt &lt;= speed)Motor_IB1Control(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">else</span> Motor_IB1Control(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;<span class="comment">//ç”µæœºåœæ­¢</span></span><br><span class="line">Motor_IA1Control(<span class="number">0</span>);</span><br><span class="line">Motor_IB1Control(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(cnt &lt; MOTOR_MAX_SPEED) cnt++;<span class="comment">//cnt 100usåŠ ä¸€æ¬¡</span></span><br><span class="line"><span class="keyword">else</span> cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @brief  2å·ç”µæœºçš„é€Ÿåº¦æ§åˆ¶å‡½æ•°</span></span><br><span class="line"><span class="comment">*åœ¨ä¸­æ–­å†…ï¼Œå‘¨æœŸæ€§çš„è°ƒç”¨</span></span><br><span class="line"><span class="comment">  * @param  speedï¼šé€Ÿåº¦,å¦‚æœæ˜¯æ­£æ•°ï¼Œç”µæœºæ­£è½¬ï¼Œè´Ÿæ•°ç”µæœºåè½¬ï¼Œ</span></span><br><span class="line"><span class="comment">*é€Ÿåº¦çš„ç»å¯¹å€¼ä¸èƒ½è¶…è¿‡MOTOR_MAX_SPEED</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Motor_No2_Control</span><span class="params">(<span class="keyword">int</span> speed)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(speed &gt; <span class="number">0</span>) &#123; <span class="comment">//ç”µæœºæ­£è½¬</span></span><br><span class="line">Motor_IB2Control(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(cnt &lt;= speed)Motor_IA2Control(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">else</span> Motor_IA2Control(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(speed &lt; <span class="number">0</span>)&#123;<span class="comment">//ç”µæœºåè½¬</span></span><br><span class="line">speed = -speed;</span><br><span class="line">Motor_IA2Control(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(cnt &lt;= speed)Motor_IB2Control(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">else</span> Motor_IB2Control(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;<span class="comment">//ç”µæœºåœæ­¢</span></span><br><span class="line">Motor_IA2Control(<span class="number">0</span>);</span><br><span class="line">Motor_IB2Control(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(cnt &lt; MOTOR_MAX_SPEED) cnt++;</span><br><span class="line"><span class="keyword">else</span> cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @brief  3å·ç”µæœºçš„é€Ÿåº¦æ§åˆ¶å‡½æ•°</span></span><br><span class="line"><span class="comment">*åœ¨ä¸­æ–­å†…ï¼Œå‘¨æœŸæ€§çš„è°ƒç”¨</span></span><br><span class="line"><span class="comment">  * @param  speedï¼šé€Ÿåº¦,å¦‚æœæ˜¯æ­£æ•°ï¼Œç”µæœºæ­£è½¬ï¼Œè´Ÿæ•°ç”µæœºåè½¬ï¼Œ</span></span><br><span class="line"><span class="comment">*é€Ÿåº¦çš„ç»å¯¹å€¼ä¸èƒ½è¶…è¿‡MOTOR_MAX_SPEED</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Motor_No3_Control</span><span class="params">(<span class="keyword">int</span> speed)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(speed &gt; <span class="number">0</span>) &#123; <span class="comment">//ç”µæœºæ­£è½¬</span></span><br><span class="line">Motor_IB3Control(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(cnt &lt;= speed)Motor_IA3Control(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">else</span> Motor_IA3Control(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(speed &lt; <span class="number">0</span>)&#123;<span class="comment">//ç”µæœºåè½¬</span></span><br><span class="line">speed = -speed;</span><br><span class="line">Motor_IA3Control(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(cnt &lt;= speed)Motor_IB3Control(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">else</span> Motor_IB3Control(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;<span class="comment">//ç”µæœºåœæ­¢</span></span><br><span class="line">Motor_IA3Control(<span class="number">0</span>);</span><br><span class="line">Motor_IB3Control(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(cnt &lt; MOTOR_MAX_SPEED) cnt++;</span><br><span class="line"><span class="keyword">else</span> cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @brief  4å·ç”µæœºçš„é€Ÿåº¦æ§åˆ¶å‡½æ•°</span></span><br><span class="line"><span class="comment">*åœ¨ä¸­æ–­å†…ï¼Œå‘¨æœŸæ€§çš„è°ƒç”¨</span></span><br><span class="line"><span class="comment">  * @param  speedï¼šé€Ÿåº¦,å¦‚æœæ˜¯æ­£æ•°ï¼Œç”µæœºæ­£è½¬ï¼Œè´Ÿæ•°ç”µæœºåè½¬ï¼Œ</span></span><br><span class="line"><span class="comment">*é€Ÿåº¦çš„ç»å¯¹å€¼ä¸èƒ½è¶…è¿‡MOTOR_MAX_SPEED</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Motor_No4_Control</span><span class="params">(<span class="keyword">int</span> speed)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(speed &gt; <span class="number">0</span>) &#123; <span class="comment">//ç”µæœºæ­£è½¬</span></span><br><span class="line">Motor_IB4Control(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(cnt &lt;= speed)Motor_IA4Control(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">else</span> Motor_IA4Control(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(speed &lt; <span class="number">0</span>)&#123;<span class="comment">//ç”µæœºåè½¬</span></span><br><span class="line">speed = -speed;</span><br><span class="line">Motor_IA4Control(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(cnt &lt;= speed)Motor_IB4Control(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">else</span> Motor_IB4Control(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;<span class="comment">//ç”µæœºåœæ­¢</span></span><br><span class="line">Motor_IA4Control(<span class="number">0</span>);</span><br><span class="line">Motor_IB4Control(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(cnt &lt; MOTOR_MAX_SPEED) cnt++;</span><br><span class="line"><span class="keyword">else</span> cnt = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__Motor_SpeedTypeDef motorSpeed = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @brief  4ä¸ªç”µæœºçš„æ•´ä½“æ§åˆ¶å‡½æ•°ï¼Œåœ¨ä¸­æ–­å†…ï¼Œå‘¨æœŸæ€§çš„è°ƒç”¨</span></span><br><span class="line"><span class="comment">  * @param  </span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Motor_Control</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Motor_No1_Control(motorSpeed.s1);</span><br><span class="line">Motor_No2_Control(motorSpeed.s2);</span><br><span class="line">Motor_No3_Control(motorSpeed.s3);</span><br><span class="line">Motor_No4_Control(motorSpeed.s4);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @brief  4ä¸ªç”µæœºçš„é€Ÿåº¦è®¾ç½®</span></span><br><span class="line"><span class="comment">  * @param  s1ã€s2ã€s3ã€s4åˆ†åˆ«æ˜¯è¦è®¾ç½®çš„å››ä¸ªç”µæœºçš„é€Ÿåº¦</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Motor_SetSpeed</span><span class="params">(<span class="keyword">int</span> s1, <span class="keyword">int</span> s2, <span class="keyword">int</span> s3, <span class="keyword">int</span> s4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">motorSpeed.s1 = s1;</span><br><span class="line">motorSpeed.s2 = s2;</span><br><span class="line">motorSpeed.s3 = s3;</span><br><span class="line">motorSpeed.s4 = s4;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" blue><summary> LCDæ˜¾ç¤ºå± </summary>              <div class='content'>              <p>lcd.hâ€”-è‡ªå¸¦<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __LCD_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __LCD_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f10x.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å»¶æ—¶åœ¨proteusä»¿çœŸä¸­å¿…é¡»ç”¨nopæ‰å‡†ç¡®</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> delay_ms(x)Delay_us(x*1000)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SPI_CTRL     GPIOB<span class="comment">//å®šä¹‰TFTæ•°æ®ç«¯å£</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SPI_SCLK        GPIO_Pin_13<span class="comment">//PB13---&gt;&gt;TFT --SCL/SCK</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SPI_MISO        GPIO_Pin_14</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SPI_MOSI        GPIO_Pin_15<span class="comment">//PB15 MOSI---&gt;&gt;TFT --SDA/DIN</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>SPI_MOSI_SET  SPI_CTRL-&gt;BSRR=SPI_MOSI    </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>SPI_SCLK_SET  SPI_CTRL-&gt;BSRR=SPI_SCLK    </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>SPI_MOSI_CLR  SPI_CTRL-&gt;BRR=SPI_MOSI    </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>SPI_SCLK_CLR  SPI_CTRL-&gt;BRR=SPI_SCLK </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_TYPE  GPIOB  <span class="comment">//GPIOç»„ç±»å‹</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_CS   11       <span class="comment">//ç‰‡é€‰å¼•è„š            PB11</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_RS   10       <span class="comment">//å¯„å­˜å™¨/æ•°æ®é€‰æ‹©å¼•è„š PB10 </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_RST  12       <span class="comment">//å¤ä½å¼•è„š            PB12</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>LCD_CS_SET  LCD_TYPE-&gt;BSRR=1&lt;&lt;LCD_CS    <span class="comment">//ç‰‡é€‰ç«¯å£  PB11</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>LCD_RS_SETLCD_TYPE-&gt;BSRR=1&lt;&lt;LCD_RS    <span class="comment">//æ•°æ®/å‘½ä»¤  PB10  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>LCD_RST_SETLCD_TYPE-&gt;BSRR=1&lt;&lt;LCD_RST   <span class="comment">//å¤ä½  PB12</span></span></span><br><span class="line">    </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>LCD_CS_CLR  LCD_TYPE-&gt;BRR=1&lt;&lt;LCD_CS     <span class="comment">//ç‰‡é€‰ç«¯å£  PB11</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>LCD_RS_CLRLCD_TYPE-&gt;BRR=1&lt;&lt;LCD_RS     <span class="comment">//æ•°æ®/å‘½ä»¤  PB10 </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>LCD_RST_CLRLCD_TYPE-&gt;BRR=1&lt;&lt;LCD_RST    <span class="comment">//å¤ä½  PB12</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_W 240</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_H 320</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> USE_HORIZONTAL   0<span class="comment">//å®šä¹‰æ¶²æ™¶å±é¡ºæ—¶é’ˆæ—‹è½¬æ–¹å‘ 0-0åº¦æ—‹è½¬ï¼Œ1-90åº¦æ—‹è½¬ï¼Œ2-180åº¦æ—‹è½¬ï¼Œ3-270åº¦æ—‹è½¬</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> u16 POINT_COLOR;</span><br><span class="line"></span><br><span class="line"><span class="comment">//LCDé‡è¦å‚æ•°é›†</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>  </span></span><br><span class="line"><span class="class">&#123;</span>    </span><br><span class="line">u16 width;<span class="comment">//LCD å®½åº¦</span></span><br><span class="line">u16 height;<span class="comment">//LCD é«˜åº¦</span></span><br><span class="line">u16 id;  <span class="comment">//LCD ID</span></span><br><span class="line">u8  dir;  <span class="comment">//æ¨ªå±è¿˜æ˜¯ç«–å±æ§åˆ¶ï¼š0ï¼Œç«–å±ï¼›1ï¼Œæ¨ªå±ã€‚</span></span><br><span class="line">u16 wramcmd;<span class="comment">//å¼€å§‹å†™gramæŒ‡ä»¤</span></span><br><span class="line">u16  setxcmd;<span class="comment">//è®¾ç½®xåæ ‡æŒ‡ä»¤</span></span><br><span class="line">u16  setycmd;<span class="comment">//è®¾ç½®yåæ ‡æŒ‡ä»¤ </span></span><br><span class="line">&#125;_lcd_dev; </span><br><span class="line"></span><br><span class="line"><span class="comment">//LCDå‚æ•°</span></span><br><span class="line"><span class="keyword">extern</span> _lcd_dev lcddev;<span class="comment">//ç®¡ç†LCDé‡è¦å‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”»ç¬”é¢œè‰²</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UNKNOWBLUE0x2D7D<span class="comment">//è‡ªå·±æ·»åŠ çš„ä¸€ç§è“è‰²</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WHITE       0xFFFF</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLACK      0x0000  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLUE       0x001F  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BRED        0XF81F</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GRED  0XFFE0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GBLUE 0X07FF</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RED         0xF800</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAGENTA     0xF81F</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GREEN       0x07E0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CYAN        0x7FFF</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> YELLOW      0xFFE0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BROWN 0XBC40 <span class="comment">//æ£•è‰²</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BRRED 0XFC07 <span class="comment">//æ£•çº¢è‰²</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GRAY  0X8430 <span class="comment">//ç°è‰²</span></span></span><br><span class="line"><span class="comment">//GUIé¢œè‰²</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DARKBLUE       0X01CF<span class="comment">//æ·±è“è‰²</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LIGHTBLUE       0X7D7C<span class="comment">//æµ…è“è‰²  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GRAYBLUE        0X5458 <span class="comment">//ç°è“è‰²</span></span></span><br><span class="line"><span class="comment">//ä»¥ä¸Šä¸‰è‰²ä¸ºPANELçš„é¢œè‰² </span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LIGHTGREEN     0X841F <span class="comment">//æµ…ç»¿è‰²</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LIGHTGRAY     0XEF5B <span class="comment">//æµ…ç°è‰²(PANNEL)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LGRAY  0XC618 <span class="comment">//æµ…ç°è‰²(PANNEL),çª—ä½“èƒŒæ™¯è‰²</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LGRAYBLUE      0XA651 <span class="comment">//æµ…ç°è“è‰²(ä¸­é—´å±‚é¢œè‰²)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LBBLUE          0X2B12 <span class="comment">//æµ…æ£•è“è‰²(é€‰æ‹©æ¡ç›®çš„åè‰²)</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SPIv_WriteData</span><span class="params">(u8 Data)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_Init</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_DisplayOn</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_DisplayOff</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_Clear</span><span class="params">(u16 Color)</span></span>; <span class="comment">//æ¸…å±</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_SetCursor</span><span class="params">(u16 Xpos, u16 Ypos)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_DrawPoint</span><span class="params">(u16 x,u16 y)</span></span>;<span class="comment">//ç”»ç‚¹</span></span><br><span class="line"><span class="function">u16  <span class="title">LCD_ReadPoint</span><span class="params">(u16 x,u16 y)</span></span>; <span class="comment">//è¯»ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_DrawLine</span><span class="params">(u16 x1, u16 y1, u16 x2, u16 y2,u16 color)</span></span>;   </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_SetWindows</span><span class="params">(u16 xStar, u16 yStar,u16 xEnd,u16 yEnd)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">u16 <span class="title">LCD_RD_DATA</span><span class="params">(<span class="keyword">void</span>)</span></span>;<span class="comment">//è¯»å–LCDæ•°æ®    </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_WriteReg</span><span class="params">(u8 LCD_Reg, u16 LCD_RegValue)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_WR_DATA</span><span class="params">(u8 data)</span></span>;</span><br><span class="line"><span class="function">u16 <span class="title">LCD_ReadReg</span><span class="params">(u8 LCD_Reg)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_WriteRAM_Prepare</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_WriteRAM</span><span class="params">(u16 RGB_Code)</span></span>;</span><br><span class="line"><span class="function">u16 <span class="title">LCD_ReadRAM</span><span class="params">(<span class="keyword">void</span>)</span></span>;   </span><br><span class="line"><span class="function">u16 <span class="title">LCD_BGR2RGB</span><span class="params">(u16 c)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_SetParam</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Lcd_WriteData_16Bit</span><span class="params">(u16 Data)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_direction</span><span class="params">(u8 direction )</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GUI_DrawPoint</span><span class="params">(u16 x,u16 y,u16 color)</span></span>;<span class="comment">//ç”»ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_Fill</span><span class="params">(u16 sx,u16 sy,u16 ex,u16 ey,u16 color)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_DrawLine</span><span class="params">(u16 x1, u16 y1, u16 x2, u16 y2,u16 color)</span></span>;<span class="comment">//ç”»çº¿</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_DrawRectangle</span><span class="params">(u16 x1, u16 y1, u16 x2, u16 y2,u16 color)</span></span>;<span class="comment">//ç”»çŸ©å½¢</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Draw_Triangel</span><span class="params">(u16 x0,u16 y0,u16 x1,u16 y1,u16 x2,u16 y2,u16 color)</span></span>;<span class="comment">//ç”»ä¸‰è§’</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Fill_Triangel</span><span class="params">(u16 x0,u16 y0,u16 x1,u16 y1,u16 x2,u16 y2)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowChar</span><span class="params">(u16 x,u16 y,u16 fc, u16 bc, u8 num,u8 size,u8 mode)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowNum</span><span class="params">(u16 x,u16 y,u32 num,u8 len,u8 size)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_Show2Num</span><span class="params">(u16 x,u16 y,u16 num,u8 len,u8 size,u8 mode)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowString</span><span class="params">(u16 x,u16 y,u8 size,u8 *p,u8 mode)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GUI_DrawFont16</span><span class="params">(u16 x, u16 y, u16 fc, u16 bc, u8 *s,u8 mode)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GUI_DrawFont24</span><span class="params">(u16 x, u16 y, u16 fc, u16 bc, u8 *s,u8 mode)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GUI_DrawFont32</span><span class="params">(u16 x, u16 y, u16 fc, u16 bc, u8 *s,u8 mode)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Show_Str</span><span class="params">(u16 x, u16 y, u16 fc, u16 bc, u8 *str,u8 size,u8 mode)</span></span>;<span class="comment">//æ˜¾ç¤ºæ±‰å­—</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gui_circle</span><span class="params">(<span class="keyword">int</span> xc, <span class="keyword">int</span> yc,u16 c,<span class="keyword">int</span> r, <span class="keyword">int</span> fill)</span></span>;<span class="comment">//ç”»åœ†</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Gui_StrCenter</span><span class="params">(u16 x, u16 y, u16 fc, u16 bc, u8 *str,u8 size,u8 mode)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_DrawFillRectangle</span><span class="params">(u16 x1, u16 y1, u16 x2, u16 y2)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Paint_Bmp</span><span class="params">(<span class="keyword">int</span> x0,<span class="keyword">int</span> y0,<span class="keyword">int</span> width,<span class="keyword">int</span> high,<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> bmp[])</span></span>;<span class="comment">//æ˜¾ç¤ºå›¾ç‰‡å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" ><summary> ä¸²å£é…ç½® </summary>              <div class='content'>              <p>usart.c<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;usart.h&quot;</span></span></span><br><span class="line"><span class="comment">//PA9å‘é€ PA10æ¥æ”¶</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Usart_Config</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//æ‰“å¼€æ—¶é’ŸGPIO USART1--APB2</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA|RCC_APB2Periph_USART1,ENABLE);</span><br><span class="line">  <span class="comment">//åˆå§‹åŒ–GPIO</span></span><br><span class="line">GPIO_InitTypeDef gpio_InStruct=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">gpio_InStruct.GPIO_Mode=GPIO_Mode_AF_PP;<span class="comment">//TX_å¤ç”¨æ¨æŒ½è¾“å‡º</span></span><br><span class="line">gpio_InStruct.GPIO_Pin=GPIO_Pin_9 ;</span><br><span class="line">gpio_InStruct.GPIO_Speed=GPIO_Speed_50MHz;</span><br><span class="line">GPIO_Init (GPIOA, &amp;gpio_InStruct) ;</span><br><span class="line"></span><br><span class="line">gpio_InStruct.GPIO_Mode=GPIO_Mode_IN_FLOATING;<span class="comment">//Rx_æµ®ç©ºè¾“å…¥</span></span><br><span class="line">gpio_InStruct.GPIO_Pin=GPIO_Pin_10;</span><br><span class="line">GPIO_Init(GPIOA, &amp;gpio_InStruct) ;</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ä¸²å£</span></span><br><span class="line">USART_InitTypeDef usart_InStruct=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">usart_InStruct.USART_BaudRate=<span class="number">57600</span>;<span class="comment">//æ³¢ç‰¹ç‡</span></span><br><span class="line">usart_InStruct.USART_HardwareFlowControl=USART_HardwareFlowControl_None;<span class="comment">//æ— ç¡¬ä»¶æ§åˆ¶æµ</span></span><br><span class="line">usart_InStruct.USART_Mode=USART_Mode_Rx|USART_Mode_Tx;<span class="comment">//æ¨¡å¼ä¸€å‘é€å’Œæ¥æ”¶</span></span><br><span class="line">usart_InStruct.USART_Parity=USART_Parity_No;<span class="comment">//æ— å¥‡å¶æ ¡éªŒ</span></span><br><span class="line">usart_InStruct.USART_StopBits=USART_StopBits_1;<span class="comment">//1ä½åœæ­¢ä½</span></span><br><span class="line">usart_InStruct.USART_WordLength=USART_WordLength_8b;<span class="comment">//8ä½åœæ­¢ä½</span></span><br><span class="line">USART_Init (USART1,&amp;usart_InStruct) ;</span><br><span class="line"><span class="comment">//ä½¿èƒ½ä¸²å£</span></span><br><span class="line">USART_Cmd(USART1,ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘é€å•å­—èŠ‚å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Usart_SendData</span><span class="params">(u8 data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(USART_GetFlagStatus(USART1,USART_FLAG_TC)==RESET)&#123;&#125;<span class="comment">//åˆ¤æ–­ä¸Šä¸€æ¬¡æ˜¯å¦å‘é€å®Œæˆ</span></span><br><span class="line">  USART_SendData (USART1,data);</span><br><span class="line">&#125;</span><br><span class="line">  <span class="comment">//æ¥æ”¶å‡½æ•°</span></span><br><span class="line"><span class="function">u8 <span class="title">Usart_ReceiveData</span><span class="params">()</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line"><span class="keyword">while</span>(USART_GetFlagStatus(USART1,USART_FLAG_RXNE)==RESET)&#123;&#125;<span class="comment">//åˆ¤æ–­ä¸Šä¸€æ¬¡æ˜¯å¦å‘é€å®Œæˆ</span></span><br><span class="line">  USART_ReceiveData(USART1);</span><br><span class="line">&#125;</span><br><span class="line">  <span class="comment">// printfé‡å®šå‘</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fputc</span> <span class="params">(<span class="keyword">int</span> c,FILE*Stream)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Usart_SendData(c) ;</span><br><span class="line"><span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>usart.h<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _USART_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _USART_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f10x.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Usart_Config</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Usart_SendData</span><span class="params">(u8 data)</span></span>;</span><br><span class="line"><span class="function">u8 <span class="title">Usart_ReceiveData</span><span class="params">()</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" ><summary> æµ‹è·ä¼ æ„Ÿå™¨ </summary>              <div class='content'>              <p>sr04.câ€”è‡ªå¸¦<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;sr04.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–GPIO </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Sr04_Config</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">GPIO_InitTypeDef GPIO_InitStruct;</span><br><span class="line"><span class="comment">//å¼€æ—¶é’Ÿ</span></span><br><span class="line">RCC_APB2PeriphClockCmd(SR04_TR_PeriphClock|SR04_ECHO_PeriphClock,ENABLE);</span><br><span class="line"><span class="comment">//é…ç½®TR</span></span><br><span class="line">GPIO_InitStruct.GPIO_Mode = GPIO_Mode_Out_PP;<span class="comment">//æ¨æŒ½è¾“å‡º</span></span><br><span class="line">GPIO_InitStruct.GPIO_Pin = SR04_TR_PIN;</span><br><span class="line">GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–GPIO</span></span><br><span class="line">GPIO_Init(SR04_TR_PORT, &amp;GPIO_InitStruct);</span><br><span class="line"><span class="comment">//é…ç½®ECHO</span></span><br><span class="line">GPIO_InitStruct.GPIO_Mode = GPIO_Mode_IN_FLOATING;<span class="comment">//æµ®ç©ºè¾“å…¥</span></span><br><span class="line">GPIO_InitStruct.GPIO_Pin = SR04_ECHO_PIN;</span><br><span class="line">GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–GPIO</span></span><br><span class="line">GPIO_Init(SR04_ECHO_PORT, &amp;GPIO_InitStruct);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TRå¼•è„šå‘é€10usè„‰å†²</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Sr04_SendTTL</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">GPIO_SetBits(SR04_TR_PORT,SR04_TR_PIN);<span class="comment">//æ‹‰é«˜</span></span><br><span class="line">Delay_nus_nop(<span class="number">10</span>);</span><br><span class="line"><span class="comment">//Delay_us(10);</span></span><br><span class="line">GPIO_ResetBits(SR04_TR_PORT,SR04_TR_PIN);<span class="comment">//æ‹‰ä½</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint32_t</span> echocount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">uint32_t</span> sr04length = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ECHOå¼•è„šæ£€æµ‹å’Œè®¡æ•°</span></span><br><span class="line"><span class="comment">//æœ€å¥½æ˜¯1usæ£€æµ‹ä¸€æ¬¡ï¼Œä½†æ˜¯ä»¿çœŸä¸­ä¼šå¡æ­»</span></span><br><span class="line"><span class="comment">//å› æ­¤æˆ‘ä»¬æ”¾åˆ°1msè¿›å…¥ä¸€æ¬¡çš„ç³»ç»Ÿæ»´ç­”å®šæ—¶å™¨çš„ä¸­æ–­æœåŠ¡å‡½æ•°å†…è®¡æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Sr04_RecvEcho</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(GPIO_ReadInputDataBit(SR04_ECHO_PORT,SR04_ECHO_PIN) == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">echocount++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(GPIO_ReadInputDataBit(SR04_ECHO_PORT,SR04_ECHO_PIN) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(echocount &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">sr04length = echocount;</span><br><span class="line">&#125;</span><br><span class="line">echocount = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">//è·ç¦»=sr04length*340m/s /2  sr04length(å•ä½ç™¾us)  è·ç¦»cmä¸ºå•ä½</span></span><br><span class="line"> <span class="comment">//è·ç¦»=sr04length*34m/s /2  </span></span><br><span class="line"><span class="comment">//è·ç¦»=sr04length*17m/s /2  </span></span><br><span class="line"><span class="comment">//è·ç¦»=sr04length*340m/s /2  </span></span><br><span class="line"><span class="comment">//è®¡ç®—è·ç¦»</span></span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">Sr04_GetLength</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">sr04length = (<span class="keyword">uint32_t</span>)(sr04length*<span class="number">1.7</span>);</span><br><span class="line"><span class="keyword">return</span> sr04length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>scr04.h<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span>__SR04_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __SR04_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f10x.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//TR:PC5ECHO:PC6</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SR04_TR_PeriphClockRCC_APB2Periph_GPIOC</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SR04_TR_PORTGPIOC</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SR04_TR_PINGPIO_Pin_5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SR04_ECHO_PeriphClockRCC_APB2Periph_GPIOC</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SR04_ECHO_PORTGPIOC</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SR04_ECHO_PINGPIO_Pin_6</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Sr04_Config</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Sr04_SendTTL</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Sr04_RecvEcho</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">Sr04_GetLength</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>              </div>            </details><details class="folding-tag" ><summary> mianå‡½æ•° </summary>              <div class='content'>              <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f10x.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;led.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;key.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;usart.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;lcd.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;adc.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;motor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;sr04.h&quot;</span></span></span><br><span class="line"><span class="comment">//extern const unsigned char gImage_pic[9800];</span></span><br><span class="line"><span class="comment">//extern const unsigned char gImage_1[5000];</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> gImage_2[<span class="number">1250</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> gImage_3[<span class="number">1250</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> gImage_4[<span class="number">1250</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> gImage_5[<span class="number">1250</span>];</span><br><span class="line">u32 safelen=<span class="number">30</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  u8 key=<span class="number">0</span>;</span><br><span class="line">  u8 flag=<span class="number">0</span>;</span><br><span class="line">  u8 power=<span class="number">0</span>;</span><br><span class="line">  u32 len=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">char</span> buff[<span class="number">20</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">char</span> buff1[<span class="number">20</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">char</span> buff2[<span class="number">20</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);<span class="comment">//å å…ˆ2ä½+æ¬¡çº§2ä½</span></span><br><span class="line"></span><br><span class="line">LED_Config();<span class="comment">//LEDåˆå§‹åŒ–</span></span><br><span class="line">  KEY_Config();<span class="comment">//æŒ‰é”®åˆå§‹åŒ–</span></span><br><span class="line">  Usart_Config();<span class="comment">//ä¸²å£åˆå§‹åŒ–</span></span><br><span class="line">  Motor_Config();<span class="comment">//ç”µæœºåˆå§‹åŒ–</span></span><br><span class="line">  Sr04_Config();<span class="comment">//sro4é¿éšœä¼ æ„Ÿå™¨åˆå§‹åŒ–</span></span><br><span class="line">  Delay_Config();<span class="comment">//æ»´ç­”å®šæ—¶å™¨åˆå§‹åŒ–</span></span><br><span class="line">  ADC_Config();<span class="comment">//ADCåˆå§‹åŒ–</span></span><br><span class="line">  LCD_Init();<span class="comment">//LCDå±åˆå§‹åŒ–ï¼Œé©±åŠ¨å¸¦çš„</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;ææ™“\r\n&quot;</span>);</span><br><span class="line">  LED1_OFF;</span><br><span class="line">  LED2_ON;</span><br><span class="line"><span class="comment">//  gui_circle(80,80,BLUE,30,0);//ç”»åœ†</span></span><br><span class="line"><span class="comment">//  GUI_DrawPoint(80,80,RED);//ç”»ç‚¹</span></span><br><span class="line">  <span class="comment">//LCD_ShowString(80,10,16,(u8*)&quot;hello&quot;,0);//æ˜¾ç¤ºå­—æ¯æˆ–æ•°å­—</span></span><br><span class="line"><span class="comment">//  Show_Str(80,10,BLUE,WHITE,(u8*)&quot;ææ™“&quot;,16,0);//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line"><span class="comment">//  Paint_Bmp(0,0,70,70,gImage_pic);//æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class="line">  <span class="comment">// LCD_Clear(u16 Color); //æ¸…å±</span></span><br><span class="line">  <span class="comment">//ç¬¬ä¸€å¼ é¡µé¢</span></span><br><span class="line">  Show_Str(<span class="number">73</span>,<span class="number">87</span>,BLUE,WHITE,(u8*)<span class="string">&quot;ç³»ç»Ÿå·²å¯åŠ¨&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line">  Show_Str(<span class="number">41</span>,<span class="number">139</span>,BLUE,WHITE,(u8*)<span class="string">&quot;æ­£åœ¨ä¸ºæ‚¨å±•ç¤ºæœ¬æ¬¡é¡¹ç›®&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line">    Show_Str(<span class="number">81</span>,<span class="number">191</span>,BLUE,WHITE,(u8*)<span class="string">&quot;.......&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—) </span></span><br><span class="line"> LCD_Clear(BLACK); <span class="comment">//æ¸…å±</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ç¬¬äºŒå¼ é¡µé¢æˆå‘˜</span></span><br><span class="line">   Show_Str(<span class="number">76</span>,<span class="number">51</span>,BLUE,BLACK,(u8*)<span class="string">&quot;å°ç»„æˆå‘˜&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line">   Show_Str(<span class="number">85</span>,<span class="number">85</span>,BLUE,BLACK,(u8*)<span class="string">&quot;ææ™“&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line">   Show_Str(<span class="number">85</span>,<span class="number">120</span>,BLUE,BLACK,(u8*)<span class="string">&quot;æä¸œæ—&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line">   Show_Str(<span class="number">85</span>,<span class="number">153</span>,BLUE,BLACK,(u8*)<span class="string">&quot;å¼ é¾™å¼º&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line">   Show_Str(<span class="number">85</span>,<span class="number">188</span>,BLUE,BLACK,(u8*)<span class="string">&quot;èµµé¾™å…ƒ&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line">   Show_Str(<span class="number">85</span>,<span class="number">219</span>,BLUE,BLACK,(u8*)<span class="string">&quot;æ¨å¿—ä¼Ÿ&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line">   Show_Str(<span class="number">85</span>,<span class="number">250</span>,BLUE,BLACK,(u8*)<span class="string">&quot;è”¡å½¬æº&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line">   LCD_Clear(BLACK); <span class="comment">//æ¸…å±</span></span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123; <span class="comment">//LED1é—ªçƒ</span></span><br><span class="line">    <span class="keyword">if</span>(timeled[<span class="number">0</span>]&gt;timeled[<span class="number">1</span>])</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span>(flag==<span class="number">0</span>)</span><br><span class="line">        LED1_ON;</span><br><span class="line">      <span class="keyword">if</span>(flag==<span class="number">1</span>)</span><br><span class="line">        LED1_OFF;</span><br><span class="line">      flag=!flag;</span><br><span class="line">      timeled[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">       </span><br><span class="line">     Show_Str(<span class="number">56</span>,<span class="number">37</span>,BLUE,BLACK,(u8*)<span class="string">&quot;é¿éšœé¡¹ç›®æ¼”ç¤º&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)   </span></span><br><span class="line">    <span class="comment">//æ˜¾ç¤ºç”µé‡</span></span><br><span class="line">    <span class="keyword">if</span>(timeadc[<span class="number">0</span>]&gt;timeadc[<span class="number">1</span>])</span><br><span class="line">    &#123;</span><br><span class="line">     power=ADC_GetValue();</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;ç”µé‡:%d\r\n&quot;</span>,power);</span><br><span class="line">      <span class="built_in">sprintf</span>(buff,<span class="string">&quot;å½“å‰ç”µé‡:\%d\r\n&quot;</span>,power);</span><br><span class="line">      Paint_Bmp(<span class="number">76</span>,<span class="number">82</span>,<span class="number">25</span>,<span class="number">25</span>,gImage_2);<span class="comment">//æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class="line">      Show_Str(<span class="number">101</span>,<span class="number">82</span>,BLUE,BLACK,(u8*)buff,<span class="number">16</span>,<span class="number">0</span>);</span><br><span class="line">      </span><br><span class="line">      timeadc[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ˜¾ç¤ºè‡ªåŠ¨é¿éšœå’Œè·ç¦»</span></span><br><span class="line"><span class="comment">//      Show_Str(120,240,BLUE,WHITE,(u8*)&quot;è‡ªåŠ¨é¿éšœ&quot;,16,0);//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)     </span></span><br><span class="line">    len=Sr04_GetLength();</span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">&quot;è·ç¦»:%d\r\n&quot;</span>,len);</span><br><span class="line">    Paint_Bmp(<span class="number">76</span>,<span class="number">115</span>,<span class="number">25</span>,<span class="number">25</span>,gImage_3);<span class="comment">//æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class="line">    <span class="built_in">sprintf</span>(buff1,<span class="string">&quot;å½“å‰è·ç¦»:%d &quot;</span>,len);</span><br><span class="line">    <span class="built_in">sprintf</span>(buff2,<span class="string">&quot;å®‰å…¨è·ç¦»ä¸º:%d&quot;</span>,safelen);</span><br><span class="line">    Show_Str(<span class="number">101</span>,<span class="number">115</span>,BLUE,BLACK,(u8*)buff1,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line">  Paint_Bmp(<span class="number">76</span>,<span class="number">152</span>,<span class="number">25</span>,<span class="number">25</span>,gImage_4);<span class="comment">//æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class="line">    Show_Str(<span class="number">101</span>,<span class="number">152</span>,BLUE,BLACK,(u8*)buff2,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line">    Paint_Bmp(<span class="number">76</span>,<span class="number">188</span>,<span class="number">25</span>,<span class="number">25</span>,gImage_5);<span class="comment">//æ˜¾ç¤ºå›¾ç‰‡ </span></span><br><span class="line">    <span class="keyword">if</span>(len&gt;safelen)</span><br><span class="line">      &#123;  </span><br><span class="line">        Show_Str(<span class="number">101</span>,<span class="number">188</span>,BLUE,BLACK,(u8*)<span class="string">&quot;å½“å‰çŠ¶æ€:å®‰å…¨&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)</span></span><br><span class="line">       Motor_SetSpeed(<span class="number">90</span>,<span class="number">90</span>,<span class="number">90</span>,<span class="number">90</span>);<span class="comment">//ç›´è¡Œ      </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123; </span><br><span class="line">      Show_Str(<span class="number">101</span>,<span class="number">188</span>,BLUE,BLACK,(u8*)<span class="string">&quot;å½“å‰çŠ¶æ€:è¿‡è¿‘&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—) </span></span><br><span class="line">       Motor_SetSpeed(<span class="number">-50</span>,<span class="number">-50</span>,<span class="number">50</span>,<span class="number">50</span>);      <span class="comment">//å³è½¬</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Show_Str(<span class="number">44</span>,<span class="number">239</span>,BLUE,BLACK,(u8*)<span class="string">&quot;é¿éšœç³»ç»Ÿæ­£å¸¸è¿è¡Œ&quot;</span>,<span class="number">16</span>,<span class="number">0</span>);<span class="comment">//æ˜¾ç¤ºæ±‰å­—(åŒ…æ‹¬å­—æ¯æ•°å­—)   </span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æŒ‰é”®æ§åˆ¶LED2æ‰“å¼€å…³é—­</span></span><br><span class="line">    key=KEY_GetValue(); </span><br><span class="line"><span class="keyword">if</span>(key==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">LED2_ON;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(key==<span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">LED2_OFF;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-3"><!-- ä¸‹é¢å†™ç¬¬ä¸‰ä¸ªåˆ†æ å†…å®¹ --><!-- <div class="img-wrap"><div class="img-bg"><img class="img" src="https://s1.vika.cn/space/2023/01/07/597f427dc7794c5ab9228b1e3e5919f0"/></div></div> --><div class="img-wrap"><div class="img-bg"><img class="img" src="/media/STM32é¿éšœå°è½¦01.webp"/></div></div><!-- <div class="img-wrap"><div class="img-bg"><img class="img" src="https://s1.vika.cn/space/2023/01/07/9886653bb16d4e16a4895c25a3a1918b"/></div></div> --><div class="img-wrap"><div class="img-bg"><img class="img" src="/media/STM32é¿éšœå°è½¦02.webp"/></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-4"><!-- ä¸‹é¢å†™ç¬¬å››ä¸ªåˆ†æ å†…å®¹ --><div class="btns rounded grid5">            <a class="button" href='https://pan.baidu.com/s/18dNE-XFxX6o1eNT0mdANtQ?pwd=8p4d' title='ä»£ç è½¯ä»¶ä¸‹è½½'><i class='fas fa-download'></i>ä»£ç è½¯ä»¶ä¸‹è½½</a>          </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> å®è®­ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ–°markdownè¯­æ³•</title>
      <link href="blog/%E6%96%B0markdown%E8%AF%AD%E6%B3%95/"/>
      <url>blog/%E6%96%B0markdown%E8%AF%AD%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="site-card-group"><a class="site-card" href="https://akilar.top/posts/615e2dec/"><div class="img"><img src="https://i.loli.net/2020/08/21/VuSwWZ1xAeUHEBC.jpg"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png"/><span class="title">akilar</span><span class="desc">å‚è€ƒåšå®¢</span></div></a><a class="site-card" href="https://www.fomal.cc/posts/2013454d.html"><div class="img"><img src="https://i.loli.net/2020/08/21/Vzbu3i8fXs6Nh5Y.jpg"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/inkss/common@master/static/web/avatar.jpg"/><span class="title">fomal</span><span class="desc">å‚è€ƒåšå®¢</span></div></a></div><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test4 %&#125;</span><br><span class="line">&lt;!-- ä¸‹é¢å†™ç¬¬ä¸€ä¸ªåˆ†æ å†…å®¹ --&gt;</span><br><span class="line">&lt;!-- tab åŸºæœ¬è¯­æ³• --&gt;</span><br><span class="line">&#123;% folding green, å¸®åŠ© %&#125;</span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&lt;!-- ä¸‹é¢å†™ç¬¬äºŒä¸ªåˆ†æ å†…å®¹ --&gt;</span><br><span class="line">&lt;!-- tab è¿›é˜¶ä½¿ç”¨ --&gt;</span><br><span class="line">&#123;% folding green, å¸®åŠ© %&#125;</span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&lt;!-- tab å¸¸ç”¨å‡½æ•° --&gt;</span><br><span class="line">&#123;% folding green, å¸®åŠ© %&#125;</span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vrepå°è½¦</title>
      <link href="blog/vrep%E5%B0%8F%E8%BD%A6/"/>
      <url>blog/vrep%E5%B0%8F%E8%BD%A6/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å»ºç«‹è½¦çš„æœ¬ä½“"><a href="#å»ºç«‹è½¦çš„æœ¬ä½“" class="headerlink" title="å»ºç«‹è½¦çš„æœ¬ä½“"></a>å»ºç«‹è½¦çš„æœ¬ä½“</h1><p> 1 ç‚¹å‡» add -&gt;primitive shape-&gt;cuboidï¼ˆé•¿æ–¹ä½“ï¼‰<br> 2 è®¾ç½®é•¿å®½é«˜0.2ï¼Œ0.3ï¼Œ0.1ï¼ˆx-0.2,y-0.3,z-0.1ï¼‰<br> 3 æœ¬ä½“ä¸Šå‡0.1ï¼š<br><img src="https://s1.ax1x.com/2022/07/27/vSLEPU.png" alt=""><br>translation-&gt;z:0.1</p><h2 id="å»ºç«‹è½¦è½®1"><a href="#å»ºç«‹è½¦è½®1" class="headerlink" title="å»ºç«‹è½¦è½®1"></a>å»ºç«‹è½¦è½®1</h2><p> 1 ç‚¹å‡» add -&gt;primitive shape-&gt;cylinderï¼ˆåœ†æŸ±ï¼‰<br> 2 è®¾ç½®ç›´å¾„0.05ï¼Œé«˜åº¦0.05ï¼ˆx-0.05,z-0.05ï¼‰<br> 3 è½¦è½®è½¬æ­£ï¼šç›¸å¯¹äºä¸–ç•Œxè½¬90åº¦<br><img src="https://s1.ax1x.com/2022/07/27/vSOmY8.png" alt=""><br>rotation-&gt;x-&gt;90<br> 4 å°†è½¦è½®ç§»åˆ°æ­£ç¡®ä½ç½®ï¼šç›¸å¯¹äºä¸–ç•Œåæ ‡(x-0.13,y-0.1)<br><img src="https://s1.ax1x.com/2022/07/27/vSLEPU.png" alt=""><br>position-&gt;</p><h2 id="ä½¿è½¬åŠ¨å…³èŠ‚1å’Œè½¦è½®1ä½ç½®é‡å "><a href="#ä½¿è½¬åŠ¨å…³èŠ‚1å’Œè½¦è½®1ä½ç½®é‡å " class="headerlink" title="ä½¿è½¬åŠ¨å…³èŠ‚1å’Œè½¦è½®1ä½ç½®é‡å "></a>ä½¿è½¬åŠ¨å…³èŠ‚1å’Œè½¦è½®1ä½ç½®é‡å </h2><p> 1 æŒ‰ä½shift é€‰ä¸­å…³èŠ‚1å’Œè½¦è½®1<br> 2 position-&gt;åº”ç”¨<br><img src="https://s1.ax1x.com/2022/07/27/vSLEPU.png" alt=""><br>position-&gt;</p><h2 id="ä¿®æ”¹è½®å­é€æ˜åº¦"><a href="#ä¿®æ”¹è½®å­é€æ˜åº¦" class="headerlink" title="ä¿®æ”¹è½®å­é€æ˜åº¦"></a>ä¿®æ”¹è½®å­é€æ˜åº¦</h2><p> 1 é€‰ä¸­è½®å­ï¼Œç‚¹å‡»å·¦è¾¹æ ä¸­çš„æœç´¢æ ‡å¿—ï¼Œç‚¹å‡»adjust color-&gt;opacity(é€æ˜åº¦)é€‰ä¸­è®¾ç½®0.5</p><h2 id="æ—‹è½¬è½¬åŠ¨å…³èŠ‚åˆ°æ­£ç¡®ä½ç½®"><a href="#æ—‹è½¬è½¬åŠ¨å…³èŠ‚åˆ°æ­£ç¡®ä½ç½®" class="headerlink" title="æ—‹è½¬è½¬åŠ¨å…³èŠ‚åˆ°æ­£ç¡®ä½ç½®"></a>æ—‹è½¬è½¬åŠ¨å…³èŠ‚åˆ°æ­£ç¡®ä½ç½®</h2><p><img src="https://s1.ax1x.com/2022/07/27/vSOmY8.png" alt=""><br>  1 rotation-&gt;ownframe-&gt;y-&gt;90</p><h2 id="è®¾ç½®è½®å­åå­—rfw-å³å‰è½®-å…³èŠ‚åå­—rfm-å³å‰å…³èŠ‚-è½¦åå­—car"><a href="#è®¾ç½®è½®å­åå­—rfw-å³å‰è½®-å…³èŠ‚åå­—rfm-å³å‰å…³èŠ‚-è½¦åå­—car" class="headerlink" title="è®¾ç½®è½®å­åå­—rfw(å³å‰è½®)å…³èŠ‚åå­—rfm(å³å‰å…³èŠ‚)è½¦åå­—car"></a>è®¾ç½®è½®å­åå­—rfw(å³å‰è½®)å…³èŠ‚åå­—rfm(å³å‰å…³èŠ‚)è½¦åå­—car</h2><h2 id="rfw-å³å‰è½®-è£…åœ¨rfm-å³å‰å…³èŠ‚-ä¸Šï¼šæ‹–ä¸€ä¸‹å°±å¯ä»¥"><a href="#rfw-å³å‰è½®-è£…åœ¨rfm-å³å‰å…³èŠ‚-ä¸Šï¼šæ‹–ä¸€ä¸‹å°±å¯ä»¥" class="headerlink" title="rfw(å³å‰è½®)è£…åœ¨rfm(å³å‰å…³èŠ‚)ä¸Šï¼šæ‹–ä¸€ä¸‹å°±å¯ä»¥"></a>rfw(å³å‰è½®)è£…åœ¨rfm(å³å‰å…³èŠ‚)ä¸Šï¼šæ‹–ä¸€ä¸‹å°±å¯ä»¥</h2><h2 id="rfm-å³å‰å…³èŠ‚-è£…åœ¨è½¦ï¼ˆcarï¼‰ä¸Š"><a href="#rfm-å³å‰å…³èŠ‚-è£…åœ¨è½¦ï¼ˆcarï¼‰ä¸Š" class="headerlink" title="rfm(å³å‰å…³èŠ‚)è£…åœ¨è½¦ï¼ˆcarï¼‰ä¸Š"></a>rfm(å³å‰å…³èŠ‚)è£…åœ¨è½¦ï¼ˆcarï¼‰ä¸Š</h2><h2 id="ç»™å…³èŠ‚ä½¿èƒ½ç”µåŠ¨"><a href="#ç»™å…³èŠ‚ä½¿èƒ½ç”µåŠ¨" class="headerlink" title="ç»™å…³èŠ‚ä½¿èƒ½ç”µåŠ¨"></a>ç»™å…³èŠ‚ä½¿èƒ½ç”µåŠ¨</h2><p> 1 ç‚¹å‡»è½¬åŠ¨å…³èŠ‚1-&gt;æœ€ä¸‹æ–¹ show dynamic-&gt;motor enabledå‹¾é€‰<br> 2 è®¾ç½®è½¬åŠ¨å…³èŠ‚ä¸å¯è§ï¼šç‚¹å‡»è½¬åŠ¨å…³èŠ‚1-&gt;common-&gt;camera visibility laye-&gt;å»æ‰å‹¾é€‰</p><h2 id="å¤åˆ¶å››ä»½è½¦è½®1ï¼Œè½¬åŠ¨å…³èŠ‚1"><a href="#å¤åˆ¶å››ä»½è½¦è½®1ï¼Œè½¬åŠ¨å…³èŠ‚1" class="headerlink" title="å¤åˆ¶å››ä»½è½¦è½®1ï¼Œè½¬åŠ¨å…³èŠ‚1"></a>å¤åˆ¶å››ä»½è½¦è½®1ï¼Œè½¬åŠ¨å…³èŠ‚1</h2><p> 1 æŒ‰ä½shift é€‰ä¸­rfmå’Œrfw,å³é”®edit-&gt;copy,ç‚¹å‡»å°è½¦é™„è¿‘å³é”®edit-&gt;paste</p><h2 id="åˆ†åˆ«å‘½ålfw-å·¦å‰è½®-lfm-å·¦å‰å…³èŠ‚-lrw-å·¦åè½®-lrm-å·¦åå…³èŠ‚-rrw-rrm"><a href="#åˆ†åˆ«å‘½ålfw-å·¦å‰è½®-lfm-å·¦å‰å…³èŠ‚-lrw-å·¦åè½®-lrm-å·¦åå…³èŠ‚-rrw-rrm" class="headerlink" title="åˆ†åˆ«å‘½ålfw(å·¦å‰è½®),lfm(å·¦å‰å…³èŠ‚),lrw(å·¦åè½®),lrm(å·¦åå…³èŠ‚)rrw,rrm"></a>åˆ†åˆ«å‘½ålfw(å·¦å‰è½®),lfm(å·¦å‰å…³èŠ‚),lrw(å·¦åè½®),lrm(å·¦åå…³èŠ‚)rrw,rrm</h2><h2 id="è°ƒæ•´å…¶ä½™å››ä¸ªè½¦è½®ä½ç½®ï¼Œå¹¶è£…åœ¨è½¦ä¸Š"><a href="#è°ƒæ•´å…¶ä½™å››ä¸ªè½¦è½®ä½ç½®ï¼Œå¹¶è£…åœ¨è½¦ä¸Š" class="headerlink" title="è°ƒæ•´å…¶ä½™å››ä¸ªè½¦è½®ä½ç½®ï¼Œå¹¶è£…åœ¨è½¦ä¸Š"></a>è°ƒæ•´å…¶ä½™å››ä¸ªè½¦è½®ä½ç½®ï¼Œå¹¶è£…åœ¨è½¦ä¸Š</h2><p>  1å·¦å‰å…³èŠ‚(lfm)ï¼šposition-&gt;xåŠ è´Ÿå·<br>  2å·¦åå…³èŠ‚(lrm): position-&gt;xåŠ è´Ÿå·yåŠ è´Ÿå·<br>  3å³åå…³èŠ‚(rrm): position-&gt;yåŠ è´Ÿå·</p><h1 id="æ·»åŠ è·¯çº¿"><a href="#æ·»åŠ è·¯çº¿" class="headerlink" title="æ·»åŠ è·¯çº¿"></a>æ·»åŠ è·¯çº¿</h1><h2 id="add-gt-path-gt-circle-type"><a href="#add-gt-path-gt-circle-type" class="headerlink" title="add-&gt;path-&gt;circle type"></a>add-&gt;path-&gt;circle type</h2><h2 id="ä¿®æ”¹è·¯çº¿çš„å½¢çŠ¶"><a href="#ä¿®æ”¹è·¯çº¿çš„å½¢çŠ¶" class="headerlink" title="ä¿®æ”¹è·¯çº¿çš„å½¢çŠ¶"></a>ä¿®æ”¹è·¯çº¿çš„å½¢çŠ¶</h2><p>  1 é€‰ä¸­path,ç‚¹å‡»å·¦æ çš„æ›²çº¿<br>  2 ä½¿è·¯çº¿å¹³æ»‘ï¼šå‹¾é€‰path is flat<br>  3 ä¿®æ”¹è·¯çº¿å½¢çŠ¶ï¼šç‚¹å‡»å·¦ä¾§çš„path point1,ç‚¹å‡»èœå•æ ç¬¬ä¸ƒä¸ªä¸Šä¸‹ç§»åŠ¨çš„å›¾æ ‡ç‚¹å‡»position é¼ æ ‡æ‹‰ç€ç‚¹å‘å¤–ï¼Œä¾æ¬¡ç±»æ¨<br>  4 ä¿®æ”¹è·¯çº¿é¢œè‰²ï¼ˆé»‘ï¼šå› ä¸ºç”¨ä¼ æ„Ÿå™¨ï¼‰é€‰ä¸­path,ç‚¹å‡»å·¦æ çš„æ›²çº¿<br>   line size:5<br>    adjust line color-&gt;ç¬¬ä¸€ä¸ª<br>  5 è·¯çº¿å½¢çŠ¶ä½¿èƒ½ï¼šshow path shaping dialog-&gt;enable<br>  6 è·¯çº¿ç±»å‹è®¾ç½®ä¸ºå¹³é¢ï¼štype-&gt;horizontal</p><h1 id="åˆ›å»ºä¼ æ„Ÿå™¨"><a href="#åˆ›å»ºä¼ æ„Ÿå™¨" class="headerlink" title="åˆ›å»ºä¼ æ„Ÿå™¨"></a>åˆ›å»ºä¼ æ„Ÿå™¨</h1><h2 id="add-gt-vision-sensor-gt-orthographic-type"><a href="#add-gt-vision-sensor-gt-orthographic-type" class="headerlink" title="add-&gt;vision sensor-&gt;orthographic type"></a>add-&gt;vision sensor-&gt;orthographic type</h2><p> 1 ä¿®æ”¹å±æ€§ï¼šå‹¾é€‰use local lights(ä½¿ç”¨å½“å‰å…‰æº)<br> 2 ä¼ æ„Ÿå™¨æ¢æµ‹åƒç´ å€¼ï¼šresolution x/y: 1,1<br> 3 ä¼ æ„Ÿå™¨æ¢æµ‹è·ç¦»ï¼šfar clipping plane:0.2(ç±³)<br> 4 ä¼ æ„Ÿå™¨ä½ç½®ï¼šç‚¹å‡»èœå•æ ç¬¬ä¸ƒä¸ªä¸Šä¸‹ç§»åŠ¨çš„å›¾æ ‡ç‚¹å‡»position<br>   ç›¸å¯¹ä¸–ç•Œï¼šx-0.02ï¼Œy-0.16,z-0.1<br> 5ä¼ æ„ŸèŒƒå›´ä½ç½®ç§»åŠ¨ï¼šç‚¹å‡»èœå•æ ç¬¬å…«ä¸ªæ—‹è½¬çš„å›¾æ ‡ç‚¹å‡»rotation<br>   ç›¸å¯¹è‡ªå·±ï¼šx-180<br> 6å‘½åä¸ºrightsensor</p><h2 id="å¤åˆ¶ä¸¤ä¸ªä¼ æ„Ÿå™¨"><a href="#å¤åˆ¶ä¸¤ä¸ªä¼ æ„Ÿå™¨" class="headerlink" title="å¤åˆ¶ä¸¤ä¸ªä¼ æ„Ÿå™¨"></a>å¤åˆ¶ä¸¤ä¸ªä¼ æ„Ÿå™¨</h2><p>  1å‘½åä¸ºleftsensorå‘½åä¸ºmiddlesensor<br>  2ä¿®æ”¹middlesensorä½ç½®ï¼šç›¸å¯¹ä¸–ç•Œï¼šx-0<br>  3ä¿®æ”¹leftsensorä½ç½®ï¼šç›¸å¯¹ä¸–ç•Œï¼šx-åŠ è´Ÿå·</p><h1 id="æ·»åŠ è§†å›¾"><a href="#æ·»åŠ è§†å›¾" class="headerlink" title="æ·»åŠ è§†å›¾"></a>æ·»åŠ è§†å›¾</h1><p>  add-&gt;float view(å¯ä»¥æ˜¾ç¤ºä¼ æ„Ÿå™¨æ•°æ®)ï¼ˆä¸‰ä¸ªï¼‰<br>  1é€‰ä¸­leftsensorï¼Œåœ¨float viewé‡Œå³é”®-&gt;view-&gt;ç¬¬ä¸€ä¸ªï¼›å…¶ä»–ä¸¤ä¸ªåŒç†<br>  2ä¼ æ„Ÿå™¨éƒ½æ‹–åˆ°å°è½¦ä¸Š</p><h1 id="ç»™å°è½¦åˆ›å»ºé›†åˆ"><a href="#ç»™å°è½¦åˆ›å»ºé›†åˆ" class="headerlink" title="ç»™å°è½¦åˆ›å»ºé›†åˆ"></a>ç»™å°è½¦åˆ›å»ºé›†åˆ</h1><p>  1æŒ‰ä½shifté¼ æ ‡æ¡†ä½æ‰€æœ‰éƒ¨ä»¶åï¼ŒæŒ‰ä½shiftä¸åŠ¨ï¼ŒæŒ‰ä½ctrlç‚¹å‡»æ¡†é€‰åŒºåŸŸï¼Œåœ¨ç‚¹ä¸€ä¸‹car<br>  2ç‚¹å‡»å·¦ä¾§æœç´¢å›¾è¡¨ï¼šcommon-&gt;é€‰ä¸­object is model base </p><h1 id="æŠŠå°è½¦ç§»åˆ°è·¯çº¿ä¸Š"><a href="#æŠŠå°è½¦ç§»åˆ°è·¯çº¿ä¸Š" class="headerlink" title="æŠŠå°è½¦ç§»åˆ°è·¯çº¿ä¸Š"></a>æŠŠå°è½¦ç§»åˆ°è·¯çº¿ä¸Š</h1><p> 1ç‚¹å‡»å°è½¦ï¼Œç‚¹å‡»èœå•æ ç¬¬ä¸ƒä¸ªä¸Šä¸‹ç§»åŠ¨çš„å›¾æ ‡,é¼ æ ‡æ‹–åŠ¨å°è½¦</p><h1 id="ç¼–å†™ç¨‹åº"><a href="#ç¼–å†™ç¨‹åº" class="headerlink" title="ç¼–å†™ç¨‹åº"></a>ç¼–å†™ç¨‹åº</h1><p> 1åˆ›å»ºè„šæœ¬ï¼šç‚¹å‡»å·¦ä¾§æ å°æœ¬æœ¬-&gt;ç‚¹å‡»insert new script-&gt;é€‰æ‹©child script( threaded)(å­è„šæœ¬çº¿ç¨‹)<br> 2è„šæœ¬å…³è”åˆ°è½¦ä¸Šï¼šassociate object-&gt;car<br> 3ä»£ç <br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//ä¸»ç¨‹åº</span></span><br><span class="line"><span class="function">function <span class="title">sysCall_threadmain</span><span class="params">()</span></span></span><br><span class="line">    -- Put some initialization code here</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">//è·å–å·¦å³å‰å…³èŠ‚çš„å¥æŸ„</span></span><br><span class="line">rghtmotor=sim.getObjectHandle(<span class="string">&quot;rightfrontmotor&quot;</span>)</span><br><span class="line">leftmotor=sim.getObjectHandle(<span class="string">&quot;leftfrontmotor&quot;</span>)</span><br><span class="line"><span class="comment">//è·å–ä¸‰ä¸ªä¼ æ„Ÿå™¨çš„å¥æŸ„</span></span><br><span class="line">lefts=sim.getObjectHandle(<span class="string">&quot;leftsensor&quot;</span>)</span><br><span class="line">middles=sim.getObjectHandle(<span class="string">&quot;middlesensor&quot;</span>)</span><br><span class="line">rights=sim.getObjectHandle(<span class="string">&quot;rightsensor&quot;</span>)</span><br><span class="line"><span class="comment">//è®¾ç½®é€Ÿåº¦èŒƒå›´</span></span><br><span class="line">speedrange=&#123;<span class="number">-1</span>,<span class="number">-6</span>&#125;</span><br><span class="line"><span class="comment">//è®¾ç½®æœ€å¤§å“åº”æ—¶é—´</span></span><br><span class="line">backwardtime=<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">--creat custom ui</span><br><span class="line">xml=</span><br><span class="line">[[</span><br><span class="line">    &lt;ui title=<span class="string">&quot;speed&quot;</span> closeable=<span class="string">&quot;true&quot;</span> resizeable=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">    &lt;hslider minimum=<span class="string">&quot;0&quot;</span> maximum=<span class="string">&quot;100&quot;</span> on-change=<span class="string">&quot;speedrange_callback&quot;</span> id=<span class="string">&quot;1&quot;</span>/&gt;</span><br><span class="line">    &lt;/ui&gt;</span><br><span class="line">]]</span><br><span class="line"><span class="comment">//åˆ›å»ºui</span></span><br><span class="line">ui=simUI.create(xml)</span><br><span class="line"></span><br><span class="line">speed=(speedrange[<span class="number">1</span>]+speedrange[<span class="number">2</span>])*<span class="number">0.5</span></span><br><span class="line"><span class="comment">//ç¼–å†™uiä¸­çš„å‡½æ•°</span></span><br><span class="line">function speedrange_callback(ui,id,newVal)</span><br><span class="line">    speed=speedrange[<span class="number">1</span>]+(speedrange[<span class="number">2</span>]-speedrange[<span class="number">1</span>])*newVal/<span class="number">100</span></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">    -- Put your main loop here, e.g.:</span><br><span class="line"> <span class="comment">//ä»¿çœŸçš„å†…å®¹   </span></span><br><span class="line">    <span class="keyword">while</span> sim.getSimulationState()~=sim.simulation_advancing_abouttostop <span class="keyword">do</span></span><br><span class="line">        <span class="comment">//åˆå§‹ä¼ æ„Ÿå™¨</span></span><br><span class="line">            sensorreadingleft=<span class="literal">false</span></span><br><span class="line">            sensorreadingmiddle=<span class="literal">false</span>            </span><br><span class="line">            sensorreadingright=<span class="literal">false</span></span><br><span class="line">         <span class="comment">//è¯»ä¼ æ„Ÿå™¨çš„è¿”å›ç»“æœå’Œæ•°æ®   </span></span><br><span class="line">            resultl,datal=sim.readVisionSensor(lefts)</span><br><span class="line">            resultm,datam=sim.readVisionSensor(middles)</span><br><span class="line">            resultr,datar=sim.readVisionSensor(rights)</span><br><span class="line"></span><br><span class="line">           <span class="comment">//åˆ¤æ–­ä¼ æ„Ÿå™¨æ˜¯å¦è¯»åˆ°æ•°æ®ï¼Œè¯»åˆ°å°±æ”¶å–æ•°æ®</span></span><br><span class="line">            <span class="keyword">if</span> resultl&gt;=<span class="number">0</span> then</span><br><span class="line">                sensorreadingleft=(datal[<span class="number">11</span>]&lt;<span class="number">0.2</span>)</span><br><span class="line">            end</span><br><span class="line">            <span class="keyword">if</span> resultm&gt;=<span class="number">0</span> then</span><br><span class="line">                sensorreadingmiddle=(datam[<span class="number">11</span>]&lt;<span class="number">0.2</span>)</span><br><span class="line">            end</span><br><span class="line">            <span class="keyword">if</span> resultr&gt;=<span class="number">0</span> then</span><br><span class="line">                sensorreadingright=(datar[<span class="number">11</span>]&lt;<span class="number">0.2</span>)</span><br><span class="line">            end</span><br><span class="line">          <span class="comment">//å®šä¹‰å·¦å³å…³èŠ‚é€Ÿåº¦ï¼ˆåˆå§‹ç›¸ç­‰ï¼‰</span></span><br><span class="line">            leftv=speed</span><br><span class="line">            rightv=speed</span><br><span class="line">            <span class="comment">//å¦‚æœå·¦ä¼ æ„Ÿå™¨è¯»åˆ°å€¼ï¼Œå·¦å…³èŠ‚é€Ÿåº¦èµ‹å€¼ï¼ˆå°ä¸€ç‚¹å°±èƒ½è½¬å¼¯äº†ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> sensorreadingleft==<span class="literal">true</span> then</span><br><span class="line">                leftv=<span class="number">0.03</span>*speed</span><br><span class="line">            end</span><br><span class="line">            <span class="comment">//å¦‚æœå³ä¼ æ„Ÿå™¨è¯»åˆ°å€¼ï¼Œå³å…³èŠ‚é€Ÿåº¦èµ‹å€¼ï¼ˆå°ä¸€ç‚¹å°±èƒ½è½¬å¼¯äº†ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> sensorreadingright==<span class="literal">true</span> then</span><br><span class="line">                rightv=<span class="number">0.03</span>*speed</span><br><span class="line">            end</span><br><span class="line">            <span class="comment">//å¦‚æœå·¦å³ä¼ æ„Ÿå™¨è¯»åˆ°å€¼ï¼Œç›´æ¥è¿›è¡Œä¸‹ä¸ªå‘¨æœŸï¼ˆä¿æŒåŸæ–¹å¼è¡Œè¿›ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> sensorreadingright==<span class="literal">true</span> <span class="keyword">and</span> sensorreadingleft==<span class="literal">true</span>  then</span><br><span class="line">                backwardtime=sim.getSimulationTime()+<span class="number">2</span></span><br><span class="line">            end</span><br><span class="line">            </span><br><span class="line"><span class="comment">//å¦‚æœè¿è¡Œçš„å›ä¼ æ—¶é—´ä»åœ¨å“åº”æ—¶é—´å†…ï¼ˆæœªè¶…æ—¶ï¼‰è®¾ç½®å·¦å³å…³èŠ‚é€Ÿåº¦</span></span><br><span class="line"><span class="keyword">if</span> backwardtime&lt;sim.getSimulationTime() then</span><br><span class="line">    sim.setJointTargetVelocity(rghtmotor,rightv)</span><br><span class="line">    sim.setJointTargetVelocity(leftmotor,leftv)</span><br><span class="line">end</span><br><span class="line"><span class="comment">//å¦‚æœè¿è¡Œçš„å›ä¼ æ—¶é—´è¶…è¿‡å“åº”æ—¶é—´å†…ï¼ˆè¶…æ—¶ï¼‰å°è½¦åé€€</span></span><br><span class="line"><span class="keyword">if</span> backwardtime&gt;sim.getSimulationTime() then</span><br><span class="line">    sim.setJointTargetVelocity(rghtmotor,-speed)</span><br><span class="line">    sim.setJointTargetVelocity(leftmotor,-speed/<span class="number">10</span>)</span><br><span class="line">end</span><br><span class="line"><span class="comment">//åˆ‡æ¢è„šæœ¬</span></span><br><span class="line">        sim.switchThread() -- resume in next simulation step</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line"><span class="comment">//æ¸…é™¤å·¥ä½œ</span></span><br><span class="line">function sysCall_cleanup()</span><br><span class="line">    -- Put some clean-up code here</span><br><span class="line">end</span><br></pre></td></tr></table></figure></p><h1 id="æºç é“¾æ¥"><a href="#æºç é“¾æ¥" class="headerlink" title="æºç é“¾æ¥"></a>æºç é“¾æ¥</h1><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1LriziMKsp0-iWGk8t47YzA?pwd=33yf">https://pan.baidu.com/s/1LriziMKsp0-iWGk8t47YzA?pwd=33yf</a><br>æå–ç ï¼š33yf</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>qt-å®‰å“</title>
      <link href="blog/qt-%E5%AE%89%E5%8D%93/"/>
      <url>blog/qt-%E5%AE%89%E5%8D%93/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>éœ€è¦åŒ… é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1hFl-u55pW1sLx759tJowKQ?pwd=hzlt">https://pan.baidu.com/s/1hFl-u55pW1sLx759tJowKQ?pwd=hzlt</a><br>æå–ç ï¼šhzlt<br>è§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1954y1Q7Ro?share_source=copy_web&amp;vd_source=3a4f02434e353296deced7b70d6b1042">https://www.bilibili.com/video/BV1954y1Q7Ro?share_source=copy_web&amp;vd_source=3a4f02434e353296deced7b70d6b1042</a></p>]]></content>
      
      
      <categories>
          
          <category> qt </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>UDP</title>
      <link href="blog/UDP/"/>
      <url>blog/UDP/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>   1ç›®æ ‡åœ°å€å’Œç›®æ ‡ç«¯å£éƒ½æ˜¯è‡ªå·±å†™çš„ï¼Œç»‘å®šç«¯å£ä¹Ÿæ˜¯è‡ªå·±å†™çš„<br>   2udpæ˜¯æ— è¿æ¥ä¼ è¾“ï¼Œæ¯ä¸ªå®¢æˆ·æœºéƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„socket<br>   3.æ¯ä¸€ä¸ªå®¢æˆ·æœºçš„socketä¸­åœ¨å¼€å§‹è¿æ¥ä¹‹å‰éƒ½è¦å†™æœ¬æœºçš„ä¿¡æ¯(æœ¬æœºIP,ç«¯å£,æƒ³è¦çš„ç›®æ ‡æœºçš„ipå’Œç«¯å£ç­‰)å’Œæƒ³è¦å‘çš„å†…å®¹<br>   4.å½“æ¯ä¸ªå®¢æˆ·æœºéƒ½å®Œå–„è‡ªå·±çš„socketå,æ¯ä¸ªå®¢æˆ·æœºçš„socketéƒ½è‡ªåŠ¨åœ¨ç½‘ç»œä¸­å¯»æ‰¾å¯¹åº”çš„socketï¼Œå¹¶è§é¢åè‡ªåŠ¨æ›´æ–°æ•°æ®æŠŠå¯¹æ–¹çš„ä¿¡æ¯æ”¾åœ¨è‡ªå·±é‡Œé¢<br>   5.è¿™æ ·ä¸€æ¥åªè¦socketé‡Œçš„ä¿¡æ¯å¢åŠ äº†å°±å¯ä»¥å»è¯»å–é‡Œé¢çš„å¯¹æ–¹çš„å†…å®¹</p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">1.</span>å¤´æ–‡ä»¶</span><br><span class="line">   include &lt;QMainWindow&gt;</span><br><span class="line">    include&lt;QLabel&gt;</span><br><span class="line">   include&lt;QUdpSocket&gt;</span><br><span class="line">   <span class="number">1</span>  å®šä¹‰udpçš„socket</span><br><span class="line">     QUdpSocket *udpSocket;</span><br><span class="line">    <span class="number">2</span> å®ç°æ§½å‡½æ•°</span><br><span class="line">    <span class="keyword">private</span> slots:</span><br><span class="line"><span class="comment">//è‡ªå®šä¹‰æ§½å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//çŠ¶æ€æ”¹å˜</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>    <span class="title">onSocketStateChange</span><span class="params">(QAbstractSocket::SocketState socketState)</span></span>;</span><br><span class="line">    <span class="comment">//è¯»å–socketä¼ å…¥çš„æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>    <span class="title">onSocketReadyRead</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç‚¹å‡»ç»‘å®š</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_actStart_triggered</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//ç‚¹å‡»è§£ç»‘</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_actStop_triggered</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//ç‚¹å‡»å‘é€</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnSend_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//ç‚¹å‡»æ¸…ç©ºæ–‡æœ¬</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_action_3_triggered</span><span class="params">()</span></span>;</span><br><span class="line">     <span class="comment">//ç‚¹å‡»å¹¿æ’­</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnBroadcast_clicked</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°å®ç°è¿‡ç¨‹"><a href="#å‡½æ•°å®ç°è¿‡ç¨‹" class="headerlink" title="å‡½æ•°å®ç°è¿‡ç¨‹"></a>å‡½æ•°å®ç°è¿‡ç¨‹</h2><p>  ä¸€ å®Œå–„socketä¿¡æ¯<br>   1.ç»‘å®šç«¯å£void on_actStart_triggered();<br>   2.å‘socketå†™å…¥ç›®æ ‡ip,ç›®æ ‡ç«¯å£å’Œå‘é€å†…å®¹void on_btnSend_clicked();<br>   ä¸»è¦æ˜¯socketé‡Œçš„writeDatagramå†™å…¥(eg: //socketé‡Œæ”¾å…¥ç›®æ ‡ipç›®æ ‡ç«¯å£å’Œå‘é€çš„æ¶ˆæ¯<br>    udpSocket-&gt;writeDatagram(str,targetAddr,targetPort);)<br>   äºŒè¯»å–æ”¶åˆ°çš„æ•°æ® void  onSocketReadyRead();<br>     è‹¥socketæœ‰æ–°æ•°æ®è¿”å›ï¼Œåˆ™è‡ªåŠ¨äº§ç”ŸreadyRead()ä¿¡å·<br>     è‹¥socketæœ‰æ–°æ•°æ®åˆ™socketé‡Œçš„hasPendingDatagrams()ä¼šè¿”å›1<br>     é€šè¿‡socketé‡Œçš„readDatagram()å‡½æ•°å¯ä»¥è¯»å–å¯¹å¯¹æ–¹çš„ä¿¡æ¯(åŒ…æ‹¬IPï¼Œç«¯å£)<br>    ä¸‰ è§£é™¤ç«¯å£ç»‘å®šä¸å†è¿æ¥void on_actStop_triggered();<br>      socketé‡Œæœ‰abort()å‡½æ•°å¯ä»¥æ¶ˆç­è¿æ¥<br>    å››è‹¥å®ç°å¹¿æ’­ï¼Œç¬¬äºŒæ­¥åœ¨å†™socketæ—¶writeDatagram(å‘é€å†…å®¹,QHostAddress::Broadcast,ç›®æ ‡ç«¯å£);//æŒ‡æ˜äº†æ–¹å¼Broadcastï¼Œæ‰€ä»¥æ²¡å†™ç›®æ ‡IP</p><h2 id="å‡½æ•°ä»£ç "><a href="#å‡½æ•°ä»£ç " class="headerlink" title="å‡½æ•°ä»£ç "></a>å‡½æ•°ä»£ç </h2><h3 id="è·å–æœ¬æœºip"><a href="#è·å–æœ¬æœºip" class="headerlink" title="è·å–æœ¬æœºip"></a>è·å–æœ¬æœºip</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function">QString <span class="title">MainWindow::getLocalIp</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;  <span class="comment">//è·å–æœ¬æœºip</span></span><br><span class="line">    QString hostName=QHostInfo::localHostName();<span class="comment">//æœ¬åœ°ä¸»æœºå</span></span><br><span class="line">    QHostInfo   hostInfo=QHostInfo::fromName(hostName);</span><br><span class="line">    QString   localIP=<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    QList&lt;QHostAddress&gt; addList=hostInfo.addresses();<span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!addList.isEmpty())</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;addList.count();i++)</span><br><span class="line">    &#123;</span><br><span class="line">        QHostAddress aHost=addList.at(i);</span><br><span class="line">        <span class="keyword">if</span> (QAbstractSocket::IPv4Protocol==aHost.protocol())</span><br><span class="line">        &#123;</span><br><span class="line">            localIP=aHost.toString();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> localIP;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::MainWindow(QWidget *parent) :</span><br><span class="line">    QMainWindow(parent),</span><br><span class="line">    ui(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(<span class="keyword">this</span>);</span><br><span class="line">    LabSocketState=<span class="keyword">new</span> QLabel(<span class="string">&quot;SocketçŠ¶æ€ï¼š&quot;</span>);<span class="comment">//çŠ¶æ€æ æ ‡ç­¾</span></span><br><span class="line">    LabSocketState-&gt;setMinimumWidth(<span class="number">200</span>);</span><br><span class="line">    ui-&gt;statusBar-&gt;addWidget(LabSocketState);</span><br><span class="line">    QString localIp=getLocalIp();<span class="comment">//æœ¬æœºIP</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;setWindowTitle(<span class="keyword">this</span>-&gt;windowTitle()+<span class="string">&quot;----æœ¬æœºIPï¼š&quot;</span>+localIp);</span><br><span class="line">    <span class="comment">//è¿™é‡Œåªæ˜¯æµ‹è¯•ï¼Œè‡ªå·±å¯ä»¥è¾“å…¥å¯¹æ–¹çš„ip</span></span><br><span class="line">    ui-&gt;comboTargetIP-&gt;addItem(localIp);</span><br><span class="line">    udpSocket=<span class="keyword">new</span> QUdpSocket(<span class="keyword">this</span>);</span><br><span class="line">    connect(udpSocket,SIGNAL(stateChanged(QAbstractSocket::SocketState)),<span class="keyword">this</span>,SLOT(onSocketStateChange(QAbstractSocket::SocketState)));</span><br><span class="line">    connect(udpSocket,SIGNAL(readyRead()),<span class="keyword">this</span>,SLOT(onSocketReadyRead()));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¯»å–socketä¼ å…¥çš„æ•°æ®"><a href="#è¯»å–socketä¼ å…¥çš„æ•°æ®" class="headerlink" title="è¯»å–socketä¼ å…¥çš„æ•°æ®"></a>è¯»å–socketä¼ å…¥çš„æ•°æ®</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::onSocketReadyRead</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¯»å–ç¼“å†²åŒºè¡Œæ–‡æœ¬</span></span><br><span class="line">    <span class="comment">//æœ‰æ•°æ®æŠ¥æ—¶è¯»å–</span></span><br><span class="line">        <span class="keyword">while</span>(udpSocket-&gt;hasPendingDatagrams())</span><br><span class="line">     &#123;</span><br><span class="line">            <span class="comment">//ç”¨ä¸€ä¸ªæ•°ç»„æ¥æ”¶</span></span><br><span class="line">            QByteArray datagram;</span><br><span class="line">           <span class="comment">//è®¾ç½®æ•°ç»„å¤§å°(æ ¹æ®æ•°æ®æŠ¥å¤§å°)</span></span><br><span class="line">            datagram.resize(udpSocket-&gt;pendingDatagramSize());</span><br><span class="line">            <span class="comment">//è¯»å–å¯¹æ–¹ipåœ°å€</span></span><br><span class="line">             <span class="comment">//è¯»å–å¯¹æ–¹ç«¯å£å·</span></span><br><span class="line">            QHostAddress peerAddr;</span><br><span class="line">            quint16 peerPort;</span><br><span class="line">            <span class="comment">//è¯»æ•°æ®æŠ¥çš„æ•°æ®ï¼Œå¤§å°ï¼Œå¯¹æ–¹ipå’Œç«¯å£</span></span><br><span class="line">            udpSocket-&gt;readDatagram(datagram.data(),datagram.size(),&amp;peerAddr,&amp;peerPort);</span><br><span class="line">            <span class="comment">//æ•°æ®è½¬åŒ–ç±»å‹</span></span><br><span class="line">            QString str=datagram.data();</span><br><span class="line">            <span class="comment">//å¯¹æ–¹ipè½¬åŒ–ç±»å‹</span></span><br><span class="line">            <span class="comment">//å¯¹æ–¹ç«¯å£è½¬åŒ–ç±»å‹</span></span><br><span class="line">            QString peer=<span class="string">&quot;æ¥è‡ª&quot;</span>+peerAddr.toString()+<span class="string">&quot;çš„&quot;</span>+QString::number(peerPort)+<span class="string">&quot;ç«¯å£:&quot;</span>;</span><br><span class="line">         <span class="comment">//æ˜¾ç¤ºå¯¹æ–¹ipï¼Œç«¯å£</span></span><br><span class="line">            ui-&gt;plainTextEdit-&gt;appendPlainText(peer);</span><br><span class="line">            <span class="comment">//æ˜¾ç¤ºæ”¶åˆ°æ¶ˆæ¯å†…å®¹</span></span><br><span class="line">           ui-&gt;plainTextEdit-&gt;appendPlainText(str);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç‚¹å‡»ç»‘å®š"><a href="#ç‚¹å‡»ç»‘å®š" class="headerlink" title="ç‚¹å‡»ç»‘å®š"></a>ç‚¹å‡»ç»‘å®š</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_actStart_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;  <span class="comment">//ç»‘å®šç«¯å£</span></span><br><span class="line">    quint16 port=ui-&gt;spinBindPort-&gt;value();</span><br><span class="line">    <span class="comment">//udpSocket-&gt;bind(port)ç»‘å®šç«¯å£å¹¶è¿”å›boolç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span>(udpSocket-&gt;bind(port))</span><br><span class="line">    &#123;</span><br><span class="line">      ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**å·²æˆåŠŸç»‘å®š&quot;</span>);</span><br><span class="line">      ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**ç»‘å®šç«¯å£:&quot;</span>+QString::number(udpSocket-&gt;localPort()));</span><br><span class="line">      ui-&gt;actStart-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">      ui-&gt;actStop-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**ç»‘å®šå¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç‚¹å‡»è§£ç»‘"><a href="#ç‚¹å‡»è§£ç»‘" class="headerlink" title="ç‚¹å‡»è§£ç»‘"></a>ç‚¹å‡»è§£ç»‘</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_actStop_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;  <span class="comment">//è§£é™¤ç«¯å£ç»‘å®š</span></span><br><span class="line">    udpSocket-&gt;<span class="built_in">abort</span>();</span><br><span class="line">    ui-&gt;actStart-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;actStop-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**å·²ç»è§£é™¤ç»‘å®š&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç‚¹å‡»å‘é€"><a href="#ç‚¹å‡»å‘é€" class="headerlink" title="ç‚¹å‡»å‘é€"></a>ç‚¹å‡»å‘é€</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_btnSend_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//ç‚¹å‡»å‘é€</span></span><br><span class="line">    QString targetIp=ui-&gt;comboTargetIP-&gt;currentText();</span><br><span class="line">    <span class="comment">//é€šè¿‡ipç”Ÿæˆä¸€ä¸ªQHostAddresså¯¹è±¡</span></span><br><span class="line">    <span class="function">QHostAddress <span class="title">targetAddr</span><span class="params">(targetIp)</span></span>;</span><br><span class="line">    quint16 targetPort=ui-&gt;spinTargetPort-&gt;value();</span><br><span class="line">    QString msg=ui-&gt;editMsg-&gt;text();</span><br><span class="line">    QByteArray str=msg.toUtf8();</span><br><span class="line">    <span class="comment">//socketé‡Œæ”¾å…¥ç›®æ ‡ipç›®æ ‡ç«¯å£å’Œå‘é€çš„æ¶ˆæ¯</span></span><br><span class="line">    udpSocket-&gt;writeDatagram(str,targetAddr,targetPort);</span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;[out]&quot;</span>+msg);</span><br><span class="line">    ui-&gt;editMsg-&gt;clear();</span><br><span class="line">    ui-&gt;editMsg-&gt;setFocus();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç‚¹å‡»å¹¿æ’­"><a href="#ç‚¹å‡»å¹¿æ’­" class="headerlink" title="ç‚¹å‡»å¹¿æ’­"></a>ç‚¹å‡»å¹¿æ’­</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_btnBroadcast_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">//è·å–è‡ªå·±å†™çš„ç›®æ ‡ç«¯å£</span></span><br><span class="line"> quint16 targetPort=ui-&gt;spinTargetPort-&gt;value();</span><br><span class="line"> <span class="comment">//è·å–è‡ªå·±è¦å‘çš„æ¶ˆæ¯</span></span><br><span class="line"> QString msg=ui-&gt;editMsg-&gt;text();</span><br><span class="line"> <span class="comment">//æ¶ˆæ¯æ¢æˆQByteArray ç±»å‹ä¿è¯ä¸ä¼šä¹±ç </span></span><br><span class="line"> QByteArray str=msg.toUtf8();</span><br><span class="line"> <span class="comment">//å‘socketé‡Œå†™æ•°æ®å¹¶è¡¨æ˜è¿™æ¡æ•°æ®ç”¨æ¥å¹¿æ’­</span></span><br><span class="line"> udpSocket-&gt;writeDatagram(str,QHostAddress::Broadcast,targetPort);</span><br><span class="line"> <span class="comment">//æ˜¾ç¤ºå¹¿æ’­ä¿¡æ¯ï¼ˆåŒç½‘æ®µçš„è¿™ä¸ªç«¯å£éƒ½èƒ½æ”¶åˆ°ï¼‰</span></span><br><span class="line"> ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;æœ¬æœºå·²å‘å¸ƒå¹¿æ’­:&quot;</span>+msg);</span><br><span class="line"> ui-&gt;editMsg-&gt;clear();</span><br><span class="line"> ui-&gt;editMsg-&gt;setFocus();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç‚¹å‡»æ¸…ç©ºæ–‡æœ¬"><a href="#ç‚¹å‡»æ¸…ç©ºæ–‡æœ¬" class="headerlink" title="ç‚¹å‡»æ¸…ç©ºæ–‡æœ¬"></a>ç‚¹å‡»æ¸…ç©ºæ–‡æœ¬</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_action_3_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;plainTextEdit-&gt;clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> æºç ï¼šé“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1Pl-YGquor1JMVlOHI57dog?pwd=waat">https://pan.baidu.com/s/1Pl-YGquor1JMVlOHI57dog?pwd=waat</a><br>æå–ç ï¼šwaat</p>]]></content>
      
      
      <categories>
          
          <category> qt </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>qté€šä¿¡tcp</title>
      <link href="blog/qt%E9%80%9A%E4%BF%A1tcp/"/>
      <url>blog/qt%E9%80%9A%E4%BF%A1tcp/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä¸€ç›¸å…³å‡½æ•°-QT-network"><a href="#ä¸€ç›¸å…³å‡½æ•°-QT-network" class="headerlink" title="ä¸€ç›¸å…³å‡½æ•°(QT       += network)"></a>ä¸€ç›¸å…³å‡½æ•°(QT       += network)</h1><h2 id="1ä¸»æœº-æœ¬æœº-ä¿¡æ¯æŸ¥è¯¢"><a href="#1ä¸»æœº-æœ¬æœº-ä¿¡æ¯æŸ¥è¯¢" class="headerlink" title="1ä¸»æœº(æœ¬æœº)ä¿¡æ¯æŸ¥è¯¢"></a>1ä¸»æœº(æœ¬æœº)ä¿¡æ¯æŸ¥è¯¢</h2><h3 id="ä¸€-QHostInfoç±»ï¼š"><a href="#ä¸€-QHostInfoç±»ï¼š" class="headerlink" title="ä¸€ QHostInfoç±»ï¼š"></a>ä¸€ QHostInfoç±»ï¼š</h3><h4 id="1-localHostName-å‡½æ•°ï¼šè¿”å›æœ¬æœºä¸»æœºå"><a href="#1-localHostName-å‡½æ•°ï¼šè¿”å›æœ¬æœºä¸»æœºå" class="headerlink" title="1 localHostName()å‡½æ•°ï¼šè¿”å›æœ¬æœºä¸»æœºå"></a>1 localHostName()å‡½æ•°ï¼šè¿”å›æœ¬æœºä¸»æœºå</h4><pre><code>æ— å‚æ•°ï¼Œè¿”å›å€¼QStringç±»å‹çš„ä¸»æœºåç§°</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QString hostName=QHostInfo::localHostName();<span class="comment">//æœ¬åœ°ä¸»æœºå</span></span><br></pre></td></tr></table></figure><h4 id="2-fromName-QString-amp-name-å‡½æ•°ï¼šè¿”å›æŒ‡å®šçš„ä¸»æœºåçš„IPåœ°å€-å‚æ•°ï¼šQStringç±»å‹çš„ä¸»æœºå-è¿”å›å€¼ï¼šæŒ‡å®šçš„ä¸»æœºåQHostInfoç±»å‹çš„IPåœ°å€"><a href="#2-fromName-QString-amp-name-å‡½æ•°ï¼šè¿”å›æŒ‡å®šçš„ä¸»æœºåçš„IPåœ°å€-å‚æ•°ï¼šQStringç±»å‹çš„ä¸»æœºå-è¿”å›å€¼ï¼šæŒ‡å®šçš„ä¸»æœºåQHostInfoç±»å‹çš„IPåœ°å€" class="headerlink" title="2 fromName(QString &amp;name)å‡½æ•°ï¼šè¿”å›æŒ‡å®šçš„ä¸»æœºåçš„IPåœ°å€  å‚æ•°ï¼šQStringç±»å‹çš„ä¸»æœºå  è¿”å›å€¼ï¼šæŒ‡å®šçš„ä¸»æœºåQHostInfoç±»å‹çš„IPåœ°å€"></a>2 fromName(QString &amp;name)å‡½æ•°ï¼šè¿”å›æŒ‡å®šçš„ä¸»æœºåçš„IPåœ°å€  å‚æ•°ï¼šQStringç±»å‹çš„ä¸»æœºå  è¿”å›å€¼ï¼šæŒ‡å®šçš„ä¸»æœºåQHostInfoç±»å‹çš„IPåœ°å€</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QHostInfo   hostInfo=QHostInfo::fromName(hostName);</span><br></pre></td></tr></table></figure><h4 id="3-addresses-å‡½æ•°ï¼šè¿”å›ä¸hostName-ä¸»æœºå…³è”çš„IPåœ°å€åˆ—è¡¨-å³QHostInfoç±»å‹è½¬åŒ–æˆQListç±»å‹æ–¹ä¾¿æå–-æ— å‚æ•°ï¼Œè¿”å›QListç±»å‹çš„ipåˆ—è¡¨-å°±æ˜¯ä¸ªæ•°ç»„æ¯ä¸€æ¡éƒ½æ˜¯QHostAddressç±»å‹"><a href="#3-addresses-å‡½æ•°ï¼šè¿”å›ä¸hostName-ä¸»æœºå…³è”çš„IPåœ°å€åˆ—è¡¨-å³QHostInfoç±»å‹è½¬åŒ–æˆQListç±»å‹æ–¹ä¾¿æå–-æ— å‚æ•°ï¼Œè¿”å›QListç±»å‹çš„ipåˆ—è¡¨-å°±æ˜¯ä¸ªæ•°ç»„æ¯ä¸€æ¡éƒ½æ˜¯QHostAddressç±»å‹" class="headerlink" title="3 addresses()å‡½æ•°ï¼šè¿”å›ä¸hostName()ä¸»æœºå…³è”çš„IPåœ°å€åˆ—è¡¨[å³QHostInfoç±»å‹è½¬åŒ–æˆQListç±»å‹æ–¹ä¾¿æå–] æ— å‚æ•°ï¼Œè¿”å›QListç±»å‹çš„ipåˆ—è¡¨(å°±æ˜¯ä¸ªæ•°ç»„æ¯ä¸€æ¡éƒ½æ˜¯QHostAddressç±»å‹)"></a>3 addresses()å‡½æ•°ï¼šè¿”å›ä¸hostName()ä¸»æœºå…³è”çš„IPåœ°å€åˆ—è¡¨[å³QHostInfoç±»å‹è½¬åŒ–æˆQList<QHostAddress>ç±»å‹æ–¹ä¾¿æå–] æ— å‚æ•°ï¼Œè¿”å›QList<QHostAddress>ç±»å‹çš„ipåˆ—è¡¨(å°±æ˜¯ä¸ªæ•°ç»„æ¯ä¸€æ¡éƒ½æ˜¯QHostAddressç±»å‹)</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QList&lt;QHostAddress&gt; addList=hostInfo.addresses();</span><br></pre></td></tr></table></figure><h4 id="4-QList-æå–æ¯æ¡QHostAddressç±»å‹çš„æ•°æ®ï¼šat-i-protocol-å‡½æ•°å¯ä»¥æ˜¾ç¤ºQHostAddressç±»å‹ä¸­çš„åœ°å€æ˜¯ipv4è¿˜æ˜¯ipv6toString-å¯ä»¥æŠŠQHostAddressç±»å‹è½¬æ¢æˆStringç±»å‹"><a href="#4-QList-æå–æ¯æ¡QHostAddressç±»å‹çš„æ•°æ®ï¼šat-i-protocol-å‡½æ•°å¯ä»¥æ˜¾ç¤ºQHostAddressç±»å‹ä¸­çš„åœ°å€æ˜¯ipv4è¿˜æ˜¯ipv6toString-å¯ä»¥æŠŠQHostAddressç±»å‹è½¬æ¢æˆStringç±»å‹" class="headerlink" title="4  QList æå–æ¯æ¡QHostAddressç±»å‹çš„æ•°æ®ï¼šat(i)protocol()å‡½æ•°å¯ä»¥æ˜¾ç¤ºQHostAddressç±»å‹ä¸­çš„åœ°å€æ˜¯ipv4è¿˜æ˜¯ipv6toString()å¯ä»¥æŠŠQHostAddressç±»å‹è½¬æ¢æˆStringç±»å‹"></a>4  QList<QHostAddress> æå–æ¯æ¡QHostAddressç±»å‹çš„æ•°æ®ï¼šat(i)protocol()å‡½æ•°å¯ä»¥æ˜¾ç¤ºQHostAddressç±»å‹ä¸­çš„åœ°å€æ˜¯ipv4è¿˜æ˜¯ipv6toString()å¯ä»¥æŠŠQHostAddressç±»å‹è½¬æ¢æˆStringç±»å‹</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//éå†æŸ¥è¯¢ip</span></span><br><span class="line"> <span class="comment">//éç©ºæ—¶å®šä¹‰ä¸€ä¸ªQHostAddressç±»å‹çš„å˜é‡æ¥æ¥æ”¶QList&lt;QHostAddress&gt;ç±»å‹çš„ipåˆ—è¡¨çš„ç¬¬iæ¡æ•°æ®</span></span><br><span class="line"><span class="keyword">if</span> (!addList.isEmpty())</span><br><span class="line"><span class="comment">//è·å–åˆ—è¡¨ä¸­æœ‰å‡ æ¡å¹¶å€Ÿæ­¤å¾ªç¯</span></span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;addList.count();i++)</span><br><span class="line"> &#123;  <span class="comment">//addList.at(i)å–å‡ºQListå®¹å™¨ä¸­ç¬¬iæ¡æ•°æ®</span></span><br><span class="line">     QHostAddress aHost=addList.at(i);</span><br><span class="line">     <span class="comment">//protocol()å‡½æ•°å¯ä»¥æ˜¾ç¤ºQHostAddressç±»å‹ä¸­çš„åœ°å€æ˜¯ipv4è¿˜æ˜¯ipv6</span></span><br><span class="line">     <span class="keyword">if</span> (QAbstractSocket::IPv4Protocol==aHost.protocol())</span><br><span class="line">     &#123;</span><br><span class="line">      <span class="comment">//  QHostAddressç±»å‹å¯ä»¥toString()è½¬æ¢æˆStringç±»å‹</span></span><br><span class="line">                 localIP=aHost.toString();</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒ-QNetworkInterfaceç±»ï¼š"><a href="#äºŒ-QNetworkInterfaceç±»ï¼š" class="headerlink" title="äºŒ QNetworkInterfaceç±»ï¼š"></a>äºŒ QNetworkInterfaceç±»ï¼š</h3><h4 id="1-allInterfaces-å‡½æ•°ï¼šè¿”å›ä¸»æœºä¸Šæ‰€æœ‰æ¥å£çš„ç½‘ç»œåˆ—è¡¨"><a href="#1-allInterfaces-å‡½æ•°ï¼šè¿”å›ä¸»æœºä¸Šæ‰€æœ‰æ¥å£çš„ç½‘ç»œåˆ—è¡¨" class="headerlink" title="1. allInterfaces()å‡½æ•°ï¼šè¿”å›ä¸»æœºä¸Šæ‰€æœ‰æ¥å£çš„ç½‘ç»œåˆ—è¡¨"></a>1. allInterfaces()å‡½æ•°ï¼šè¿”å›ä¸»æœºä¸Šæ‰€æœ‰æ¥å£çš„ç½‘ç»œåˆ—è¡¨</h4><pre><code>   æ— å‚æ•°ï¼Œè¿”å›å€¼QList&lt;QNetworkInterface&gt;(QNetworkInterfaceç±»å‹çš„æ•°ç»„)   è¿”å›å€¼åŒ…å«QStringç±»å‹çš„ï¼š              æ¥å£åç§° :é€šè¿‡QNetworkInterfacçš„å¯¹è±¡.humanReadableName()              ç¡¬ä»¶åœ°å€ :é€šè¿‡QNetworkInterfacçš„å¯¹è±¡.hardwareAddress()            QList&lt;QNetworkAddressEntry&gt;ç±»å‹çš„ï¼š              ipåœ°å€åˆ—è¡¨(åŒ…å«ip,macåœ°å€å’Œ ): é€šè¿‡QNetworkInterfacçš„å¯¹è±¡.addressEntries()2. .ip().toString()å‡½æ•°: æŠŠQNetworkAddressEntryç±»å‹é‡Œçš„IPè½¬åŒ–ä¸ºString3.  .netmask().toString()å‡½æ•°ï¼šæŠŠQNetworkAddressEntryç±»å‹é‡Œçš„ç‰©ç†macåœ°å€è½¬åŒ–ä¸ºString4.  .broadcast.toString()å‡½æ•°ï¼šæŠŠQNetworkAddressEntryç±»å‹é‡Œçš„å¹¿æ’­åœ°å€è½¬åŒ–ä¸ºString</code></pre><p><img src="https://s1.ax1x.com/2022/07/22/jOUkmd.png" alt=""><br><img src="https://s1.ax1x.com/2022/07/22/jOUK1S.png" alt=""></p><h2 id="2-å®ç°è¿‡ç¨‹ï¼ˆæœåŠ¡ç«¯ï¼‰"><a href="#2-å®ç°è¿‡ç¨‹ï¼ˆæœåŠ¡ç«¯ï¼‰" class="headerlink" title="2.å®ç°è¿‡ç¨‹ï¼ˆæœåŠ¡ç«¯ï¼‰"></a>2.å®ç°è¿‡ç¨‹ï¼ˆæœåŠ¡ç«¯ï¼‰</h2><p>   ui  comboIP:ç›‘å¬åœ°å€<br>       actStart:å¼€å§‹ç›‘å¬æŒ‰é’®<br>       spinPort:ç›‘å¬ç«¯å£æŒ‰é’®<br>       btnSend:å‘é€æŒ‰é’®<br>       editMsgï¼šæ¶ˆæ¯å‘é€æ–‡æœ¬æ¡†</p><h3 id="1-åœ¨mainwindow-hä¸­"><a href="#1-åœ¨mainwindow-hä¸­" class="headerlink" title="1. åœ¨mainwindow.hä¸­"></a>1. åœ¨mainwindow.hä¸­</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">#<span class="meta-keyword">include</span>    <span class="meta-string">&lt;QTcpSocket&gt;</span></span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">include</span>    <span class="meta-string">&lt;QLabel&gt;</span></span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QLabel  *LabListen;<span class="comment">//çŠ¶æ€æ æ ‡ç­¾(æ˜¾ç¤ºæ˜¯å¦ç›‘å¬æˆåŠŸ)</span></span><br><span class="line">    QLabel  *LabSocketState;<span class="comment">//çŠ¶æ€æ æ ‡ç­¾ï¼ˆæ˜¾ç¤ºå¥—æ¥å­—çŠ¶æ€ï¼‰</span></span><br><span class="line"></span><br><span class="line">    QTcpServer *tcpServer; <span class="comment">//TCPæœåŠ¡å™¨(å®ä¾‹åŒ–ä¸€ä¸ªæœåŠ¡å™¨å¯¹è±¡)</span></span><br><span class="line"></span><br><span class="line">    QTcpSocket *tcpSocket;<span class="comment">//TCPé€šè®¯çš„Socket(å®ä¾‹åŒ–ä¸€ä¸ªå¥—æ¥å­—)</span></span><br><span class="line"></span><br><span class="line">    <span class="function">QString <span class="title">getLocalIP</span><span class="params">()</span></span>;<span class="comment">//è·å–æœ¬æœºIPåœ°å€(å†™ä¸€ä¸ªè·å–æœ¬åœ°ipçš„å‡½æ•°)</span></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line"><span class="comment">//è‡ªå®šä¹‰æ§½å‡½æ•°</span></span><br><span class="line">    <span class="comment">//ä¸€æ—¦æœ‰æ–°çš„è¿æ¥å¹¶æˆåŠŸè¿æ¥ï¼ŒQTcpServerç±»å®ä¾‹åŒ–çš„å¯¹è±¡å°±ä¼šè‡ªåŠ¨äº§ç”ŸnewConnection()ä¿¡å·</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>    <span class="title">onNewConnection</span><span class="params">()</span></span>;<span class="comment">//QTcpServerçš„newConnection()ä¿¡å·</span></span><br><span class="line">    <span class="comment">// å¥—æ¥å­—çŠ¶æ€æ”¹å˜æ‰§è¡Œçš„</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>    <span class="title">onSocketStateChange</span><span class="params">(QAbstractSocket::SocketState socketState)</span></span>;</span><br><span class="line">    <span class="comment">// å®¢æˆ·ç«¯å¯åŠ¨è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>    <span class="title">onClientConnected</span><span class="params">()</span></span>; <span class="comment">//Client Socket connected</span></span><br><span class="line">    <span class="comment">//å®¢æˆ·ç«¯å…³æ‰è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>    <span class="title">onClientDisconnected</span><span class="params">()</span></span>;<span class="comment">//Client Socket disconnected</span></span><br><span class="line">    <span class="comment">//è¯»å–socketä¼ å…¥çš„æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>    <span class="title">onSocketReadyRead</span><span class="params">()</span></span>;<span class="comment">//è¯»å–socketä¼ å…¥çš„æ•°æ®</span></span><br><span class="line"><span class="comment">//UIç”Ÿæˆçš„</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_actStart_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_actStop_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_actClear_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnSend_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_actHostInfo_triggered</span><span class="params">()</span></span>;    </span><br></pre></td></tr></table></figure><h3 id="2-åœ¨mainwindow-cppä¸­-include"><a href="#2-åœ¨mainwindow-cppä¸­-include" class="headerlink" title="2. åœ¨mainwindow.cppä¸­(#include    )"></a>2. åœ¨mainwindow.cppä¸­(#include    <QtNetwork>)</h3><h4 id="å®ç°è·å–æœ¬åœ°ip-ç¼–å†™-getLocalIP"><a href="#å®ç°è·å–æœ¬åœ°ip-ç¼–å†™-getLocalIP" class="headerlink" title="å®ç°è·å–æœ¬åœ°ip: ç¼–å†™  getLocalIP()"></a>å®ç°è·å–æœ¬åœ°ip: ç¼–å†™  getLocalIP()</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QString <span class="title">MainWindow::getLocalIP</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//è·å–æœ¬æœºIPv4åœ°å€</span></span><br><span class="line">    QString hostName=QHostInfo::localHostName();<span class="comment">//æœ¬åœ°ä¸»æœºå</span></span><br><span class="line">    QHostInfo   hostInfo=QHostInfo::fromName(hostName);</span><br><span class="line">    QString   localIP=<span class="string">&quot;&quot;</span>;</span><br><span class="line">     <span class="comment">//ä¸€ä¸ªå®¹å™¨</span></span><br><span class="line">    QList&lt;QHostAddress&gt; addList=hostInfo.addresses();<span class="comment">//</span></span><br><span class="line">     <span class="comment">//åˆ¤æ®µæ˜¯å¦ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> (!addList.isEmpty())</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;addList.count();i++)</span><br><span class="line">    &#123;</span><br><span class="line">        QHostAddress aHost=addList.at(i);</span><br><span class="line">        <span class="comment">//ç­›é€‰ipv4ç±»å‹çš„</span></span><br><span class="line">        <span class="keyword">if</span> (QAbstractSocket::IPv4Protocol==aHost.protocol())</span><br><span class="line">        &#123;</span><br><span class="line">            localIP=aHost.toString();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è¿”å›ipåœ°å€</span></span><br><span class="line">    <span class="keyword">return</span> localIP;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ„é€ å‡½æ•°ï¼š"><a href="#æ„é€ å‡½æ•°ï¼š" class="headerlink" title="æ„é€ å‡½æ•°ï¼š"></a>æ„é€ å‡½æ•°ï¼š</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">   MainWindow::MainWindow(QWidget *parent) :</span><br><span class="line">    QMainWindow(parent),</span><br><span class="line">    ui(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//å»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ¡†åå­—ä¸º LabListenï¼Œåˆå§‹æ‰“å°&quot;ç›‘å¬çŠ¶æ€&quot;</span></span><br><span class="line">    LabListen=<span class="keyword">new</span> QLabel(<span class="string">&quot;ç›‘å¬çŠ¶æ€:&quot;</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®æ–‡æœ¬æ¡†(LabListen)çš„æœ€å°å®½åº¦</span></span><br><span class="line">    LabListen-&gt;setMinimumWidth(<span class="number">150</span>);</span><br><span class="line">    <span class="comment">//æŠŠæ–‡æœ¬æ¡†(LabListen)æ·»åŠ åˆ°uiä¸­</span></span><br><span class="line">    ui-&gt;statusBar-&gt;addWidget(LabListen);</span><br><span class="line">    <span class="comment">//å»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ¡†åå­—ä¸º LabSocketStateï¼Œåˆå§‹æ‰“å°&quot;SocketçŠ¶æ€:&quot;</span></span><br><span class="line">    LabSocketState=<span class="keyword">new</span> QLabel(<span class="string">&quot;SocketçŠ¶æ€ï¼š&quot;</span>);</span><br><span class="line">     <span class="comment">//è®¾ç½®æ–‡æœ¬æ¡†(LabSocketState)çš„æœ€å°å®½åº¦</span></span><br><span class="line">    LabSocketState-&gt;setMinimumWidth(<span class="number">200</span>);</span><br><span class="line">    <span class="comment">//æŠŠæ–‡æœ¬æ¡†(LabSocketState)æ·»åŠ åˆ°uiä¸­</span></span><br><span class="line">    ui-&gt;statusBar-&gt;addWidget(LabSocketState);</span><br><span class="line">     <span class="comment">//å¾—åˆ°æœ¬æœºip</span></span><br><span class="line">    QString localIP=getLocalIP();<span class="comment">//æœ¬æœºIP</span></span><br><span class="line">    <span class="comment">//è®¾ç½®çª—å£æ ‡é¢˜ä¸ºæœ¬æœºip</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;setWindowTitle(<span class="keyword">this</span>-&gt;windowTitle()+<span class="string">&quot;----æœ¬æœºIPï¼š&quot;</span>+localIP);</span><br><span class="line">    <span class="comment">//æ˜¾ç¤ºæœ¬æœºipåˆ°comboIPæ§ä»¶</span></span><br><span class="line">    ui-&gt;comboIP-&gt;addItem(localIP);</span><br><span class="line">     <span class="comment">//å®ä¾‹åŒ–ä¸€ä¸ªæœåŠ¡å™¨</span></span><br><span class="line">    tcpServer=<span class="keyword">new</span> QTcpServer(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//(æœåŠ¡å™¨å¼€å§‹ç›‘å¬åæ”¶åˆ°ä¿¡å·ä¼šè‡ªåŠ¨è¿æ¥ï¼ŒæˆåŠŸåä¼šè‡ªåŠ¨äº§ç”ŸnewConnection()ä¿¡å·)ä¸€æ—¦è¿æ¥æœåŠ¡å™¨å¯¹è±¡è¿æ¥æˆåŠŸæ‰§è¡Œæ§½å‡½æ•°onNewConnectio()</span></span><br><span class="line">    connect(tcpServer,SIGNAL(newConnection()),<span class="keyword">this</span>,SLOT(onNewConnection()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™æœåŠ¡å™¨ç›‘å¬å‡½æ•°-on-actStart-triggered"><a href="#ç¼–å†™æœåŠ¡å™¨ç›‘å¬å‡½æ•°-on-actStart-triggered" class="headerlink" title="ç¼–å†™æœåŠ¡å™¨ç›‘å¬å‡½æ•° on_actStart_triggered();"></a>ç¼–å†™æœåŠ¡å™¨ç›‘å¬å‡½æ•° on_actStart_triggered();</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_actStart_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//å¼€å§‹ç›‘å¬</span></span><br><span class="line">   <span class="comment">//è·å–æœ¬åœ°ip</span></span><br><span class="line">    QString     IP=ui-&gt;comboIP-&gt;currentText();<span class="comment">//IPåœ°å€</span></span><br><span class="line">    <span class="comment">//è·å–è‡ªå·±å¡«å†™çš„ç«¯å£</span></span><br><span class="line">    quint16     port=ui-&gt;spinPort-&gt;value();<span class="comment">//ç«¯å£</span></span><br><span class="line">    <span class="comment">//é€šè¿‡ipç”Ÿæˆä¸€ä¸ªQHostAddressç±»å‹çš„ip</span></span><br><span class="line">    <span class="function">QHostAddress    <span class="title">addr</span><span class="params">(IP)</span></span>;</span><br><span class="line">    <span class="comment">//æœåŠ¡å™¨ç›‘å¬æ­¤åœ°å€å’Œæ­¤ç«¯å£</span></span><br><span class="line">    tcpServer-&gt;listen(addr,port);</span><br><span class="line"><span class="comment">//    tcpServer-&gt;listen(QHostAddress::LocalHost,port);// Equivalent to QHostAddress(&quot;127.0.0.1&quot;).</span></span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**å¼€å§‹ç›‘å¬...&quot;</span>);</span><br><span class="line">  <span class="comment">// æ˜¾ç¤ºæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**æœåŠ¡å™¨åœ°å€ï¼š&quot;</span></span><br><span class="line">                       +tcpServer-&gt;serverAddress().toString());</span><br><span class="line">   <span class="comment">//æ˜¾ç¤ºæœåŠ¡å™¨ç«¯å£                    </span></span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**æœåŠ¡å™¨ç«¯å£ï¼š&quot;</span></span><br><span class="line">                       +QString::number(tcpServer-&gt;serverPort()));</span><br><span class="line">   <span class="comment">//å¼€å§‹ç›‘å¬æŒ‰é’®ä¸èƒ½ç‚¹å‡»</span></span><br><span class="line">    ui-&gt;actStart-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">   <span class="comment">// åœæ­¢æŒ‰é’®å¯ä»¥ç‚¹å‡»</span></span><br><span class="line">    ui-&gt;actStop-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">   <span class="comment">//æ–‡æœ¬æ˜¾ç¤º&quot;ç›‘å¬çŠ¶æ€ï¼šæ­£åœ¨ç›‘å¬&quot;</span></span><br><span class="line">    LabListen-&gt;setText(<span class="string">&quot;ç›‘å¬çŠ¶æ€ï¼šæ­£åœ¨ç›‘å¬&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™å®¢æˆ·ç«¯å¯åŠ¨è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„å‡½æ•°onClientConnected"><a href="#ç¼–å†™å®¢æˆ·ç«¯å¯åŠ¨è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„å‡½æ•°onClientConnected" class="headerlink" title="ç¼–å†™å®¢æˆ·ç«¯å¯åŠ¨è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„å‡½æ•°onClientConnected()"></a>ç¼–å†™å®¢æˆ·ç«¯å¯åŠ¨è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„å‡½æ•°onClientConnected()</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åªæ‰“å°ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::onClientConnected</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**client socket connected&quot;</span>);</span><br><span class="line">    <span class="comment">//é€šè¿‡ä¼ å…¥çš„socketå–å‡ºå®¢æˆ·ç«¯åœ°å€å¹¶æ˜¾ç¤º</span></span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**peer address:&quot;</span>+ tcpSocket-&gt;peerAddress().toString());</span><br><span class="line">      <span class="comment">//  é€šè¿‡ä¼ å…¥çš„socketå–å‡ºå®¢æˆ·ç«¯ç«¯å£å¹¶æ˜¾ç¤º                           </span></span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**peer port:&quot;</span>+ QString::number(tcpSocket-&gt;peerPort()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„å‡½æ•°onClientDisconnected"><a href="#ç¼–å†™å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„å‡½æ•°onClientDisconnected" class="headerlink" title="ç¼–å†™å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„å‡½æ•°onClientDisconnected()"></a>ç¼–å†™å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„å‡½æ•°onClientDisconnected()</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::onClientDisconnected</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**client socket disconnected&quot;</span>);</span><br><span class="line">    <span class="comment">//åˆ é™¤Socket</span></span><br><span class="line">    tcpSocket-&gt;deleteLater();</span><br><span class="line">    <span class="comment">//    deleteLater();//QObject::deleteLater();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æˆåŠŸå»ºç«‹æ–°è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„å‡½æ•°onNewConnection"><a href="#ç¼–å†™å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æˆåŠŸå»ºç«‹æ–°è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„å‡½æ•°onNewConnection" class="headerlink" title="ç¼–å†™å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æˆåŠŸå»ºç«‹æ–°è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„å‡½æ•°onNewConnection()"></a>ç¼–å†™å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æˆåŠŸå»ºç«‹æ–°è¿æ¥æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œçš„å‡½æ•°onNewConnection()</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::onNewConnection</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//åˆ›å»ºsocket</span></span><br><span class="line">    tcpSocket = tcpServer-&gt;nextPendingConnection(); <span class="comment">//åˆ›å»ºsocket</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    connect(tcpSocket, SIGNAL(connected()),</span><br><span class="line">            <span class="keyword">this</span>, SLOT(onClientConnected()));</span><br><span class="line">    onClientConnected();<span class="comment">//</span></span><br><span class="line">    <span class="comment">//è¿æ¥æ–­å¼€æ—¶Socketè‡ªåŠ¨äº§ç”Ÿdisconnected()ä¿¡å·</span></span><br><span class="line">    <span class="comment">//å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶æœåŠ¡å™¨æ‰§è¡Œæ§½å‡½æ•°onClientDisconnected()</span></span><br><span class="line">    connect(tcpSocket, SIGNAL(disconnected()),</span><br><span class="line">            <span class="keyword">this</span>, SLOT(onClientDisconnected()));</span><br><span class="line">     <span class="comment">//socketçŠ¶æ€æ”¹å˜æ—¶Socketè‡ªåŠ¨äº§ç”ŸstateChangedä¿¡å·</span></span><br><span class="line">     <span class="comment">//å‚æ•°QAbstractSocket::SocketState socketStateè‡ªåŠ¨æ”¹å˜</span></span><br><span class="line">     <span class="comment">//socketçŠ¶æ€æ”¹å˜æ—¶æœåŠ¡å™¨è¯¥æ‰§è¡Œæ§½å‡½æ•°onSocketStateChange(QAbstractSocket::SocketState)</span></span><br><span class="line">    connect(tcpSocket,SIGNAL(stateChanged(QAbstractSocket::SocketState)),</span><br><span class="line">            <span class="keyword">this</span>,SLOT(onSocketStateChange(QAbstractSocket::SocketState)));</span><br><span class="line">    <span class="comment">//å»ºç«‹äº†æ–°è¿æ¥ï¼Œæ‰§è¡Œæ§½å‡½æ•° onSocketStateChangeæ›´æ”¹é‡Œé¢çš„å€¼</span></span><br><span class="line">    onSocketStateChange(tcpSocket-&gt;state());</span><br><span class="line">     <span class="comment">//å®Œæˆè¿æ¥åä¸€æ—¦Socketé‡ŒèƒŒå†™å…¥ä¿¡æ¯è‡ªåŠ¨äº§ç”ŸreadyRead()ä¿¡å· æ‰§è¡Œæ§½å‡½æ•°onSocketReadyRead()è¯»Socketé‡Œçš„ä¿¡æ¯ </span></span><br><span class="line">    connect(tcpSocket,SIGNAL(readyRead()),</span><br><span class="line">            <span class="keyword">this</span>,SLOT(onSocketReadyRead()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨socketçŠ¶æ€æ”¹å˜è¯¥æ‰§è¡Œçš„å‡½æ•°onSocketStateChange-QAbstractSocket-SocketState-socketState"><a href="#ç¼–å†™å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨socketçŠ¶æ€æ”¹å˜è¯¥æ‰§è¡Œçš„å‡½æ•°onSocketStateChange-QAbstractSocket-SocketState-socketState" class="headerlink" title="ç¼–å†™å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨socketçŠ¶æ€æ”¹å˜è¯¥æ‰§è¡Œçš„å‡½æ•°onSocketStateChange(QAbstractSocket::SocketState socketState)"></a>ç¼–å†™å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨socketçŠ¶æ€æ”¹å˜è¯¥æ‰§è¡Œçš„å‡½æ•°onSocketStateChange(QAbstractSocket::SocketState socketState)</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::onSocketStateChange</span><span class="params">(QAbstractSocket::SocketState socketState)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//ä¸€æ—¦socketçŠ¶æ€å˜åŒ–æ—¶å‚æ•°QAbstractSocket::SocketState socketStateè‡ªåŠ¨æ”¹å˜</span></span><br><span class="line">    <span class="comment">//socketçŠ¶æ€å˜åŒ–æ—¶</span></span><br><span class="line">    <span class="keyword">switch</span>(socketState)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> QAbstractSocket::UnconnectedState:</span><br><span class="line">    <span class="comment">//æ— è¿æ¥</span></span><br><span class="line">        LabSocketState-&gt;setText(<span class="string">&quot;scoketçŠ¶æ€ï¼šUnconnectedState&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">     <span class="comment">//æ­£åœ¨æŸ¥è¯¢   </span></span><br><span class="line">    <span class="keyword">case</span> QAbstractSocket::HostLookupState:</span><br><span class="line">        LabSocketState-&gt;setText(<span class="string">&quot;scoketçŠ¶æ€ï¼šHostLookupState&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">//æ­£åœ¨è¿æ¥  </span></span><br><span class="line">    <span class="keyword">case</span> QAbstractSocket::ConnectingState:</span><br><span class="line">        LabSocketState-&gt;setText(<span class="string">&quot;scoketçŠ¶æ€ï¼šConnectingState&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">       <span class="comment">//è¿æ¥æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">case</span> QAbstractSocket::ConnectedState:</span><br><span class="line">        LabSocketState-&gt;setText(<span class="string">&quot;scoketçŠ¶æ€ï¼šConnectedState&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">       <span class="comment">//è¾¹ç•ŒçŠ¶æ€</span></span><br><span class="line">    <span class="keyword">case</span> QAbstractSocket::BoundState:</span><br><span class="line">        LabSocketState-&gt;setText(<span class="string">&quot;scoketçŠ¶æ€ï¼šBoundState&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">       <span class="comment">//å…³é—­çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">case</span> QAbstractSocket::ClosingState:</span><br><span class="line">        LabSocketState-&gt;setText(<span class="string">&quot;scoketçŠ¶æ€ï¼šClosingState&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">//ç›‘å¬çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">case</span> QAbstractSocket::ListeningState:</span><br><span class="line">        LabSocketState-&gt;setText(<span class="string">&quot;scoketçŠ¶æ€ï¼šListeningState&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™è‡ªåŠ¨è¯»å–Socketå­˜æ”¾çš„æ¶ˆæ¯çš„å‡½æ•°onSocketReadyRead"><a href="#ç¼–å†™è‡ªåŠ¨è¯»å–Socketå­˜æ”¾çš„æ¶ˆæ¯çš„å‡½æ•°onSocketReadyRead" class="headerlink" title="ç¼–å†™è‡ªåŠ¨è¯»å–Socketå­˜æ”¾çš„æ¶ˆæ¯çš„å‡½æ•°onSocketReadyRead()"></a>ç¼–å†™è‡ªåŠ¨è¯»å–Socketå­˜æ”¾çš„æ¶ˆæ¯çš„å‡½æ•°onSocketReadyRead()</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::onSocketReadyRead</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//è¯»å–ç¼“å†²åŒºè¡Œæ–‡æœ¬</span></span><br><span class="line"><span class="comment">//å¦‚æœèƒ½è¯»ä¸€è¡Œï¼Œå°±è¯»ä¸€è¡Œ</span></span><br><span class="line">    <span class="keyword">while</span>(tcpSocket-&gt;canReadLine())</span><br><span class="line">        ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;[in] &quot;</span>+tcpSocket-&gt;readLine());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™æœåŠ¡å™¨åœæ­¢ç›‘å¬å‡½æ•°-on-actStop-triggered"><a href="#ç¼–å†™æœåŠ¡å™¨åœæ­¢ç›‘å¬å‡½æ•°-on-actStop-triggered" class="headerlink" title="ç¼–å†™æœåŠ¡å™¨åœæ­¢ç›‘å¬å‡½æ•° on_actStop_triggered();"></a>ç¼–å†™æœåŠ¡å™¨åœæ­¢ç›‘å¬å‡½æ•° on_actStop_triggered();</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_actStop_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">//tcpServeræ­£åœ¨ç›‘å¬</span></span><br><span class="line">    <span class="keyword">if</span> (tcpServer-&gt;isListening()) </span><br><span class="line">    &#123;  <span class="comment">//åœæ­¢ç›‘å¬</span></span><br><span class="line">        tcpServer-&gt;close();</span><br><span class="line">        <span class="comment">//æ‰“å¼€å¼€å§‹ç›‘å¬æŒ‰é’®</span></span><br><span class="line">        ui-&gt;actStart-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//å…³é—­åœæ­¢ç›‘å¬æŒ‰é’®</span></span><br><span class="line">        ui-&gt;actStop-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">        LabListen-&gt;setText(<span class="string">&quot;ç›‘å¬çŠ¶æ€ï¼šå·²åœæ­¢ç›‘å¬&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™å‘é€å‡½æ•°-on-btnSend-clicked-æ”¶å‘åè®®"><a href="#ç¼–å†™å‘é€å‡½æ•°-on-btnSend-clicked-æ”¶å‘åè®®" class="headerlink" title="ç¼–å†™å‘é€å‡½æ•° on_btnSend_clicked()//æ”¶å‘åè®®"></a>ç¼–å†™å‘é€å‡½æ•° on_btnSend_clicked()//æ”¶å‘åè®®</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_btnSend_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//å‘é€ä¸€è¡Œå­—ç¬¦ä¸²ï¼Œä»¥æ¢è¡Œç¬¦ç»“æŸ</span></span><br><span class="line">    <span class="comment">//è·å–è¾“å…¥æ–‡æœ¬æ¡†çš„å†…å®¹è¿›è¡Œç¼“å†²ï¼ˆmsgå°±æ˜¯ç¼“å†²ï¼‰</span></span><br><span class="line">    QString  msg=ui-&gt;editMsg-&gt;text();</span><br><span class="line">    <span class="comment">//æ˜¾ç¤ºæ–‡æœ¬</span></span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;[out] &quot;</span>+msg);</span><br><span class="line">    <span class="comment">//æ¸…ç©ºè¾“å…¥</span></span><br><span class="line">    ui-&gt;editMsg-&gt;clear();</span><br><span class="line">    <span class="comment">//å®šä½å…‰æ ‡</span></span><br><span class="line">    ui-&gt;editMsg-&gt;setFocus();</span><br><span class="line">     <span class="comment">//æŠŠmsg(ç¼“å†²)é‡Œçš„å†…å®¹è½¬æ¢æˆUtf8</span></span><br><span class="line">    QByteArray  str=msg.toUtf8();</span><br><span class="line">    <span class="comment">//æ·»åŠ æ¢è¡Œç¬¦ä»¥ä¾¿è¯†åˆ«è¾“å…¥ç»“æŸ</span></span><br><span class="line">    str.append(<span class="string">&#x27;\n&#x27;</span>);<span class="comment">//æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ï¼ˆå¿…é¡»ï¼‰</span></span><br><span class="line">    <span class="comment">//æŠŠæ¶ˆæ¯å†™å…¥Socket</span></span><br><span class="line">    tcpSocket-&gt;write(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-å®ç°è¿‡ç¨‹ï¼ˆå®¢æˆ·ç«¯ï¼‰"><a href="#3-å®ç°è¿‡ç¨‹ï¼ˆå®¢æˆ·ç«¯ï¼‰" class="headerlink" title="3.å®ç°è¿‡ç¨‹ï¼ˆå®¢æˆ·ç«¯ï¼‰"></a>3.å®ç°è¿‡ç¨‹ï¼ˆå®¢æˆ·ç«¯ï¼‰</h2><p>  ui  comboServer:æœåŠ¡å™¨åœ°å€æ–‡æœ¬æ¡†(é‡Œé¢æ˜¯è‡ªå·±å¡«çš„ä¸æ˜¯ä¼ è¾“å¾—åˆ°çš„)<br>       actConnect:è¿æ¥æœåŠ¡å™¨æŒ‰é’®<br>       spinPort:éœ€è¦è¿æ¥çš„æœåŠ¡å™¨ç«¯å£æ–‡æœ¬æ¡†((é‡Œé¢æ˜¯è‡ªå·±å¡«çš„ä¸æ˜¯ä¼ è¾“å¾—åˆ°çš„))<br>       actDisconnect:æ–­å¼€æœåŠ¡å™¨æŒ‰é’®<br>       btnSend:å‘é€æŒ‰é’®<br>       editMsgï¼šæ¶ˆæ¯å‘é€æ–‡æœ¬æ¡†</p><h3 id="1-åœ¨mainwindow-hä¸­-1"><a href="#1-åœ¨mainwindow-hä¸­-1" class="headerlink" title="1. åœ¨mainwindow.hä¸­"></a>1. åœ¨mainwindow.hä¸­</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span>    <span class="meta-string">&lt;QTcpSocket&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span>    <span class="meta-string">&lt;QLabel&gt;</span></span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QTcpSocket  *tcpClient;  <span class="comment">//ä½¿ç”¨socketå®ä¾‹åŒ–ä¸€ä¸ªé‡Œå®¢æˆ·ç«¯å¯¹è±¡</span></span><br><span class="line">    QLabel  *LabSocketState;  <span class="comment">//çŠ¶æ€æ æ ‡ç­¾ï¼ˆæ˜¾ç¤ºå¥—æ¥å­—çŠ¶æ€ï¼‰</span></span><br><span class="line">    <span class="function">QString <span class="title">getLocalIP</span><span class="params">()</span></span>;<span class="comment">//è·å–æœ¬æœºIPåœ°å€</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span>    <span class="title">closeEvent</span><span class="params">(QCloseEvent *event)</span></span>;</span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line"><span class="comment">//è‡ªå®šä¹‰æ§½å‡½æ•°</span></span><br><span class="line">    <span class="comment">//å®¢æˆ·ç«¯è¿æ¥æˆåŠŸæ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>    <span class="title">onConnected</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//å®¢æˆ·ç«¯æ–­å¼€æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>    <span class="title">onDisconnected</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// å¥—æ¥å­—çŠ¶æ€æ”¹å˜æ‰§è¡Œçš„</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>    <span class="title">onSocketStateChange</span><span class="params">(QAbstractSocket::SocketState socketState)</span></span>;</span><br><span class="line">    <span class="comment">//è¯»å–socketä¼ å…¥çš„æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>    <span class="title">onSocketReadyRead</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//uiç”Ÿæˆçš„</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_actConnect_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_actDisconnect_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_actClear_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnSend_clicked</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><h3 id="2-åœ¨mainwindow-cppä¸­"><a href="#2-åœ¨mainwindow-cppä¸­" class="headerlink" title="2. åœ¨mainwindow.cppä¸­"></a>2. åœ¨mainwindow.cppä¸­</h3><pre><code>#include &lt;QHostAddress&gt;#include &lt;QHostInfo&gt;)</code></pre><h4 id="å®ç°è·å–æœ¬åœ°ip-ç¼–å†™-getLocalIP-1"><a href="#å®ç°è·å–æœ¬åœ°ip-ç¼–å†™-getLocalIP-1" class="headerlink" title="å®ç°è·å–æœ¬åœ°ip: ç¼–å†™  getLocalIP()"></a>å®ç°è·å–æœ¬åœ°ip: ç¼–å†™  getLocalIP()</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸ä¸Šé¢çš„ä¸€æ ·</span><br></pre></td></tr></table></figure><h4 id="æ„é€ å‡½æ•°ï¼š-1"><a href="#æ„é€ å‡½æ•°ï¼š-1" class="headerlink" title="æ„é€ å‡½æ•°ï¼š"></a>æ„é€ å‡½æ•°ï¼š</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::MainWindow(QWidget *parent) :</span><br><span class="line">    QMainWindow(parent),</span><br><span class="line">    ui(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(<span class="keyword">this</span>);</span><br><span class="line">      <span class="comment">//ä½¿ç”¨socketå®ä¾‹åŒ–ä¸€ä¸ªé‡Œå®¢æˆ·ç«¯å¯¹è±¡(å®¢æˆ·ç«¯æœ¬èº«å°±æ˜¯ä¸ªsocket)</span></span><br><span class="line">      <span class="comment">//åˆ›å»ºsocketå˜é‡</span></span><br><span class="line">    tcpClient=<span class="keyword">new</span> QTcpSocket(<span class="keyword">this</span>); </span><br><span class="line">    <span class="comment">//å»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ¡†åå­—ä¸º LabSocketStateï¼Œåˆå§‹æ‰“å°&quot;SocketçŠ¶æ€:&quot;</span></span><br><span class="line">    LabSocketState=<span class="keyword">new</span> QLabel(<span class="string">&quot;SocketçŠ¶æ€ï¼š&quot;</span>);<span class="comment">//çŠ¶æ€æ æ ‡ç­¾</span></span><br><span class="line">    <span class="comment">//è®¾ç½®æ–‡æœ¬æ¡†(LabSocketState)çš„æœ€å°å®½åº¦</span></span><br><span class="line">    LabSocketState-&gt;setMinimumWidth(<span class="number">250</span>);</span><br><span class="line">     <span class="comment">//æŠŠæ–‡æœ¬æ¡†(LabSocketState)æ·»åŠ åˆ°uiä¸­</span></span><br><span class="line">    ui-&gt;statusBar-&gt;addWidget(LabSocketState);</span><br><span class="line">      <span class="comment">//å¾—åˆ°æœ¬æœºip</span></span><br><span class="line">    QString localIP=getLocalIP();<span class="comment">//æœ¬æœºIP</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;setWindowTitle(<span class="keyword">this</span>-&gt;windowTitle()+<span class="string">&quot;----æœ¬æœºIPï¼š&quot;</span>+localIP);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿æ¥æˆåŠŸè‡ªåŠ¨äº§ç”Ÿconnected()ä¿¡å·ï¼Œæ‰§è¡ŒonConnected()æ§½å‡½æ•°</span></span><br><span class="line">    connect(tcpClient,SIGNAL(connected()),<span class="keyword">this</span>,SLOT(onConnected()));</span><br><span class="line">    <span class="comment">//è¿æ¥å¤±è´¥è‡ªåŠ¨äº§ç”Ÿdisconnected()ä¿¡å·ï¼Œæ‰§è¡ŒonDisconnected()æ§½å‡½æ•°</span></span><br><span class="line">    connect(tcpClient,SIGNAL(disconnected()),<span class="keyword">this</span>,SLOT(onDisconnected()));</span><br><span class="line">     <span class="comment">//è¿æ¥çŠ¶æ€æ”¹å˜è‡ªåŠ¨äº§ç”ŸstateChanged(QAbstractSocket::SocketState)ä¿¡å·ï¼Œæ‰§è¡ŒonSocketStateChange(QAbstractSocket::SocketState))æ§½å‡½æ•°  </span></span><br><span class="line">    connect(tcpClient,SIGNAL(stateChanged(QAbstractSocket::SocketState)),</span><br><span class="line">            <span class="keyword">this</span>,SLOT(onSocketStateChange(QAbstractSocket::SocketState)));</span><br><span class="line">     <span class="comment">// socketé‡Œæœ‰æ¶ˆæ¯å¯ä»¥è¯»æ—¶è‡ªåŠ¨äº§ç”ŸreadyRead()ä¿¡å·ï¼Œæ‰§è¡ŒonSocketReadyRead()æ§½å‡½æ•°      </span></span><br><span class="line">    connect(tcpClient,SIGNAL(readyRead()),</span><br><span class="line">            <span class="keyword">this</span>,SLOT(onSocketReadyRead()));</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™å®¢æˆ·ç«¯æŒ‰ä¸‹å¯åŠ¨è¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°on-actConnect-triggered"><a href="#ç¼–å†™å®¢æˆ·ç«¯æŒ‰ä¸‹å¯åŠ¨è¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°on-actConnect-triggered" class="headerlink" title="ç¼–å†™å®¢æˆ·ç«¯æŒ‰ä¸‹å¯åŠ¨è¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°on_actConnect_triggered()"></a>ç¼–å†™å®¢æˆ·ç«¯æŒ‰ä¸‹å¯åŠ¨è¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°on_actConnect_triggered()</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_actConnect_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//è¿æ¥åˆ°æœåŠ¡å™¨</span></span><br><span class="line">   <span class="comment">//è·å–comboServeræ–‡æœ¬æ¡†é‡Œå¡«å†™çš„æœåŠ¡å™¨åœ°å€</span></span><br><span class="line">    QString     addr=ui-&gt;comboServer-&gt;currentText();</span><br><span class="line">    <span class="comment">//è·å–spinPortæ–‡æœ¬æ¡†é‡Œå¡«å†™çš„æœåŠ¡å™¨ç«¯å£</span></span><br><span class="line">    quint16     port=ui-&gt;spinPort-&gt;value();</span><br><span class="line">    <span class="comment">//å®¢æˆ·ç«¯æ ¹æ®åœ°å€å’Œç«¯å£è¿æ¥åˆ°ä¸»æœº(qtè‡ªå¸¦çš„)</span></span><br><span class="line">    <span class="comment">//å¥—æ¥å­—å®ä¾‹åŒ–çš„å®¢æˆ·ç«¯ä½¿ç”¨qtçš„connectToHostå‡½æ•°å¯ä»¥è‡ªåŠ¨è¿æ¥åˆ°æŸä¸ªæœåŠ¡å™¨</span></span><br><span class="line">    tcpClient-&gt;connectToHost(addr,port);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™å®¢æˆ·ç«¯æ— æ³•è¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°onDisconnected"><a href="#ç¼–å†™å®¢æˆ·ç«¯æ— æ³•è¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°onDisconnected" class="headerlink" title="ç¼–å†™å®¢æˆ·ç«¯æ— æ³•è¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°onDisconnected()"></a>ç¼–å†™å®¢æˆ·ç«¯æ— æ³•è¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°onDisconnected()</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è‡ªåŠ¨çš„</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::onDisconnected</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//disConnected()ä¿¡å·æ§½å‡½æ•°</span></span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**å·²æ–­å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥&quot;</span>);</span><br><span class="line">    ui-&gt;actConnect-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;actDisconnect-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™å®¢æˆ·ç«¯æˆåŠŸè¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°onConnected"><a href="#ç¼–å†™å®¢æˆ·ç«¯æˆåŠŸè¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°onConnected" class="headerlink" title="ç¼–å†™å®¢æˆ·ç«¯æˆåŠŸè¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°onConnected()"></a>ç¼–å†™å®¢æˆ·ç«¯æˆåŠŸè¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°onConnected()</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è‡ªåŠ¨çš„</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::onConnected</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">//connected()ä¿¡å·æ§½å‡½æ•°</span></span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**å·²è¿æ¥åˆ°æœåŠ¡å™¨&quot;</span>);</span><br><span class="line">    <span class="comment">//æ‰“å°æœåŠ¡å™¨çš„åœ°å€(peerä»£è¡¨åŒç±»,è¿æ¥æˆåŠŸåæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å°±æ˜¯ä¸€å¯¹åŒç±»)</span></span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**peer address:&quot;</span>+</span><br><span class="line">                                   tcpClient-&gt;peerAddress().toString());</span><br><span class="line">    <span class="comment">// æ‰“å°æœåŠ¡å™¨çš„ç«¯å£(peerä»£è¡¨åŒç±»)                              </span></span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;**peer port:&quot;</span>+</span><br><span class="line">                                   QString::number(tcpClient-&gt;peerPort()));</span><br><span class="line">     <span class="comment">// ä½¿èƒ½æŒ‰é’®                             </span></span><br><span class="line">    ui-&gt;actConnect-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;actDisconnect-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™å®¢æˆ·ç«¯æŒ‰ä¸‹æ–­å¼€è¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°on-actDisconnect-triggered"><a href="#ç¼–å†™å®¢æˆ·ç«¯æŒ‰ä¸‹æ–­å¼€è¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°on-actDisconnect-triggered" class="headerlink" title="ç¼–å†™å®¢æˆ·ç«¯æŒ‰ä¸‹æ–­å¼€è¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°on_actDisconnect_triggered()"></a>ç¼–å†™å®¢æˆ·ç«¯æŒ‰ä¸‹æ–­å¼€è¿æ¥æ—¶è¯¥æ‰§è¡Œçš„å‡½æ•°on_actDisconnect_triggered()</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_actDisconnect_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//æ–­å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥ </span></span><br><span class="line">     <span class="comment">//åˆ¤æ–­(socketå®ä¾‹åŒ–çš„)å®¢æˆ·ç«¯çŠ¶æ€:(è‡ªåŠ¨çš„)</span></span><br><span class="line">    <span class="keyword">if</span> (tcpClient-&gt;state()==QAbstractSocket::ConnectedState)</span><br><span class="line">       <span class="comment">// å®¢æˆ·æ®µæ–­å¼€ä¸ä¸»æœºçš„è”ç³»(qtè‡ªå¸¦disconnectFromHost())</span></span><br><span class="line">        tcpClient-&gt;disconnectFromHost();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™å®¢æˆ·ç«¯è‡ªåŠ¨è¯»å–socketé‡Œçš„æ¶ˆæ¯çš„å‡½æ•°onSocketReadyRead"><a href="#ç¼–å†™å®¢æˆ·ç«¯è‡ªåŠ¨è¯»å–socketé‡Œçš„æ¶ˆæ¯çš„å‡½æ•°onSocketReadyRead" class="headerlink" title="ç¼–å†™å®¢æˆ·ç«¯è‡ªåŠ¨è¯»å–socketé‡Œçš„æ¶ˆæ¯çš„å‡½æ•°onSocketReadyRead()"></a>ç¼–å†™å®¢æˆ·ç«¯è‡ªåŠ¨è¯»å–socketé‡Œçš„æ¶ˆæ¯çš„å‡½æ•°onSocketReadyRead()</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::onSocketReadyRead</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//readyRead()ä¿¡å·æ§½å‡½æ•°</span></span><br><span class="line">    <span class="comment">//å¦‚æœsocketé‡Œæœ‰æ¶ˆæ¯å¯ä»¥è¯»</span></span><br><span class="line">    <span class="keyword">while</span>(tcpClient-&gt;canReadLine())</span><br><span class="line">        ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;[in] &quot;</span>+tcpClient-&gt;readLine());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™å‘é€å‡½æ•°-on-btnSend-clicked-æ”¶å‘åè®®-1"><a href="#ç¼–å†™å‘é€å‡½æ•°-on-btnSend-clicked-æ”¶å‘åè®®-1" class="headerlink" title="ç¼–å†™å‘é€å‡½æ•° on_btnSend_clicked()//æ”¶å‘åè®®"></a>ç¼–å†™å‘é€å‡½æ•° on_btnSend_clicked()//æ”¶å‘åè®®</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_btnSend_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//å‘é€æ•°æ®</span></span><br><span class="line">    QString  msg=ui-&gt;editMsg-&gt;text();</span><br><span class="line">    ui-&gt;plainTextEdit-&gt;appendPlainText(<span class="string">&quot;[out] &quot;</span>+msg);</span><br><span class="line">    ui-&gt;editMsg-&gt;clear();</span><br><span class="line">    ui-&gt;editMsg-&gt;setFocus();</span><br><span class="line"></span><br><span class="line">    QByteArray  str=msg.toUtf8();</span><br><span class="line">    str.append(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    tcpClient-&gt;write(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™æ¸…ç©ºæ–‡æœ¬å‡½æ•°on-actClear-triggered"><a href="#ç¼–å†™æ¸…ç©ºæ–‡æœ¬å‡½æ•°on-actClear-triggered" class="headerlink" title="ç¼–å†™æ¸…ç©ºæ–‡æœ¬å‡½æ•°on_actClear_triggered()"></a>ç¼–å†™æ¸…ç©ºæ–‡æœ¬å‡½æ•°on_actClear_triggered()</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_actClear_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;plainTextEdit-&gt;clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="æœåŠ¡ç«¯ï¼ˆQTcpServer-tcpServer-TCPæœåŠ¡å™¨-å®ä¾‹åŒ–ä¸€ä¸ªæœåŠ¡å™¨å¯¹è±¡-ï¼‰"><a href="#æœåŠ¡ç«¯ï¼ˆQTcpServer-tcpServer-TCPæœåŠ¡å™¨-å®ä¾‹åŒ–ä¸€ä¸ªæœåŠ¡å™¨å¯¹è±¡-ï¼‰" class="headerlink" title="æœåŠ¡ç«¯ï¼ˆQTcpServer *tcpServer; //TCPæœåŠ¡å™¨(å®ä¾‹åŒ–ä¸€ä¸ªæœåŠ¡å™¨å¯¹è±¡)ï¼‰"></a>æœåŠ¡ç«¯ï¼ˆQTcpServer *tcpServer; //TCPæœåŠ¡å™¨(å®ä¾‹åŒ–ä¸€ä¸ªæœåŠ¡å™¨å¯¹è±¡)ï¼‰</h2><h3 id="1-å…ˆè·å–æœ¬æœºip"><a href="#1-å…ˆè·å–æœ¬æœºip" class="headerlink" title="1.å…ˆè·å–æœ¬æœºip"></a>1.å…ˆè·å–æœ¬æœºip</h3><h3 id="2-æœåŠ¡å™¨ç›‘å¬æœ¬æœºipå’ŒæŸä¸ªç«¯å£-è‡ªå·±å†™çš„-ï¼štcpServer-gt-listen-addr-port"><a href="#2-æœåŠ¡å™¨ç›‘å¬æœ¬æœºipå’ŒæŸä¸ªç«¯å£-è‡ªå·±å†™çš„-ï¼štcpServer-gt-listen-addr-port" class="headerlink" title="2.æœåŠ¡å™¨ç›‘å¬æœ¬æœºipå’ŒæŸä¸ªç«¯å£(è‡ªå·±å†™çš„)ï¼štcpServer-&gt;listen(addr,port);"></a>2.æœåŠ¡å™¨ç›‘å¬æœ¬æœºipå’ŒæŸä¸ªç«¯å£(è‡ªå·±å†™çš„)ï¼štcpServer-&gt;listen(addr,port);</h3><h3 id="3-æœåŠ¡å™¨å¼€å§‹ç›‘å¬åæ”¶åˆ°ä¿¡å·ä¼šè‡ªåŠ¨è¿æ¥ï¼ŒæˆåŠŸåä¼šè‡ªåŠ¨äº§ç”ŸnewConnection-ä¿¡å·-ä¸€æ—¦è¿æ¥æœåŠ¡å™¨å¯¹è±¡è¿æ¥æˆåŠŸæ‰§è¡Œæ§½å‡½æ•°onNewConnectio"><a href="#3-æœåŠ¡å™¨å¼€å§‹ç›‘å¬åæ”¶åˆ°ä¿¡å·ä¼šè‡ªåŠ¨è¿æ¥ï¼ŒæˆåŠŸåä¼šè‡ªåŠ¨äº§ç”ŸnewConnection-ä¿¡å·-ä¸€æ—¦è¿æ¥æœåŠ¡å™¨å¯¹è±¡è¿æ¥æˆåŠŸæ‰§è¡Œæ§½å‡½æ•°onNewConnectio" class="headerlink" title="3.æœåŠ¡å™¨å¼€å§‹ç›‘å¬åæ”¶åˆ°ä¿¡å·ä¼šè‡ªåŠ¨è¿æ¥ï¼ŒæˆåŠŸåä¼šè‡ªåŠ¨äº§ç”ŸnewConnection()ä¿¡å·)ä¸€æ—¦è¿æ¥æœåŠ¡å™¨å¯¹è±¡è¿æ¥æˆåŠŸæ‰§è¡Œæ§½å‡½æ•°onNewConnectio()"></a>3.æœåŠ¡å™¨å¼€å§‹ç›‘å¬åæ”¶åˆ°ä¿¡å·ä¼šè‡ªåŠ¨è¿æ¥ï¼ŒæˆåŠŸåä¼šè‡ªåŠ¨äº§ç”ŸnewConnection()ä¿¡å·)ä¸€æ—¦è¿æ¥æœåŠ¡å™¨å¯¹è±¡è¿æ¥æˆåŠŸæ‰§è¡Œæ§½å‡½æ•°onNewConnectio()</h3><p> 1.å»ºç«‹æœåŠ¡å™¨çš„socket:tcpSocket = tcpServer-&gt;nextPendingConnection();<br> 2.è‡ªåŠ¨è¿æ¥æˆåŠŸåæœåŠ¡å™¨çš„socketè‡ªåŠ¨äº§ç”Ÿconnected()ä¿¡å·æ‰§è¡Œæ§½å‡½æ•°onNewConnectio()<br> 3.è¿æ¥æ–­å¼€æ—¶æœåŠ¡å™¨Socketè‡ªåŠ¨äº§ç”Ÿdisconnected()ä¿¡å·æ‰§è¡Œæ§½å‡½æ•°onClientDisconnected()<br> 4.socketçŠ¶æ€æ”¹å˜æ—¶Socketè‡ªåŠ¨äº§ç”ŸstateChangedä¿¡å·æ‰§è¡Œæ§½å‡½æ•°onSocketStateChange<br> 5.å®Œæˆè¿æ¥åä¸€æ—¦Socketé‡Œå†™å…¥ä¿¡æ¯è‡ªåŠ¨äº§ç”ŸreadyRead()ä¿¡å· æ‰§è¡Œæ§½å‡½æ•°onSocketReadyRead()è¯»Socketé‡Œçš„ä¿¡æ¯<br> 6.å‘é€æ¶ˆæ¯å°±æ˜¯å¾€socketé‡Œå†™æ•°æ®ï¼š tcpSocket-&gt;write(str);</p><h3 id="4-åœæ­¢ç›‘å¬-ï¼štcpServer-gt-close"><a href="#4-åœæ­¢ç›‘å¬-ï¼štcpServer-gt-close" class="headerlink" title="4.åœæ­¢ç›‘å¬ ï¼štcpServer-&gt;close();"></a>4.åœæ­¢ç›‘å¬ ï¼štcpServer-&gt;close();</h3><h2 id="å®¢æˆ·ç«¯ï¼ˆQTcpSocket-tcpClient-ä½¿ç”¨socketå®ä¾‹åŒ–ä¸€ä¸ªé‡Œå®¢æˆ·ç«¯å¯¹è±¡ï¼‰"><a href="#å®¢æˆ·ç«¯ï¼ˆQTcpSocket-tcpClient-ä½¿ç”¨socketå®ä¾‹åŒ–ä¸€ä¸ªé‡Œå®¢æˆ·ç«¯å¯¹è±¡ï¼‰" class="headerlink" title="å®¢æˆ·ç«¯ï¼ˆQTcpSocket  *tcpClient;  //ä½¿ç”¨socketå®ä¾‹åŒ–ä¸€ä¸ªé‡Œå®¢æˆ·ç«¯å¯¹è±¡ï¼‰"></a>å®¢æˆ·ç«¯ï¼ˆQTcpSocket  *tcpClient;  //ä½¿ç”¨socketå®ä¾‹åŒ–ä¸€ä¸ªé‡Œå®¢æˆ·ç«¯å¯¹è±¡ï¼‰</h2><p> 1.ä½¿ç”¨socketå®ä¾‹åŒ–ä¸€ä¸ªé‡Œå®¢æˆ·ç«¯å¯¹è±¡(å®¢æˆ·ç«¯æœ¬èº«å°±æ˜¯ä¸ªsocket)tcpClient=new QTcpSocket(this);<br> 2.è·å–æœ¬æœºipç¼–å†™<br> 3.å®¢æˆ·ç«¯æ ¹æ®åœ°å€å’Œç«¯å£(è‡ªå·±å†™çš„è¦è¿æ¥çš„æœåŠ¡å™¨ipå’Œç«¯å£)è¿æ¥åˆ°ä¸»æœº(qtè‡ªå¸¦çš„):å¥—æ¥å­—å®ä¾‹åŒ–çš„å®¢æˆ·ç«¯ä½¿ç”¨qtçš„connectToHostå‡½æ•°å¯ä»¥è‡ªåŠ¨è¿æ¥åˆ°æŸä¸ªæœåŠ¡å™¨<br> 4.è‡ªåŠ¨è¿æ¥æˆåŠŸåå®¢æˆ·ç«¯è‡ªåŠ¨äº§ç”Ÿconnected()ä¿¡å·æ‰§è¡Œæ§½å‡½æ•°onConnected()<br> 5.å®Œæˆè¿æ¥åä¸€æ—¦Socketé‡Œå†™å…¥ä¿¡æ¯è‡ªåŠ¨äº§ç”ŸreadyRead()ä¿¡å· æ‰§è¡Œæ§½å‡½æ•°onSocketReadyRead()è¯»Socketé‡Œçš„ä¿¡æ¯<br> 6.è¿æ¥å¤±è´¥è‡ªåŠ¨äº§ç”Ÿdisconnected()ä¿¡å·ï¼Œæ‰§è¡ŒonDisconnected()æ§½å‡½æ•°<br> 7.è¿æ¥çŠ¶æ€æ”¹å˜è‡ªåŠ¨äº§ç”ŸstateChanged(QAbstractSocket::SocketState)ä¿¡å·ï¼Œæ‰§è¡ŒonSocketStateChange(QAbstractSocket::SocketState))æ§½å‡½æ•°<br> 8.å‘é€æ¶ˆæ¯å°±æ˜¯å¾€socketé‡Œå†™æ•°æ®ï¼štcpClient-&gt;write(str);<br> 9.åœæ­¢è¿æ¥ï¼š å®¢æˆ·æ®µæ–­å¼€ä¸ä¸»æœºçš„è”ç³»(qtè‡ªå¸¦disconnectFromHost())ï¼štcpClient-&gt;disconnectFromHost();</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„:"></a>æ³¨æ„:</h2><pre><code>    æœåŠ¡ç«¯çš„ipæ˜¯è·å–æœ¬æœºipå¾—åˆ°çš„ï¼Œç«¯å£è‡ªå·±å†™çš„ï¼›    å®¢æˆ·ç«¯è¦è¿æ¥å“ªä¸ªæœåŠ¡å™¨çš„å“ªä¸ªç«¯å£æ˜¯è‡ªå·±å†™çš„ :    å»ºç«‹è¿æ¥åç”±äºæ˜¯åŒç±»äº†ï¼Œå¯ä»¥é€šè¿‡å¥—æ¥å­—é‡Œçš„peeræŸ¥çœ‹å¯¹æ–¹çš„ipå’Œç«¯å£ï¼›    æœåŠ¡å™¨æŸ¥çœ‹å®¢æˆ·ç«¯çš„ï¼š    IPï¼š tcpSocket-&gt;peerAddress().toString()     ç«¯å£ï¼šQString::number(tcpSocket-&gt;peerPort())    å®¢æˆ·ç«¯æŸ¥çœ‹æœåŠ¡å™¨çš„ï¼š    ip:    tcpClient-&gt;peerAddress().toString()    ç«¯å£ï¼šQString::number(tcpClient-&gt;peerPort())</code></pre><h2 id="æºç ï¼š"><a href="#æºç ï¼š" class="headerlink" title="æºç ï¼š"></a>æºç ï¼š</h2><p>   é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1xqtD4-d9SbWwVlFMMrLxEg?pwd=sjii">https://pan.baidu.com/s/1xqtD4-d9SbWwVlFMMrLxEg?pwd=sjii</a><br>æå–ç ï¼šsjii</p>]]></content>
      
      
      <categories>
          
          <category> qt </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>äººè„¸è¯†åˆ«</title>
      <link href="blog/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/"/>
      <url>blog/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä¸€è¿‡ç¨‹"><a href="#ä¸€è¿‡ç¨‹" class="headerlink" title="ä¸€è¿‡ç¨‹"></a>ä¸€è¿‡ç¨‹</h1><h2 id="1ç”Ÿæˆcsvæ–‡ä»¶ï¼ˆåœ¨ç¼–è¯‘ä¸‹ç›®å½•é‡Œçš„1-ã€2ã€ã€‚ã€‚ã€‚é‡Œé¢æ¯ä¸ªç”¨æˆ·ä¸€ä¸ªï¼‰"><a href="#1ç”Ÿæˆcsvæ–‡ä»¶ï¼ˆåœ¨ç¼–è¯‘ä¸‹ç›®å½•é‡Œçš„1-ã€2ã€ã€‚ã€‚ã€‚é‡Œé¢æ¯ä¸ªç”¨æˆ·ä¸€ä¸ªï¼‰" class="headerlink" title="1ç”Ÿæˆcsvæ–‡ä»¶ï¼ˆåœ¨ç¼–è¯‘ä¸‹ç›®å½•é‡Œçš„1 ã€2ã€ã€‚ã€‚ã€‚é‡Œé¢æ¯ä¸ªç”¨æˆ·ä¸€ä¸ªï¼‰"></a>1ç”Ÿæˆcsvæ–‡ä»¶ï¼ˆåœ¨ç¼–è¯‘ä¸‹ç›®å½•é‡Œçš„1 ã€2ã€ã€‚ã€‚ã€‚é‡Œé¢æ¯ä¸ªç”¨æˆ·ä¸€ä¸ªï¼‰</h2><p> 1.1æ‹ç…§ ï¼Œç”Ÿæˆtempæ–‡ä»¶å¤¹æ”¾å…¥æ‹ç…§çš„å›¾ç‰‡<br> 1.2åŠ è½½äººè„¸è¯†åˆ«ç‰¹å¾å™¨ï¼Œè£å‰ªç”Ÿæˆæ ·æœ¬ï¼ˆ50*60ï¼‰ï¼Œç”Ÿæˆ1æ–‡ä»¶å¤¹<br> 1.3ç”ŸæˆCSVæ–‡ä»¶ç»™äººè„¸ç¼–å·<br> 1.4ç”Ÿæˆuseræ–‡ä»¶ï¼ˆå‰é¢ç¼–å·ï¼Œåé¢äººåï¼‰</p><h2 id="2é‡‡æ ·å›¾ç‰‡ç°åº¦åŒ–å¤„ç†"><a href="#2é‡‡æ ·å›¾ç‰‡ç°åº¦åŒ–å¤„ç†" class="headerlink" title="2é‡‡æ ·å›¾ç‰‡ç°åº¦åŒ–å¤„ç†"></a>2é‡‡æ ·å›¾ç‰‡ç°åº¦åŒ–å¤„ç†</h2><h2 id="3ç›´æ–¹å›¾å‡è¡¡"><a href="#3ç›´æ–¹å›¾å‡è¡¡" class="headerlink" title="3ç›´æ–¹å›¾å‡è¡¡"></a>3ç›´æ–¹å›¾å‡è¡¡</h2><h2 id="4è®­ç»ƒï¼š-å›¾ç‰‡ç»™æ¨¡å‹è®­ç»ƒå™¨ç”Ÿæˆfacemodel-xmlæ–‡ä»¶"><a href="#4è®­ç»ƒï¼š-å›¾ç‰‡ç»™æ¨¡å‹è®­ç»ƒå™¨ç”Ÿæˆfacemodel-xmlæ–‡ä»¶" class="headerlink" title="4è®­ç»ƒï¼š å›¾ç‰‡ç»™æ¨¡å‹è®­ç»ƒå™¨ç”Ÿæˆfacemodel.xmlæ–‡ä»¶"></a>4è®­ç»ƒï¼š å›¾ç‰‡ç»™æ¨¡å‹è®­ç»ƒå™¨ç”Ÿæˆfacemodel.xmlæ–‡ä»¶</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Ptr&lt;FaceRecognizer&gt; model = createEigenFaceRecognizer();</span><br><span class="line">model-&gt;train(images, labels);</span><br><span class="line">model-&gt;save(<span class="string">&quot;MyFacePCAModel.xml&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="5äººè„¸è¯†åˆ«"><a href="#5äººè„¸è¯†åˆ«" class="headerlink" title="5äººè„¸è¯†åˆ«"></a>5äººè„¸è¯†åˆ«</h2><p> 5.1æ‰“å¼€æ‘„åƒå¤´é‡‡é›†æ•°æ®<br> 5.2ä½¿ç”¨äººè„¸ç‰¹å¾çº§è”å™¨â€”æ£€æµ‹åˆ°äººè„¸ï¼ˆç‰¹å¾æå–ï¼Œåœˆä¸»äººè„¸ï¼‰<br> 5.3åŠ è½½åˆšæ‰è®­ç»ƒçš„æ¨¡å‹ï¼Œè¿›è¡Œäººè„¸è¯†åˆ«<br>é€šè¿‡csv\user.txtâ€”æ˜¾ç¤ºç”¨æˆ·å</p><h1 id="äºŒå®ç°å‡½æ•°"><a href="#äºŒå®ç°å‡½æ•°" class="headerlink" title="äºŒå®ç°å‡½æ•°"></a>äºŒå®ç°å‡½æ•°</h1><h2 id="ä¿®æ”¹æ–‡ä»¶åœ°å€"><a href="#ä¿®æ”¹æ–‡ä»¶åœ°å€" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶åœ°å€"></a>ä¿®æ”¹æ–‡ä»¶åœ°å€</h2><p>1.mainwidows.cpp 134è¡Œ/home/lixiao/opencv/opencv-3.4.5éœ€è¦æ”¹æˆè‡ªå·±è£…opencvçš„ä½ç½®<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> face_Classifier_name = <span class="string">&quot;/home/lixiao/opencv/opencv-3.4.5/data/haarcascades_cuda/haarcascade_frontalface_alt.xml&quot;</span>;</span><br></pre></td></tr></table></figure><br>2.mainwidows.cpp 26è¡Œç™»å½•ç•Œé¢çš„èƒŒæ™¯å›¾ç‰‡åœ°å€<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPixmap <span class="title">logo</span><span class="params">(<span class="string">&quot;/home/lixiao/face/opencv.jpg&quot;</span>)</span></span>;</span><br></pre></td></tr></table></figure></p><h2 id="ä¿®æ”¹åœˆä½äººè„¸çš„åœ°æ–¹-172è¡Œ"><a href="#ä¿®æ”¹åœˆä½äººè„¸çš„åœ°æ–¹-172è¡Œ" class="headerlink" title="ä¿®æ”¹åœˆä½äººè„¸çš„åœ°æ–¹ 172è¡Œ"></a>ä¿®æ”¹åœˆä½äººè„¸çš„åœ°æ–¹ 172è¡Œ</h2><p>mainwidows.cpp 172è¡Œ<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//imshow(&quot;face&quot;, face[i]);</span></span><br><span class="line">               <span class="keyword">if</span> (faces[i].height &gt; <span class="number">0</span> &amp;&amp; faces[i].width &gt; <span class="number">0</span>)</span><br><span class="line">               &#123;</span><br><span class="line">                   face = gray(faces[i]);</span><br><span class="line">                   cv::rectangle(frame, faces[i], cv::Scalar(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>);</span><br><span class="line">                   <span class="function">emit <span class="title">getQimage</span><span class="params">(frame)</span></span>;</span><br><span class="line">               &#125;</span><br></pre></td></tr></table></figure></p><h2 id="æ‰“å°åå­—ï¼ˆæ˜¾ç¤ºè¯†åˆ«ç»“æœ"><a href="#æ‰“å°åå­—ï¼ˆæ˜¾ç¤ºè¯†åˆ«ç»“æœ" class="headerlink" title="æ‰“å°åå­—ï¼ˆæ˜¾ç¤ºè¯†åˆ«ç»“æœ)"></a>æ‰“å°åå­—ï¼ˆæ˜¾ç¤ºè¯†åˆ«ç»“æœ)</h2><p>mainwidows.cpp 217è¡Œ<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QStringList <span class="built_in">list</span> = line.split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">                ui-&gt;lineEdit_user-&gt;setText(<span class="built_in">list</span>[<span class="number">1</span>]);<span class="comment">//æ˜¾ç¤ºè¯†åˆ«ç»“æœçš„åå­—</span></span><br></pre></td></tr></table></figure><br>å›¾ç‰‡æ˜¾ç¤ºåå­—<br>mainwidows.cpp 217è¡Œä¸‹åŠ å…¥putText()<br>    å‚æ•°pointâ€”æ–‡å­—æ˜¾ç¤ºçš„ä½ç½®<br>        Scalarâ€”é¢œè‰²<br>        2â€”çº¿çš„ç²—ç»†<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">putText(frame,<span class="built_in">list</span>[<span class="number">1</span>].toStdString(),Point(<span class="number">10</span>,<span class="number">50</span>),FONT_HERSHEY_SIMPLEX,<span class="number">2</span>,Scalar(<span class="number">128</span>,<span class="number">0</span>,<span class="number">255</span>),<span class="number">2</span>,LINE_4);</span><br></pre></td></tr></table></figure></p><h2 id="ç»˜åˆ¶åœ†å½¢"><a href="#ç»˜åˆ¶åœ†å½¢" class="headerlink" title="ç»˜åˆ¶åœ†å½¢"></a>ç»˜åˆ¶åœ†å½¢</h2><p>æ–¹æ³•<br>circle(img, center, radius, color, thickness, lineType, shift)<br>å‚æ•°ï¼š<br>1ã€img:å›¾åƒï¼›<br>2ã€centerï¼šåœ†çš„ä¸­å¿ƒã€‚<br>3ã€radiusï¼šåœ†åŠå¾„ã€‚<br>4ã€colorï¼šåœ†é¢œè‰²æˆ–äº®åº¦ï¼ˆç°åº¦å›¾åƒï¼‰ã€‚<br>5ã€thicknessï¼šè½®å»“åšåº¦ã€‚è´Ÿå€¼ï¼Œå¡«å……ã€‚<br>6ã€lineTypeï¼šçº¿å‹ã€‚<br>7ã€shiftï¼šç‚¹åæ ‡ä¸­å°æ•°ä½æ•°çš„å‚æ•°ç§»ä½æ•°ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">newimage = (<span class="number">500</span>, <span class="number">500</span>, <span class="number">3</span>)</span><br><span class="line">image = np.zeros(newimage, np.uint8)</span><br><span class="line">cv2.circle(image, (<span class="number">150</span>,<span class="number">150</span>), <span class="number">100</span>, (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">2</span>)</span><br><span class="line">cv2.circle(image, (<span class="number">300</span>,<span class="number">150</span>), <span class="number">50</span>, (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">-1</span>)</span><br><span class="line">cv2.imshow(&#x27;circle&#x27;, image)</span><br><span class="line">cv2.waitKey(<span class="number">0</span>)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure></p><h1 id="ä»£ç ï¼ˆèŠ‚é€‰ï¼‰"><a href="#ä»£ç ï¼ˆèŠ‚é€‰ï¼‰" class="headerlink" title="ä»£ç ï¼ˆèŠ‚é€‰ï¼‰"></a>ä»£ç ï¼ˆèŠ‚é€‰ï¼‰</h1><p>mainwindow.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ui_mainwindow.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;opencv2/core.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;opencv2/face.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;opencv2/imgproc/types_c.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;opencv2/face/facerec.hpp&quot;</span></span></span><br><span class="line"><span class="comment">//#include &quot;opencv2/contrib/contrib.hpp&quot;</span></span><br><span class="line"><span class="comment">//#include&lt;face/face.hpp&gt;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv::face;</span><br><span class="line"><span class="comment">//using namespace cv;</span></span><br><span class="line"><span class="comment">// SVM;</span></span><br><span class="line">MainWindow::MainWindow(QWidget *parent) :</span><br><span class="line">    QMainWindow(parent),</span><br><span class="line">    ui(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(<span class="keyword">this</span>);</span><br><span class="line">    <span class="function">QPixmap <span class="title">logo</span><span class="params">(<span class="string">&quot;/home/lixiao/face/opencv1.jpg&quot;</span>)</span></span>;</span><br><span class="line">    ui-&gt;label_video-&gt;setPixmap(logo);</span><br><span class="line">    connect(<span class="keyword">this</span>, SIGNAL(getQimage(cv::Mat&amp;)), <span class="keyword">this</span>, SLOT(showimage(cv::Mat&amp;)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::~MainWindow()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::Sleep</span><span class="params">(<span class="keyword">int</span> msec)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QTime dieTime = QTime::currentTime().addMSecs(msec);</span><br><span class="line">       <span class="keyword">while</span>( QTime::currentTime() &lt; dieTime )</span><br><span class="line">           QCoreApplication::processEvents(QEventLoop::AllEvents, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::deldir</span><span class="params">(QString &amp;path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (path.isEmpty())</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="function">QDir <span class="title">dir</span><span class="params">(path)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(!dir.exists())</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">    dir.setFilter(QDir::AllEntries | QDir::NoDotAndDotDot);</span><br><span class="line">    QFileInfoList fileList = dir.entryInfoList();</span><br><span class="line">    foreach (QFileInfo fi, fileList)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (fi.isFile())</span><br><span class="line">            fi.dir().remove(fi.fileName());</span><br><span class="line">        <span class="comment">//else</span></span><br><span class="line">        <span class="comment">//   ; //DeleteDirectory(fi.absoluteFilePath());</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ ·æœ¬è·å–</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_pushButton_photo_sample_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PhotoIn = <span class="keyword">new</span> Dialogin(<span class="keyword">this</span>);</span><br><span class="line">    PhotoIn-&gt;setMaximumSize(QSize(<span class="number">670</span>,<span class="number">610</span>));</span><br><span class="line">    PhotoIn-&gt;setMinimumSize(QSize(<span class="number">670</span>,<span class="number">610</span>));</span><br><span class="line">    PhotoIn-&gt;show();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ¨¡å‹è®­ç»ƒå¼€å§‹è¯†åˆ«</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_pushButton_train_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QMessageBox *startbox = <span class="keyword">new</span> QMessageBox(QMessageBox::Warning  ,<span class="string">&quot;ä¿¡æ¯&quot;</span>,<span class="string">&quot;å¼€å§‹è®­ç»ƒè¯·ç¨åï¼ï¼ï¼&quot;</span>,QMessageBox::NoButton,<span class="keyword">this</span>);<span class="comment">//ç•Œé¢å¯¹è¯æ¡†</span></span><br><span class="line">    startbox-&gt;show();</span><br><span class="line">    Sleep(<span class="number">1000</span>);</span><br><span class="line">    <span class="function">QFile <span class="title">csv</span><span class="params">(QDir::currentPath() + <span class="string">&quot;/csv.txt&quot;</span>)</span></span>;<span class="comment">//è¯»å–csv.txtæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span>(!csv.open(QIODevice::ReadOnly | QIODevice::Text))</span><br><span class="line">    &#123;</span><br><span class="line">        qDebug() &lt;&lt; csv.errorString() &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        startbox-&gt;close();</span><br><span class="line">        QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;é”™è¯¯&quot;</span>),tr(<span class="string">&quot;csvæ–‡ä»¶æœªæ‰¾åˆ°ï¼ï¼ï¼&quot;</span>),QMessageBox::Ok);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Mat&gt;images;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;labels;</span><br><span class="line">    <span class="keyword">while</span>(!csv.atEnd())</span><br><span class="line">    &#123;</span><br><span class="line">        QString p = csv.readLine(<span class="number">128</span>);</span><br><span class="line">        QStringList qlist = p.split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(qlist.size() == <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            QString a =qlist[<span class="number">0</span>];</span><br><span class="line">            QByteArray b =  a.toLatin1();</span><br><span class="line">            <span class="keyword">char</span> *path = b.data();</span><br><span class="line">            <span class="comment">// char *path =  (qlist[0].toLatin1()).data();</span></span><br><span class="line">            <span class="keyword">int</span> tag = qlist[<span class="number">1</span>].mid(<span class="number">0</span>, <span class="number">1</span>).toInt();</span><br><span class="line"></span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">string</span> filepath =cv::format(path);</span><br><span class="line">            images.push_back(cv::imread(path, <span class="number">0</span>));</span><br><span class="line">            labels.push_back(tag);</span><br><span class="line">            qDebug()&lt;&lt; qlist.size() &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(images.size() &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;é”™è¯¯&quot;</span>),tr(<span class="string">&quot;åŠ è½½å›¾ç‰‡å¤±è´¥ï¼ï¼ï¼&quot;</span>),QMessageBox::Ok);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   cv::Ptr&lt;face::FaceRecognizer&gt; model = EigenFaceRecognizer::create();</span><br><span class="line">   <span class="comment">//cv::Ptr&lt;FaceRecognizer&gt; model = EigenFaceRecognizer::create();</span></span><br><span class="line">    model-&gt;train(images, labels);</span><br><span class="line">    model-&gt;save(<span class="string">&quot;facemodel.xml&quot;</span>);</span><br><span class="line">    startbox-&gt;close();</span><br><span class="line">    QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;ä¿¡æ¯&quot;</span>),tr(<span class="string">&quot;æ­å–œæ¨¡å‹è®­ç»ƒå®Œæˆï¼ï¼ï¼&quot;</span>),QMessageBox::Ok);</span><br><span class="line"><span class="comment">/**********************************/</span></span><br><span class="line">    <span class="keyword">double</span> confidence=<span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">int</span> predictedLabel=<span class="number">-1</span>;</span><br><span class="line">        CvCapture* capture = cvCaptureFromCAM(<span class="number">0</span>);    <span class="comment">//æ‰“å¼€é»˜è®¤æ‘„åƒå¤´</span></span><br><span class="line">        cvSetCaptureProperty(capture, CV_CAP_PROP_FRAME_WIDTH, <span class="number">640</span>);</span><br><span class="line">        cvSetCaptureProperty(capture, CV_CAP_PROP_FRAME_HEIGHT, <span class="number">480</span>);</span><br><span class="line">        <span class="keyword">if</span> (capture == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;é”™è¯¯&quot;</span>),tr(<span class="string">&quot;æ‘„åƒå¤´æ‰“å¼€å¤±è´¥&quot;</span>),QMessageBox::Ok);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        IplImage* frames;</span><br><span class="line">        cv::Mat frame;</span><br><span class="line">        cv::Mat gray;</span><br><span class="line">        cv::CascadeClassifier faceClassifier;</span><br><span class="line">        <span class="comment">//è®­ç»ƒå¥½çš„æ–‡ä»¶åç§°ï¼Œæ”¾ç½®åœ¨å¯æ‰§è¡Œæ–‡ä»¶åŒç›®å½•ä¸‹</span></span><br><span class="line">        <span class="keyword">bool</span> flag =faceClassifier.load(<span class="string">&quot;/home/lixiao/opencv/opencv-3.4.5/data/haarcascades_cuda/haarcascade_frontalface_alt.xml&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(flag == <span class="literal">false</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;é”™è¯¯&quot;</span>),tr(<span class="string">&quot;ä¸èƒ½åŠ è½½haarcascade_frontalface_alt2.xmlæ–‡ä»¶ï¼ï¼&quot;</span>),QMessageBox::Ok);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">QFile <span class="title">facemodel</span><span class="params">(QDir::currentPath() + <span class="string">&quot;/facemodel.xml&quot;</span>)</span></span>;<span class="comment">//å¯»æ‰¾facemodel.xml</span></span><br><span class="line">        <span class="keyword">if</span>(!facemodel.open(QIODevice::ReadOnly | QIODevice::Text))</span><br><span class="line">        &#123;</span><br><span class="line">            qDebug() &lt;&lt; facemodel.errorString() &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            cvReleaseCapture(&amp;capture);</span><br><span class="line">            QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;é”™è¯¯&quot;</span>),tr(<span class="string">&quot;facemodel.xmlæ–‡ä»¶æœªæ‰¾åˆ°ï¼ï¼ï¼&quot;</span>),QMessageBox::Ok);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//model-&gt;predict(labels,predictedLabel,confidence);</span></span><br><span class="line">        stopflag = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span>(stopflag == <span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Sleep(<span class="number">100</span>);</span><br><span class="line">            frames = cvQueryFrame( capture );</span><br><span class="line">            frame=cvarrToMat(frames);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Rect&gt; faces;</span><br><span class="line">            <span class="comment">//RGBè½¬BGRæ ¼å¼</span></span><br><span class="line">            cv::cvtColor(frame, gray, CV_BGR2GRAY);</span><br><span class="line">            <span class="comment">//å˜æ¢åçš„å›¾åƒè¿›è¡Œç›´æ–¹å›¾å‡å€¼åŒ–å¤„ç†</span></span><br><span class="line">            cv::equalizeHist(gray, gray);</span><br><span class="line">            <span class="comment">//é€šè¿‡äººè„¸åˆ†ç±»å™¨è¯†åˆ«æœ‰å¤šå°‘äººè„¸</span></span><br><span class="line">            faceClassifier.detectMultiScale(gray, faces, <span class="number">1.1</span>, <span class="number">2</span>, cv::CASCADE_FIND_BIGGEST_OBJECT|cv::CASCADE_DO_ROUGH_SEARCH, cv::Size(<span class="number">50</span>, <span class="number">50</span>));</span><br><span class="line">            <span class="comment">//qDebug() &lt;&lt; &quot;faces.size =&quot; &lt;&lt; faces.size() &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">            cv::Mat face;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; faces.size(); i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//imshow(&quot;face&quot;, face[i]);</span></span><br><span class="line">                <span class="keyword">if</span> (faces[i].height &gt; <span class="number">0</span> &amp;&amp; faces[i].width &gt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    face = gray(faces[i]);</span><br><span class="line"><span class="comment">//                    cv::rectangle(frame, faces[i], cv::Scalar(0, 0, 255), 1, 8, 0);</span></span><br><span class="line"><span class="comment">//                    emit getQimage(frame);</span></span><br><span class="line">                    <span class="function">Point <span class="title">center</span><span class="params">(faces[i].x + faces[i].width*<span class="number">0.5</span>, faces[i].y + faces[i].height*<span class="number">0.5</span>)</span></span>;</span><br><span class="line">                     cv::ellipse(frame, center,Size(faces[i].width*<span class="number">0.5</span>, faces[i].height*<span class="number">0.5</span>), <span class="number">0</span>, <span class="number">0</span>, <span class="number">360</span>, Scalar(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                      <span class="function">emit <span class="title">getQimage</span><span class="params">(frame)</span></span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(faces.size() == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ui-&gt;lineEdit_confidence-&gt;clear();</span><br><span class="line">                ui-&gt;lineEdit_user-&gt;clear();</span><br><span class="line">                <span class="function">emit <span class="title">getQimage</span><span class="params">(frame)</span></span>;</span><br><span class="line">            &#125;</span><br><span class="line">            cv::Mat face_test;</span><br><span class="line">            <span class="keyword">if</span>((face.rows &gt; <span class="number">112</span>) || (face.cols &gt; <span class="number">92</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                cv::resize(face, face_test, cv::Size(<span class="number">92</span>,<span class="number">112</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//int predictPCA = 0;</span></span><br><span class="line">            <span class="keyword">double</span> confidence=<span class="number">0.0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!face_test.empty())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//æµ‹è¯•å›¾åƒåº”è¯¥æ˜¯ç°åº¦å›¾</span></span><br><span class="line">                <span class="keyword">int</span> predictedLabel=<span class="number">-1</span>;</span><br><span class="line">                <span class="comment">//predictPCA = model-&gt;predict(face_test);</span></span><br><span class="line">                model-&gt;predict(face_test,predictedLabel,confidence);</span><br><span class="line">                qDebug() &lt;&lt; <span class="string">&quot;=============================&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">                ui-&gt;lineEdit_confidence-&gt;setText(QString::number(confidence));<span class="comment">//æ˜¾ç¤ºç½®ä¿¡åº¦</span></span><br><span class="line">    <span class="comment">//            qDebug() &lt;&lt; &quot;predictPCA =&quot; &lt;&lt; predictPCA &lt;&lt; endl;</span></span><br><span class="line">    <span class="comment">//            qDebug()&lt;&lt;&quot;predictedLabel:&quot;&lt;&lt;predictedLabel;</span></span><br><span class="line">    <span class="comment">//            qDebug()&lt;&lt;&quot;confidence:&quot;&lt;&lt;confidence;</span></span><br><span class="line"></span><br><span class="line">                <span class="function">QFile <span class="title">user</span><span class="params">(QDir::currentPath() + <span class="string">&quot;/usr.txt&quot;</span>)</span></span>;</span><br><span class="line">                <span class="keyword">if</span>(!user.open(QIODevice::ReadWrite | QIODevice::Text))</span><br><span class="line">                &#123;</span><br><span class="line">                    qDebug() &lt;&lt; user.errorString() &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                qint64 usrlinenum =<span class="number">0</span>;</span><br><span class="line">                <span class="comment">//usrlinenum=1;</span></span><br><span class="line">                QString line;</span><br><span class="line">                <span class="function">QTextStream <span class="title">in</span><span class="params">(&amp;user)</span></span>;</span><br><span class="line">                <span class="keyword">while</span>((!in.atEnd()) &amp;&amp; (usrlinenum &lt; predictedLabel) )</span><br><span class="line">                &#123;</span><br><span class="line">                   line = in.readLine();</span><br><span class="line">                   usrlinenum++;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                QStringList <span class="built_in">list</span> = line.split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">                ui-&gt;lineEdit_user-&gt;setText(<span class="built_in">list</span>[<span class="number">1</span>]);<span class="comment">//æ˜¾ç¤ºè¯†åˆ«ç»“æœçš„åå­—</span></span><br><span class="line">                ui-&gt;label_3-&gt;setText(<span class="built_in">list</span>[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">         cvReleaseCapture(&amp;capture);</span><br><span class="line">         <span class="function">QPixmap <span class="title">logo</span><span class="params">(QDir::currentPath() + <span class="string">&quot;/opencv.jpg&quot;</span>)</span></span>;</span><br><span class="line">         ui-&gt;label_video-&gt;setPixmap(logo);</span><br><span class="line">        <span class="comment">//startbox-&gt;close();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::showimage</span><span class="params">(cv::Mat &amp;image)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat src = image ;</span><br><span class="line">    cvtColor( src, src, CV_BGR2RGB );</span><br><span class="line">    QImage img=QImage((<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span>*)(src.data), src.cols, src.rows, QImage::Format_RGB888);</span><br><span class="line">    QPixmap pix = QPixmap::fromImage(img);</span><br><span class="line">    ui-&gt;label_video-&gt;setPixmap(pix);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åœæ­¢è¯†åˆ«</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_pushButton_face_reco_stop_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     stopflag = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ¸…é™¤æ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MainWindow::on_pushButton_clear_data_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString path = QDir::currentPath();</span><br><span class="line">    <span class="function">QFile <span class="title">facemodel</span><span class="params">(path + <span class="string">&quot;/facemodel.xml&quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(facemodel.exists())</span><br><span class="line">    &#123;</span><br><span class="line">        facemodel.remove();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QFile <span class="title">csv</span><span class="params">(path + <span class="string">&quot;/csv.txt&quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(csv.exists())</span><br><span class="line">    &#123;</span><br><span class="line">        csv.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>dialogin.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;dialogin.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ui_dialogin.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;opencv2/core.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;opencv2/face.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;opencv2/imgproc/types_c.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv::face;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line">Dialogin::Dialogin(QWidget *parent) :</span><br><span class="line">    QDialog(parent),</span><br><span class="line">    ui(<span class="keyword">new</span> Ui::Dialogin)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    ui-&gt;setupUi(<span class="keyword">this</span>);</span><br><span class="line">    i=<span class="number">0</span>;</span><br><span class="line">    capture = <span class="literal">NULL</span>;</span><br><span class="line">     capture = cvCaptureFromCAM(<span class="number">0</span>);<span class="comment">//æ‰“å¼€æ‘„åƒå¤´</span></span><br><span class="line"> <span class="comment">//è®¾ç½®è§†é¢‘è·å–å±æ€§ </span></span><br><span class="line">             cvSetCaptureProperty(capture, CV_CAP_PROP_FRAME_WIDTH, <span class="number">640</span>);<span class="comment">// è§†é¢‘æµçš„å¸§å®½åº¦ï¼ˆåªå¯¹æ‘„åƒå¤´æœ‰æ•ˆï¼‰</span></span><br><span class="line">             cvSetCaptureProperty(capture, CV_CAP_PROP_FRAME_HEIGHT, <span class="number">480</span>);<span class="comment">// è§†é¢‘æµçš„å¸§é«˜åº¦ï¼ˆåªå¯¹æ‘„åƒå¤´æœ‰æ•ˆï¼‰</span></span><br><span class="line">    setWindowFlags(windowFlags()&amp;~ Qt::WindowCloseButtonHint);<span class="comment">//çª—å£åªæœ‰ä¸€ä¸ªå…³é—­æŒ‰é’®</span></span><br><span class="line">    <span class="comment">//gimage =NULL;</span></span><br><span class="line">   <span class="comment">// connect(this, SIGNAL(getimage(const QImage &amp;image)), this, SLOT(showimage(const QImage &amp;image)));</span></span><br><span class="line">    timer = <span class="keyword">new</span> QTimer(<span class="keyword">this</span>);</span><br><span class="line">    timer-&gt;setInterval(<span class="number">50</span>);</span><br><span class="line">    connect(timer, SIGNAL(timeout()), <span class="keyword">this</span>, SLOT(showimage()));</span><br><span class="line">    timer-&gt;start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Dialogin::~Dialogin()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dialogin::Sleep</span><span class="params">(<span class="keyword">int</span> msec)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QTime dieTime = QTime::currentTime().addMSecs(msec);</span><br><span class="line">       <span class="keyword">while</span>( QTime::currentTime() &lt; dieTime )</span><br><span class="line">           QCoreApplication::processEvents(QEventLoop::AllEvents, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¼€å§‹æ‹ç…§</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dialogin::on_pushButton_photo_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// qDebug() &lt;&lt; ui-&gt;pushButton_photo-&gt;text() &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(ui-&gt;lineEdit_name-&gt;text() == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;é”™è¯¯&quot;</span>),tr(<span class="string">&quot;è¯·è¾“å…¥å§“å&quot;</span>),QMessageBox::Ok);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(capture == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            QMessageBox::warning(<span class="keyword">this</span>, tr(<span class="string">&quot;è­¦å‘Šï¼ï¼ï¼&quot;</span>), tr(<span class="string">&quot;æ‘„åƒå¤´æ‰“ä¸å¼€ï¼ï¼ï¼ï¼&quot;</span>), QMessageBox::Abort);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        QDir *path = <span class="keyword">new</span> QDir;</span><br><span class="line">        <span class="keyword">bool</span> exist = path-&gt;exists(QDir::currentPath() + <span class="string">&quot;/TEMP&quot;</span>);<span class="comment">//æŠŠæ‹å®Œç…§çš„å›¾ç‰‡ä¿å­˜åˆ°TEMPç›®å½•ä¸‹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!exist)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">bool</span> ok = path-&gt;mkdir(QDir::currentPath() + <span class="string">&quot;/TEMP&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(ok)</span><br><span class="line">            &#123;</span><br><span class="line">                QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;åˆ›å»ºæ–‡ä»¶å¤¹&quot;</span>),tr(<span class="string">&quot;æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸï¼&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        QString temp =  QDir::currentPath() + <span class="string">&quot;/TEMP/%d.jpg&quot;</span>;<span class="comment">//ç…§ç‰‡çš„æ•°é‡</span></span><br><span class="line">        <span class="keyword">char</span> * path_src;</span><br><span class="line">        QByteArray ba= temp.toLatin1();</span><br><span class="line">        path_src = ba.data();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        frames = cvQueryFrame( capture );<span class="comment">//å‡½æ•°cvQueryFrameä»æ‘„åƒå¤´æˆ–è€…æ–‡ä»¶ä¸­æŠ“å–ä¸€å¸§ï¼Œç„¶åè§£å‹å¹¶è¿”å›è¿™ä¸€å¸§</span></span><br><span class="line">        frame=cvarrToMat(frames); <span class="comment">//æ ¼å¼è½¬æ¢å¦åˆ™æ— æ³•æ­£å¸¸æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> filename = cv::format(path_src, i);</span><br><span class="line">        ui-&gt;pushButton_photo-&gt;setText(QString::number(i+<span class="number">1</span>,<span class="number">10</span>));</span><br><span class="line">        imwrite(filename, frame);</span><br><span class="line">        i++;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¼€å§‹å–æ ·</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dialogin::on_pushButton_start_photo_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QMessageBox *startbox = <span class="keyword">new</span> QMessageBox(QMessageBox::Warning  ,<span class="string">&quot;ä¿¡æ¯&quot;</span>,<span class="string">&quot;å¼€å§‹å–æ ·è¯·ç¨åï¼ï¼ï¼&quot;</span>,QMessageBox::NoButton,<span class="keyword">this</span>);<span class="comment">//å¯¹è¯æ¡†çš„äº¤äº’</span></span><br><span class="line">    startbox-&gt;show();</span><br><span class="line">    Sleep(<span class="number">1000</span>);</span><br><span class="line">    <span class="function">QFile <span class="title">user</span><span class="params">(QDir::currentPath() + <span class="string">&quot;/usr.txt&quot;</span>)</span></span>;<span class="comment">//ä¿å­˜ç…§ç‰‡çš„åå­—</span></span><br><span class="line">    <span class="keyword">if</span>(!user.open(QIODevice::ReadWrite | QIODevice::Text))</span><br><span class="line">    &#123;</span><br><span class="line">        startbox-&gt;close();</span><br><span class="line">        qDebug() &lt;&lt; user.errorString() &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    qint64 usrlinenum =<span class="number">0</span>;</span><br><span class="line">    usrlinenum=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!user.atEnd())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> buf[<span class="number">128</span>];</span><br><span class="line">        qint64 c = user.readLine(buf, <span class="keyword">sizeof</span>(buf));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(c &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            usrlinenum++;</span><br><span class="line">            qDebug() &lt;&lt; buf &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(c &lt;<span class="number">0</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            startbox-&gt;close();</span><br><span class="line">            QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;æ–‡ä»¶è¯»å–&quot;</span>),tr(<span class="string">&quot;æ–‡ä»¶è¯»å–å¤±è´¥ï¼ï¼ï¼&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; QString::number(i, 10) &lt;&lt;endl;</span></span><br><span class="line">    QString usrline = QString::number(usrlinenum, <span class="number">10</span>)  + <span class="string">&quot;;&quot;</span> +  ui-&gt;lineEdit_name-&gt;text() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">    qDebug() &lt;&lt; usrline &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> * p;</span><br><span class="line">    QByteArray buf = usrline.toLatin1();</span><br><span class="line">    p = buf.data();</span><br><span class="line">    user.write(p);</span><br><span class="line">    user.close();</span><br><span class="line"></span><br><span class="line">    QDir *pathdata = <span class="keyword">new</span> QDir;</span><br><span class="line">    <span class="keyword">bool</span> exist = pathdata-&gt;exists(QDir::currentPath() + <span class="string">&quot;/&quot;</span> +QString::number(usrlinenum, <span class="number">10</span>) );</span><br><span class="line">    <span class="keyword">if</span>(!exist)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">bool</span> ok =  pathdata-&gt;mkdir(QDir::currentPath() + <span class="string">&quot;/&quot;</span> +QString::number(usrlinenum, <span class="number">10</span>));</span><br><span class="line">        <span class="keyword">if</span>(!ok)</span><br><span class="line">        &#123;</span><br><span class="line">            QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥&quot;</span>),tr(<span class="string">&quot;æ–‡ä»¶å¤¹åˆ›å»ºå¤±è´¥ï¼&quot;</span>));</span><br><span class="line">            startbox-&gt;close();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    QString pathdst = QDir::currentPath() + <span class="string">&quot;/&quot;</span> +QString::number(usrlinenum, <span class="number">10</span>) + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">    <span class="comment">/*********************************************************************************************/</span></span><br><span class="line"></span><br><span class="line">    cv::CascadeClassifier face_Classifier;   <span class="comment">//å®šä¹‰äººè„¸åˆ†ç±»å™¨</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> face_Classifier_name = <span class="string">&quot;/home/lixiao/opencv/opencv-3.4.5/data/haarcascades_cuda/haarcascade_frontalface_alt.xml&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Rect&gt; face_rect;</span><br><span class="line">    cv::Mat dst_gray;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!face_Classifier.load(face_Classifier_name))<span class="comment">//åŠ è½½æ–‡ä»¶</span></span><br><span class="line">    &#123;</span><br><span class="line">        startbox-&gt;close();</span><br><span class="line">        QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;é”™è¯¯&quot;</span>),tr(<span class="string">&quot;haarcascade_frontalface_alt.xmlåŠ è½½å¤±è´¥&quot;</span>),QMessageBox::Ok);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    QString dst_path = pathdst + <span class="string">&quot;%d.jpg&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function">QDir <span class="title">dir</span><span class="params">(QDir::currentPath() + <span class="string">&quot;/TEMP/&quot;</span>)</span></span>;</span><br><span class="line">    QStringList dst_file_name;</span><br><span class="line">    dst_file_name &lt;&lt; <span class="string">&quot;*.jpg&quot;</span> ;</span><br><span class="line"></span><br><span class="line">    QFileInfoList <span class="built_in">list</span> = dir.entryInfoList(dst_file_name, QDir::Files|QDir::Readable, QDir::Name);</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="built_in">list</span>.size() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> * path_dst;</span><br><span class="line">    QByteArray dsttemp= dst_path.toLatin1();</span><br><span class="line">    path_dst = dsttemp.data();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> z=<span class="number">0</span>;z&lt; <span class="built_in">list</span>.size();z++)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span> *  path_list_src ;</span><br><span class="line"></span><br><span class="line">        QByteArray dsttemp=  <span class="built_in">list</span>[z].absoluteFilePath().toLatin1();</span><br><span class="line">        path_list_src = dsttemp.data();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> srcfile = cv::format(path_list_src);</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> dstfile = cv::format( path_dst, z);</span><br><span class="line">        cv::Mat srcframe = cv::imread(srcfile);</span><br><span class="line">        cv::cvtColor(srcframe, dst_gray, cv::COLOR_BGR2GRAY);</span><br><span class="line">        cv::equalizeHist(dst_gray, dst_gray);</span><br><span class="line"><span class="comment">//äººè„¸æ£€æµ‹</span></span><br><span class="line">        face_Classifier.detectMultiScale(dst_gray,  face_rect, <span class="number">1.1</span>, <span class="number">3</span>, CV_HAAR_DO_ROUGH_SEARCH, cv::Size(<span class="number">30</span>, <span class="number">30</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; (<span class="keyword">int</span>)face_rect.size(); j++)</span><br><span class="line">        &#123;</span><br><span class="line">            cv::Mat faceROI = srcframe(face_rect[j]);</span><br><span class="line">            cv::Mat MyFace;</span><br><span class="line">            cv::Mat gray_MyFace;</span><br><span class="line">            <span class="keyword">if</span> (faceROI.cols &gt; <span class="number">100</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                cv::resize(faceROI, MyFace, cv::Size(<span class="number">92</span>, <span class="number">112</span>));</span><br><span class="line">                cv::cvtColor(MyFace, gray_MyFace, CV_BGR2GRAY);</span><br><span class="line">                imwrite(dstfile, gray_MyFace);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/***********************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*å½“æˆ‘ä»¬å†™äººè„¸æ¨¡å‹çš„è®­ç»ƒç¨‹åºçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è¯»å–äººè„¸å’Œäººè„¸å¯¹åº”çš„æ ‡ç­¾ã€‚ç›´æ¥åœ¨æ•°æ®åº“ä¸­è¯»å–æ˜¾ç„¶æ˜¯ä½æ•ˆçš„ã€‚æ‰€ä»¥æˆ‘ä»¬ç”¨csvæ–‡ä»¶è¯»å–*/</span></span><br><span class="line">    <span class="function">QFile <span class="title">csv</span><span class="params">(QDir::currentPath() + <span class="string">&quot;/csv.txt&quot;</span>)</span></span>;<span class="comment">//å†™å…¥csv.txtæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span>(!csv.open(QIODevice::WriteOnly | QIODevice::Append | QIODevice::Text))</span><br><span class="line">    &#123;</span><br><span class="line">        qDebug() &lt;&lt; csv.errorString() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        startbox-&gt;close();</span><br><span class="line">        QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;é”™è¯¯&quot;</span>),tr(<span class="string">&quot;æ— æ³•åˆ›å»ºcsvæ–‡ä»¶ï¼ï¼ï¼&quot;</span>),QMessageBox::Ok);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QDir <span class="title">dst_file_dir</span><span class="params">(pathdst)</span></span>;</span><br><span class="line">    QStringList dst_file_filter;</span><br><span class="line">    dst_file_filter &lt;&lt;  <span class="string">&quot;*.jpg&quot;</span> ;</span><br><span class="line">    QFileInfoList dst_file_list_path = dst_file_dir.entryInfoList(dst_file_filter, QDir::Files | QDir::Readable, QDir::Name);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> x=<span class="number">0</span>; x&lt;dst_file_list_path.size(); x++)</span><br><span class="line">    &#123;</span><br><span class="line">        csv.write(QString(dst_file_list_path[x].absoluteFilePath() + <span class="string">&quot;;&quot;</span> + QString::number(usrlinenum, <span class="number">10</span>) + <span class="string">&quot;\r\n&quot;</span>).toLatin1());</span><br><span class="line">    &#125;</span><br><span class="line">    startbox-&gt;close();</span><br><span class="line">    QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="string">&quot;ä¿¡æ¯&quot;</span>),tr(<span class="string">&quot;å–æ ·å·²ç»å®Œæˆã€csvæ–‡ä»¶å®Œåˆ›å»ºæˆï¼ï¼ï¼&quot;</span>),QMessageBox::Ok);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…³é—­é‡‡æ ·ç•Œé¢</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dialogin::on_pushButton_close_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    ui-&gt;lineEdit_name-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;pushButton_start_photo-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;lineEdit_name-&gt;clear();</span><br><span class="line">    <span class="keyword">if</span>(capture != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cvReleaseCapture(&amp;capture);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>-&gt;close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dialogin::showimage</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(capture != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        IplImage* pBinary;</span><br><span class="line">        cv::Mat src ;</span><br><span class="line">        pBinary = cvQueryFrame( capture );<span class="comment">//å‡½æ•°cvQueryFrameä»æ‘„åƒå¤´æˆ–è€…æ–‡ä»¶ä¸­æŠ“å–ä¸€å¸§ï¼Œç„¶åè§£å‹å¹¶è¿”å›è¿™ä¸€å¸§</span></span><br><span class="line">        src=cvarrToMat(pBinary);</span><br><span class="line">        <span class="comment">//æ ¼å¼è½¬æ¢å¦åˆ™æ— æ³•æ­£å¸¸æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class="line">        cvtColor( src, src, CV_BGR2RGB );<span class="comment">//å°†å›¾åƒä»ä¸€ä¸ªé¢œè‰²ç©ºé—´è½¬æ¢åˆ°å¦ä¸€ä¸ªé¢œè‰²ç©ºé—´çš„è½¬æ¢</span></span><br><span class="line"></span><br><span class="line">        QImage img=QImage((<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span>*)(src.data), src.cols, src.rows, QImage::Format_RGB888);</span><br><span class="line"></span><br><span class="line">        QPixmap pix = QPixmap::fromImage(img);<span class="comment">//ç”¨æ¥å¯¹å›¾ç‰‡è¿›è¡Œé¢„å¤„ç†</span></span><br><span class="line">        ui-&gt;label_video-&gt;setPixmap(pix);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>æºç èµ„æ–™<br>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1Rol3vv-ERg4fulwcshF1Yg?pwd=k7xx">https://pan.baidu.com/s/1Rol3vv-ERg4fulwcshF1Yg?pwd=k7xx</a><br>æå–ç ï¼šk7xx</p>]]></content>
      
      
      <categories>
          
          <category> å®è®­ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>linux</title>
      <link href="blog/linux/"/>
      <url>blog/linux/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">my commend</button></li><li class="tab"><button type="button" data-href="#test4-2">å¸¸è§å‘½ä»¤</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><p>1.å‘½ä»¤é—®é¢˜</p><ul><li>1.<a href="https://www.jianshu.com/p/06f8b31a90e6">Linux sedåœ¨æŸä¸€è¡Œå‰é¢ã€åé¢è¿½åŠ </a></li></ul><p>2.æºç </p><ol><li><p class='p blue'>rosè‡ªåŠ¨åˆ›å»ºæ–‡ä»¶è„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ¬¢è¿ä½¿ç”¨ros,åˆ›å»ºæ–‡ä»¶å¼€å§‹ï¼Œè¯·æŒ‰ç…§æ“ä½œè¾“å…¥&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;è¯·è¾“å…¥å·¥ä½œç©ºé—´åå­—&quot;</span></span><br><span class="line"><span class="built_in">read</span> catkin_ws</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -d ~/<span class="variable">$catkin_ws</span></span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å·²ç»å­˜åœ¨ï¼ï¼æ­£åœ¨è¿›å…¥è¯¥å·¥ä½œç©ºé—´&quot;</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line"><span class="comment">#å…ˆåˆ‡å›ä¸»ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> ~/</span><br><span class="line"><span class="comment">#æ–°å»ºå·¥ä½œç©ºé—´æ–‡ä»¶å¤¹</span></span><br><span class="line">mkdir <span class="variable">$catkin_ws</span></span><br><span class="line"><span class="comment">#åœ¨ catkin_ws ç›®å½•ä¸‹æ–°å»º src æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$catkin_ws</span></span><br><span class="line">mkdir src</span><br><span class="line"><span class="comment">#åˆå§‹åŒ– src ç›®å½•ï¼Œç”Ÿæˆçš„ CMakeLists.txt ä¸ºåŠŸèƒ½åŒ…ç¼–è¯‘é…ç½®</span></span><br><span class="line"><span class="built_in">cd</span> src</span><br><span class="line">catkin_init_workspace</span><br><span class="line"><span class="comment">#åˆ‡å› catkin_ws ç›®å½•ï¼Œå¯¹è¯¥å·¥ä½œç©ºé—´æ‰§è¡Œä¸€æ¬¡ç¼–è¯‘</span></span><br><span class="line"><span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span></span><br><span class="line">catkin_make</span><br><span class="line"><span class="comment">#ç¯å¢ƒå˜é‡é…ç½®ï¼Œä½¿æ–°å»ºçš„ catkin_ws å·¥ä½œç©ºé—´å¯ç”¨</span></span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;è¯·è¾“å…¥åŠŸèƒ½åŒ…å:&quot;</span></span><br><span class="line"><span class="built_in">read</span> package</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -d ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;å·²ç»å­˜åœ¨ï¼ï¼æ­£åœ¨è¿›å…¥&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"> <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/</span><br><span class="line"> catkin_create_pkg <span class="variable">$package</span> roscpp std_msgs</span><br><span class="line">  <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/</span><br><span class="line"> catkin_make -DCATKIN_WHITELIST_PACKAGES=<span class="string">&quot;<span class="variable">$package</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ˜¯å¦å»ºç«‹èŠ‚ç‚¹æˆ–è€…å¯¹èŠ‚ç‚¹æ“ä½œ(y/n):&quot;</span></span><br><span class="line"><span class="built_in">read</span> n</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$n</span> == n ]</span><br><span class="line">   <span class="keyword">then</span></span><br><span class="line">           <span class="built_in">echo</span> <span class="string">&quot;å·²è·³è¿‡å»ºç«‹èŠ‚ç‚¹ï¼ï¼&quot;</span></span><br><span class="line">   <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">&quot;è¯·è¾“å…¥åˆ›å»ºæˆ–è€…æ“ä½œçš„èŠ‚ç‚¹åå­—&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> node</span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">test</span> -e ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/src/<span class="variable">$node</span>.cpp</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$node</span>å·²ç»å­˜åœ¨ï¼ï¼æ­£åœ¨è¿›å…¥&quot;</span></span><br><span class="line">   </span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/src/</span><br><span class="line">      touch <span class="variable">$node</span>.cpp</span><br><span class="line">      cat &gt;&gt;<span class="variable">$node</span>.cpp&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">  main()&#123;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">  </span><br><span class="line">      </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨ä¸ºæ‚¨å£°æ˜å¯æ‰§è¡Œæ–‡ä»¶........&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/</span><br><span class="line">  cat &gt;&gt;CMakeLists.txt&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">  add_executable($node src/$node.cpp)</span></span><br><span class="line"><span class="string">  target_link_libraries($node \$&#123;catkin_LIBRARIES&#125;)</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ‚¨çš„èŠ‚ç‚¹åå³ä¸ºå¯æ‰§è¡Œæ–‡ä»¶å&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å¯æ‰§è¡Œæ–‡ä»¶åˆ›ç«‹æˆåŠŸ!!!&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ˜¯å¦å»ºç«‹æœåŠ¡æˆ–è€…ä¸ºèŠ‚ç‚¹å…³è”æœåŠ¡(y/n):&quot;</span></span><br><span class="line"><span class="built_in">read</span> s</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$s</span> == n ]</span><br><span class="line">   <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;å·²è·³è¿‡å»ºç«‹æœåŠ¡æˆ–è€…ä¸ºèŠ‚ç‚¹å…³è”æœåŠ¡ï¼ï¼&quot;</span></span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;è¯·è¾“å…¥æœåŠ¡å(æ–‡ä»¶åå­—)ï¼š&quot;</span></span><br><span class="line">   <span class="built_in">read</span> srv</span><br><span class="line">   </span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -d ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/srv</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;srvå·²ç»å­˜åœ¨ï¼ï¼æ­£åœ¨è¿›å…¥&quot;</span></span><br><span class="line"><span class="keyword">else</span> <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/</span><br><span class="line">            mkdir srv</span><br><span class="line">     <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/</span><br><span class="line">             var1=`sed -n <span class="string">&#x27;/std_msgs/=&#x27;</span> CMakeLists.txt |sed -n <span class="string">&quot;1&quot;</span>p`</span><br><span class="line">sed -e <span class="string">&quot;&quot;</span><span class="variable">$var1</span><span class="string">&quot;a\message_generation&quot;</span> CMakeLists.txt &gt; tmpFile</span><br><span class="line">mv tmpFile CMakeLists.txt</span><br><span class="line">var2=`sed -n <span class="string">&#x27;/Generate services/=&#x27;</span> CMakeLists.txt |sed -n <span class="string">&quot;1&quot;</span>p`</span><br><span class="line">sed -e <span class="string">&quot;&quot;</span><span class="variable">$var2</span><span class="string">&quot;a\add_service_files(\nFILES\n\#Service2.srv\n)&quot;</span> CMakeLists.txt &gt; tmpFile</span><br><span class="line">mv tmpFile CMakeLists.txt</span><br><span class="line"></span><br><span class="line">var4=`sed -n <span class="string">&#x27;/Generate added messages/=&#x27;</span> CMakeLists.txt |sed -n <span class="string">&quot;1&quot;</span>p`</span><br><span class="line">sed -e <span class="string">&quot;&quot;</span><span class="variable">$var4</span><span class="string">&quot;a\generate_messages(\nDEPENDENCIES\nstd_msgs\n)&quot;</span> CMakeLists.txt &gt; tmpFile</span><br><span class="line">mv tmpFile CMakeLists.txt</span><br><span class="line">var5=`sed -n <span class="string">&#x27;/&lt;doc_depend&gt;doxygen/=&#x27;</span> package.xml |sed -n <span class="string">&quot;1&quot;</span>p`</span><br><span class="line">sed -e<span class="string">&quot;&quot;</span><span class="variable">$var5</span><span class="string">&quot;a\&lt;build_depend&gt;message_generation&lt;/build_depend&gt;\n&lt;build_export_depend&gt;message_generation&lt;/build_export_depend&gt;\n&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;\n&quot;</span> package.xml &gt; tmpFile</span><br><span class="line">mv tmpFile package.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">test</span> -e ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/srv/<span class="variable">$srv</span>.srv</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$srv</span>.srvå·²ç»å­˜åœ¨ï¼ï¼æ­£åœ¨è¿›å…¥&quot;</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line">            </span><br><span class="line"> </span><br><span class="line">   </span><br><span class="line">             <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/srv</span><br><span class="line">     touch <span class="variable">$srv</span>.srv</span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;æ–‡ä»¶åˆ›ç«‹å®Œæ¯•ï¼Œå‡†å¤‡æ·»åŠ ä¾èµ–é¡¹......&quot;</span></span><br><span class="line">     <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/</span><br><span class="line"></span><br><span class="line">            <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/</span><br><span class="line">            </span><br><span class="line"><span class="comment">#æ³¨æ„ï¼Œæ˜¯ç”¨å•å¼•å·åŒ…å«åŒå¼•å·æ¥å¼•ç”¨å˜é‡ã€‚</span></span><br><span class="line">var3=`sed -n <span class="string">&#x27;/Service2.srv/=&#x27;</span> CMakeLists.txt |sed -n <span class="string">&quot;1&quot;</span>p`</span><br><span class="line">sed -e <span class="string">&#x27;&#x27;</span><span class="string">&quot;<span class="variable">$&#123;var3&#125;</span>&quot;</span><span class="string">&#x27;a\&#x27;</span><span class="string">&quot;<span class="variable">$&#123;srv&#125;</span>&quot;</span><span class="string">&#x27;.srv&#x27;</span> CMakeLists.txt &gt; tmpFile</span><br><span class="line">mv tmpFile CMakeLists.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ï¼ï¼ï¼æç¤ºè¯·ä¸è¦åœ¨cppæ–‡ä»¶æ²¡å†™mainæ—¶ç¼–è¯‘(ä½¿ç”¨æœ¬è„šæœ¬åˆ›ç«‹çš„èŠ‚ç‚¹å¿½ç•¥)&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ˜¯å¦å»ºç«‹æ¶ˆæ¯æ–‡ä»¶æˆ–è€…ä¸ºèŠ‚ç‚¹å…³è”æ¶ˆæ¯(y/n)&quot;</span></span><br><span class="line"><span class="built_in">read</span> m</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$m</span> == n ]</span><br><span class="line">   <span class="keyword">then</span></span><br><span class="line">           <span class="built_in">echo</span> <span class="string">&quot;å·²è·³è¿‡å»ºç«‹æ¶ˆæ¯æ–‡ä»¶æˆ–è€…ä¸ºèŠ‚ç‚¹å…³è”æ¶ˆæ¯ï¼ï¼&quot;</span></span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">           <span class="keyword">if</span> <span class="built_in">test</span> -d ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/msg</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;msgæ–‡ä»¶å¤¹å·²ç»å­˜åœ¨ï¼ï¼æ­£åœ¨è¿›å…¥&quot;</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line"> var6=`sed -n <span class="string">&#x27;/Generate messages/=&#x27;</span> CMakeLists.txt |sed -n <span class="string">&quot;1&quot;</span>p`</span><br><span class="line">sed -e <span class="string">&quot;&quot;</span><span class="variable">$var6</span><span class="string">&quot;a\add_message_files(\nFILES\n\#Message2.msg\n)&quot;</span> CMakeLists.txt &gt; tmpFile</span><br><span class="line">mv tmpFile CMakeLists.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/</span><br><span class="line">            mkdir msg</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;è¯·è¾“å…¥æ¶ˆæ¯å(æ–‡ä»¶åå­—)ï¼š&quot;</span></span><br><span class="line">           <span class="built_in">read</span> msg</span><br><span class="line"></span><br><span class="line">          </span><br><span class="line"><span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/msg</span><br><span class="line">           <span class="keyword">if</span> <span class="built_in">test</span> -e ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/msg/<span class="variable">$msg</span>.msg</span><br><span class="line">   <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;è¯¥msgæ–‡ä»¶å·²å­˜åœ¨ï¼Œå‡†å¤‡ä¸ºæ‚¨å…³è”èŠ‚ç‚¹&quot;</span></span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">    </span><br><span class="line">          touch <span class="variable">$msg</span>.msg</span><br><span class="line">            cat &gt;&gt;<span class="variable">$msg</span>.msg&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">int32 A</span></span><br><span class="line"><span class="string">int32 B</span></span><br><span class="line"><span class="string">int32 C</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -d ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/srv</span><br><span class="line"></span><br><span class="line">   <span class="keyword">then</span></span><br><span class="line">  var7=`sed -n <span class="string">&#x27;/Message2.msg/=&#x27;</span> CMakeLists.txt |sed -n <span class="string">&quot;1&quot;</span>p`</span><br><span class="line">sed -e <span class="string">&#x27;&#x27;</span><span class="string">&quot;<span class="variable">$&#123;var7&#125;</span>&quot;</span><span class="string">&#x27;a\&#x27;</span><span class="string">&quot;<span class="variable">$&#123;msg&#125;</span>&quot;</span><span class="string">&#x27;.msg&#x27;</span> CMakeLists.txt &gt; tmpFile</span><br><span class="line">mv tmpFile CMakeLists.txt</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  </span><br><span class="line">var8=`sed -n <span class="string">&#x27;/&lt;doc_depend&gt;doxygen/=&#x27;</span> package.xml |sed -n <span class="string">&quot;1&quot;</span>p`</span><br><span class="line">sed -e<span class="string">&quot;&quot;</span><span class="variable">$var8</span><span class="string">&quot;a\&lt;build_depend&gt;message_generation&lt;/build_depend&gt;\n&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;\n&quot;</span> package.xml &gt; tmpFile</span><br><span class="line">mv tmpFile package.xml</span><br><span class="line"> var9=`sed -n <span class="string">&#x27;/std_msgs/=&#x27;</span> CMakeLists.txt |sed -n <span class="string">&quot;1&quot;</span>p`</span><br><span class="line">sed -e <span class="string">&quot;&quot;</span><span class="variable">$var9</span><span class="string">&quot;a\message_generation&quot;</span> CMakeLists.txt &gt; tmpFile</span><br><span class="line">mv tmpFile CMakeLists.txt</span><br><span class="line">var10=`sed -n <span class="string">&#x27;/Message2.msg/=&#x27;</span> CMakeLists.txt |sed -n <span class="string">&quot;1&quot;</span>p`</span><br><span class="line">sed -e <span class="string">&#x27;&#x27;</span><span class="string">&quot;<span class="variable">$&#123;var10&#125;</span>&quot;</span><span class="string">&#x27;a\&#x27;</span><span class="string">&quot;<span class="variable">$&#123;msg&#125;</span>&quot;</span><span class="string">&#x27;.msg&#x27;</span> CMakeLists.txt &gt; tmpFile</span><br><span class="line">mv tmpFile CMakeLists.txt</span><br><span class="line">var11=`sed -n <span class="string">&#x27;/Generate added messages/=&#x27;</span> CMakeLists.txt |sed -n <span class="string">&quot;1&quot;</span>p`</span><br><span class="line">sed -e <span class="string">&quot;&quot;</span><span class="variable">$var11</span><span class="string">&quot;a\generate_messages(\nDEPENDENCIES\nstd_msgs\n)&quot;</span> CMakeLists.txt &gt; tmpFile</span><br><span class="line">mv tmpFile CMakeLists.txt</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ˜¯å¦å»ºç«‹ä¸ºæ‚¨å»ºç«‹launchæ–‡ä»¶æˆ–è€…ä¸ºèŠ‚ç‚¹å…³è”launchæ–‡ä»¶(y/n)&quot;</span></span><br><span class="line"><span class="built_in">read</span> L</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$L</span> == n ]</span><br><span class="line">   <span class="keyword">then</span></span><br><span class="line">           <span class="built_in">echo</span> <span class="string">&quot;å·²è·³è¿‡å»ºç«‹launchæ–‡ä»¶æˆ–è€…ä¸ºèŠ‚ç‚¹å…³è”launchæ–‡ä»¶ï¼ï¼&quot;</span></span><br><span class="line">   <span class="keyword">else</span> </span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;launchæ–‡ä»¶çš„å†…å®¹é»˜è®¤ä¸ºæ‚¨è¿½åŠ &quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;è¾“å…¥ä½¿ç”¨çš„launchæ–‡ä»¶å(é€šå¸¸ä¸å½“å‰ä½ç½®åŒ…åä¸€è‡´)&quot;</span></span><br><span class="line">        <span class="built_in">read</span> launch</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;è¯·è¾“å…¥å‘å¸ƒçš„èŠ‚ç‚¹&quot;</span></span><br><span class="line">        <span class="built_in">read</span> node1</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;è¯·è¾“å…¥å‘å¸ƒèŠ‚ç‚¹çš„åŒ…å&quot;</span></span><br><span class="line">        <span class="built_in">read</span> package1</span><br><span class="line">        <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/</span><br><span class="line">           <span class="keyword">if</span> <span class="built_in">test</span> -d ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package1</span>/launch</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;launchæ–‡ä»¶å¤¹å·²ç»å­˜åœ¨ï¼ï¼æ­£åœ¨è¿›å…¥&quot;</span></span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">         mkdir launch</span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package1</span>/launch</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -e ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package1</span>/launch/<span class="variable">$launch</span>.launch</span><br><span class="line">  <span class="keyword">then</span> </span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;è¯¥launchæ–‡ä»¶å·²ç»å­˜åœ¨å¼€å§‹è¿½åŠ ......&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package1</span>/launch/</span><br><span class="line">       touch <span class="string">&quot;<span class="variable">$launch</span>&quot;</span>.launch</span><br><span class="line"></span><br><span class="line">   <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package1</span>/launch/  </span><br><span class="line">    cat &gt;&gt;<span class="string">&quot;<span class="variable">$launch</span>&quot;</span>.launch&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">  &lt;launch&gt;</span></span><br><span class="line"><span class="string">&lt;/launch&gt;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package1</span>/launch/ </span><br><span class="line">var13=`sed -n <span class="string">&#x27;/&lt;launch&gt;/=&#x27;</span> <span class="string">&quot;<span class="variable">$launch</span>&quot;</span>.launch |sed -n <span class="string">&quot;1&quot;</span>p`</span><br><span class="line">sed -e <span class="string">&#x27;&#x27;</span><span class="string">&quot;<span class="variable">$var13</span>&quot;</span><span class="string">&#x27;a\&lt;node name=&quot;&#x27;</span><span class="string">&quot;<span class="variable">$node1</span>&quot;</span><span class="string">&#x27;&quot;pkg=&quot;&#x27;</span><span class="string">&quot;<span class="variable">$package1</span>&quot;</span><span class="string">&#x27;&quot;type=&quot;&#x27;</span><span class="string">&quot;<span class="variable">$node1</span>&quot;</span><span class="string">&#x27;&quot;/&gt;&#x27;</span> <span class="string">&quot;<span class="variable">$launch</span>&quot;</span>.launch &gt; tmpFile</span><br><span class="line">mv tmpFile <span class="string">&quot;<span class="variable">$launch</span>&quot;</span>.launch</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$n</span> == n ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;ä¾èµ–é¡¹æ·»åŠ å®Œæ¯•ï¼ï¼&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -e ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/srv/$*srv  </span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/</span><br><span class="line"></span><br><span class="line">      cat &gt;&gt;CMakeLists.txt&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">  add_dependencies($node $&#123;package&#125;_gencpp)</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">test</span> -e ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/msg/<span class="variable">$msg</span>*msg</span><br><span class="line"></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"> <span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/src/<span class="variable">$package</span>/</span><br><span class="line"></span><br><span class="line">      cat &gt;&gt;CMakeLists.txt&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">  add_dependencies($node $&#123;package&#125;_gencpp)</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ä¾èµ–é¡¹æ·»åŠ å®Œæ¯•ï¼ï¼&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#rm -rf &#x27;&quot;$launch&quot;&#x27;.launch</span></span><br><span class="line"><span class="built_in">cd</span> ~/<span class="variable">$catkin_ws</span>/</span><br><span class="line"> catkin_make -DCATKIN_WHITELIST_PACKAGES=<span class="string">&quot;<span class="variable">$package</span>&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;ä¾èµ–é¡¹æ·»åŠ å®Œæ¯•ï¼ï¼&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ç¼–è¯‘å®Œæ¯•ï¼ï¼&quot;</span></span><br></pre></td></tr></table></figure></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><details class="folding-tag" green><summary> å¸®åŠ© </summary>              <div class='content'>              <ol><li>æŸ¥çœ‹å¸®åŠ©æ‰‹å†Œman<br>è¯­æ³•ï¼š<br>man [man options] [[section] page â€¦] â€¦<br>man -k [apropos options] regexp â€¦<br>man -K [man options] [section] term â€¦<br>man -f [whatis options] page â€¦<br>man -l [man options] file â€¦<br>man -w|-W [man options] page â€¦<br>å‚æ•°ï¼š<br>-f æ˜¾ç¤ºç»™å®šå…³é”®å­—çš„ç®€çŸ­æè¿°ä¿¡æ¯<br>-k æ ¹æ®å…³é”®è¯æœç´¢å¸®åŠ©æ‰‹å†Œ<br>-w æ˜¾ç¤ºæ‰‹å†Œæ–‡ä»¶æ‰€åœ¨ä½ç½®<br>å¿«æ·æ“ä½œï¼š<br>ç©ºæ ¼é”® ä¸‹ç¿»ä¸€é¡µ<br>å›è½¦é”® ä¸‹æ»šä¸€è¡Œ<br>j ä¸‹æ»šä¸€è¡Œ<br>k ä¸Šæ»šä¸€è¡Œ<br>b å›ç¿»ä¸€é¡µ<br>f ä¸‹ç¿»ä¸€é¡µ<br>q é€€å‡º<br>/word æœç´¢wordå…³é”®è¯<br>æ¡ˆä¾‹ï¼š<br>æŸ¥çœ‹ cp å‘½ä»¤çš„å¸®åŠ©æ‰‹å†Œ man cp<br>æŸ¥çœ‹ sleep å‘½ä»¤çš„ç®€è¦ä¿¡æ¯ man -f sleep<br>æŸ¥çœ‹ç¬¬ 3 ä¸ªç« èŠ‚çš„ sleep ä¿¡æ¯ man 3 sleep<br>æŸ¥çœ‹ passwd æ–‡ä»¶çš„è¯¦ç»†ä»‹ç» man 5 passwd<br>æŸ¥çœ‹ ls å‘½ä»¤å¸®åŠ©æ‰‹å†Œæ–‡ä»¶æ‰€åœ¨ä½ç½® man -w ls<br>æœç´¢è·Ÿ disk ç›¸å…³çš„å¸®åŠ©æ‰‹å†Œ man -k disk</li><li>æŸ¥è¯¢ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œä»€ä¹ˆåŠŸèƒ½ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœæ‰“å°åˆ°ç»ˆç«¯ä¸Šwhatis<br>è¯­æ³•ï¼š<br>whatis å‘½ä»¤<br>æ¡ˆä¾‹ï¼š<br>æŸ¥è¯¢ sleep å‘½ä»¤çš„åŠŸèƒ½ whatis sleep</li><li>é˜…è¯»infoæ ¼å¼çš„æ–‡ä»¶info<br>è¯­æ³•ï¼š<br>info [OPTION]â€¦ [MENU-ITEMâ€¦]<br>å‚æ•°ï¼š<br>-w æ˜¾ç¤ºinfoæ–‡æ¡£çš„ç‰©ç†ä½ç½®<br>-f æŒ‡å®šè¦è®¿é—®çš„infoæ–‡ä»¶<br>-n åœ¨é¦–ä¸ªæµè§ˆè¿‡infoæ–‡ä»¶ä¸­æŒ‡å®šèŠ‚ç‚¹<br>-O è·³è½¬è‡³å‘½ä»¤è¡Œé€‰é¡¹èŠ‚ç‚¹<br>å¸¸ç”¨æ“ä½œï¼š<br>n æ˜¾ç¤ºä¸‹ä¸€èŠ‚ç‚¹çš„é¡µé¢å†…å®¹<br>p æ˜¾ç¤ºä¸Šä¸€èŠ‚ç‚¹çš„é¡µé¢å†…å®¹<br>l è¿”å›ä¸Šä¸€ä¸ªè®¿é—®èŠ‚ç‚¹çš„é¡µé¢å†…å®¹<br>ç©ºæ ¼é”® å‘å‰æ»šåŠ¨ä¸€é¡µ<br>é€€æ ¼é”®/del å‘åæ»šåŠ¨ä¸€é¡µ<br>b/e ä¸€ä¸ªèŠ‚ç‚¹å†…å®¹çš„å¼€å§‹/ç»“æŸ<br>h æ‰“å¼€ info æ•™ç¨‹<br>d å›åˆ° info çš„åˆå§‹èŠ‚ç‚¹<br>å›è½¦é”® è·³è½¬åˆ°é“¾æ¥æ–‡æœ¬<br>q é€€å‡º<br>æ¡ˆä¾‹ï¼š<br>æŸ¥çœ‹ ls å‘½ä»¤çš„ info æ–‡æ¡£ info ls<br>æ˜¾ç¤º ls å‘½ä»¤ info æ–‡æ¡£çš„ç‰©ç†ä½ç½® info -w ls</li></ol>              </div>            </details><details class="folding-tag" blue><summary> æ–‡ä»¶åŠç›®å½• </summary>              <div class='content'>              <details class="folding-tag" green><summary> åˆ›å»ºå’Œåˆ é™¤ </summary>              <div class='content'>              <ol><li>æ”¹å˜å·²æœ‰æ–‡ä»¶çš„æ—¶é—´æˆ³å±æ€§æˆ–è€…touch</li><li>åˆ›å»ºç›®å½•mkdir</li><li>åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•rm</li><li>åˆ é™¤ç©ºç›®å½•rmdir</li><li>ç§»åŠ¨æ–‡ä»¶æˆ–è€…é‡å‘½ä»¤æ–‡ä»¶mv</li><li>å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•cp</li></ol>              </div>            </details><details class="folding-tag" blue><summary> ç›®å½•æ“ä½œ </summary>              <div class='content'>              <ol><li>åˆ‡æ¢ç›®å½•cd</li><li>æ˜¾ç¤ºå½“å‰è·¯å¾„pwd</li><li>æ˜¾ç¤ºç›®å½•ä¿¡æ¯ls</li><li>ä»¥æ ‘çŠ¶å›¾åˆ—å‡ºç›®å½•å†…å®¹tree</li></ol>              </div>            </details><details class="folding-tag" blue><summary> æ–‡ä»¶æ“ä½œ </summary>              <div class='content'>              <ol><li>æ˜¾ç¤ºæ–‡ä»¶æˆ–æ–‡ä»¶ç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯stat</li><li>ç”¨å­—ç¬¦ä¸²æ›¿æ¢çš„æ–¹å¼æ‰¹é‡æ”¹å˜æ–‡ä»¶årename</li><li>æå–æ–‡ä»¶è·¯å¾„åçš„æ–‡ä»¶åbasename</li><li>å»é™¤æ–‡ä»¶åä¸­çš„éç›®å½•éƒ¨åˆ†dirname</li><li>æ›´æ”¹æ–‡ä»¶å±æ€§chattr/lsattr</li><li>è¯†åˆ«æ–‡ä»¶ç±»å‹file</li><li>ç”Ÿæˆå’Œæ ¡éªŒæ–‡ä»¶çš„md5å€¼md5sum</li></ol>              </div>            </details><details class="folding-tag" blue><summary> æŸ¥æ‰¾ç›®å½•/æ–‡ä»¶ </summary>              <div class='content'>              <ol><li>æœç´¢æŒ‡å®šæ–‡ä»¶find</li><li>æŸ¥æ‰¾å‘½ä»¤æ–‡ä»¶æ‰€åœ¨ä½ç½®which</li><li>æŸ¥æ‰¾å‘½ä»¤çš„äºŒè¿›åˆ¶ç¨‹åºã€æºä»£ç æ–‡ä»¶å’Œmanæ‰‹å†Œé¡µç­‰ç›¸å…³æ–‡ä»¶çš„è·¯å¾„whereis</li><li>å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶æˆ–ç›®å½•locate</li></ol>              </div>            </details><details class="folding-tag" blue><summary> æƒé™æ“ä½œ </summary>              <div class='content'>              <ol><li>æ”¹å˜æ–‡ä»¶æˆ–ç›®å½•çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„chown</li><li>æ›´æ”¹æ–‡ä»¶ç”¨æˆ·ç»„chgrp</li><li>æ”¹å˜æ–‡ä»¶æˆ–ç›®å½•æƒé™chmod</li></ol>              </div>            </details>              </div>            </details><details class="folding-tag" green><summary> æ–‡æœ¬å¤„ç† </summary>              <div class='content'>              <details class="folding-tag" blue><summary> æŸ¥æ‰¾æ–‡æœ¬å†…å®¹ </summary>              <div class='content'>              <ol><li>æ–‡æœ¬æœç´¢å·¥å…·grep</li><li>æŸ¥æ‰¾æŒ‡å®šçš„å­—ç¬¦ä¸²egrep</li></ol>              </div>            </details><details class="folding-tag" blue><summary> æŸ¥çœ‹æ–‡æœ¬å†…å®¹ </summary>              <div class='content'>              <ol><li>åœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤ºæ–‡ä»¶å†…å®¹cat</li><li>åˆ†é¡µæ˜¾ç¤ºæ–‡æœ¬æ–‡ä»¶å†…å®¹more</li><li>åˆ†é¡µæ˜¾ç¤ºæ–‡æœ¬å†…å®¹less</li><li>æ˜¾ç¤ºæ–‡ä»¶å¼€å¤´çš„å†…å®¹head</li><li>æŸ¥çœ‹æ–‡ä»¶å°¾éƒ¨å†…å®¹tail</li><li>åå‘æ˜¾ç¤ºæ–‡ä»¶å†…å®¹tac</li><li>æ·»åŠ è¡Œå·nl</li></ol>              </div>            </details><details class="folding-tag" blue><summary> æ–‡æœ¬å†…å®¹å¤„ç† </summary>              <div class='content'>              <ol><li>ç»Ÿè®¡æ–‡æœ¬ä¿¡æ¯wc</li><li>æ–‡ä»¶åˆ†å‰²split</li><li>ä»æ–‡ä»¶ä¸­æå–æ–‡æœ¬çš„ä¸€éƒ¨åˆ†cut</li><li>åˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶paste</li><li>å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œæ’åºsort</li><li>å»é™¤æ–‡ä»¶ä¸­çš„é‡å¤è¡Œuniq</li><li>æ¯”è¾ƒæ–‡ä»¶çš„å·®å¼‚diff/patch</li><li>è¿æ¥ä¸¤ä¸ªæ–‡ä»¶join</li><li>è½¬æ¢æˆ–åˆ é™¤æ–‡ä»¶ä¸­çš„å­—ç¬¦tr</li><li>æ‰¹é‡ç¼–è¾‘æ–‡æœ¬æ–‡ä»¶sed</li><li>æ–‡æœ¬å’Œæ•°æ®è¿›è¡Œå¤„ç†çš„ç¼–ç¨‹è¯­è¨€awk</li></ol>              </div>            </details>              </div>            </details><details class="folding-tag" blue><summary> ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿ </summary>              <div class='content'>              <details class="folding-tag" blue><summary> ç£ç›˜ç›¸å…³ </summary>              <div class='content'>              <ol><li>æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ç©ºé—´du</li><li>æ˜¾ç¤ºç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µdf</li><li>å¼ºåˆ¶å°†æ›´æ”¹çš„å†…å®¹ç«‹åˆ»å†™å…¥ç£ç›˜sync</li></ol>              </div>            </details><details class="folding-tag" blue><summary> æ–‡ä»¶ç³»ç»Ÿ </summary>              <div class='content'>              <ol><li>æŠŠæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°ç›®å½•mount</li><li>å¸è½½æ–‡ä»¶ç³»ç»Ÿumount</li><li>æ‹·è´åŠè½¬æ¢æ–‡ä»¶dd</li></ol>              </div>            </details><details class="folding-tag" blue><summary> å‹ç¼©/è§£å‹ç¼© </summary>              <div class='content'>              <ol><li>æ‰“åŒ…/è§£å‹å·¥å…·tar</li><li>å‹ç¼©/è§£å‹æ–‡ä»¶zip/unzip</li><li>å‹ç¼©/è§£å‹æ–‡ä»¶gzip/gunzip</li></ol>              </div>            </details>              </div>            </details><details class="folding-tag" blue><summary> ç³»ç»Ÿç®¡ç†ä¸æ€§èƒ½ç›‘æ§ </summary>              <div class='content'>              <details class="folding-tag" blue><summary> ç³»ç»Ÿç®¡ç† </summary>              <div class='content'>              <ol><li>æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯uname</li><li>æ˜¾ç¤ºå’Œè®¾ç½®ç³»ç»Ÿçš„ä¸»æœºåhostname</li><li>æ˜¾ç¤ºå¼€æœºä¿¡æ¯dmesg</li><li>æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨æ—¶é—´åŠè´Ÿè½½ä¿¡æ¯uptime</li><li>æ˜¾ç¤ºç³»ç»Ÿå†…å­˜ä½¿ç”¨é‡æƒ…å†µfree</li><li>æ§åˆ¶shellç¨‹åºçš„èµ„æºulimit</li><li>åˆ‡æ¢ç³»ç»Ÿè¿è¡Œçº§åˆ«init</li><li>æ§åˆ¶ç³»ç»ŸæœåŠ¡service</li></ol>              </div>            </details><details class="folding-tag" blue><summary> ç³»ç»Ÿç®¡ç† </summary>              <div class='content'>              <ol><li>æ˜¾ç¤ºè™šæ‹Ÿå†…å­˜çŠ¶æ€vmstat</li><li>ç›‘è§†ç³»ç»Ÿè¾“å…¥è¾“å‡ºè®¾å¤‡å’ŒCPUçš„ä½¿ç”¨æƒ…å†µiostat</li><li>ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ç»Ÿè®¡sar</li><li>æ˜¾ç¤ºè¿›ç¨‹é—´é€šè®¯è®¾å¤‡çš„ä¿¡æ¯ipcs</li><li>åˆ é™¤ä¸€ä¸ªæˆ–æ›´å¤šçš„æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡é›†æˆ–è€…å…±äº«å†…å­˜æ ‡è¯†ipcrm</li></ol>              </div>            </details>              </div>            </details><details class="folding-tag" blue><summary> ç½‘ç»œå·¥å…· </summary>              <div class='content'>              <details class="folding-tag" blue><summary> ç½‘ç»œè·¯ç”± </summary>              <div class='content'>              <ol><li>æ˜¾ç¤ºå¹¶è®¾ç½®è·¯ç”±route</li><li>æµ‹è¯•ä¸»æœºé—´ç½‘ç»œè¿é€šæ€§ping</li><li>è¿½è¸ªæ•°æ®åŒ…åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“æ—¶çš„å…¨éƒ¨è·¯å¾„traceroute</li><li>æ˜¾ç¤ºæˆ–è®¾ç½®ç½‘ç»œè®¾å¤‡ifconfig</li><li>æ¿€æ´»/ç¦ç”¨ç½‘ç»œæ¥å£ifup/ifdown</li><li>æ˜¾ç¤ºç½‘ç»œçŠ¶æ€netstat</li><li>æ˜¾ç¤ºæ´»åŠ¨å¥—æ¥å­—ä¿¡æ¯ss</li></ol>              </div>            </details><details class="folding-tag" blue><summary> æ•°æ®ä¼ è¾“ </summary>              <div class='content'>              <ol><li>è¿œç¨‹ç™»å…¥æœåŠ¡å™¨telnet</li><li>è¿œç¨‹è¿æ¥å·¥å…·ssh</li><li>æ–‡ä»¶ä¼ è¾“åè®®å®¢æˆ·ç«¯ftp</li><li>äº¤äº’å¼çš„æ–‡ä»¶ä¼ è¾“ç¨‹åºsftp</li><li>ä¸€æ¬¾ä¼˜ç§€çš„æ–‡ä»¶å®¢æˆ·ç«¯ç¨‹åºlftp</li><li>æ–‡ä»¶ä¸‹è½½wget</li><li>è¿œç¨‹æ‹·å¤‡æ–‡ä»¶scp</li><li>æ–‡ä»¶ä¼ è¾“å·¥å…·curl</li></ol>              </div>            </details><details class="folding-tag" blue><summary> ç½‘ç»œæ“ä½œ </summary>              <div class='content'>              <ol><li>åŸŸåæŸ¥è¯¢host</li><li>ç›‘å¬ç½‘ç»œæµé‡tcpdump</li><li>è®¾ç½®è·¯ç”±å™¨nc</li></ol>              </div>            </details>              </div>            </details><details class="folding-tag" blue><summary> ç”¨æˆ·ç®¡ç† </summary>              <div class='content'>              <details class="folding-tag" blue><summary> ç”¨æˆ· </summary>              <div class='content'>              <ol><li>åˆ›å»ºå¹¶è®¾ç½®ç”¨æˆ·ä¿¡æ¯useradd</li><li>åˆ›å»ºç”¨æˆ·è´¦æˆ·adduser</li><li>ä¿®æ”¹ç”¨æˆ·çš„å¯†ç passwd</li><li>åˆ é™¤ç”¨æˆ·è´¦æˆ·userdel</li><li>åˆ‡æ¢ç”¨æˆ·èº«ä»½su</li><li>ä»¥ç³»ç»Ÿç®¡ç†å‘˜çš„èº«ä»½æ‰§è¡ŒæŒ‡ä»¤sudo</li><li>æ˜¾ç¤ºç”¨æˆ·IDå’Œç»„IDid</li></ol>              </div>            </details><details class="folding-tag" blue><summary> ç”¨æˆ·ç»„ </summary>              <div class='content'>              <ol><li>ä¿®æ”¹ç”¨æˆ·è´¦å·ä¿¡æ¯usermod</li><li>æ˜¾ç¤ºä¸€ä¸ªç”¨æˆ·æ‰€åŠ å…¥çš„æ‰€æœ‰ç”¨æˆ·ç»„groups</li><li>åˆ›å»ºæ–°çš„ç”¨æˆ·ç»„groupadd</li><li>åˆ é™¤ç”¨æˆ·ç»„groupdel</li></ol>              </div>            </details><details class="folding-tag" blue><summary> ç”¨æˆ·ä¿¡æ¯ </summary>              <div class='content'>              <ol><li>æ‰“å°å½“å‰ç™»å½•ç”¨æˆ·whoami</li><li>æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯who</li><li>æ˜¾ç¤ºå·²ç™»å½•ç”¨æˆ·w</li><li>æ˜¾ç¤ºç”¨æˆ·æˆ–ç»ˆç«¯çš„ç™»å½•æƒ…å†µlast</li><li>æ˜¾ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·users</li></ol>              </div>            </details>              </div>            </details><details class="folding-tag" blue><summary> è¿›ç¨‹ç®¡ç† </summary>              <div class='content'>              <details class="folding-tag" blue><summary> è¿›ç¨‹æŸ¥çœ‹ </summary>              <div class='content'>              <ol><li>å®æ—¶æ˜¾ç¤ºè¿›ç¨‹åŠ¨æ€top</li><li>æ˜¾ç¤ºè¿›ç¨‹çŠ¶æ€ps</li><li>ä»¥æ ‘çŠ¶å›¾æ˜¾ç¤ºè¿›ç¨‹pstree</li><li>æ£€ç´¢å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹pgrep</li><li>æ˜¾ç¤ºè¿›ç¨‹çš„å†…å­˜æ˜ åƒpmap</li><li>æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶lsof</li></ol>              </div>            </details><details class="folding-tag" blue><summary> è¿›ç¨‹æ“ä½œ </summary>              <div class='content'>              <ol><li>ç»ˆç«¯ä»»åŠ¡è°ƒåº¦jobs/bg/fg</li><li>å‘é€ä¿¡å·åˆ°è¿›ç¨‹kill</li><li>ä½¿ç”¨è¿›ç¨‹åç§°æ¥æ€æ­»è¿›ç¨‹killall</li><li>è°ƒæ•´è¿›ç¨‹çš„ä¼˜å…ˆçº§nice/renice</li><li>åå°è¿è¡Œç¨‹åºnohup</li></ol>              </div>            </details>              </div>            </details><details class="folding-tag" blue><summary> å…¶å®ƒå‘½ä»¤ </summary>              <div class='content'>              <details class="folding-tag" blue><summary> åŒ…ç®¡ç†å™¨ </summary>              <div class='content'>              <ol><li>åŒ…ç®¡ç†å™¨apt</li><li>åŒ…ç®¡ç†å™¨apt-get</li></ol>              </div>            </details><details class="folding-tag" blue><summary> ç¯å¢ƒå˜é‡ç›¸å…³ </summary>              <div class='content'>              <ol><li>è®¾ç½®æˆ–æ˜¾ç¤ºç¯å¢ƒå˜é‡export</li><li>åœ¨å½“å‰Shellç¯å¢ƒä¸­ä»æŒ‡å®šæ–‡ä»¶è¯»å–å’Œæ‰§è¡Œå‘½ä»¤source</li><li>è®¾ç½®/åˆ é™¤shellå˜é‡set/unset</li></ol>              </div>            </details><details class="folding-tag" blue><summary> ç»ˆç«¯æ“ä½œ </summary>              <div class='content'>              <ol><li>åœ¨ç»ˆç«¯è¾“å‡ºå­—ç¬¦ä¸²echo</li><li>æ ¼å¼åŒ–å¹¶è¾“å‡ºç»“æœprintf</li><li>æ¸…é™¤å±å¹•clear</li><li>æ˜¾ç¤ºä¸ç®¡ç†å†å²å‘½ä»¤è®°å½•history</li><li>ç™»å…¥/ç™»å‡ºç³»ç»Ÿlogin/logout</li><li>é€€å‡ºç»ˆç«¯/sshè¿æ¥exit</li></ol>              </div>            </details><details class="folding-tag" blue><summary> å‘½ä»¤ç›¸å…³ </summary>              <div class='content'>              <ol><li>è¿‡æ»¤å™¨xargs</li><li>è°ƒç”¨å¹¶æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤exec</li><li>è®¾ç½®/å–æ¶ˆå‘½ä»¤åˆ«åalias/unalias</li><li>æ˜¾ç¤ºæŒ‡å®šå‘½ä»¤çš„ç±»å‹type</li></ol>              </div>            </details><details class="folding-tag" blue><summary> æ—¶é—´ç›¸å…³ </summary>              <div class='content'>              <ol><li>æ˜¾ç¤ºæˆ–è®¾å®šç³»ç»Ÿæ—¥æœŸå’Œæ—¶é—´date</li><li>æ˜¾ç¤ºæ—¥å†cal</li><li>å®šæ—¶æ‰§è¡Œä»»åŠ¡crontab</li><li>æ—¶é—´æ‰§è¡Œä¸€ä¸ªä»»åŠ¡at/atq/atrm</li><li>æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œæ—¶æ‰€æ¶ˆè€—çš„æ—¶é—´time</li><li>å‘¨æœŸæ€§æ‰§è¡Œå‘½ä»¤watch</li></ol>              </div>            </details><details class="folding-tag" blue><summary> å°å·¥å…· </summary>              <div class='content'>              <ol><li>æ•°å­—è®¡ç®—å™¨bc</li><li>ä¸ºæ–‡ä»¶åˆ›å»ºå¿«æ·æ–¹å¼ln</li><li>å…³é—­/é‡å¯æœåŠ¡å™¨shutdown/halt/poweroff/reboot</li></ol>              </div>            </details>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å·¥å…·</title>
      <link href="blog/tools/"/>
      <url>blog/tools/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>1.å­¦ä¹ ç±»</p><ul><li>1.<a href="https://markdown.com.cn">Markdownè¯­æ³•</a></li><li>2.<a href="https://www.ldoceonline.com/">æœ—æ–‡è¯å…¸</a></li><li>3.<a href="https://www.macmillandictionary.com/">éº¦å…‹ç±³ä¼¦è¯å…¸</a></li><li>4.<a href="https://www.qtool.net/colorsize">é¢œè‰²è½¬æ¢å·¥å…·</a></li><li>5.<a href="https://airmore.cn/video-to-gif-online">åœ¨çº¿è§†é¢‘è½¬gifå·¥å…·</a></li><li>6.<a href="https://www.bilibili.com/video/BV18G411G7ah/?spm_id_from=333.1007.top_right_bar_window_history.content.click&amp;vd_source=58a378a1355c6a1143efc8069e63155c">åˆ¶ä½œå›¾åºŠ</a><div class="btns rounded grid5">            <a class="button" href='https://pan.baidu.com/s/17W0yrfHVZHwAfSwPJNoRBQ?pwd=yca3' title='picgoä¸‹è½½'><i class='fas fa-download'></i>picgoä¸‹è½½</a>          </div></li><li>7.<a href="https://zhuanlan.zhihu.com/p/391195241">windoså…³é—­è‡ªåŠ¨æ›´æ–°</a></li><li>8.<a href="https://www.bilibili.com/video/BV1sK411Q7S7/?spm_id_from=333.788&amp;vd_source=58a378a1355c6a1143efc8069e63155c">åšå®¢é­”æ”¹</a></li><li>9.<a href="https://www.bilibili.com/video/BV1Jd4y1L7w6/?vd_source=58a378a1355c6a1143efc8069e63155c">AIè§†é¢‘å’Œå›¾ç‰‡ä¿®å¤</a></li></ul><p>2.å¨±ä¹ç±»</p><ul><li>1.<a href="https://www.4399.com/flash/112689.htm#search3-e5f8">çš‡åŸçªè¢­æ— æ•Œç‰ˆ</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è§†é¢‘ç½‘å€</title>
      <link href="blog/videos/"/>
      <url>blog/videos/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>è§†é¢‘ç½‘å€</p>]]></content>
      
      
      <categories>
          
          <category> è§†é¢‘ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æµ‹è¯•é¡µé¢</title>
      <link href="blog/done/"/>
      <url>blog/done/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h1><p>å¦‚æœä½ çœ‹åˆ°æ­¤é¡µé¢ï¼Œè¯´æ˜ä½ å·²æˆåŠŸè¿è¡Œå¹¶éƒ¨ç½²æ­¤ç½‘ç«™ã€‚</p><p><img src="1.jpg" alt=""></p><p>ä½ å¯ä»¥æŸ¥çœ‹ï¼Œä»¥ä¸‹æ–‡æ¡£è¿›è¡Œè‡ªå®šä¹‰è®¾ç½®ã€‚</p><blockquote><p>ç½‘ç«™ä¿®æ”¹é…ç½®æ–‡æ¡£ï¼š</p></blockquote><a class="btn-beautify button--animated " href="https://guguge.gitee.io/blog/butterfly"   title="é“¾æ¥1"><i class="fas fa-download"></i><span>é“¾æ¥1</span></a><a class="btn-beautify button--animated " href="https://guguge.top/blog/butterfly"   title="é“¾æ¥2"><i class="fas fa-download"></i><span>é“¾æ¥2</span></a><hr><blockquote><p>æ–‡ç« ä¹¦å†™æ ¼å¼å‚è€ƒæ–‡æ¡£ï¼š</p></blockquote><a class="btn-beautify button--animated " href="https://guguge.gitee.io/blog/markdown"   title="é“¾æ¥1"><i class="fas fa-download"></i><span>é“¾æ¥1</span></a><a class="btn-beautify button--animated " href="https://guguge.top/blog/markdown"   title="é“¾æ¥2"><i class="fas fa-download"></i><span>é“¾æ¥2</span></a>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
